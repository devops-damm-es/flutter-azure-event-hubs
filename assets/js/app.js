!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=59)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s}));var r=n(31),i=n(1);const o=Object(r.a)("event-hubs");function s(e){Object(i.c)(e,["stack"])&&e.stack&&o.verbose(e.stack)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return c}));var r=n(81),i=n(82);function o(e){return null!=e}function s(e,t){if(!o(e)||"object"!=typeof e)return!1;for(const n of t)if(!a(e,n))return!1;return!0}function a(e,t){return"object"==typeof e&&t in e}function c(e){return function(e){const t=e;return t&&"function"==typeof t.getToken&&(void 0===t.signRequest||t.getToken.length>0)}(e)||Object(r.a)(e)||Object(i.a)(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16);t.types=r.types,t.message=r.message,t.filter=r.filter,t.uuid_to_string=r.uuid_to_string,t.generate_uuid=r.generate_uuid,t.string_to_uuid=r.string_to_uuid,t.ReceiverEvents=r.ReceiverEvents,t.SenderEvents=r.SenderEvents,t.ConnectionEvents=r.ConnectionEvents,t.SessionEvents=r.SessionEvents,t.Typed=r.Typed;var i=n(50);t.EventContext=i.EventContext;var o=n(53);t.Container=o.Container;var s=n(37);t.Connection=s.Connection;var a=n(38);t.Session=a.Session;var c=n(51);t.Receiver=c.Receiver;var u=n(41);t.Sender=u.Sender,t.SenderSendOptions=u.SenderSendOptions;var h=n(52);t.AwaitableSender=h.AwaitableSender;var d=n(26);t.AmqpResponseStatusCode=d.AmqpResponseStatusCode,t.isAmqpError=d.isAmqpError,t.delay=d.delay,t.messageHeader=d.messageHeader,t.messageProperties=d.messageProperties,t.parseConnectionString=d.parseConnectionString;var l=n(27);t.InsufficientCreditError=l.InsufficientCreditError,t.OperationTimeoutError=l.OperationTimeoutError,t.SendOperationFailedError=l.SendOperationFailedError},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s}));var r=n(31),i=n(10);const o=Object(r.a)("core-amqp");function s(e){Object(i.b)(e,["stack"])&&o.verbose(e.stack)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));const r={associatedLinkName:"associated-link-name",partitionKey:"x-opt-partition-key",sequenceNumber:"x-opt-sequence-number",enqueueSequenceNumber:"x-opt-enqueue-sequence-number",enqueuedTime:"x-opt-enqueued-time",scheduledEnqueueTime:"x-opt-scheduled-enqueue-time",offset:"x-opt-offset",lockedUntil:"x-opt-locked-until",partitionIdName:"x-opt-partition-id",publisher:"x-opt-publisher-name",viaPartitionKey:"x-opt-via-partition-key",deadLetterSource:"x-opt-deadletter-source",messageState:"x-opt-message-state",enqueuedTimeAnnotation:"amqp.annotation.x-opt-enqueued-time",offsetAnnotation:"amqp.annotation.x-opt-offset",sequenceNumberAnnotation:"amqp.annotation.x-opt-sequence-number",guidSize:16,message:"message",error:"error",statusCode:"status-code",statusDescription:"status-description",errorCondition:"error-condition",management:"$management",partition:"partition",partitionId:"partitionId",readOperation:"READ",TLS:"tls",establishConnection:"establishConnection",defaultConsumerGroup:"$default",eventHub:"eventhub",cbsEndpoint:"$cbs",cbsReplyTo:"cbs",operationPutToken:"put-token",aadEventHubsAudience:"https://eventhubs.azure.net/",aadEventHubsScope:"https://eventhubs.azure.net//.default",aadServiceBusAudience:"https://servicebus.azure.net/",aadServiceBusScope:"https://servicebus.azure.net//.default",maxUserAgentLength:512,vendorString:"com.microsoft",attachEpoch:"com.microsoft:epoch",receiverIdentifierName:"com.microsoft:receiver-name",enableReceiverRuntimeMetricName:"com.microsoft:enable-receiver-runtime-metric",timespan:"com.microsoft:timespan",uri:"com.microsoft:uri",dateTimeOffset:"com.microsoft:datetime-offset",sessionFilterName:"com.microsoft:session-filter",receiverError:"receiver_error",senderError:"sender_error",sessionError:"session_error",connectionError:"connection_error",defaultOperationTimeoutInMs:6e4,defaultConnectionIdleTimeoutInMs:6e4,managementRequestKey:"managementRequest",negotiateCbsKey:"negotiateCbs",negotiateClaim:"negotiateClaim",ensureContainerAndBlob:"ensureContainerAndBlob",defaultPrefetchCount:1e3,reconnectLimit:100,maxMessageIdLength:128,maxPartitionKeyLength:128,maxSessionIdLength:128,pathDelimiter:"/",ruleNameMaximumLength:50,maximumSqlFilterStatementLength:1024,maximumSqlRuleActionStatementLength:1024,maxDeadLetterReasonLength:4096,maxDurationValue:922337203685477,minDurationValue:-922337203685477,maxAbsoluteExpiryTime:new Date("9999-12-31T07:59:59.000Z").getTime(),aadTokenValidityMarginInMs:5e3,connectionReconnectDelay:300,defaultMaxRetries:3,defaultMaxRetriesForConnection:150,defaultDelayBetweenOperationRetriesInMs:3e4,defaultMaxDelayForExponentialRetryInMs:9e4,receiverSettleMode:"receiver-settle-mode",dispositionStatus:"disposition-status",fromSequenceNumber:"from-sequence-number",messageCount:"message-count",lockTokens:"lock-tokens",messageIdMapKey:"message-id",sequenceNumberMapKey:"sequence-number",lockTokenMapKey:"lock-token",sessionIdMapKey:"session-id",sequenceNumbers:"sequence-numbers",deadLetterReason:"deadletter-reason",deadLetterDescription:"deadletter-description",propertiesToModify:"properties-to-modify",deadLetterName:"com.microsoft:dead-letter",trackingId:"com.microsoft:tracking-id",serverTimeout:"com.microsoft:server-timeout",operations:{putToken:"put-token",read:"READ",cancelScheduledMessage:"com.microsoft:cancel-scheduled-message",scheduleMessage:"com.microsoft:schedule-message",renewLock:"com.microsoft:renew-lock",peekMessage:"com.microsoft:peek-message",receiveBySequenceNumber:"com.microsoft:receive-by-sequence-number",updateDisposition:"com.microsoft:update-disposition",renewSessionLock:"com.microsoft:renew-session-lock",setSessionState:"com.microsoft:set-session-state",getSessionState:"com.microsoft:get-session-state",enumerateSessions:"com.microsoft:get-message-sessions",addRule:"com.microsoft:add-rule",removeRule:"com.microsoft:remove-rule",enumerateRules:"com.microsoft:enumerate-rules"},descriptorCodes:{ruleDescriptionList:1335734829060,sqlFilterList:83483426822,correlationFilterList:83483426825,sqlRuleActionList:1335734829062,trueFilterList:83483426823,falseFilterList:83483426824}},i="The operation was aborted."},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));const r={name:"@azure/event-hubs",version:"5.8.0"},i={capability:"com.microsoft:idempotent-producer",epoch:"com.microsoft:producer-epoch",producerId:"com.microsoft:producer-id",producerSequenceNumber:"com.microsoft:producer-sequence-number"},o=Symbol.for("@azure/event-hubs.pendingPublishSequenceNumber")},function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return p})),n.d(t,"f",(function(){return f}));var r,i=n(0),o=n(1),s=n(2),a=n(7);function c(e){if(e&&e.wasConnectionCloseCalled){const t=new Error("The underlying AMQP connection is closed.");throw i.b.warning(`[${e.connectionId}] ${t.name}: ${t.message}`),Object(i.a)(t),t}}function u(e,t,n,r){if(!Object(o.b)(r)){const r=new TypeError(`${t} called without required argument "${n}"`);throw i.b.warning(`[${e}] ${r.name}: ${r.message}`),Object(i.a)(r),r}}!function(e){e["com.microsoft:out-of-order-sequence"]="SequenceOutOfOrderError",e["com.microsoft:producer-epoch-stolen"]="ProducerDisconnectedError"}(r||(r={}));const h=new Set(["ProducerDisconnectedError","SequenceOutOfOrderError"]);function d(e){const t=Object(a.e)(e);if(!Object(a.d)(t)||!Object(s.isAmqpError)(e)||t.code)return t;const n=e.condition;return n?(t.code=r[n],t.code&&(t.retryable=!h.has(t.code)),t):t}const l="These events have already been successfully published. When idempotent publishing is enabled, events that were acknowledged by the Event Hubs service may not be published again.",p="1 or more of these events have already been successfully published. When idempotent publishing is enabled, events that were acknowledged by the Event Hubs service may not be published again.";function f({enableIdempotentRetries:e,partitionId:t,partitionKey:n}){if(e&&(Object(o.b)(n)||!Object(o.b)(t)))throw new Error('The "partitionId" must be supplied and "partitionKey" must not be provided when the EventHubProducerClient has "enableIdempotentRetries" set to true.');if(Object(o.b)(t)&&Object(o.b)(n))throw new Error(`The partitionId (${t}) and partitionKey (${n}) cannot both be specified.`)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return h})),n.d(t,"c",(function(){return d})),n.d(t,"e",(function(){return m}));var r,i,o,s=n(2),a=n(10),c=n(11);!function(e){e[e["com.microsoft:timeout"]=408]="com.microsoft:timeout",e[e["amqp:not-found"]=404]="amqp:not-found",e[e["amqp:not-implemented"]=501]="amqp:not-implemented",e[e["com.microsoft:entity-already-exists"]=409]="com.microsoft:entity-already-exists",e[e["com.microsoft:message-lock-lost"]=410]="com.microsoft:message-lock-lost",e[e["com.microsoft:session-lock-lost"]=410]="com.microsoft:session-lock-lost",e[e["com.microsoft:no-matching-subscription"]=500]="com.microsoft:no-matching-subscription",e[e["amqp:link:message-size-exceeded"]=403]="amqp:link:message-size-exceeded",e[e["com.microsoft:server-busy"]=503]="com.microsoft:server-busy",e[e["com.microsoft:argument-error"]=400]="com.microsoft:argument-error",e[e["com.microsoft:argument-out-of-range"]=400]="com.microsoft:argument-out-of-range",e[e["com.microsoft:store-lock-lost"]=410]="com.microsoft:store-lock-lost",e[e["com.microsoft:session-cannot-be-locked"]=410]="com.microsoft:session-cannot-be-locked",e[e["com.microsoft:partition-not-owned"]=410]="com.microsoft:partition-not-owned",e[e["com.microsoft:entity-disabled"]=400]="com.microsoft:entity-disabled",e[e["com.microsoft:publisher-revoked"]=401]="com.microsoft:publisher-revoked",e[e["amqp:link:stolen"]=410]="amqp:link:stolen",e[e["amqp:not-allowed"]=400]="amqp:not-allowed",e[e["amqp:unauthorized-access"]=401]="amqp:unauthorized-access",e[e["amqp:resource-limit-exceeded"]=403]="amqp:resource-limit-exceeded"}(r||(r={})),function(e){e["com.microsoft:address-already-in-use"]="AddressAlreadyInUseError",e["com.microsoft:store-lock-lost"]="StoreLockLostError",e["com.microsoft:no-matching-subscription"]="NoMatchingSubscriptionError",e["com.microsoft:partition-not-owned"]="PartitionNotOwnedError",e["com.microsoft:publisher-revoked"]="PublisherRevokedError",e["com.microsoft:entity-already-exists"]="MessagingEntityAlreadyExistsError",e["com.microsoft:entity-disabled"]="MessagingEntityDisabledError",e["com.microsoft:message-lock-lost"]="MessageLockLostError",e["com.microsoft:session-lock-lost"]="SessionLockLostError",e["com.microsoft:session-cannot-be-locked"]="SessionCannotBeLockedError",e["amqp:internal-error"]="InternalServerError",e["amqp:not-found"]="ServiceCommunicationError",e["com.microsoft:message-not-found"]="MessageNotFoundError",e["com.microsoft:relay-not-found"]="RelayNotFoundError",e["amqp:not-implemented"]="NotImplementedError",e["amqp:not-allowed"]="InvalidOperationError",e["amqp:resource-limit-exceeded"]="QuotaExceededError",e["amqp:unauthorized-access"]="UnauthorizedError",e["com.microsoft:auth-failed"]="UnauthorizedError",e["com.microsoft:timeout"]="ServiceUnavailableError",e["com.microsoft:message-wait-timeout"]="MessageWaitTimeout",e["com.microsoft:argument-out-of-range"]="ArgumentOutOfRangeError",e["amqp:precondition-failed"]="PreconditionFailedError",e["com.microsoft:precondition-failed"]="PreconditionFailedError",e["amqp:decode-error"]="DecodeError",e["amqp:invalid-field"]="InvalidFieldError",e["amqp:resource-locked"]="ResourceLockedError",e["amqp:resource-deleted"]="ResourceDeletedError",e["amqp:illegal-state"]="IllegalStateError",e["amqp:frame-size-too-small"]="FrameSizeTooSmallError",e["amqp:link:detach-forced"]="DetachForcedError",e["amqp:link:transfer-limit-exceeded"]="TransferLimitExceededError",e["amqp:link:message-size-exceeded"]="MessageTooLargeError",e["amqp:link:redirect"]="LinkRedirectError",e["amqp:link:stolen"]="ReceiverDisconnectedError",e["amqp:session:window-violation"]="SessionWindowViolationError",e["amqp:session:errant-link"]="ErrantLinkError",e["amqp:session:handle-in-use"]="HandleInUseError",e["amqp:session:unattached-handle"]="UnattachedHandleError",e["amqp:connection:forced"]="ConnectionForcedError",e["amqp:connection:framing-error"]="FramingError",e["amqp:connection:redirect"]="ConnectionRedirectError",e["com.microsoft:server-busy"]="ServerBusyError",e["com.microsoft:argument-error"]="ArgumentError",e["com.microsoft:operation-cancelled"]="OperationCancelledError",e["client.sender:not-enough-link-credit"]="SenderBusyError",e["system:error"]="SystemError"}(i||(i={})),function(e){e.AddressAlreadyInUseError="com.microsoft:address-already-in-use",e.StoreLockLostError="com.microsoft:store-lock-lost",e.NoMatchingSubscriptionError="com.microsoft:no-matching-subscription",e.PartitionNotOwnedError="com.microsoft:partition-not-owned",e.PublisherRevokedError="com.microsoft:publisher-revoked",e.MessagingEntityAlreadyExistsError="com.microsoft:entity-already-exists",e.MessagingEntityDisabledError="com.microsoft:entity-disabled",e.MessageLockLostError="com.microsoft:message-lock-lost",e.SessionLockLostError="com.microsoft:session-lock-lost",e.SessionCannotBeLockedError="com.microsoft:session-cannot-be-locked",e.InternalServerError="amqp:internal-error",e.ServiceCommunicationError="amqp:not-found",e.MessageNotFoundError="com.microsoft:message-not-found",e.RelayNotFoundError="com.microsoft:relay-not-found",e.NotImplementedError="amqp:not-implemented",e.InvalidOperationError="amqp:not-allowed",e.QuotaExceededError="amqp:resource-limit-exceeded",e.UnauthorizedError="amqp:unauthorized-access",e.ServiceUnavailableError="com.microsoft:timeout",e.MessageWaitTimeout="com.microsoft:message-wait-timeout",e.ArgumentOutOfRangeError="com.microsoft:argument-out-of-range",e.PreconditionFailedError="amqp:precondition-failed",e.DecodeError="amqp:decode-error",e.InvalidFieldError="amqp:invalid-field",e.ResourceLockedError="amqp:resource-locked",e.ResourceDeletedError="amqp:resource-deleted",e.IllegalStateError="amqp:illegal-state",e.FrameSizeTooSmallError="amqp:frame-size-too-small",e.DetachForcedError="amqp:link:detach-forced",e.TransferLimitExceededError="amqp:link:transfer-limit-exceeded",e.MessageTooLargeError="amqp:link:message-size-exceeded",e.LinkRedirectError="amqp:link:redirect",e.ReceiverDisconnectedError="amqp:link:stolen",e.SessionWindowViolationError="amqp:session:window-violation",e.ErrantLinkError="amqp:session:errant-link",e.HandleInUseError="amqp:session:handle-in-use",e.UnattachedHandleError="amqp:session:unattached-handle",e.ConnectionForcedError="amqp:connection:forced",e.FramingError="amqp:connection:framing-error",e.ConnectionRedirectError="amqp:connection:redirect",e.ServerBusyError="com.microsoft:server-busy",e.ArgumentError="com.microsoft:argument-error",e.OperationCancelledError="com.microsoft:operation-cancelled",e.SenderBusyError="client.sender:not-enough-link-credit",e.SystemError="system:error"}(o||(o={}));const u=["address","code","errno","info","port","stack","syscall"];function h(e){return"MessagingError"===e.name}class d extends Error{constructor(e,t){if(super(e),this.name="MessagingError",this.retryable=!0,t)for(const e of u)null!=t[e]&&(this[e]=t[e])}}const l=["InternalServerError","ServerBusyError","ServiceUnavailableError","OperationCancelledError","UnauthorizedError","OperationTimeoutError","SenderBusyError","MessagingError","DetachForcedError","ConnectionForcedError","TransferLimitExceededError","InsufficientCreditError"];var p;!function(e){e.ENOTFOUND="amqp:not-found",e.EBUSY="com.microsoft:server-busy",e.ECONNREFUSED="amqp:connection:forced",e.ETIMEDOUT="com.microsoft:timeout",e.ECONNRESET="com.microsoft:timeout",e.ENETDOWN="com.microsoft:timeout",e.EHOSTDOWN="com.microsoft:timeout",e.ENETRESET="com.microsoft:timeout",e.ENETUNREACH="com.microsoft:timeout",e.ENONET="com.microsoft:timeout"}(p||(p={}));const f=["OperationTimeoutError","InsufficientCreditError","SendOperationFailedError"];function m(e){if(!Object(a.a)(e))return new Error("Unknown error encountered.");if("object"!=typeof e)return new Error(e);if(e instanceof TypeError||e instanceof RangeError)return e;if(t=e,Object(s.isAmqpError)(t)){const t=e.condition,n=e.description,r=new d(n);return e.stack&&(r.stack=e.stack),r.info=e.info,t&&(r.code=i[t]),n&&(n.includes("status-code: 404")||null!==n.match(/The messaging entity .* could not be found.*/i))&&(r.code="MessagingEntityNotFoundError"),r.code&&-1===l.indexOf(r.code)&&(r.retryable=!1),r}var t;if("MessagingError"===e.name)return e;if(function(e){return!!Object(a.b)(e,["code","syscall","errno"])&&(!(!Object(c.e)(e.code)||!Object(c.e)(e.syscall))&&!(!Object(c.e)(e.errno)&&!Object(c.d)(e.errno)))}(e)){const t=e.code,n=e.message,r=new d(n,e);let o="SystemError";if(t){const e=p[t];o=i[e]}return-1===l.indexOf(o)&&(r.retryable=!1),r}if(function(e){let t=!1;return!c.c&&self&&"error"===e.type&&e.target instanceof self.WebSocket&&(t=!0),t}(e)){const e=new d("Websocket connection failed.");return e.code=i[o.ServiceCommunicationError],e.retryable=!1,e}if(-1!==f.indexOf(e.name)){const t=new d(e.message,e);return t.code=e.name,t.code&&-1===l.indexOf(t.code)&&(t.retryable=!1),t}return e}},function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return h}));const r={span:Symbol.for("@azure/core-tracing span"),namespace:Symbol.for("@azure/core-tracing namespace")};function i(e={}){let t=new o(e.parentContext);return e.span&&(t=t.setValue(r.span,e.span)),e.namespace&&(t=t.setValue(r.namespace,e.namespace)),t}class o{constructor(e){this._contextMap=e instanceof o?new Map(e._contextMap):new Map}setValue(e,t){const n=new o(this);return n._contextMap.set(e,t),n}getValue(e){return this._contextMap.get(e)}deleteValue(e){const t=new o(this);return t._contextMap.delete(e),t}}let s;function a(){return s||(s={createRequestHeaders:()=>({}),parseTraceparentHeader:()=>{},startSpan:(e,t)=>({span:{end:()=>{},isRecording:()=>!1,recordException:()=>{},setAttribute:()=>{},setStatus:()=>{}},tracingContext:i({parentContext:t.tracingContext})}),withContext:(e,t,...n)=>t(...n)}),s}var c=n(5);const u=function(e){const{namespace:t,packageName:n,packageVersion:i}=e;function o(e,o,s){var c;const u=a().startSpan(e,Object.assign(Object.assign({},s),{packageName:n,packageVersion:i,tracingContext:null===(c=null==o?void 0:o.tracingOptions)||void 0===c?void 0:c.tracingContext}));let h=u.tracingContext;const d=u.span;h.getValue(r.namespace)||(h=h.setValue(r.namespace,t)),d.setAttribute("az.namespace",h.getValue(r.namespace));return{span:d,updatedOptions:Object.assign({},o,{tracingOptions:Object.assign(Object.assign({},null==o?void 0:o.tracingOptions),{tracingContext:h})})}}function s(e,t,...n){return a().withContext(e,t,...n)}return{startSpan:o,withSpan:async function(e,t,n,r){const{span:i,updatedOptions:a}=o(e,t,r);try{const e=await s(a.tracingOptions.tracingContext,()=>Promise.resolve(n(a,i)));return i.setStatus({status:"success"}),e}catch(e){throw i.setStatus({status:"error",error:e}),e}finally{i.end()}},withContext:s,parseTraceparentHeader:function(e){return a().parseTraceparentHeader(e)},createRequestHeaders:function(e){return a().createRequestHeaders(e)}}}({namespace:"Microsoft.EventHub",packageName:c.c.name,packageVersion:c.c.version});function h(e,t){const n={spanAttributes:{"message_bus.destination":e.entityPath,"peer.address":e.host}};return t&&(n.spanKind=t),n}},,function(e,t,n){"use strict";function r(e){return null!=e}function i(e,t){if(!r(e)||"object"!=typeof e)return!1;for(const n of t)if(!o(e,n))return!1;return!0}function o(e,t){return"object"==typeof e&&t in e}function s(e){return i(e,["isSasTokenProvider"])&&!0===e.isSasTokenProvider}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s}))},function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"d",(function(){return p}));var r,i=n(33),o=n(55),s=n(4),a=n(10);const c=void 0!==e&&Boolean(e.version)&&Boolean(null===(r=e.versions)||void 0===r?void 0:r.node);function u(e){const t={},n=e.trim().split(";");for(let e of n){if(e=e.trim(),""===e)continue;const n=e.indexOf("=");if(-1===n)throw new Error("Connection string malformed: each part of the connection string must have an `=` assignment.");const r=e.substring(0,n).trim();if(""===r)throw new Error("Connection string malformed: missing key for assignment");const i=e.substring(n+1).trim();t[r]=i}return t}const h=new o.a;function d(e,t,n,r){return new Promise((o,c)=>{let u=void 0,h=void 0;const d=()=>c(new i.b(n||s.b)),l=()=>{t&&h&&t.removeEventListener("abort",h)};if(h=()=>(Object(a.a)(u)&&clearTimeout(u),l(),d()),t&&t.aborted)return d();u=setTimeout(()=>{l(),o(r)},e),t&&t.addEventListener("abort",h)})}function l(e){return"string"==typeof e}function p(e){return"number"==typeof e}}).call(this,n(12))},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],h=!1,d=-1;function l(){h&&c&&(h=!1,c.length?u=c.concat(u):d=-1,u.length&&p())}function p(){if(!h){var e=a(l);h=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,h=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||h||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(62),i=n(63),o=n(64);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=l(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|f(t,n),i=(e=a(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):l(e,t);if("Buffer"===t.type&&o(t.data))return l(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(h(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function l(e,t){var n=t.length<0?0:0|p(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return H(e).length;default:if(r)return B(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return k(this,t,n);case"latin1":case"binary":return P(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function _(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:g(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):g(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var h=-1;for(o=n;o<a;o++)if(u(e,o)===u(t,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===c)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var d=!0,l=0;l<c;l++)if(u(e,o+l)!==u(t,l)){d=!1;break}if(d)return o}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function y(e,t,n,r){return F(B(t,e.length-n),e,n,r)}function w(e,t,n,r){return F(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function E(e,t,n,r){return w(e,t,n,r)}function S(e,t,n,r){return F(H(t),e,n,r)}function O(e,t,n,r){return F(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function C(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,u=e[i],h=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(h=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(h=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,d=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return h(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)_(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)_(this,t,t+3),_(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)_(this,t,t+7),_(this,t+1,t+6),_(this,t+2,t+5),_(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(r,i),h=e.slice(t,n),d=0;d<a;++d)if(u[d]!==h[d]){o=u[d],s=h[d];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function k(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function P(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function x(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=U(e[o]);return i}function T(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function A(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function j(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function M(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function N(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function L(e,t,n,r,o){return o||N(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function q(e,t,n,r,o){return o||N(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||A(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||A(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||A(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||A(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||A(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||A(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||A(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||A(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||A(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):j(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):j(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);R(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);R(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):j(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):j(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return L(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return L(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return q(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return q(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=c.isBuffer(e)?e:B(new c(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var $=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function H(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace($,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(61))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(4),i=n(1);function o(e){return!Object(i.b)(e)||"number"!=typeof e.timeoutInMs||!isFinite(e.timeoutInMs)||e.timeoutInMs<r.a.defaultOperationTimeoutInMs?r.a.defaultOperationTimeoutInMs:e.timeoutInMs}},,function(e,t,n){"use strict";(function(t){var r=n(60),i=n(20),o=n(46),s=n(19),a=n(75),c=n(48),u=n(49),h=n(21).EventEmitter,d=function(e){this.options=e?Object.create(e):{},this.options.id||(this.options.id=s.generate_uuid()),this.id=this.options.id,this.sasl_server_mechanisms=o.server_mechanisms()};(d.prototype=Object.create(h.prototype)).constructor=d,d.prototype.dispatch=function(e){return i.events("[%s] Container got event: "+e,this.id),h.prototype.emit.apply(this,arguments),!!this.listeners(e).length},d.prototype.connect=function(e){return new r(e,this).connect()},d.prototype.create_connection=function(e){return new r(e,this)},d.prototype.listen=function(e){var n,i=this;if(void 0===e.transport||"tcp"===e.transport)(n=c.createServer()).on("connection",(function(t){new r(e,i).accept(t)}));else{if("tls"!==e.transport&&"ssl"!==e.transport)throw Error("Unrecognised transport: "+e.transport);(n=u.createServer(e)).on("secureConnection",(function(t){new r(e,i).accept(t)}))}return t.version.match(/v0\.10\.\d+/)?n.listen(e.port,e.host):n.listen(e),n},d.prototype.create_container=function(e){return new d(e)},d.prototype.get_option=function(e,t){return void 0!==this.options[e]?this.options[e]:t},d.prototype.generate_uuid=s.generate_uuid,d.prototype.string_to_uuid=s.string_to_uuid,d.prototype.uuid_to_string=s.uuid_to_string;var l=n(76);d.prototype.websocket_accept=function(e,t){new r(t,this).accept(l.wrap(e))},d.prototype.websocket_connect=l.connect,d.prototype.filter=n(77),d.prototype.types=n(18),d.prototype.message=n(36),d.prototype.sasl=o,d.prototype.ReceiverEvents=a.ReceiverEvents,d.prototype.SenderEvents=a.SenderEvents,d.prototype.SessionEvents=a.SessionEvents,d.prototype.ConnectionEvents=a.ConnectionEvents,e.exports=new d}).call(this,n(12))},function(e,t,n){"use strict";var r=n(34);function i(e){Error.call(this),this.message=e,this.name="ProtocolError"}function o(e){i.call(this,e),this.message=e,this.name="TypeError"}function s(e,t,n){Error.call(this,e),this.message=e,this.name="ConnectionError",this.condition=t,this.description=e,Object.defineProperty(this,"connection",{value:n})}r.inherits(i,Error),r.inherits(o,i),r.inherits(s,Error),s.prototype.toJSON=function(){return{type:this.name,code:this.condition,message:this.description}},e.exports={ProtocolError:i,TypeError:o,ConnectionError:s}},function(e,t,n){"use strict";(function(t){var r=n(17),i=n(19);function o(e,t,n,r){this.type=e,this.value=t,n&&(this.array_constructor={typecode:n},r&&(this.array_constructor.descriptor=r))}function s(e,t,n,r){this.name=e,this.typecode=t;var i=t>>>4;switch(i){case 4:this.width=0,this.category=1;break;case 5:this.width=1,this.category=1;break;case 6:this.width=2,this.category=1;break;case 7:this.width=4,this.category=1;break;case 8:this.width=8,this.category=1;break;case 9:this.width=16,this.category=1;break;case 10:this.width=1,this.category=2;break;case 11:this.width=4,this.category=2;break;case 12:this.width=1,this.category=3;break;case 13:this.width=4,this.category=3;break;case 14:this.width=1,this.category=4;break;case 15:this.width=4,this.category=4}n&&(n.read&&(this.read=n.read),n.write&&(this.write=n.write),n.encoding&&(this.encoding=n.encoding));var s=this;this.create=4===i?function(){return new o(s,r)}:14===i||15===i?function(e,t,n){return new o(s,e,t,n)}:function(e){return new o(s,e)}}function a(e){return Number(e).toString(16)}o.prototype.toString=function(){return this.value?this.value.toString():null},o.prototype.toLocaleString=function(){return this.value?this.value.toLocaleString():null},o.prototype.valueOf=function(){return this.value},o.prototype.toJSON=function(){return this.value&&this.value.toJSON?this.value.toJSON():this.value},o.prototype.toRheaTyped=function(){return this},s.prototype.toString=function(){return this.name+"#"+a(this.typecode)};var c={by_code:{}};function u(e,t,n,r){var i=new s(e,t,n,r);i.create.typecode=i.typecode,c.by_code[i.typecode]=i,c[e]=i.create}Object.defineProperty(c,"MAX_UINT",{value:4294967295,writable:!1,configurable:!1}),Object.defineProperty(c,"MAX_USHORT",{value:65535,writable:!1,configurable:!1});function h(e,t,n){if("number"==typeof t||t instanceof Number){var r=Math.abs(t),i=Math.floor(r/4294967296),o=r%4294967296;if(e.writeInt32BE(i,n),e.writeUInt32BE(o,n+4),t<0)for(var s=1,a=0;a<8;a++){var c=n+(7-a),u=(255^e[c])+s;e[c]=255&u,s=u>>8}}else t.copy(e,n)}function d(e,t){var n=e.readInt32BE(t),r=e.readUInt32BE(t+4);return n<2097153&&n>-2097153?4294967296*n+r:e.slice(t,t+8)}function l(e,t){for(var n=0;n<t.length;n++)if(e.type.typecode===t[n].typecode)return!0;return!1}function p(e,t,n){for(var r=0;r<t&&r<e.length;r++)if(e[r]!==(n?255:0))return!1;return!0}function f(e){for(var t={},n=0;n+1<e.length;)t[e[n++]]=e[n++];return t}u("Null",64,void 0,null),u("Boolean",86,{read:function(e,t){return e.readUInt8(t)},write:function(e,t,n){e.writeUInt8(t,n)}}),u("True",65,void 0,!0),u("False",66,void 0,!1),u("Ubyte",80,{read:function(e,t){return e.readUInt8(t)},write:function(e,t,n){e.writeUInt8(t,n)}}),u("Ushort",96,{read:function(e,t){return e.readUInt16BE(t)},write:function(e,t,n){e.writeUInt16BE(t,n)}}),u("Uint",112,{read:function(e,t){return e.readUInt32BE(t)},write:function(e,t,n){e.writeUInt32BE(t,n)}}),u("SmallUint",82,{read:function(e,t){return e.readUInt8(t)},write:function(e,t,n){e.writeUInt8(t,n)}}),u("Uint0",67,void 0,0),u("Ulong",128,{write:function(e,t,n){if("number"==typeof t||t instanceof Number){var r=Math.floor(t/4294967296),i=t%4294967296;e.writeUInt32BE(r,n),e.writeUInt32BE(i,n+4)}else t.copy(e,n)},read:function(e,t){var n=e.readUInt32BE(t),r=e.readUInt32BE(t+4);return n<2097153?4294967296*n+r:e.slice(t,t+8)}}),u("SmallUlong",83,{read:function(e,t){return e.readUInt8(t)},write:function(e,t,n){e.writeUInt8(t,n)}}),u("Ulong0",68,void 0,0),u("Byte",81,{read:function(e,t){return e.readInt8(t)},write:function(e,t,n){e.writeInt8(t,n)}}),u("Short",97,{read:function(e,t){return e.readInt16BE(t)},write:function(e,t,n){e.writeInt16BE(t,n)}}),u("Int",113,{read:function(e,t){return e.readInt32BE(t)},write:function(e,t,n){e.writeInt32BE(t,n)}}),u("SmallInt",84,{read:function(e,t){return e.readInt8(t)},write:function(e,t,n){e.writeInt8(t,n)}}),u("Long",129,{write:h,read:d}),u("SmallLong",85,{read:function(e,t){return e.readInt8(t)},write:function(e,t,n){e.writeInt8(t,n)}}),u("Float",114,{read:function(e,t){return e.readFloatBE(t)},write:function(e,t,n){e.writeFloatBE(t,n)}}),u("Double",130,{read:function(e,t){return e.readDoubleBE(t)},write:function(e,t,n){e.writeDoubleBE(t,n)}}),u("Decimal32",116),u("Decimal64",132),u("Decimal128",148),u("CharUTF32",115,{read:function(e,t){return e.readUInt32BE(t)},write:function(e,t,n){e.writeUInt32BE(t,n)}}),u("Timestamp",131,{write:function(e,t,n){return"object"==typeof t&&null!==t&&"function"==typeof t.getTime&&(t=t.getTime()),h(e,t,n)},read:function(e,t){const n=d(e,t);return new Date(n)}}),u("Uuid",152),u("Vbin8",160),u("Vbin32",176),u("Str8",161,{encoding:"utf8"}),u("Str32",177,{encoding:"utf8"}),u("Sym8",163,{encoding:"ascii"}),u("Sym32",179,{encoding:"ascii"}),u("List0",69,void 0,[]),u("List8",192),u("List32",208),u("Map8",193),u("Map32",209),u("Array8",224),u("Array32",240),c.is_ulong=function(e){return l(e,[c.Ulong,c.Ulong0,c.SmallUlong])},c.is_string=function(e){return l(e,[c.Str8,c.Str32])},c.is_symbol=function(e){return l(e,[c.Sym8,c.Sym32])},c.is_list=function(e){return l(e,[c.List0,c.List8,c.List32])},c.is_map=function(e){return l(e,[c.Map8,c.Map32])},c.wrap_boolean=function(e){return e?c.True():c.False()},c.wrap_ulong=function(e){return t.isBuffer(e)?p(e,8,!1)?c.Ulong0():p(e,7,!1)?c.SmallUlong(e[7]):c.Ulong(e):0===e?c.Ulong0():e>255?c.Ulong(e):c.SmallUlong(e)},c.wrap_uint=function(e){return 0===e?c.Uint0():e>255?c.Uint(e):c.SmallUint(e)},c.wrap_ushort=function(e){return c.Ushort(e)},c.wrap_ubyte=function(e){return c.Ubyte(e)},c.wrap_long=function(e){if(t.isBuffer(e)){var n=0!=(128&e[0]);return p(e,7,n)&&(128&e[7])==(n?128:0)?c.SmallLong(n?-(1+(255^e[7])):e[7]):c.Long(e)}return e>127||e<-128?c.Long(e):c.SmallLong(e)},c.wrap_int=function(e){return e>127||e<-128?c.Int(e):c.SmallInt(e)},c.wrap_short=function(e){return c.Short(e)},c.wrap_byte=function(e){return c.Byte(e)},c.wrap_float=function(e){return c.Float(e)},c.wrap_double=function(e){return c.Double(e)},c.wrap_timestamp=function(e){return c.Timestamp(e)},c.wrap_char=function(e){return c.CharUTF32(e)},c.wrap_uuid=function(e){return c.Uuid(e)},c.wrap_binary=function(e){return e.length>255?c.Vbin32(e):c.Vbin8(e)},c.wrap_string=function(e){return t.byteLength(e)>255?c.Str32(e):c.Str8(e)},c.wrap_symbol=function(e){return t.byteLength(e)>255?c.Sym32(e):c.Sym8(e)},c.wrap_list=function(e){if(0===e.length)return c.List0();var t=e.map(c.wrap);return c.List32(t)},c.wrap_set_as_list=function(e){if(0===e.size)return c.List0();var t=Array.from(e,c.wrap);return c.List32(t)},c.wrap_map=function(e,t){var n=[];for(var r in e)n.push(t?t(r):c.wrap(r)),n.push(c.wrap(e[r]));return c.Map32(n)},c.wrap_map_as_map=function(e){var t=[];for(var[n,r]of e)t.push(c.wrap(n)),t.push(c.wrap(r));return c.Map32(t)},c.wrap_symbolic_map=function(e){return c.wrap_map(e,c.wrap_symbol)},c.wrap_array=function(e,t,n){if(t)return c.Array32(e,t,n);throw console.trace("An array must specify a type for its elements"),new r.TypeError("An array must specify a type for its elements")},c.wrap=function(e){var n=typeof e;return"object"===n&&null!==e&&"function"==typeof e.toRheaTyped?e.toRheaTyped():"string"===n?c.wrap_string(e):"boolean"===n?e?c.True():c.False():"number"===n||e instanceof Number?isNaN(e)?c.Null():Math.floor(e)-e!=0?c.Double(e):e>0?e<4294967296?c.wrap_uint(e):c.wrap_ulong(e):e>-2147483647?c.wrap_int(e):c.wrap_long(e):e instanceof Date?c.wrap_timestamp(e.getTime()):e instanceof t||e instanceof Uint8Array?c.wrap_binary(e):"undefined"===n||null===e?c.Null():Array.isArray(e)?c.wrap_list(e):e instanceof Map?c.wrap_map_as_map(e):e instanceof Set?c.wrap_set_as_list(e):c.wrap_map(e)},c.wrap_described=function(e,t){var n=c.wrap(e);return t&&("string"==typeof t?n=c.described(c.wrap_symbol(t),n):("number"==typeof t||t instanceof Number)&&(n=c.described(c.wrap_ulong(t),n))),n},c.wrap_message_id=function(e){var n=typeof e;if("string"===n)return c.wrap_string(e);if("number"===n||e instanceof Number)return c.wrap_ulong(e);if(t.isBuffer(e))return c.wrap_uuid(e);throw new r.TypeError("invalid message id:"+e)};var m,_,v={};function g(e){var t=c.by_code[e];if(!t)throw new r.TypeError("Unrecognised typecode: "+a(e));return t}function b(e,t){if(null!=t){if(Array.isArray(t)){if(!e.multiple)throw new r.TypeError("Field "+e.name+" does not support multiple values, got "+JSON.stringify(t));var n=function(e){if("symbol"===e)return{typecode:c.Sym8.typecode};throw new r.TypeError("TODO: Array of type "+e+" not yet supported")}(e.type);return c.wrap_array(t,n.typecode,n.descriptor)}if("*"===e.type)return t;var i=c["wrap_"+e.type];if(i)return i(t);throw new r.TypeError("No wrapper for field "+e.name+" of type "+e.type)}if(e.mandatory)throw new r.TypeError("Field "+e.name+" is mandatory");return c.Null()}function y(e,t){return{get:"*"===t.type?function(){return this.value[e]}:function(){return c.unwrap(this.value[e])},set:function(n){this.value[e]=b(t,n)},enumerable:!0,configurable:!1}}c.unwrap_map_simple=function(e){return f(e.value.map((function(e){return c.unwrap(e,!0)})))},c.unwrap=function(e,t){if(e instanceof o){if(e.descriptor){var n=v[e.descriptor.value];if(n)return new n(e.value);if(t)return e}var r=c.unwrap(e.value,!0);return c.is_map(e)?f(r):r}return Array.isArray(e)?e.map((function(e){return c.unwrap(e,!0)})):e},c.described_nc=function(e,t){return e.length?(t.descriptor=e.shift(),c.described(e,t)):(t.descriptor=e,t)},c.described=c.described_nc,c.Reader=function(e){this.buffer=e,this.position=0},c.Reader.prototype.read_typecode=function(){return this.read_uint(1)},c.Reader.prototype.read_uint=function(e){var t=this.position;if(this.position+=e,1===e)return this.buffer.readUInt8(t);if(2===e)return this.buffer.readUInt16BE(t);if(4===e)return this.buffer.readUInt32BE(t);throw new r.TypeError("Unexpected width for uint "+e)},c.Reader.prototype.read_fixed_width=function(e){var t=this.position;return this.position+=e.width,e.read?e.read(this.buffer,t):this.buffer.slice(t,this.position)},c.Reader.prototype.read_variable_width=function(e){var t=this.read_uint(e.width),n=this.read_bytes(t);return e.encoding?n.toString(e.encoding):n},c.Reader.prototype.read=function(){var e=this.read_constructor(),t=this.read_value(g(e.typecode));return e.descriptor?c.described_nc(e.descriptor,t):t},c.Reader.prototype.read_constructor=function(e){var t=this.read_typecode();return 0===t?(void 0===e&&(e=[]),e.push(this.read()),this.read_constructor(e)):void 0===e?{typecode:t}:1===e.length?{typecode:t,descriptor:e[0]}:{typecode:t,descriptor:e[0],descriptors:e}},c.Reader.prototype.read_value=function(e){if(0===e.width)return e.create();if(1===e.category)return e.create(this.read_fixed_width(e));if(2===e.category)return e.create(this.read_variable_width(e));if(3===e.category)return this.read_compound(e);if(4===e.category)return this.read_array(e);throw new r.TypeError("Invalid category for type: "+e)},c.Reader.prototype.read_array_items=function(e,t){for(var n=[];n.length<e;)n.push(this.read_value(t));return n},c.Reader.prototype.read_n=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this.read();return t},c.Reader.prototype.read_size_count=function(e){return{size:this.read_uint(e),count:this.read_uint(e)}},c.Reader.prototype.read_compound=function(e){var t=this.read_size_count(e.width);return e.create(this.read_n(t.count))},c.Reader.prototype.read_array=function(e){var t=this.read_size_count(e.width),n=this.read_constructor();return e.create(this.read_array_items(t.count,g(n.typecode)),n.typecode,n.descriptor)},c.Reader.prototype.toString=function(){var e="buffer@"+this.position;this.position&&(e+=": ");for(var t=this.position;t<this.buffer.length;t++)t>0&&(e+=","),e+="0x"+Number(this.buffer[t]).toString(16);return e},c.Reader.prototype.reset=function(){this.position=0},c.Reader.prototype.skip=function(e){this.position+=e},c.Reader.prototype.read_bytes=function(e){var t=this.position;return this.position+=e,this.buffer.slice(t,this.position)},c.Reader.prototype.remaining=function(){return this.buffer.length-this.position},c.Writer=function(e){this.buffer=e||i.allocate_buffer(1024),this.position=0},c.Writer.prototype.toBuffer=function(){return this.buffer.slice(0,this.position)},c.Writer.prototype.ensure=function(e){if(this.buffer.length<e){var t=i.allocate_buffer((n=2*this.buffer.length)>(r=e)?n:r);this.buffer.copy(t),this.buffer=t}var n,r},c.Writer.prototype.write_typecode=function(e){this.write_uint(e,1)},c.Writer.prototype.write_uint=function(e,t){var n=this.position;if(this.ensure(this.position+t),this.position+=t,1===t)return this.buffer.writeUInt8(e,n);if(2===t)return this.buffer.writeUInt16BE(e,n);if(4===t)return this.buffer.writeUInt32BE(e,n);throw new r.TypeError("Unexpected width for uint "+t)},c.Writer.prototype.write_fixed_width=function(e,t){var n=this.position;if(this.ensure(this.position+e.width),this.position+=e.width,e.write)e.write(this.buffer,t,n);else{if(!t.copy)throw new r.TypeError("Cannot handle write for "+e);t.copy(this.buffer,n)}},c.Writer.prototype.write_variable_width=function(e,n){var r=e.encoding?t.from(n,e.encoding):t.from(n);this.write_uint(r.length,e.width),this.write_bytes(r)},c.Writer.prototype.write_bytes=function(e){var t=this.position;this.ensure(this.position+e.length),this.position+=e.length,e.copy(this.buffer,t)},c.Writer.prototype.write_constructor=function(e,t){t&&(this.write_typecode(0),this.write(t)),this.write_typecode(e)},c.Writer.prototype.write=function(e){if(void 0===e.type){if(!e.described)throw new r.TypeError("Cannot write "+JSON.stringify(e));this.write(e.described())}else this.write_constructor(e.type.typecode,e.descriptor),this.write_value(e.type,e.value,e.array_constructor)},c.Writer.prototype.write_value=function(e,t,n){if(0!==e.width)if(1===e.category)this.write_fixed_width(e,t);else if(2===e.category)this.write_variable_width(e,t);else if(3===e.category)this.write_compound(e,t);else{if(4!==e.category)throw new r.TypeError("Invalid category "+e.category+" for type: "+e);this.write_array(e,t,n)}},c.Writer.prototype.backfill_size=function(e,t){var n=this.position-t;this.position=t,this.write_uint(n-e,e),this.position+=n-e},c.Writer.prototype.write_compound=function(e,t){var n=this.position;this.position+=e.width,this.write_uint(t.length,e.width);for(var r=0;r<t.length;r++)void 0===t[r]||null===t[r]?this.write(c.Null()):this.write(t[r]);this.backfill_size(e.width,n)},c.Writer.prototype.write_array=function(e,t,n){var r=this.position;this.position+=e.width,this.write_uint(t.length,e.width),this.write_constructor(n.typecode,n.descriptor);for(var i=g(n.typecode),o=0;o<t.length;o++)this.write_value(i,t[o]);this.backfill_size(e.width,r)},c.Writer.prototype.toString=function(){var e="buffer@"+this.position;this.position&&(e+=": ");for(var t=0;t<this.position;t++)t>0&&(e+=","),e+=("00"+Number(this.buffer[t]).toString(16)).slice(-2);return e},c.Writer.prototype.skip=function(e){this.ensure(this.position+e),this.position+=e},c.Writer.prototype.clear=function(){this.buffer.fill(0),this.position=0},c.Writer.prototype.remaining=function(){return this.buffer.length-this.position},c.define_composite=function(e){var t=function(e){this.value=e||[]};t.descriptor={numeric:e.code,symbolic:"amqp:"+e.name+":list"},t.prototype.dispatch=function(t,n){t["on_"+e.name](n)};for(var n=0;n<e.fields.length;n++){var r=e.fields[n];Object.defineProperty(t.prototype,r.name,y(n,r))}return t.toString=function(){return e.name+"#"+Number(e.code).toString(16)},t.prototype.toJSON=function(){var e={};for(var t in this)"value"!==t&&this[t]&&(e[t]=this[t]);return e},t.create=function(e){var n=new t;for(var r in e)n[r]=e[r];return n},t.prototype.described=function(){return c.described_nc(c.wrap_ulong(t.descriptor.numeric),c.wrap_list(this.value))},t},m={name:"error",code:29,fields:[{name:"condition",type:"symbol",mandatory:!0},{name:"description",type:"string"},{name:"info",type:"map"}]},_=c.define_composite(m),c["wrap_"+m.name]=function(e){return _.create(e).described()},v[Number(_.descriptor.numeric).toString(10)]=_,v[_.descriptor.symbolic]=_,e.exports=c}).call(this,n(13).Buffer)},function(e,t,n){"use strict";(function(t){var r=n(17),i={allocate_buffer:function(e){return t.alloc?t.alloc(e):new t(e)},generate_uuid:function(){return i.uuid_to_string(i.uuid4())},uuid4:function(){for(var e=i.allocate_buffer(16),t=0;t<e.length;t++)e[t]=255*Math.random()|0;return e[7]&=15,e[7]|=64,e[8]&=63,e[8]|=128,e},uuid_to_string:function(e){if(16===e.length)return[e.slice(0,4),e.slice(4,6),e.slice(6,8),e.slice(8,10),e.slice(10,16)].map((function(e){return e.toString("hex")})).join("-");throw new r.TypeError("Not a UUID, expecting 16 byte buffer")}},o=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/;i.string_to_uuid=function(e){var n=o.exec(e.toLowerCase());if(n)return t.from(n.slice(1).join(""),"hex");throw new r.TypeError("Not a valid UUID string: "+e)},i.clone=function(e){for(var t=Object.create(e.prototype||{}),n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var i=n[r];t[i]=e[i]}return t},i.and=function(e,t){return void 0===t?e:function(n){return e(n)&&t(n)}},i.is_sender=function(e){return e.is_sender()},i.is_receiver=function(e){return e.is_receiver()},i.sender_filter=function(e){return i.and(i.is_sender,e)},i.receiver_filter=function(e){return i.and(i.is_receiver,e)},i.is_defined=function(e){return null!=e},e.exports=i}).call(this,n(13).Buffer)},function(e,t,n){"use strict";var r=n(45);r.formatters&&(r.formatters.h=function(e){return e.toString("hex")}),e.exports={config:r("rhea:config"),frames:r("rhea:frames"),raw:r("rhea:raw"),reconnect:r("rhea:reconnect"),events:r("rhea:events"),message:r("rhea:message"),flow:r("rhea:flow"),io:r("rhea:io")}},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}v(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&v(e,"error",t,n)}(e,i,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,o,s,a;if(u(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=h(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function f(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):_(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function _(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function v(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return h(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,h=_(c,u);for(n=0;n<u;++n)o(h[n],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,o,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(45);t.container=r("rhea-promise:container"),t.connection=r("rhea-promise:connection"),t.session=r("rhea-promise:session"),t.sender=r("rhea-promise:sender"),t.receiver=r("rhea-promise:receiver"),t.error=r("rhea-promise:error"),t.eventHandler=r("rhea-promise:eventhandler"),t.contextTranslator=r("rhea-promise:translate")},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r,i=n(11),o=n(10);!function(e){e.CbsTokenTypeJwt="jwt",e.CbsTokenTypeSas="servicebus.windows.net:sastoken"}(r||(r={}));var s=n(4),a=n(14),c=n(0),u=n(32);class h{constructor(e,t){this.isConnecting=!1,t||(t={}),this._context=e,this.address=t.address||"",this.audience=t.audience||"",this.name=`${t.name}-${Object(u.a)()}`,this.partitionId=t.partitionId}async _negotiateClaim({abortSignal:e,setTokenRenewal:t,timeoutInMs:n}){c.b.verbose("[%s] Acquiring cbs lock: '%s' for creating the cbs session while creating the %s: '%s' with address: '%s'.",this._context.connectionId,this._context.cbsSession.cbsLock,this._type,this.name,this.address);const a=Date.now();let u,h;if(this._context.cbsSession.isOpen()||await i.a.acquire(this._context.cbsSession.cbsLock,()=>this._context.cbsSession.init({abortSignal:e,timeoutInMs:n-(Date.now()-a)}),{abortSignal:e,timeoutInMs:n}),Object(o.c)(this._context.tokenCredential))u=this._context.tokenCredential.getToken(this.audience),h=r.CbsTokenTypeSas,this._tokenTimeoutInMs=27e5;else{const e=await this._context.tokenCredential.getToken(s.a.aadEventHubsScope);if(!e)throw new Error('Failed to get token from the provided "TokenCredential" object');u=e,h=r.CbsTokenTypeJwt,this._tokenTimeoutInMs=u.expiresOnTimestamp-Date.now()-12e4}c.b.verbose("[%s] %s: calling negotiateClaim for audience '%s'.",this._context.connectionId,this._type,this.audience),c.b.verbose("[%s] Acquiring cbs lock: '%s' for cbs auth for %s: '%s' with address '%s'.",this._context.connectionId,this._context.negotiateClaimLock,this._type,this.name,this.address),await i.a.acquire(this._context.negotiateClaimLock,()=>this._context.cbsSession.negotiateClaim(this.audience,u.token,h,{abortSignal:e,timeoutInMs:n-(Date.now()-a)}),{abortSignal:e,timeoutInMs:n-(Date.now()-a)}),c.b.verbose("[%s] Negotiated claim for %s '%s' with with address: %s",this._context.connectionId,this._type,this.name,this.address),t&&await this._ensureTokenRenewal()}_ensureTokenRenewal(){this._tokenTimeoutInMs&&(this._tokenRenewalTimer&&clearTimeout(this._tokenRenewalTimer),this._tokenRenewalTimer=setTimeout(async()=>{try{await this._negotiateClaim({setTokenRenewal:!0,abortSignal:void 0,timeoutInMs:Object(a.a)(void 0)})}catch(e){c.b.verbose("[%s] %s '%s' with address %s, an error occurred while renewing the token: %O",this._context.connectionId,this._type,this.name,this.address,e)}},this._tokenTimeoutInMs),c.b.verbose("[%s] %s '%s' with address %s, has next token renewal in %d milliseconds @(%s).",this._context.connectionId,this._type,this.name,this.address,this._tokenTimeoutInMs,new Date(Date.now()+this._tokenTimeoutInMs).toString()))}async _closeLink(e){if(clearTimeout(this._tokenRenewalTimer),e)try{await e.close(),c.b.verbose("[%s] %s '%s' with address '%s' closed.",this._context.connectionId,this._type,this.name,this.address)}catch(e){c.b.verbose("[%s] An error occurred while closing the %s '%s' with address '%s': %O",this._context.connectionId,this._type,this.name,this.address,e)}}get _type(){let e="LinkEntity";return this.constructor&&this.constructor.name&&(e=this.constructor.name),e}}},function(e,t,n){"use strict";(function(e){var r=n(54);const i=void 0!==e&&e.env&&e.env.DEBUG||void 0;let o,s=[],a=[];const c=[];i&&h(i);const u=Object.assign(e=>l(e),{enable:h,enabled:d,disable:function(){const e=o||"";return h(""),e},log:r.a});function h(e){o=e,s=[],a=[];const t=/\*/g,n=e.split(",").map(e=>e.trim().replace(t,".*?"));for(const e of n)e.startsWith("-")?a.push(new RegExp(`^${e.substr(1)}$`)):s.push(new RegExp(`^${e}$`));for(const e of c)e.enabled=d(e.namespace)}function d(e){if(e.endsWith("*"))return!0;for(const t of a)if(t.test(e))return!1;for(const t of s)if(t.test(e))return!0;return!1}function l(e){const t=Object.assign((function(...n){if(!t.enabled)return;n.length>0&&(n[0]=`${e} ${n[0]}`);t.log(...n)}),{enabled:d(e),destroy:p,log:u.log,namespace:e,extend:f});return c.push(t),t}function p(){const e=c.indexOf(this);return e>=0&&(c.splice(e,1),!0)}function f(e){const t=l(`${this.namespace}:${e}`);return t.log=this.log,t}t.a=u}).call(this,n(12))},function(e,t,n){"use strict";var r=n(18),i=n(17),o={},s={};function a(e,t){var n=r.define_composite(t);o[t.name]=n.create,s[Number(n.descriptor.numeric).toString(10)]=n,s[n.descriptor.symbolic]=n}o.read_header=function(e){var t=4,n={};if("AMQP"!==e.toString("ascii",0,t))throw new i.ProtocolError("Invalid protocol header for AMQP: "+e.toString("hex",0,t));if(n.protocol_id=e.readUInt8(t++),n.major=e.readUInt8(t++),n.minor=e.readUInt8(t++),n.revision=e.readUInt8(t++),0===n.protocol_id&&0===n.major&&9===n.minor&&1===n.revision)throw new i.ProtocolError("Unsupported AMQP version: 0-9-1");if(1===n.protocol_id&&1===n.major&&0===n.minor&&10===n.revision)throw new i.ProtocolError("Unsupported AMQP version: 0-10");if(1!==n.major||0!==n.minor)throw new i.ProtocolError("Unsupported AMQP version: "+JSON.stringify(n));return n},o.write_header=function(e,t){var n=4;return e.write("AMQP",0,n,"ascii"),e.writeUInt8(t.protocol_id,n++),e.writeUInt8(t.major,n++),e.writeUInt8(t.minor,n++),e.writeUInt8(t.revision,n++),8},o.TYPE_AMQP=0,o.TYPE_SASL=1,o.read_frame=function(e){var t=new r.Reader(e),n={};if(n.size=t.read_uint(4),t.remaining()<n.size-4)return null;var a=t.read_uint(1);if(a<2)throw new i.ProtocolError("Invalid data offset, must be at least 2 was "+a);if(n.type=t.read_uint(1),n.type===o.TYPE_AMQP)n.channel=t.read_uint(2);else{if(n.type!==o.TYPE_SASL)throw new i.ProtocolError("Unknown frame type "+n.type);t.skip(2),n.channel=0}if(a>1&&t.skip(4*a-8),t.remaining()){n.performative=t.read();var c=s[n.performative.descriptor.value];c&&(n.performative=new c(n.performative.value)),t.remaining()&&(n.payload=t.read_bytes(t.remaining()))}return n},o.write_frame=function(e){var t=new r.Writer;if(t.skip(4),t.write_uint(2,1),t.write_uint(e.type,1),e.type===o.TYPE_AMQP)t.write_uint(e.channel,2);else{if(e.type!==o.TYPE_SASL)throw new i.ProtocolError("Unknown frame type "+e.type);t.write_uint(0,2)}e.performative&&(t.write(e.performative),e.payload&&t.write_bytes(e.payload));var n=t.toBuffer();return n.writeUInt32BE(n.length,0),n},o.amqp_frame=function(e,t,n){return{channel:e||0,type:o.TYPE_AMQP,performative:t,payload:n}},o.sasl_frame=function(e){return{channel:0,type:o.TYPE_SASL,performative:e}};a(o.TYPE_AMQP,{name:"open",code:16,fields:[{name:"container_id",type:"string",mandatory:!0},{name:"hostname",type:"string"},{name:"max_frame_size",type:"uint",default_value:4294967295},{name:"channel_max",type:"ushort",default_value:65535},{name:"idle_time_out",type:"uint"},{name:"outgoing_locales",type:"symbol",multiple:!0},{name:"incoming_locales",type:"symbol",multiple:!0},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]}),a(o.TYPE_AMQP,{name:"begin",code:17,fields:[{name:"remote_channel",type:"ushort"},{name:"next_outgoing_id",type:"uint",mandatory:!0},{name:"incoming_window",type:"uint",mandatory:!0},{name:"outgoing_window",type:"uint",mandatory:!0},{name:"handle_max",type:"uint",default_value:"4294967295"},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]}),a(o.TYPE_AMQP,{name:"attach",code:18,fields:[{name:"name",type:"string",mandatory:!0},{name:"handle",type:"uint",mandatory:!0},{name:"role",type:"boolean",mandatory:!0},{name:"snd_settle_mode",type:"ubyte",default_value:2},{name:"rcv_settle_mode",type:"ubyte",default_value:0},{name:"source",type:"*"},{name:"target",type:"*"},{name:"unsettled",type:"map"},{name:"incomplete_unsettled",type:"boolean",default_value:!1},{name:"initial_delivery_count",type:"uint"},{name:"max_message_size",type:"ulong"},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]}),a(o.TYPE_AMQP,{name:"flow",code:19,fields:[{name:"next_incoming_id",type:"uint"},{name:"incoming_window",type:"uint",mandatory:!0},{name:"next_outgoing_id",type:"uint",mandatory:!0},{name:"outgoing_window",type:"uint",mandatory:!0},{name:"handle",type:"uint"},{name:"delivery_count",type:"uint"},{name:"link_credit",type:"uint"},{name:"available",type:"uint"},{name:"drain",type:"boolean",default_value:!1},{name:"echo",type:"boolean",default_value:!1},{name:"properties",type:"symbolic_map"}]}),a(o.TYPE_AMQP,{name:"transfer",code:20,fields:[{name:"handle",type:"uint",mandatory:!0},{name:"delivery_id",type:"uint"},{name:"delivery_tag",type:"binary"},{name:"message_format",type:"uint"},{name:"settled",type:"boolean"},{name:"more",type:"boolean",default_value:!1},{name:"rcv_settle_mode",type:"ubyte"},{name:"state",type:"delivery_state"},{name:"resume",type:"boolean",default_value:!1},{name:"aborted",type:"boolean",default_value:!1},{name:"batchable",type:"boolean",default_value:!1}]}),a(o.TYPE_AMQP,{name:"disposition",code:21,fields:[{name:"role",type:"boolean",mandatory:!0},{name:"first",type:"uint",mandatory:!0},{name:"last",type:"uint"},{name:"settled",type:"boolean",default_value:!1},{name:"state",type:"*"},{name:"batchable",type:"boolean",default_value:!1}]}),a(o.TYPE_AMQP,{name:"detach",code:22,fields:[{name:"handle",type:"uint",mandatory:!0},{name:"closed",type:"boolean",default_value:!1},{name:"error",type:"error"}]}),a(o.TYPE_AMQP,{name:"end",code:23,fields:[{name:"error",type:"error"}]}),a(o.TYPE_AMQP,{name:"close",code:24,fields:[{name:"error",type:"error"}]});a(o.TYPE_SASL,{name:"sasl_mechanisms",code:64,fields:[{name:"sasl_server_mechanisms",type:"symbol",multiple:!0,mandatory:!0}]}),a(o.TYPE_SASL,{name:"sasl_init",code:65,fields:[{name:"mechanism",type:"symbol",mandatory:!0},{name:"initial_response",type:"binary"},{name:"hostname",type:"string"}]}),a(o.TYPE_SASL,{name:"sasl_challenge",code:66,fields:[{name:"challenge",type:"binary",mandatory:!0}]}),a(o.TYPE_SASL,{name:"sasl_response",code:67,fields:[{name:"response",type:"binary",mandatory:!0}]}),a(o.TYPE_SASL,{name:"sasl_outcome",code:68,fields:[{name:"code",type:"ubyte",mandatory:!0},{name:"additional_data",type:"binary"}]}),e.exports=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(22),i=n(50);!function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.OK=200]="OK",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.Ambiguous=300]="Ambiguous",e[e.MultipleChoices=300]="MultipleChoices",e[e.Moved=301]="Moved",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.Redirect=302]="Redirect",e[e.RedirectMethod=303]="RedirectMethod",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.RedirectKeepVerb=307]="RedirectKeepVerb",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.RequestEntityTooLarge=413]="RequestEntityTooLarge",e[e.RequestUriTooLong=414]="RequestUriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RequestedRangeNotSatisfiable=416]="RequestedRangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported"}(t.AmqpResponseStatusCode||(t.AmqpResponseStatusCode={})),t.messageProperties=["message_id","reply_to","to","correlation_id","content_type","absolute_expiry_time","group_id","group_sequence","reply_to_group_id","content_encoding","creation_time","subject","user_id"],t.messageHeader=["first_acquirer","delivery_count","ttl","durable","priority"],t.isAmqpError=function(e){if(!e||"object"!=typeof e)throw new Error("err is a required parameter and must be of type 'object'.");let t=!1;return(e.condition&&"string"==typeof e.condition&&e.description&&"string"==typeof e.description||e.value&&Array.isArray(e.value)||e.constructor&&"c"===e.constructor.name)&&(t=!0),t},t.delay=function(e,t){return new Promise(n=>setTimeout(()=>n(t),e))},t.parseConnectionString=function(e,t){t||(t={});const n=t.entitySeperator||";",r=t.keyValueSeparator||"=";return e.split(n).reduce((e,t)=>{const n=t.indexOf(r);return Object.assign({},e,{[t.substring(0,n)]:t.substring(n+1)})},{})},t.emitEvent=function(e){const t=()=>{const t=e.emitter&&(e.emitter.id||e.emitter.name);r[e.emitterType]("[%s] %s '%s' got event: '%s'. Re-emitting the translated context.",e.connectionId,e.emitterType,t,e.eventName),e.emitter.emit(e.eventName,i.EventContext.translate(e.rheaContext,e.emitter,e.eventName))};-1!==e.eventName.indexOf("error")&&e.emitter.actionInitiated>0?(r[e.emitterType]("[%s] %s got event: '%s'. Will re-emit in the next tick, since this happened before the promise for create/close was resolved.",e.connectionId,e.emitterType,e.eventName),setTimeout(t)):t()},t.abortErrorName="AbortError",t.createAbortError=function(){const e=new Error("The operation was aborted.");return e.name=t.abortErrorName,e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e){super(e),this.name="OperationTimeoutError"}}t.OperationTimeoutError=r;class i extends Error{constructor(e){super(e),this.name="InsufficientCreditError"}}t.InsufficientCreditError=i;class o extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.innerError=n,this.name="SendOperationFailedError",this.code=t,this.innerError=n}}t.SendOperationFailedError=o},,function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return i})),n.d(t,"__assign",(function(){return o})),n.d(t,"__rest",(function(){return s})),n.d(t,"__decorate",(function(){return a})),n.d(t,"__param",(function(){return c})),n.d(t,"__metadata",(function(){return u})),n.d(t,"__awaiter",(function(){return h})),n.d(t,"__generator",(function(){return d})),n.d(t,"__createBinding",(function(){return l})),n.d(t,"__exportStar",(function(){return p})),n.d(t,"__values",(function(){return f})),n.d(t,"__read",(function(){return m})),n.d(t,"__spread",(function(){return _})),n.d(t,"__spreadArrays",(function(){return v})),n.d(t,"__spreadArray",(function(){return g})),n.d(t,"__await",(function(){return b})),n.d(t,"__asyncGenerator",(function(){return y})),n.d(t,"__asyncDelegator",(function(){return w})),n.d(t,"__asyncValues",(function(){return E})),n.d(t,"__makeTemplateObject",(function(){return S})),n.d(t,"__importStar",(function(){return C})),n.d(t,"__importDefault",(function(){return I})),n.d(t,"__classPrivateFieldGet",(function(){return k})),n.d(t,"__classPrivateFieldSet",(function(){return P})),n.d(t,"__classPrivateFieldIn",(function(){return x}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function a(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var l=Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function p(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||l(t,e,n)}function f(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function m(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function _(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(m(arguments[t]));return e}function v(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function g(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function b(e){return this instanceof b?(this.v=e,this):new b(e)}function y(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof b?Promise.resolve(n.value.v).then(c,u):h(o[0][2],n)}catch(e){h(o[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function h(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function w(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:b(e[r](t)),done:"return"===r}:i?i(t):t}:i}}function E(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=f(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function S(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var O=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function C(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&l(t,e,n);return O(t,e),t}function I(e){return e&&e.__esModule?e:{default:e}}function k(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function P(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n}function x(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}},function(e,t,n){"use strict";function r(e,t){if(!function(e){return null!=e}(e)||"object"!=typeof e)return!1;for(const n of t)if(!i(e,n))return!1;return!0}function i(e,t){return"object"==typeof e&&t in e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var r=n(24);const i=new Set,o=void 0!==e&&e.env&&e.env.AZURE_LOG_LEVEL||void 0;let s;const a=Object(r.a)("azure");a.log=(...e)=>{r.a.log(...e)};const c=["verbose","info","warning","error"];o&&(f(o)?function(e){if(e&&!f(e))throw new Error(`Unknown log level '${e}'. Acceptable values: ${c.join(",")}`);s=e;const t=[];for(const e of i)p(e)&&t.push(e.namespace);r.a.enable(t.join(","))}(o):console.error(`AZURE_LOG_LEVEL set to unknown log level '${o}'; logging is not enabled. Acceptable values: ${c.join(", ")}.`));const u={verbose:400,info:300,warning:200,error:100};function h(e){const t=a.extend(e);return d(a,t),{error:l(t,"error"),warning:l(t,"warning"),info:l(t,"info"),verbose:l(t,"verbose")}}function d(e,t){t.log=(...t)=>{e.log(...t)}}function l(e,t){const n=Object.assign(e.extend(t),{level:t});if(d(e,n),p(n)){const e=r.a.disable();r.a.enable(e+","+n.namespace)}return i.add(n),n}function p(e){return!!(s&&u[e.level]<=u[s])}function f(e){return c.includes(e)}}).call(this,n(12))},function(e,t,n){"use strict";var r,i=new Uint8Array(16);function o(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var a=function(e){return"string"==typeof e&&s.test(e)},c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));var h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n};t.a=function(e,t,n){var r=(e=e||{}).random||(e.rng||o)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return h(r)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return c}));const r=new WeakMap,i=new WeakMap;class o{constructor(){this.onabort=null,r.set(this,[]),i.set(this,!1)}get aborted(){if(!i.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");return i.get(this)}static get none(){return new o}addEventListener(e,t){if(!r.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");r.get(this).push(t)}removeEventListener(e,t){if(!r.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");const n=r.get(this),i=n.indexOf(t);i>-1&&n.splice(i,1)}dispatchEvent(e){throw new Error("This is a stub dispatchEvent implementation that should not be used.  It only exists for type-checking purposes.")}}function s(e){if(e.aborted)return;e.onabort&&e.onabort.call(e);const t=r.get(e);t&&t.slice().forEach(t=>{t.call(e,{type:"abort"})}),i.set(e,!0)}class a extends Error{constructor(e){super(e),this.name="AbortError"}}class c{constructor(e){if(this._signal=new o,e){Array.isArray(e)||(e=arguments);for(const t of e)t.aborted?this.abort():t.addEventListener("abort",()=>{this.abort()})}}get signal(){return this._signal}abort(){s(this._signal)}static timeout(e){const t=new o,n=setTimeout(s,e,t);return"function"==typeof n.unref&&n.unref(),t}}},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},i=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,s=String(e).replace(i,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),c=r[n];n<o;c=r[++n])m(c)||!y(c)?s+=" "+c:s+=" "+a(c);return s},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var o,s={};function a(e,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(n)?r.showHidden=n:n&&t._extend(r,n),g(r.showHidden)&&(r.showHidden=!1),g(r.depth)&&(r.depth=2),g(r.colors)&&(r.colors=!1),g(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),h(r,e,r.depth)}function c(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function u(e,t){return e}function h(e,n,r){if(e.customInspect&&n&&S(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return v(i)||(i=h(e,i,r)),i}var o=function(e,t){if(g(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(_(t))return e.stylize(""+t,"number");if(f(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,n);if(o)return o;var s=Object.keys(n),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(n)),E(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(n);if(0===s.length){if(S(n)){var c=n.name?": "+n.name:"";return e.stylize("[Function"+c+"]","special")}if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(E(n))return d(n)}var u,y="",O=!1,C=["{","}"];(p(n)&&(O=!0,C=["[","]"]),S(n))&&(y=" [Function"+(n.name?": "+n.name:"")+"]");return b(n)&&(y=" "+RegExp.prototype.toString.call(n)),w(n)&&(y=" "+Date.prototype.toUTCString.call(n)),E(n)&&(y=" "+d(n)),0!==s.length||O&&0!=n.length?r<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),u=O?function(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)P(t,String(s))?o.push(l(e,t,n,r,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(l(e,t,n,r,i,!0))})),o}(e,n,r,a,s):s.map((function(t){return l(e,n,r,a,t,O)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,y,C)):C[0]+y+C[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function l(e,t,n,r,i,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),P(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=m(n)?h(e,c.value,null):h(e,c.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),g(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function m(e){return null===e}function _(e){return"number"==typeof e}function v(e){return"string"==typeof e}function g(e){return void 0===e}function b(e){return y(e)&&"[object RegExp]"===O(e)}function y(e){return"object"==typeof e&&null!==e}function w(e){return y(e)&&"[object Date]"===O(e)}function E(e){return y(e)&&("[object Error]"===O(e)||e instanceof Error)}function S(e){return"function"==typeof e}function O(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(g(o)&&(o=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!s[n])if(new RegExp("\\b"+n+"\\b","i").test(o)){var r=e.pid;s[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else s[n]=function(){};return s[n]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=f,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=_,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=g,t.isRegExp=b,t.isObject=y,t.isDate=w,t.isError=E,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(65);var I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function k(){var e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":");return[e.getDate(),I[e.getMonth()],t].join(" ")}function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",k(),t.format.apply(t,arguments))},t.inherits=n(66),t._extend=function(e,t){if(!t||!y(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var x="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function T(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(x&&e[x]){var t;if("function"!=typeof(t=e[x]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,x,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),x&&Object.defineProperty(t,x,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=x,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,s=function(){return i.apply(o,arguments)};t.apply(this,n).then((function(t){e.nextTick(s,null,t)}),(function(t){e.nextTick(T,t,s)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(12))},function(e,t,n){"use strict";var r=function(){this.init()};r.prototype.init=function(){this.local_open=!1,this.remote_open=!1,this.open_requests=0,this.close_requests=0,this.initialised=!1,this.marker=void 0},r.prototype.mark=function(e){return this.marker=e||Date.now(),this.marker},r.prototype.open=function(){return this.marker=void 0,this.initialised=!0,!this.local_open&&(this.local_open=!0,this.open_requests++,!0)},r.prototype.close=function(){return this.marker=void 0,!!this.local_open&&(this.local_open=!1,this.close_requests++,!0)},r.prototype.disconnected=function(){var e=this.initialised;this.was_open=this.local_open,this.init(),this.initialised=e},r.prototype.reconnect=function(){this.was_open&&(this.open(),this.was_open=void 0)},r.prototype.remote_opened=function(){return!this.remote_open&&(this.remote_open=!0,!0)},r.prototype.remote_closed=function(){return!!this.remote_open&&(this.remote_open=!1,!0)},r.prototype.is_open=function(){return this.local_open&&this.remote_open},r.prototype.is_closed=function(){return this.initialised&&!(this.local_open||this.was_open)&&!this.remote_open},r.prototype.has_settled=function(){return 0===this.open_requests&&0===this.close_requests},r.prototype.need_open=function(){return this.open_requests>0&&(this.open_requests--,!0)},r.prototype.need_close=function(){return this.close_requests>0&&(this.close_requests--,!0)},e.exports=r},function(e,t,n){"use strict";var r=n(20),i=n(18),o={},s={},a=[],c={};function u(e,t,n){t.descriptor=e,s[e.symbolic]=t,s[Number(e.numeric).toString(10)]=t,n&&a.push(n)}function h(e){var t=i.define_composite(e);c[e.name]=t.create,o[Number(t.descriptor.numeric).toString(10)]=t,o[t.descriptor.symbolic]=t;u(t.descriptor,(function(n,r){for(var i=new t(r.value),o=0;o<e.fields.length;o++){var s=e.fields[o],a=i[s.name];null!=a&&(n[s.name]=a)}}),(function(e,n){e.push(t.create(n).described())}))}function d(e,t){var n=t?i.wrap_symbolic_map:i.wrap_map,r={numeric:e.code};r.symbolic="amqp:"+e.name.replace(/_/g,"-")+":map";u(r,(function(t,n){t[e.name]=i.unwrap_map_simple(n)}),(function(t,o){o[e.name]&&t.push(i.described_nc(i.wrap_ulong(r.numeric),n(o[e.name])))}))}function l(e,t,n){this.typecode=e,this.content=t,this.multiple=n}function p(e,t,n){void 0===e.body?e.body=new l(n,i.unwrap(t)):e.body.constructor===l&&e.body.typecode===n&&(e.body.multiple?e.body.content.push(i.unwrap(t)):(e.body.multiple=!0,e.body.content=[e.body.content,i.unwrap(t)]))}function f(e){e&&function e(t,n){for(var r in t){var i=t[r];"object"==typeof i?e(i,n[r]):n[r]=i}}(e,this)}l.prototype.described=function(e){return i.described(i.wrap_ulong(this.typecode),i.wrap(e||this.content))},l.prototype.collect_sections=function(e){if(this.multiple)for(var t=0;t<this.content.length;t++)e.push(this.described(this.content[t]));else e.push(this.described())},h({name:"header",code:112,fields:[{name:"durable",type:"boolean",default_value:!1},{name:"priority",type:"ubyte",default_value:4},{name:"ttl",type:"uint"},{name:"first_acquirer",type:"boolean",default_value:!1},{name:"delivery_count",type:"uint",default_value:0}]}),d({name:"delivery_annotations",code:113},!0),d({name:"message_annotations",code:114},!0),h({name:"properties",code:115,fields:[{name:"message_id",type:"message_id"},{name:"user_id",type:"binary"},{name:"to",type:"string"},{name:"subject",type:"string"},{name:"reply_to",type:"string"},{name:"correlation_id",type:"message_id"},{name:"content_type",type:"symbol"},{name:"content_encoding",type:"symbol"},{name:"absolute_expiry_time",type:"timestamp"},{name:"creation_time",type:"timestamp"},{name:"group_id",type:"string"},{name:"group_sequence",type:"uint"},{name:"reply_to_group_id",type:"string"}]}),d({name:"application_properties",code:116}),u({numeric:117,symbolic:"amqp:data:binary"},(function(e,t){p(e,t,117)})),u({numeric:118,symbolic:"amqp:amqp-sequence:list"},(function(e,t){p(e,t,118)})),u({numeric:119,symbolic:"amqp:value:*"},(function(e,t){e.body=i.unwrap(t)})),d({name:"footer",code:120}),a.push((function(e,t){t.body&&t.body.collect_sections?t.body.collect_sections(e):e.push(i.described(i.wrap_ulong(119),i.wrap(t.body)))})),c.data_section=function(e){return new l(117,e)},c.sequence_section=function(e){return new l(118,e)},c.data_sections=function(e){return new l(117,e,!0)},c.sequence_sections=function(e){return new l(118,e,!0)},f.prototype.toJSON=function(){var e={};for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e},f.prototype.toString=function(){return JSON.stringify(this.toJSON())},c.encode=function(e){var t=[];a.forEach((function(n){n(t,e)}));for(var n=new i.Writer,o=0;o<t.length;o++)r.message("Encoding section %d of %d: %o",o+1,t.length,t[o]),n.write(t[o]);var s=n.toBuffer();return r.message("encoded %d bytes",s.length),s},c.decode=function(e){for(var t=new f,n=new i.Reader(e);n.remaining();){var o=n.read();if(r.message("decoding section: %o of type: %o",o,o.descriptor),o.descriptor){var a=s[o.descriptor.value];a?a(t,o):console.warn("WARNING: did not recognise message section with descriptor "+o.descriptor)}else console.warn("WARNING: expected described message section got "+JSON.stringify(o))}return t};var m={};function _(e){var t=i.define_composite(e);t.composite_type=e.name,c[e.name]=t.create,m[Number(t.descriptor.numeric).toString(10)]=t,m[t.descriptor.symbolic]=t,c["is_"+e.name]=function(t){if(t&&t.descriptor){var n=m[t.descriptor.value];if(n)return n.descriptor.numeric===e.code}return!1}}c.unwrap_outcome=function(e){if(e&&e.descriptor){var t=m[e.descriptor.value];if(t)return new t(e.value)}return console.error("unrecognised outcome: "+JSON.stringify(e)),e},c.are_outcomes_equivalent=function(e,t){return void 0===e&&void 0===t||void 0!==e&&void 0!==t&&(e.descriptor.value===t.descriptor.value&&36===e.descriptor.value)},_({name:"received",code:35,fields:[{name:"section_number",type:"uint",mandatory:!0},{name:"section_offset",type:"ulong",mandatory:!0}]}),_({name:"accepted",code:36,fields:[]}),_({name:"rejected",code:37,fields:[{name:"error",type:"error"}]}),_({name:"released",code:38,fields:[]}),_({name:"modified",code:39,fields:[{name:"delivery_failed",type:"boolean"},{name:"undeliverable_here",type:"boolean"},{name:"message_annotations",type:"map"}]}),e.exports=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(29),i=n(22),o=n(38),s=n(53),a=n(78),c=n(26),u=n(16),h=n(40),d=n(27);class l extends h.Entity{constructor(e){if(super(),e||(e={}),null==e.operationTimeoutInSeconds&&(e.operationTimeoutInSeconds=a.defaultOperationTimeoutInSeconds),(t=e)&&"object"==typeof t.container&&"object"==typeof t.rheaConnection)this._connection=e.rheaConnection,this.container=e.container;else{const t=e;if(t.webSocketOptions){const e=u.websocket_connect(t.webSocketOptions.webSocket);t.connection_details=e(t.webSocketOptions.url,t.webSocketOptions.protocol,t.webSocketOptions.options)}this._connection=u.create_connection(t),this.container=s.Container.copyFromContainerInstance(this._connection.container)}var t;this.options=this._connection.options,this.options.operationTimeoutInSeconds=e.operationTimeoutInSeconds,this._initializeEventListeners()}get id(){return this._connection.options.id}get properties(){return this._connection.properties}get maxFrameSize(){return this._connection.max_frame_size}get idleTimeout(){return this._connection.idle_time_out}get channelMax(){return this._connection.channel_max}get error(){return this._connection.error}removeSession(e){return e.remove()}open(e){return new Promise((t,n)=>{if(this.isOpen())return t(this);{let r,o,s;const a=e&&e.abortSignal;let h;const d=()=>{clearTimeout(h),this.actionInitiated--,this._connection.removeListener(u.ConnectionEvents.connectionOpen,r),this._connection.removeListener(u.ConnectionEvents.connectionClose,o),this._connection.removeListener(u.ConnectionEvents.disconnected,o),a&&a.removeEventListener("abort",s)};r=e=>(d(),i.connection("[%s] Resolving the promise with amqp connection.",this.id),t(this)),o=e=>{d();const t=e.error||e.connection.error||Error("Failed to connect");return i.error("[%s] Error occurred while establishing amqp connection: %O",this.id,t),n(t)},s=()=>{d(),this._connection.close();const e=c.createAbortError();return i.error("[%s] [%s]",this.id,e.message),n(e)};const l=()=>{d();const e=`Unable to open the amqp connection "${this.id}" due to operation timeout.`;return i.error("[%s] %s",this.id,e),n(new Error(e))};this._connection.once(u.ConnectionEvents.connectionOpen,r),this._connection.once(u.ConnectionEvents.connectionClose,o),this._connection.once(u.ConnectionEvents.disconnected,o),h=setTimeout(l,1e3*this.options.operationTimeoutInSeconds),i.connection("[%s] Trying to create a new amqp connection.",this.id),this._connection.connect(),this.actionInitiated++,a&&(a.aborted?s():a.addEventListener("abort",s))}})}close(e){return new Promise((t,n)=>{if(i.error("[%s] The connection is open ? -> %s",this.id,this.isOpen()),!this.isOpen())return t();{let r,o,s,a;const h=e&&e.abortSignal;let d;const l=()=>{clearTimeout(d),this.actionInitiated--,this._connection.removeListener(u.ConnectionEvents.connectionError,o),this._connection.removeListener(u.ConnectionEvents.connectionClose,r),this._connection.removeListener(u.ConnectionEvents.disconnected,s),h&&h.removeEventListener("abort",a)};r=e=>(l(),i.connection("[%s] Resolving the promise as the connection has been successfully closed.",this.id),t()),o=e=>(l(),i.error("[%s] Error occurred while closing amqp connection: %O.",this.id,e.connection.error),n(e.connection.error)),s=e=>{l();const t=e.connection&&e.connection.error?e.connection.error:e.error;i.error("[%s] Connection got disconnected while closing itself: %O.",this.id,t)},a=()=>{l();const e=c.createAbortError();return i.error("[%s] [%s]",this.id,e.message),n(e)};const p=()=>{l();const e=`Unable to close the amqp connection "${this.id}" due to operation timeout.`;return i.error("[%s] %s",this.id,e),n(new Error(e))};this._connection.once(u.ConnectionEvents.connectionClose,r),this._connection.once(u.ConnectionEvents.connectionError,o),this._connection.once(u.ConnectionEvents.disconnected,s),d=setTimeout(p,1e3*this.options.operationTimeoutInSeconds),this._connection.close(),this.actionInitiated++,h&&(h.aborted?a():h.addEventListener("abort",a))}})}isOpen(){let e=!1;return this._connection&&this._connection.is_open&&this._connection.is_open()&&(e=!0),e}removeAllSessions(){this._connection&&this._connection.remove_all_sessions()}isRemoteOpen(){return this._connection.is_remote_open()}getError(){return this._connection.get_error()}getPeerCertificate(){return this._connection.get_peer_certificate()}getTlsSocket(){return this._connection.get_tls_socket()}wasCloseInitiated(){return this._connection.is_closed()}createSession(e){return new Promise((t,n)=>{const r=e&&e.abortSignal;let s;if(r){const e=()=>{const e=c.createAbortError();return i.error("[%s] [%s]",this.id,e.message),n(e)};if(s=()=>(_(),a.is_open()?a.close():a.is_closed()||a.once(u.SessionEvents.sessionOpen,()=>{a.close()}),e()),r.aborted)return e();r.addEventListener("abort",s)}const a=this._connection.create_session(),h=new o.Session(this,a);let l,p,f,m;h.actionInitiated++;const _=()=>{clearTimeout(m),h.actionInitiated--,a.removeListener(u.SessionEvents.sessionOpen,l),a.removeListener(u.SessionEvents.sessionClose,p),a.connection.removeListener(u.ConnectionEvents.disconnected,f),r&&r.removeEventListener("abort",s)};l=e=>(_(),i.session("[%s] Resolving the promise with amqp session '%s'.",this.id,h.id),t(h)),p=e=>(_(),i.error("[%s] Error occurred while establishing a session over amqp connection: %O.",this.id,e.session.error),n(e.session.error)),f=e=>{_();const t=e.connection&&e.connection.error?e.connection.error:e.error;return i.error("[%s] Connection got disconnected while creating amqp session '%s': %O.",this.id,h.id,t),n(t)};a.once(u.SessionEvents.sessionOpen,l),a.once(u.SessionEvents.sessionClose,p),a.connection.once(u.ConnectionEvents.disconnected,f),i.session("[%s] Calling amqp session.begin().",this.id),m=setTimeout(()=>{_();const e="Unable to create the amqp session due to operation timeout.";return i.error("[%s] %s",this.id,e),n(new d.OperationTimeoutError(e))},1e3*this.options.operationTimeoutInSeconds),a.begin()})}createSender(e){return r.__awaiter(this,void 0,void 0,(function*(){if(e&&e.session&&e.session.createSender)return e.session.createSender(e);return(yield this.createSession({abortSignal:e&&e.abortSignal})).createSender(e)}))}createAwaitableSender(e){return r.__awaiter(this,void 0,void 0,(function*(){if(e&&e.session&&e.session.createAwaitableSender)return e.session.createAwaitableSender(e);return(yield this.createSession({abortSignal:e&&e.abortSignal})).createAwaitableSender(e)}))}createReceiver(e){return r.__awaiter(this,void 0,void 0,(function*(){if(e&&e.session&&e.session.createReceiver)return e.session.createReceiver(e);return(yield this.createSession({abortSignal:e&&e.abortSignal})).createReceiver(e)}))}createRequestResponseLink(e,t,n={}){return r.__awaiter(this,void 0,void 0,(function*(){if(!e)throw new Error("Please provide sender options.");if(!t)throw new Error("Please provide receiver options.");const{session:r,abortSignal:o}=n,s=r||(yield this.createSession({abortSignal:o})),[a,c]=yield Promise.all([s.createSender(Object.assign({},e,{abortSignal:o})),s.createReceiver(Object.assign({},t,{abortSignal:o}))]);return i.connection("[%s] Successfully created the sender '%s' and receiver '%s' on the same amqp session '%s'.",this.id,a.name,c.name,s.id),{session:s,sender:a,receiver:c}}))}_initializeEventListeners(){for(const e of Object.keys(u.ConnectionEvents))this._connection.on(u.ConnectionEvents[e],t=>{const n={rheaContext:t,emitter:this,eventName:u.ConnectionEvents[e],emitterType:"connection",connectionId:this.id};u.ConnectionEvents[e]===u.ConnectionEvents.protocolError&&i.connection("[%s] ProtocolError is: %O.",this.id,t),c.emitEvent(n)});this._connection.on(u.SenderEvents.senderError,e=>{const t={rheaContext:e,emitter:this,eventName:u.SenderEvents.senderError,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),this._connection.on(u.SenderEvents.senderClose,e=>{const t={rheaContext:e,emitter:this,eventName:u.SenderEvents.senderClose,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),this._connection.on(u.ReceiverEvents.receiverError,e=>{const t={rheaContext:e,emitter:this,eventName:u.ReceiverEvents.receiverError,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),this._connection.on(u.ReceiverEvents.receiverClose,e=>{const t={rheaContext:e,emitter:this,eventName:u.ReceiverEvents.receiverClose,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),this._connection.on(u.SessionEvents.sessionError,e=>{const t={rheaContext:e,emitter:this,eventName:u.SessionEvents.sessionError,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),this._connection.on(u.SessionEvents.sessionClose,e=>{const t={rheaContext:e,emitter:this,eventName:u.SessionEvents.sessionClose,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),"function"==typeof this._connection.eventNames&&i.eventHandler("[%s] rhea-promise 'connection' object is listening for events: %o emitted by rhea's 'connection' object.",this.id,this._connection.eventNames())}}t.Connection=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(29),i=n(22),o=n(51),s=n(41),a=n(16),c=n(26),u=n(40),h=n(27),d=n(52);var l;!function(e){e.sender="sender",e.AwaitableSender="AwaitableSender"}(l||(l={}));class p extends u.Entity{constructor(e,t){super(),this._connection=e,this._session=t,this._initializeEventListeners()}get connection(){return this._connection}get incoming(){return this._session.incoming}get outgoing(){return this._session.outgoing}get error(){return this._session.error}get id(){let e="";const t=this._session;return t.local&&(e+=`local-${t.local.channel}_`),t.remote&&(e+=`remote-${t.remote.channel}_`),e&&(e+=""+this._connection.id),e}isOpen(){let e=!1;return this._connection.isOpen()&&this._session.is_open()&&(e=!0),e}isClosed(){return this._session.is_closed()}isItselfClosed(){return this._session.is_itself_closed()}remove(){this._session&&(this.removeAllListeners(),this._session.removeAllListeners(),this._session.remove())}begin(){this._session&&this._session.begin()}close(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=new Promise((t,n)=>{if(i.error("[%s] The amqp session '%s' is open ? -> %s",this.connection.id,this.id,this.isOpen()),!this.isOpen())return t();{let r,o,s,u;const d=e&&e.abortSignal;let l;const p=()=>{clearTimeout(l),this.actionInitiated--,this._session.removeListener(a.SessionEvents.sessionError,r),this._session.removeListener(a.SessionEvents.sessionClose,o),this._session.connection.removeListener(a.ConnectionEvents.disconnected,s),d&&d.removeEventListener("abort",u)};o=e=>(p(),i.session("[%s] Resolving the promise as the amqp session '%s' has been closed.",this.connection.id,this.id),t()),r=e=>{p(),i.error("[%s] Error occurred while closing amqp session '%s'.",this.connection.id,this.id,e.session.error),n(e.session.error)},s=e=>{p();const t=e.connection&&e.connection.error?e.connection.error:e.error;i.error("[%s] Connection got disconnected while closing amqp session '%s': %O.",this.connection.id,this.id,t)},u=()=>{p();const e=c.createAbortError();return i.error("[%s] [%s]",this.connection.id,e.message),n(e)};const f=()=>{p();const e=`Unable to close the amqp session ${this.id} due to operation timeout.`;i.error("[%s] %s",this.connection.id,e),n(new h.OperationTimeoutError(e))};this._session.once(a.SessionEvents.sessionClose,o),this._session.once(a.SessionEvents.sessionError,r),this._session.connection.once(a.ConnectionEvents.disconnected,s),i.session("[%s] Calling session.close() for amqp session '%s'.",this.connection.id,this.id),l=setTimeout(f,1e3*this.connection.options.operationTimeoutInSeconds),this._session.close(),this.actionInitiated++,d&&(d.aborted?u():d.addEventListener("abort",u))}});try{yield t}finally{this.removeAllListeners()}}))}createReceiver(e){return new Promise((t,n)=>{if(e&&(e.onMessage&&!e.onError||e.onError&&!e.onMessage)&&0!==e.credit_window)return n(new Error("Either provide both 'onMessage' and 'onError' handlers, or please set the credit_window to 0, if you want to provide only the 'onError' handler. This ensures no messages are lost between the receiver getting created  and the 'onMessage' handler being added."));const r=e&&e.abortSignal;let s;if(r){const e=()=>{const e=c.createAbortError();return i.error("[%s] [%s]",this.connection.id,e.message),n(e)};if(s=()=>(_(),u.is_open()?u.close():u.is_closed()||u.once(a.ReceiverEvents.receiverOpen,()=>{u.close()}),e()),r.aborted)return e();r.addEventListener("abort",s)}e&&e.onSessionError&&(this.on(a.SessionEvents.sessionError,e.onSessionError),i.session("[%s] Added event handler for event '%s' on rhea-promise 'session: %s', while creating the 'receiver'.",this.connection.id,a.SessionEvents.sessionError,this.id)),e&&e.onSessionClose&&(this.on(a.SessionEvents.sessionClose,e.onSessionClose),i.session("[%s] Added event handler for event '%s' on rhea-promise 'session: %s',  while creating the 'receiver'.",this.connection.id,a.SessionEvents.sessionClose,this.id));const u=this._session.attach_receiver(e),d=new o.Receiver(this,u,e);let l,p,f,m;d.actionInitiated++,e&&e.onMessage&&(d.on(a.ReceiverEvents.message,e.onMessage),i.receiver("[%s] Added event handler for event '%s' on rhea-promise 'receiver'.",this.connection.id,a.ReceiverEvents.message)),e&&e.onError&&(d.on(a.ReceiverEvents.receiverError,e.onError),i.receiver("[%s] Added event handler for event '%s' on rhea-promise 'receiver'.",this.connection.id,a.ReceiverEvents.receiverError)),e&&e.onClose&&(d.on(a.ReceiverEvents.receiverClose,e.onClose),i.receiver("[%s] Added event handler for event '%s' on rhea-promise 'receiver'.",this.connection.id,a.ReceiverEvents.receiverClose)),e&&e.onSettled&&(d.on(a.ReceiverEvents.settled,e.onSettled),i.receiver("[%s] Added event handler for event '%s' on rhea-promise 'receiver'.",this.connection.id,a.ReceiverEvents.settled));const _=()=>{clearTimeout(m),d.actionInitiated--,u.removeListener(a.ReceiverEvents.receiverOpen,l),u.removeListener(a.ReceiverEvents.receiverClose,p),u.session.connection.removeListener(a.ConnectionEvents.disconnected,f),r&&r.removeEventListener("abort",s)};l=e=>(_(),i.receiver("[%s] Resolving the promise with amqp receiver '%s' on amqp session '%s'.",this.connection.id,d.name,this.id),t(d)),p=e=>(_(),i.error("[%s] Error occurred while creating the amqp receiver '%s' on amqp session '%s' over amqp connection: %O.",this.connection.id,d.name,this.id,e.receiver.error),n(e.receiver.error)),f=e=>{_();const t=e.connection&&e.connection.error?e.connection.error:e.error;return i.error("[%s] Connection got disconnected while creating amqp receiver '%s' on amqp session '%s': %O.",this.connection.id,d.name,this.id,t),n(t)};u.once(a.ReceiverEvents.receiverOpen,l),u.once(a.ReceiverEvents.receiverClose,p),u.session.connection.on(a.ConnectionEvents.disconnected,f),m=setTimeout(()=>{_();const e=`Unable to create the amqp receiver '${d.name}' on amqp session '${this.id}' due to operation timeout.`;return i.error("[%s] %s",this.connection.id,e),n(new h.OperationTimeoutError(e))},1e3*this.connection.options.operationTimeoutInSeconds)})}createSender(e){return this._createSender(l.sender,e)}createAwaitableSender(e){return this._createSender(l.AwaitableSender,e)}_createSender(e,t){return new Promise((n,r)=>{const o=t&&t.abortSignal;let u;if(o){const e=()=>{const e=c.createAbortError();return i.error("[%s] [%s]",this.connection.id,e.message),r(e)};if(u=()=>(b(),p.is_open()?p.close():p.is_closed()||p.once(a.SenderEvents.senderOpen,()=>{p.close()}),e()),o.aborted)return e();o.addEventListener("abort",u)}t&&t.onSessionError&&(this.on(a.SessionEvents.sessionError,t.onSessionError),i.session("[%s] Added event handler for event '%s' on rhea-promise 'session: %s', while creating the sender.",this.connection.id,a.SessionEvents.sessionError,this.id)),t&&t.onSessionClose&&(this.on(a.SessionEvents.sessionClose,t.onSessionClose),i.session("[%s] Added event handler for event '%s' on rhea-promise 'session: %s', while creating the sender.",this.connection.id,a.SessionEvents.sessionClose,this.id));const p=this._session.attach_sender(t);let f,m,_,v,g;f=e===l.sender?new s.Sender(this,p,t):new d.AwaitableSender(this,p,t),f.actionInitiated++,t&&(t.onError&&f.on(a.SenderEvents.senderError,t.onError),t.onClose&&f.on(a.SenderEvents.senderClose,t.onClose),e===l.sender&&(t.onAccepted&&f.on(a.SenderEvents.accepted,t.onAccepted),t.onRejected&&f.on(a.SenderEvents.rejected,t.onRejected),t.onReleased&&f.on(a.SenderEvents.released,t.onReleased),t.onModified&&f.on(a.SenderEvents.modified,t.onModified)));const b=()=>{clearTimeout(g),f.actionInitiated--,p.removeListener(a.SenderEvents.senderOpen,m),p.removeListener(a.SenderEvents.senderClose,_),p.session.connection.removeListener(a.ConnectionEvents.disconnected,v),o&&o.removeEventListener("abort",u)};m=e=>(b(),i.sender("[%s] Resolving the promise with amqp sender '%s' on amqp session '%s'.",this.connection.id,f.name,this.id),n(f)),_=e=>(b(),i.error("[%s] Error occurred while creating the amqp sender '%s' on amqp session '%s' over amqp connection: %O.",this.connection.id,f.name,this.id,e.sender.error),r(e.sender.error)),v=e=>{b();const t=e.connection&&e.connection.error?e.connection.error:e.error;return i.error("[%s] Connection got disconnected while creating amqp sender '%s' on amqp session '%s': %O.",this.connection.id,f.name,this.id,t),r(t)};p.once(a.SenderEvents.sendable,m),p.once(a.SenderEvents.senderClose,_),p.session.connection.on(a.ConnectionEvents.disconnected,v),g=setTimeout(()=>{b();const e=`Unable to create the amqp sender '${f.name}' on amqp session '${this.id}' due to operation timeout.`;return i.error("[%s] %s",this.connection.id,e),r(new h.OperationTimeoutError(e))},1e3*this.connection.options.operationTimeoutInSeconds)})}_initializeEventListeners(){for(const e of Object.keys(a.SessionEvents))this._session.on(a.SessionEvents[e],t=>{const n={rheaContext:t,emitter:this,eventName:a.SessionEvents[e],emitterType:"session",connectionId:this.connection.id};c.emitEvent(n)});this._session.on(a.SenderEvents.senderError,e=>{const t={rheaContext:e,emitter:this,eventName:a.SenderEvents.senderError,emitterType:"session",connectionId:this.connection.id};c.emitEvent(t)}),this._session.on(a.SenderEvents.senderClose,e=>{const t={rheaContext:e,emitter:this,eventName:a.SenderEvents.senderClose,emitterType:"session",connectionId:this.connection.id};c.emitEvent(t)}),this._session.on(a.ReceiverEvents.receiverError,e=>{const t={rheaContext:e,emitter:this,eventName:a.ReceiverEvents.receiverError,emitterType:"session",connectionId:this.connection.id};c.emitEvent(t)}),this._session.on(a.ReceiverEvents.receiverClose,e=>{const t={rheaContext:e,emitter:this,eventName:a.ReceiverEvents.receiverClose,emitterType:"session",connectionId:this.connection.id};c.emitEvent(t)}),"function"==typeof this._session.eventNames&&i.eventHandler("[%s] rhea-promise 'session' object '%s' is listening for events: %o emitted by rhea's 'session' object.",this.connection.id,this.id,this._session.eventNames())}}t.Session=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(29),i=n(22),o=n(16),s=n(26),a=n(40),c=n(27);var u;!function(e){e.sender="sender",e.receiver="receiver"}(u=t.LinkType||(t.LinkType={}));class h extends a.Entity{constructor(e,t,n,r){super(),this.type=e,this._session=t,this._link=n,this.linkOptions=r,this._initializeEventListeners()}get name(){return this._link.name}get error(){return this._link.error}get properties(){return this._link.properties}get sendSettleMode(){return this._link.snd_settle_mode}get receiveSettleMode(){return this._link.rcv_settle_mode}get source(){return this._link.source}set source(e){this._link.set_source(e)}get target(){return this._link.target}set target(e){this._link.set_source(e)}get maxMessageSize(){return this._link.max_message_size}get offeredCapabilities(){return this._link.offered_capabilities}get desiredCapabilities(){return this._link.desired_capabilities}get address(){return this.source.address}get credit(){return this._link.credit}get session(){return this._session}get connection(){return this._session.connection}isOpen(){let e=!1;return this._session.isOpen()&&this._link.is_open()&&(e=!0),e}isRemoteOpen(){return this._link.is_remote_open()}hasCredit(){return this._link.has_credit()}isSender(){return this._link.is_sender()}isReceiver(){return this._link.is_receiver()}isClosed(){return this._link.is_closed()}isItselfClosed(){return this._link.is_itself_closed()}isSessionClosed(){return this._session.isClosed()}isSessionItselfClosed(){return this._session.isItselfClosed()}remove(){this._link&&(this.removeAllListeners(),this._link.removeAllListeners(),this._link.remove()),this._session&&this._session.remove()}close(e){return r.__awaiter(this,void 0,void 0,(function*(){e||(e={}),null==e.closeSession&&(e.closeSession=!0);const t=new Promise((e,t)=>{if(i.error("[%s] The %s '%s' on amqp session '%s' is open ? -> %s",this.connection.id,this.type,this.name,this.session.id,this.isOpen()),!this.isOpen())return e();{const n=this.type===u.sender?o.SenderEvents.senderError:o.ReceiverEvents.receiverError,r=this.type===u.sender?o.SenderEvents.senderClose:o.ReceiverEvents.receiverClose;let s,a,h,d;const l=()=>{clearTimeout(d),this.actionInitiated--,this._link.removeListener(n,s),this._link.removeListener(r,a),this._link.connection.removeListener(o.ConnectionEvents.disconnected,h)};a=t=>(l(),i[this.type]("[%s] Resolving the promise as the %s '%s' on amqp session '%s' has been closed.",this.connection.id,this.type,this.name,this.session.id),e()),s=e=>{l();let n=e.session.error;return this.type===u.sender&&e.sender&&e.sender.error?n=e.sender.error:this.type===u.receiver&&e.receiver&&e.receiver.error&&(n=e.receiver.error),i.error("[%s] Error occurred while closing %s '%s' on amqp session '%s': %O.",this.connection.id,this.type,this.name,this.session.id,n),t(n)},h=e=>{l();const t=e.connection&&e.connection.error?e.connection.error:e.error;i.error("[%s] Connection got disconnected while closing amqp %s '%s' on amqp session '%s': %O.",this.connection.id,this.type,this.name,this.session.id,t)};const p=()=>{l();const e=`Unable to close the ${this.type} '${this.name}' on amqp session '${this.session.id}' due to operation timeout.`;return i.error("[%s] %s",this.connection.id,e),t(new c.OperationTimeoutError(e))};this._link.once(r,a),this._link.once(n,s),this._link.connection.once(o.ConnectionEvents.disconnected,h),d=setTimeout(p,1e3*this.connection.options.operationTimeoutInSeconds),this._link.close(),this.actionInitiated++}});try{yield t}finally{this.removeAllListeners()}if(e.closeSession)return i[this.type]("[%s] %s '%s' has been closed, now closing it's amqp session '%s'.",this.connection.id,this.type,this.name,this.session.id),this._session.close()}))}_initializeEventListeners(){const e=this.type===u.sender?o.SenderEvents:o.ReceiverEvents;for(const t of Object.keys(e))this._link.on(e[t],n=>{const r={rheaContext:n,emitter:this,eventName:e[t],emitterType:this.type,connectionId:this.connection.id};s.emitEvent(r)});"function"==typeof this._link.eventNames&&i.eventHandler("[%s] rhea-promise '%s' object is listening for events: %o emitted by rhea's '%s' object.",this.connection.id,this.type,this._link.eventNames(),this.type),"function"==typeof this._link.listenerCount&&i.eventHandler("[%s] ListenerCount for event '%s_error' on rhea's '%s' object is: %d.",this.connection.id,this.type,this.type,this._link.listenerCount(this.type+"_error"))}}t.Link=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(21);class i extends r.EventEmitter{constructor(){super(),this.actionInitiated=0}}t.Entity=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(39);class i extends r.Link{constructor(e,t,n){super(r.LinkType.sender,e,t,n)}setDrained(e){this._link.set_drained(e)}sendable(){return this._link.sendable()}}t.BaseSender=i;t.SenderSendOptions=class{};t.Sender=class extends i{constructor(e,t,n){super(e,t,n)}send(e,t={}){return this._link.send(e,t.tag,t.format)}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(33),i=n(7),o=n(2),s=n(4),a=n(3),c=n(10);class u{constructor(e,t,n){this.session=e,this.sender=t,this.receiver=n,this._responsesMap=new Map,this.session=e,this.sender=t,this.receiver=n,this.receiver.on(o.ReceiverEvents.message,e=>{!function(e,t,n){const r=e.message;if(!r)return void a.b.verbose(`[${t}] "message" property on the EventContext is "undefined" which is unexpected, returning from the "onMessageReceived" handler without resolving or rejecting the promise upon encountering the message event.`);const o=r.correlation_id;if(!n.has(o))return void a.b.verbose(`[${t}] correlationId "${o}" property on the response does not match with any of the "request-id"s in the map, returning from the "onMessageReceived" handler without resolving or rejecting the promise upon encountering the message event.`);const c=n.get(o);c.cleanupBeforeResolveOrReject();const u=n.delete(o);a.b.verbose(`[${t}] Successfully deleted the response with id ${o} from the map. Delete result - `+u);const h=((e={})=>({statusCode:e[s.a.statusCode]||e.statusCode,statusDescription:e[s.a.statusDescription]||e.statusDescription,errorCondition:e[s.a.errorCondition]||e.errorCondition}))(r.application_properties);let d;h.statusCode||(d=new Error(`[${t}] No statusCode in the "application_properties" in the returned response with correlation-id: ${o}`));if(h.statusCode>199&&h.statusCode<300)return a.b.verbose(`[${t}] Resolving the response with correlation-id: ${o}`),c.resolve(r);if(!d){const e=h.errorCondition||i.a[h.statusCode]||"amqp:internal-error";d=Object(i.e)({condition:e,description:h.statusDescription}),a.b.warning(`${null==d?void 0:d.name}: ${null==d?void 0:d.message}`)}Object(a.a)(d),c.reject(d)}(e,this.connection.id,this._responsesMap)})}get connection(){return this.session.connection}isOpen(){return this.session.isOpen()&&this.sender.isOpen()&&this.receiver.isOpen()}sendRequest(e,t={}){const n=t.timeoutInMs||s.a.defaultOperationTimeoutInMs,u=t.abortSignal;return e.message_id||(e.message_id=Object(o.generate_uuid)()),new Promise((o,h)=>{let d=void 0;const l=()=>{this._responsesMap.delete(e.message_id);const n=this.receiver.address||"address",i=t.requestName,o=`[${this.connection.id}] The request "${i}" to "${n}" has been cancelled by the user.`;a.b.info(o);const c=new r.b(s.b);h(c)},p=()=>{Object(c.a)(d)&&clearTimeout(d),u.removeEventListener("abort",p),l()};if(u){if(u.aborted)return l();u.addEventListener("abort",p)}d=setTimeout(()=>{this._responsesMap.delete(e.message_id),u&&u.removeEventListener("abort",p);const t=this.receiver.address||"address",n={name:"OperationTimeoutError",message:`The request with message_id "${e.message_id}" to "${t}" endpoint timed out. Please try again later.`};return h(Object(i.e)(n))},n),this._responsesMap.set(e.message_id,{resolve:o,reject:h,cleanupBeforeResolveOrReject:()=>{u&&u.removeEventListener("abort",p),Object(c.a)(d)&&clearTimeout(d)}}),a.b.verbose("[%s] %s request sent: %O",this.connection.id,e.to||"$management",e),this.sender.send(e)})}async close(){await this.sender.close({closeSession:!1}),await this.receiver.close({closeSession:!1}),await this.session.close()}remove(){this.sender.remove(),this.receiver.remove(),this.session.remove()}static async create(e,t,n,r={}){const{abortSignal:i}=r,o=await e.createSession({abortSignal:i}),s=await o.createSender(Object.assign(Object.assign({},t),{abortSignal:i})),c=await o.createReceiver(Object.assign(Object.assign({},n),{abortSignal:i}));return a.b.verbose("[%s] Successfully created the sender and receiver links on the same session.",e.id),new u(o,s,c)}}},function(e,t){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},,function(e,t,n){"use strict";(function(r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(67)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(12))},function(e,t,n){"use strict";var r=n(17),i=n(25),o=n(47),s=n(19),a=0,c=1,u=2,h=3,d=4;var l=function(e){this.callback=e,this.outcome=void 0,this.username=void 0};l.prototype.start=function(e,t){var n=function(e){for(var t=[],n=0,r=0;r<e.length;)0===e[r]?(r>n?t.push(e.toString("utf8",n,r)):t.push(null),n=++r):++r;return r>n?t.push(e.toString("utf8",n,r)):t.push(null),t}(e);if(3!==n.length)return Promise.reject("Unexpected response in PLAIN, got "+n.length+" fields, expected 3");var r=this;return Promise.resolve(this.callback(n[1],n[2],t)).then((function(e){e?(r.outcome=!0,r.username=n[1]):r.outcome=!1}))};var p=function(e,t){this.username=e,this.password=t};p.prototype.start=function(e){var t=s.allocate_buffer(1+this.username.length+1+this.password.length);t.writeUInt8(0,0),t.write(this.username,1),t.writeUInt8(0,1+this.username.length),t.write(this.password,1+this.username.length+1),e(void 0,t)};var f=function(){this.outcome=void 0,this.username=void 0};f.prototype.start=function(e){this.outcome=!0,this.username=e?e.toString("utf8"):"anonymous"};var m=function(e){this.username=e||"anonymous"};m.prototype.start=function(e){var t=s.allocate_buffer(1+this.username.length);t.writeUInt8(0,0),t.write(this.username,1),e(void 0,t)};var _=function(){this.outcome=void 0,this.username=void 0};_.prototype.start=function(){this.outcome=!0};var v=function(){this.username=void 0};v.prototype.start=function(e){e(void 0,"")},v.prototype.step=function(e){e(void 0,"")};var g=function(e,t){this.username=e,this.token=t};g.prototype.start=function(e){var t=s.allocate_buffer(this.username.length+this.token.length+5+12+3),n=0;t.write("user=",n),n+=5,t.write(this.username,n),n+=this.username.length,t.writeUInt8(1,n),n+=1,t.write("auth=Bearer ",n),n+=12,t.write(this.token,n),n+=this.token.length,t.writeUInt8(1,n),n+=1,t.writeUInt8(1,n),n+=1,e(void 0,t)};var b=function(e,t){this.connection=e,this.transport=new o(e.amqp_transport.identifier,3,i.TYPE_SASL,this),this.next=e.amqp_transport,this.mechanisms=t,this.mechanism=void 0,this.outcome=void 0,this.username=void 0;var n=Object.getOwnPropertyNames(t);this.transport.encode(i.sasl_frame(i.sasl_mechanisms({sasl_server_mechanisms:n})))};b.prototype.do_step=function(e){if(void 0===this.mechanism.outcome)this.transport.encode(i.sasl_frame(i.sasl_challenge({challenge:e}))),this.connection.output();else{this.outcome=this.mechanism.outcome?a:c;var t=i.sasl_frame(i.sasl_outcome({code:this.outcome}));this.transport.encode(t),this.connection.output(),this.outcome===a&&(this.username=this.mechanism.username,this.transport.write_complete=!0,this.transport.read_complete=!0)}},b.prototype.on_sasl_init=function(e){var t=this.mechanisms[e.performative.mechanism];t?(this.mechanism=t(),Promise.resolve(this.mechanism.start(e.performative.initial_response,e.performative.hostname)).then(this.do_step.bind(this)).catch(this.do_fail.bind(this))):(this.outcome=c,this.transport.encode(i.sasl_frame(i.sasl_outcome({code:this.outcome}))))},b.prototype.on_sasl_response=function(e){Promise.resolve(this.mechanism.step(e.performative.response)).then(this.do_step.bind(this)).catch(this.do_fail.bind(this))},b.prototype.do_fail=function(e){var t=i.sasl_frame(i.sasl_outcome({code:u}));this.transport.encode(t),this.connection.output();try{this.connection.sasl_failed("Sasl callback promise failed with "+e,"amqp:internal-error")}catch(e){console.error("Uncaught error: ",e.message)}},b.prototype.has_writes_pending=function(){return this.transport.has_writes_pending()||this.next.has_writes_pending()},b.prototype.write=function(e){return this.transport.write_complete&&0===this.transport.pending.length?this.next.write(e):this.transport.write(e)},b.prototype.read=function(e){return this.transport.read_complete?this.next.read(e):this.transport.read(e)};var y=function(e,t,n){this.connection=e,this.transport=new o(e.amqp_transport.identifier,3,i.TYPE_SASL,this),this.next=e.amqp_transport,this.mechanisms=t,this.mechanism=void 0,this.mechanism_name=void 0,this.hostname=n,this.failed=!1};y.prototype.on_sasl_mechanisms=function(e){var t=[];Array.isArray(e.performative.sasl_server_mechanisms)?t=e.performative.sasl_server_mechanisms:e.performative.sasl_server_mechanisms&&(t=[e.performative.sasl_server_mechanisms]);for(var n=0;void 0===this.mechanism&&n<t.length;n++){var r=t[n],o=this.mechanisms[r];o&&(this.mechanism="function"==typeof o?o():o,this.mechanism_name=r)}if(this.mechanism){var s=this;this.mechanism.start((function(e,t){if(e)s.failed=!0,s.connection.sasl_failed("SASL mechanism init failed: "+e);else{var n={mechanism:s.mechanism_name,initial_response:t};s.hostname&&(n.hostname=s.hostname),s.transport.encode(i.sasl_frame(i.sasl_init(n))),s.connection.output()}}))}else this.failed=!0,this.connection.sasl_failed("No suitable mechanism; server supports "+e.performative.sasl_server_mechanisms)},y.prototype.on_sasl_challenge=function(e){var t=this;this.mechanism.step(e.performative.challenge,(function(e,n){e?(t.failed=!0,t.connection.sasl_failed("SASL mechanism challenge failed: "+e)):(t.transport.encode(i.sasl_frame(i.sasl_response({response:n}))),t.connection.output())}))},y.prototype.on_sasl_outcome=function(e){switch(e.performative.code){case a:this.transport.read_complete=!0,this.transport.write_complete=!0;break;case u:case h:case d:this.transport.write_complete=!0,this.connection.sasl_failed("Failed to authenticate: "+e.performative.code,"amqp:internal-error");break;default:this.transport.write_complete=!0,this.connection.sasl_failed("Failed to authenticate: "+e.performative.code)}},y.prototype.has_writes_pending=function(){return this.transport.has_writes_pending()||this.next.has_writes_pending()},y.prototype.write=function(e){return this.transport.write_complete?this.next.write(e):this.transport.write(e)},y.prototype.read=function(e){return this.transport.read_complete?this.next.read(e):this.transport.read(e)};var w=function(e,t){this.header_received=!1,this.transports={0:e.amqp_transport,3:new b(e,t)},this.selected=void 0};w.prototype.has_writes_pending=function(){return this.header_received&&this.selected.has_writes_pending()},w.prototype.write=function(e){return this.selected?this.selected.write(e):0},w.prototype.read=function(e){if(!this.header_received){if(e.length<8)return 0;if(this.header_received=i.read_header(e),this.selected=this.transports[this.header_received.protocol_id],void 0===this.selected)throw new r.ProtocolError("Invalid AMQP protocol id "+this.header_received.protocol_id)}return this.selected.read(e)};var E={enable_anonymous:function(){this.ANONYMOUS=function(){return new f}},enable_plain:function(e){this.PLAIN=function(){return new l(e)}}},S={enable_anonymous:function(e){this.ANONYMOUS=function(){return new m(e)}},enable_plain:function(e,t){this.PLAIN=function(){return new p(e,t)}},enable_external:function(){this.EXTERNAL=function(){return new v}},enable_xoauth2:function(e,t){if(e&&t)this.XOAUTH2=function(){return new g(e,t)};else{if(void 0===t)throw Error("token must be specified");if(void 0===e)throw Error("username must be specified")}}};e.exports={Client:y,Server:b,Selective:w,server_mechanisms:function(){return Object.create(E)},client_mechanisms:function(){return Object.create(S)},server_add_external:function(e){return e.EXTERNAL=function(){return new _},e}}},function(e,t,n){"use strict";var r=n(17),i=n(25),o=n(20),s=n(19),a=function(e,t,n,r){this.identifier=e,this.protocol_id=t,this.frame_type=n,this.handler=r,this.pending=[],this.header_sent=void 0,this.header_received=void 0,this.write_complete=!1,this.read_complete=!1};a.prototype.has_writes_pending=function(){return this.pending.length>0||!this.header_sent},a.prototype.encode=function(e){this.pending.push(e)},a.prototype.write=function(e){if(!this.header_sent){var t=s.allocate_buffer(8),n={protocol_id:this.protocol_id,major:1,minor:0,revision:0};o.frames("[%s] -> %o",this.identifier,n),i.write_header(t,n),e.write(t),this.header_sent=n}for(var r=0;r<this.pending.length;r++){var a=this.pending[r];t=i.write_frame(a);e.write(t),a.performative?o.frames("[%s]:%s -> %s %j",this.identifier,a.channel,a.performative.constructor,a.performative,a.payload||""):o.frames("[%s]:%s -> empty",this.identifier,a.channel),o.raw("[%s] SENT: %d %h",this.identifier,t.length,t)}this.pending=[]},a.prototype.read=function(e){var t=0;if(!this.header_received){if(e.length<8)return t;if(this.header_received=i.read_header(e),o.frames("[%s] <- %o",this.identifier,this.header_received),this.header_received.protocol_id!==this.protocol_id)throw 3===this.protocol_id&&0===this.header_received.protocol_id?new r.ProtocolError("Expecting SASL layer"):0===this.protocol_id&&3===this.header_received.protocol_id?new r.ProtocolError("SASL layer not enabled"):new r.ProtocolError("Invalid AMQP protocol id "+this.header_received.protocol_id+" expecting: "+this.protocol_id);t=8}for(;t<e.length-4&&!this.read_complete;){var n=e.readUInt32BE(t);if(o.io("[%s] got frame of size %d",this.identifier,n),e.length<t+n){o.io("[%s] incomplete frame; have only %d of %d",this.identifier,e.length-t,n);break}var s=e.slice(t,t+n);o.raw("[%s] RECV: %d %h",this.identifier,s.length,s);var a=i.read_frame(s);if(a.performative?o.frames("[%s]:%s <- %s %j",this.identifier,a.channel,a.performative.constructor,a.performative,a.payload||""):o.frames("[%s]:%s <- empty",this.identifier,a.channel),a.type!==this.frame_type)throw new r.ProtocolError("Invalid frame type: "+a.type);t+=n,a.performative&&a.performative.dispatch(this.handler,a)}return t},e.exports=a},function(e,t){},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(37),i=n(38),o=n(39),s=n(22);!function(e){e.translate=function(e,t,n){const a=t instanceof r.Connection?t:t.connection;s.contextTranslator("[%s] Translating the context for event: '%s'.",a.id,n);const c=Object.assign({_context:e},e);return c.connection=a,c.container=a.container,t instanceof o.Link?(c.session=t.session,t.type===o.LinkType.receiver&&e.receiver?c.receiver=t:t.type===o.LinkType.sender&&e.sender&&(c.sender=t)):t instanceof i.Session&&(c.session=t),c}}(t.EventContext||(t.EventContext={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(39);class i extends r.Link{constructor(e,t,n){super(r.LinkType.receiver,e,t,n)}get drain(){return this._link.drain}set drain(e){this._link.drain=e}addCredit(e){this._link.add_credit(e)}drainCredit(){this._link.drain_credit()}setCreditWindow(e){this._link.set_credit_window(e)}}t.Receiver=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(16),i=n(22),o=n(41),s=n(16),a=n(27),c=n(26);class u extends o.BaseSender{constructor(e,t,n={}){super(e,t,n),this.deliveryDispositionMap=new Map;const o=e=>{const t=e.id;if(this.deliveryDispositionMap.has(e.id)){const n=this.deliveryDispositionMap.get(t);clearTimeout(n.timer);const r=this.deliveryDispositionMap.delete(t);return i.sender("[%s] Event: 'Accepted', Successfully deleted the delivery with id %d from the map of sender '%s' on amqp session '%s' and cleared the timer: %s.",this.connection.id,t,this.name,this.session.id,r),n.resolve(e)}},c=(e,t,n)=>{if(this.deliveryDispositionMap.has(t)){const r=this.deliveryDispositionMap.get(t);clearTimeout(r.timer);const o=this.deliveryDispositionMap.delete(t);i.sender("[%s] Event: '%s', Successfully deleted the delivery with id %d from the  map of sender '%s' on amqp session '%s' and cleared the timer: %s.",this.connection.id,e,t,this.name,this.session.id,o);const s=`Sender '${this.name}' on amqp session '${this.session.id}', received a '${e}' disposition. Hence we are rejecting the promise.`,c=new a.SendOperationFailedError(s,e,n);return i.error("[%s] %s",this.connection.id,s),r.reject(c)}},u=(e,t)=>{for(const n of this.deliveryDispositionMap.keys())c(e,n,t)};this.on(s.SenderEvents.accepted,e=>{o(e.delivery)}),this.on(s.SenderEvents.rejected,e=>{const t=e.delivery;c(s.SenderEvents.rejected,t.id,t.remote_state&&t.remote_state.error)}),this.on(s.SenderEvents.released,e=>{const t=e.delivery;c(s.SenderEvents.released,t.id,t.remote_state&&t.remote_state.error)}),this.on(s.SenderEvents.modified,e=>{const t=e.delivery;c(s.SenderEvents.modified,t.id,t.remote_state&&t.remote_state.error)}),n.onError||this.on(s.SenderEvents.senderError,e=>{u(s.SenderEvents.senderError,e.sender.error)}),n.onSessionError||this.session.on(r.SessionEvents.sessionError,e=>{u(r.SessionEvents.sessionError,e.session.error)})}send(e,t={}){return new Promise((n,r)=>{i.sender("[%s] Sender '%s' on amqp session '%s', credit: %d available: %d",this.connection.id,this.name,this.session.id,this.credit,this.session.outgoing.available());const o=t&&t.abortSignal,s=t.timeoutInSeconds||20;if(o&&o.aborted){const e=c.createAbortError();return i.error("[%s] %s",this.connection.id,e.message),r(e)}if(this.sendable()){const u=setTimeout(()=>{this.deliveryDispositionMap.delete(l.id);const e=`Sender '${this.name}' on amqp session '${this.session.id}', with address '${this.address}' was not able to send the message with delivery id ${l.id} right now, due to operation timeout.`;return i.error("[%s] %s",this.connection.id,e),r(new a.OperationTimeoutError(e))},1e3*s),h=()=>{if(this.deliveryDispositionMap.has(l.id)){const e=this.deliveryDispositionMap.get(l.id);clearTimeout(e.timer);const t=this.deliveryDispositionMap.delete(l.id);i.sender("[%s] Event: 'abort', Successfully deleted the delivery with id %d from the  map of sender '%s' on amqp session '%s' and cleared the timer: %s.",this.connection.id,l.id,this.name,this.session.id,t);const n=c.createAbortError();i.error("[%s] %s",this.connection.id,n.message),e.reject(n)}},d=()=>{o&&o.removeEventListener("abort",h)},l=this._link.send(e,t.tag,t.format);this.deliveryDispositionMap.set(l.id,{resolve:e=>{n(e),d()},reject:e=>{r(e),d()},timer:u}),o&&o.addEventListener("abort",h)}else{const e=`Sender "${this.name}" on amqp session "${this.session.id}", with address `+this.address+" cannot send the message right now as it does not have enough credit. Please try later.";i.error("[%s] %s",this.connection.id,e),r(new a.InsufficientCreditError(e))}})}}t.AwaitableSender=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(29),i=n(16),o=n(21),s=n(37);class a extends o.EventEmitter{constructor(e){e||(e={}),super(),e.createdInstance?(this._container=e.createdInstance,delete e.createdInstance):this._container=i.create_container(e),this.options=this._container.options}get id(){return this._container.id}get filter(){return this._container.filter}get types(){return this._container.types}get message(){return this._container.message}get sasl(){return this._container.sasl}get saslServerMechanisms(){return this._container.sasl_server_mechanisms}createConnection(e){const t=this._container.create_connection(e);return new s.Connection({rheaConnection:t,container:this})}connect(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.createConnection(e).open()}))}listen(e){return this._container.listen(e)}generateUUid(){return this._container.generate_uuid()}stringToUuid(e){return this._container.string_to_uuid(e)}uuidToString(e){return this._container.uuid_to_string(e)}websocketAccept(e,t){return this._container.websocket_accept(e,t)}websocketConnect(e){return this._container.websocket_connect(e)}static create(e){return new a(e)}static copyFromContainerInstance(e){return new a({createdInstance:e})}}t.Container=a},function(e,t,n){"use strict";function r(...e){if(e.length>0){const t=String(e[0]);t.includes(":error")?console.error(...e):t.includes(":warning")?console.warn(...e):t.includes(":info")?console.info(...e):(t.includes(":verbose"),console.debug(...e))}}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(33),i=n(2),o=n(4),s=n(3);class a{constructor(){this._keyMap=new Map,this._executionRunningSet=new Set}acquire(e,t,n){var a;const{abortSignal:c,timeoutInMs:u}=n;if(null==c?void 0:c.aborted)return Promise.reject(new r.b(o.b));const h=null!==(a=this._keyMap.get(e))&&void 0!==a?a:[];this._keyMap.set(e,h);const{promise:d,rejecter:l,resolver:p}=function(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolver:e,rejecter:t}}(),f={reject:l,resolve:p,task:t};if("number"==typeof u){const t=setTimeout(()=>{this._removeTaskDetails(e,f),l(new i.OperationTimeoutError("The task timed out waiting to acquire a lock for "+e))},u);f.tid=t}if(c){const t=()=>{this._removeTaskDetails(e,f),l(new r.b(o.b))};c.addEventListener("abort",t),f.abortSignal=c,f.abortListener=t}return h.push(f),s.b.verbose(`Called acquire() for lock "${e}". Lock "${e}" has ${h.length} pending tasks.`),this._execute(e),d}async _execute(e){if(this._executionRunningSet.has(e))return;const t=this._keyMap.get(e);if(t&&t.length){for(this._executionRunningSet.add(e);t.length;){const n=t.shift();if(n){try{s.b.verbose(`Acquired lock for "${e}", invoking task.`),c(n);const t=await n.task();n.resolve(t)}catch(e){n.reject(e)}s.b.verbose(`Task completed for lock "${e}". Lock "${e}" has ${t.length} pending tasks.`)}}this._executionRunningSet.delete(e)}}_removeTaskDetails(e,t){const n=this._keyMap.get(e);if(!n||!n.length)return;const r=n.indexOf(t);if(-1!==r){const[e]=n.splice(r,1);c(e)}}}function c(e){e.tid&&clearTimeout(e.tid),e.abortSignal&&e.abortListener&&e.abortSignal.removeEventListener("abort",e.abortListener)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return _}));var r=n(4),i=n(10),o=n(7),s=n(42),a=n(11),c=n(58),u=n(2),h=n(0),d=n(6),l=n(23),p=n(8),f=n(14),m=n(32);class _ extends l.a{constructor(e,t){super(e,{address:t&&t.address?t.address:r.a.management,audience:t&&t.audience?t.audience:e.config.getManagementAudience()}),this.managementLock=`${r.a.managementRequestKey}-${Object(m.a)()}`,this.replyTo=Object(m.a)(),this._context=e,this.entityPath=e.config.entityPath}async getSecurityToken(){if(Object(i.c)(this._context.tokenCredential)){const e=this.audience.split("/");e[e.length-1]===this.address&&e.pop();const t=e.join("/");return this._context.tokenCredential.getToken(t)}return this._context.tokenCredential.getToken(r.a.aadEventHubsScope)}async getEventHubProperties(t={}){return Object(d.c)(this._context),p.b.withSpan("ManagementClient.getEventHubProperties",t,async t=>{try{const n=await this.getSecurityToken(),i={body:e.from(JSON.stringify([])),message_id:Object(m.a)(),reply_to:this.replyTo,application_properties:{operation:r.a.readOperation,name:this.entityPath,type:`${r.a.vendorString}:${r.a.eventHub}`,security_token:null==n?void 0:n.token}},o=await this._makeManagementRequest(i,Object.assign(Object.assign({},t),{requestName:"getHubRuntimeInformation"})),s={name:o.name,createdOn:new Date(o.created_at),partitionIds:o.partition_ids};return h.b.verbose("[%s] The hub runtime info is: %O",this._context.connectionId,s),s}catch(e){throw h.b.warning(`An error occurred while getting the hub runtime information: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(h.a)(e),e}},Object(p.a)(this._context.config))}async getPartitionProperties(t,n={}){return Object(d.c)(this._context),Object(d.d)(this._context.connectionId,"getPartitionProperties","partitionId",t),t=String(t),p.b.withSpan("ManagementClient.getPartitionProperties",n,async n=>{try{const i=await this.getSecurityToken(),o={body:e.from(JSON.stringify([])),message_id:Object(m.a)(),reply_to:this.replyTo,application_properties:{operation:r.a.readOperation,name:this.entityPath,type:`${r.a.vendorString}:${r.a.partition}`,partition:""+t,security_token:null==i?void 0:i.token}},s=await this._makeManagementRequest(o,Object.assign(Object.assign({},n),{requestName:"getPartitionInformation"})),a={beginningSequenceNumber:s.begin_sequence_number,eventHubName:s.name,lastEnqueuedOffset:s.last_enqueued_offset,lastEnqueuedOnUtc:new Date(s.last_enqueued_time_utc),lastEnqueuedSequenceNumber:s.last_enqueued_sequence_number,partitionId:s.partition,isEmpty:s.is_partition_empty};return h.b.verbose("[%s] The partition info is: %O.",this._context.connectionId,a),a}catch(e){throw h.b.warning(`An error occurred while getting the partition information: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(h.a)(e),e}},Object(p.a)(this._context.config))}async close(){try{if(clearTimeout(this._tokenRenewalTimer),this._isMgmtRequestResponseLinkOpen()){const e=this._mgmtReqResLink;this._mgmtReqResLink=void 0,await e.close(),h.b.info("Successfully closed the management session.")}}catch(e){const t=`An error occurred while closing the management session: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`;throw h.b.warning(t),Object(h.a)(e),new Error(t)}}async _init({abortSignal:e,timeoutInMs:t}){try{if(!this._isMgmtRequestResponseLinkOpen()){await this._context.readyToOpenLink(),await this._negotiateClaim({setTokenRenewal:!1,abortSignal:e,timeoutInMs:t});const n={source:{address:this.address},name:this.replyTo,target:{address:this.replyTo},onSessionError:e=>{const t=e.connection.options.id,n=Object(o.e)(e.session.error);h.b.verbose("[%s] An error occurred on the session for request/response links for $management: %O",t,n)}},r={target:{address:this.address}};h.b.verbose("[%s] Creating sender/receiver links on a session for $management endpoint with srOpts: %o, receiverOpts: %O.",this._context.connectionId,r,n),this._mgmtReqResLink=await s.a.create(this._context.connection,r,n,{abortSignal:e}),this._mgmtReqResLink.sender.on(u.SenderEvents.senderError,e=>{const t=e.connection.options.id,n=Object(o.e)(e.sender.error);h.b.verbose("[%s] An error occurred on the $management sender link.. %O",t,n)}),this._mgmtReqResLink.receiver.on(u.ReceiverEvents.receiverError,e=>{const t=e.connection.options.id,n=Object(o.e)(e.receiver.error);h.b.verbose("[%s] An error occurred on the $management receiver link.. %O",t,n)}),h.b.verbose("[%s] Created sender '%s' and receiver '%s' links for $management endpoint.",this._context.connectionId,this._mgmtReqResLink.sender.name,this._mgmtReqResLink.receiver.name),await this._ensureTokenRenewal()}}catch(e){const t=Object(o.e)(e);throw h.b.warning(`[${this._context.connectionId}] An error occured while establishing the $management links: ${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(h.a)(t),t}}async _makeManagementRequest(e,t={}){const n=t.retryOptions||{};try{const r=t&&t.abortSignal,i=async()=>{const n=Object(f.a)(t.retryOptions);let i=0;if(!this._isMgmtRequestResponseLinkOpen()){h.b.verbose("[%s] Acquiring lock to get the management req res link.",this._context.connectionId);const e=Date.now();try{await a.a.acquire(this.managementLock,()=>{const t=Date.now(),i=n-(t-e);return this._init({abortSignal:r,timeoutInMs:i})},{abortSignal:r,timeoutInMs:n})}catch(e){const t=Object(o.e)(e);throw h.b.warning("[%s] An error occurred while creating the management link %s: %s",this._context.connectionId,this.name,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(h.a)(t),t}i=Date.now()-e}const s=n-i,c={abortSignal:t.abortSignal,requestName:t.requestName,timeoutInMs:s};return e.message_id||(e.message_id=Object(u.generate_uuid)()),this._mgmtReqResLink.sendRequest(e,c)},s=Object.defineProperties({operation:i,operationType:c.b.management,abortSignal:r,retryOptions:n},{connectionId:{enumerable:!0,get:()=>this._context.connectionId}});return(await Object(c.c)(s)).body}catch(e){const t=Object(o.e)(e);throw h.b.warning("[%s] An error occurred during send on management request-response link with address '%s': %s",this._context.connectionId,this.address,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(h.a)(t),t}}_isMgmtRequestResponseLinkOpen(){return this._mgmtReqResLink&&this._mgmtReqResLink.isOpen()}}}).call(this,n(13).Buffer)},function(e,t,n){"use strict";(function(e){function r(t,n){const r=function(t){const n=function(e,t=0,n=0){let r,o,s;r=o=s=3735928559+e.length+t,s+=n;let a=0,c=e.length;for(;c>12;)r+=i(e,a),o+=i(e,a+4),s+=i(e,a+8),r-=s,r^=s<<4|s>>>28,s+=o,o-=r,o^=r<<6|r>>>26,r+=s,s-=o,s^=o<<8|o>>>24,o+=r,r-=s,r^=s<<16|s>>>16,s+=o,o-=r,o^=r<<19|r>>>13,r+=s,s-=o,s^=o<<4|o>>>28,o+=r,a+=12,c-=12;let u=c;switch(u){case 12:r+=i(e,a),o+=i(e,a+4),s+=i(e,a+8);break;case 11:s+=e[a+10]<<16,u=10;case 10:s+=e[a+9]<<8,u=9;case 9:s+=e[a+8],u=8;case 8:o+=i(e,a+4),r+=i(e,a);break;case 7:o+=e[a+6]<<16,u=6;case 6:o+=e[a+5]<<8,u=5;case 5:o+=e[a+4],u=4;case 4:r+=i(e,a);break;case 3:r+=e[a+2]<<16,u=2;case 2:r+=e[a+1]<<8,u=1;case 1:r+=e[a];break;case 0:return{b:o>>>0,c:s>>>0}}return s^=o,s-=o<<14|o>>>18,r^=s,r-=s<<11|s>>>21,o^=r,o-=r<<25|r>>>7,s^=o,s-=o<<16|o>>>16,r^=s,r-=s<<4|s>>>28,o^=r,o-=r<<14|r>>>18,s^=o,s-=o<<24|o>>>8,{b:o>>>0,c:s>>>0}}(e.from(t,"utf8"));return r=n.c^n.b,new Int16Array([r])[0];var r}(t);return Math.abs(r%n)}function i(e,t){return e.readUInt32LE(t)}n.d(t,"a",(function(){return r}))}).call(this,n(13).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return d}));var r=n(7),i=n(4);var o,s,a=n(11),c=n(3);function u(e){let t=!1;return e&&"number"==typeof e.id&&"boolean"==typeof e.settled&&"boolean"==typeof e.remote_settled&&"number"==typeof e.format&&(t=!0),t}function h(e,t,n,r){if(r===o.Exponential){const r=(.8*t+Math.floor(Math.random()*(1.2*t-.8*t)))*(Math.pow(2,e)-1);return Math.min(r,n)}return t}async function d(e){let t,n;!function(e){if(!e.operation)throw new TypeError("Missing 'operation' in retry configuration");if(!e.connectionId)throw new TypeError("Missing 'connectionId' in retry configuration");if(!e.operationType)throw new TypeError("Missing 'operationType' in retry configuration")}(e),e.retryOptions||(e.retryOptions={}),(null==e.retryOptions.maxRetries||e.retryOptions.maxRetries<0)&&(e.retryOptions.maxRetries=i.a.defaultMaxRetries),(null==e.retryOptions.retryDelayInMs||e.retryOptions.retryDelayInMs<0)&&(e.retryOptions.retryDelayInMs=i.a.defaultDelayBetweenOperationRetriesInMs),(null==e.retryOptions.maxRetryDelayInMs||e.retryOptions.maxRetryDelayInMs<0)&&(e.retryOptions.maxRetryDelayInMs=i.a.defaultMaxDelayForExponentialRetryInMs),null==e.retryOptions.mode&&(e.retryOptions.mode=o.Fixed);let s=!1;const d=e.retryOptions.maxRetries+1;for(let i=1;i<=d;i++){c.b.verbose("[%s] Attempt number for '%s': %d.",e.connectionId,e.operationType,i);try{n=await e.operation(),s=!0,c.b.verbose("[%s] Success for '%s', after attempt number: %d.",e.connectionId,e.operationType,i),n&&!u(n)&&c.b.verbose("[%s] Success result for '%s': %O",e.connectionId,e.operationType,n);break}catch(n){let o=n;if(o.translated||(o=Object(r.e)(o)),!o.retryable&&"ServiceCommunicationError"===o.name&&e.connectionHost){await(e.connectionHost,Promise.resolve(self.navigator.onLine))||(o.name="ConnectionLostError",o.retryable=!0)}if(t=o,c.b.verbose("[%s] Error occurred for '%s' in attempt number %d: %O",e.connectionId,e.operationType,i,o),t&&t.retryable&&d>i){const t=h(i,e.retryOptions.retryDelayInMs,e.retryOptions.maxRetryDelayInMs,e.retryOptions.mode);c.b.verbose("[%s] Sleeping for %d milliseconds for '%s'.",e.connectionId,t,e.operationType),await Object(a.b)(t,e.abortSignal,"The retry operation has been cancelled by the user.");continue}break}}if(s)return n;throw t}!function(e){e[e.Exponential=0]="Exponential",e[e.Fixed=1]="Fixed"}(o||(o={})),function(e){e.cbsAuth="cbsAuth",e.connection="connection",e.management="management",e.receiverLink="receiverLink",e.senderLink="senderLink",e.sendMessage="sendMessage",e.receiveMessage="receiveMessage",e.session="session",e.messageSettlement="settlement"}(s||(s={}))},function(e,t,n){const{EventHubProducerClient:r,EventHubConsumerClient:i}=n(79);flutterAzureEventHubs={},flutterAzureEventHubs.eventHubProducerClient=r,flutterAzureEventHubs.eventHubConsumerClient=i,flutterAzureEventHubs.instances={},flutterAzureEventHubs.instances.eventHubProducerClient=[],flutterAzureEventHubs.instances.eventHubConsumerClient=[],flutterAzureEventHubs.api={},flutterAzureEventHubs.setEventHubProducerClient=function(e,t){flutterAzureEventHubs.instances.eventHubProducerClient.push({key:e,value:t})},flutterAzureEventHubs.getEventHubProducerClientByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.eventHubProducerClient.length;t++)if(flutterAzureEventHubs.instances.eventHubProducerClient[t].key===e)return flutterAzureEventHubs.instances.eventHubProducerClient[t].value},flutterAzureEventHubs.removeEventHubProducerClientByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.eventHubProducerClient.length;t++)if(flutterAzureEventHubs.instances.eventHubProducerClient[t].key===e){flutterAzureEventHubs.instances.eventHubProducerClient.splice(t,1),t--;break}},flutterAzureEventHubs.setEventHubConsumerClient=function(e,t){flutterAzureEventHubs.instances.eventHubConsumerClient.push({key:e,value:t})},flutterAzureEventHubs.getEventHubConsumerClientByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.eventHubConsumerClient.length;t++)if(flutterAzureEventHubs.instances.eventHubConsumerClient[t].key===e)return flutterAzureEventHubs.instances.eventHubConsumerClient[t].value},flutterAzureEventHubs.removeEventHubConsumerClientByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.eventHubConsumerClient.length;t++)if(flutterAzureEventHubs.instances.eventHubConsumerClient[t].key===e){flutterAzureEventHubs.instances.eventHubConsumerClient.splice(t,1),t--;break}},flutterAzureEventHubs.api.createEventHubProducerClient=function(e,t,n,r,i){try{var o=new flutterAzureEventHubs.eventHubProducerClient(t,n);flutterAzureEventHubs.setEventHubProducerClient(e,o),proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:r,success:!0,result:""}))}catch(e){proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:r,success:!1,result:e.toString()}))}},flutterAzureEventHubs.api.sendEventDataBatch=function(e,t,n,r,i){var o=flutterAzureEventHubs.getEventHubProducerClientByKey(e);null!=o?o.sendBatch(t,n).then((function(){proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:r,success:!0,result:""}))})).catch((function(e){proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:r,success:!1,result:e.toString()}))})):proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:r,success:!1,result:"ERROR: EventHubProducerClient not found."}))},flutterAzureEventHubs.api.closeEventHubProducerClient=function(e,t,n){var r=flutterAzureEventHubs.getEventHubProducerClientByKey(e);null!=r?r.close().then((function(){proxyInterop.postMessage(JSON.stringify({id:n,javascriptTransactionId:t,success:!0,result:""}))})).catch((function(e){proxyInterop.postMessage(JSON.stringify({id:n,javascriptTransactionId:t,success:!1,result:e.toString()}))})):proxyInterop.postMessage(JSON.stringify({id:n,javascriptTransactionId:t,success:!1,result:"ERROR: EventHubProducerClient not found."}))},flutterAzureEventHubs.api.createEventHubConsumerClient=function(e,t,n,r,i,o){try{var s=new flutterAzureEventHubs.eventHubConsumerClient(t,n,r);flutterAzureEventHubs.setEventHubConsumerClient(e,s),proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:i,success:!0,result:""}))}catch(e){proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:i,success:!1,result:e.toString()}))}},flutterAzureEventHubs.api.subscribe=function(e,t,n,r,i){var o=flutterAzureEventHubs.getEventHubConsumerClientByKey(e);if(null!=o)try{o.subscribe({processEvents:function(e,n){var r={receivedEventDataList:[]};for(var o in e)r.receivedEventDataList.push({body:e[o].body,enqueuedTimeUtc:e[o].enqueuedTimeUtc,partitionKey:e[o].partitionKey,offset:e[o].offset,sequenceNumber:e[o].sequenceNumber});r.partitionContext={fullyQualifiedNamespace:n._context.fullyQualifiedNamespace,eventHubName:n._context.eventHubName,consumerGroup:n._context.consumerGroup,partitionId:n._context.partitionId},proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:t,success:!0,result:JSON.stringify(r)}))},processError:function(e){proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:t,success:!1,result:e.toString()}))}},n),proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:r,success:!0,result:""}))}catch(e){proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:r,success:!1,result:e.toString()}))}else proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:r,success:!1,result:"ERROR: EventHubConsumerClient not found."}))}},function(e,t,n){"use strict";(function(t,r){var i=n(17),o=n(25),s=n(20),a=n(46),c=n(19),u=n(35),h=n(69),d=n(47),l=n(72),p=n(73),f=n(74),m=n(48),_=n(49),v=n(21).EventEmitter;function g(){var e=function(){var e;e=t.env.MESSAGING_CONNECT_FILE?[t.env.MESSAGING_CONNECT_FILE]:[t.cwd(),f.join(p.homedir(),".config/messaging"),"/etc/messaging"].map((function(e){return f.join(e,"/connect.json")}));for(var n=0;n<e.length;n++)if(l.existsSync(e[n])){var r=JSON.parse(l.readFileSync(e[n],"utf8"));return s.config("using config from %s: %j",e[n],r),r}return{}}(),n={};return"amqps"===e.scheme&&(n.transport="tls"),e.host&&(n.host=e.host),"amqp"===e.port?n.port=5672:"amqps"===e.port?n.port=5671:n.port=e.port,e.sasl&&!1===e.sasl.enabled||(e.user?n.username=e.user:n.username="anonymous",e.password&&(n.password=e.password),e.sasl_mechanisms&&(n.sasl_mechanisms=e.sasl_mechanisms)),e.tls&&(e.tls.key&&(n.key=l.readFileSync(e.tls.key)),e.tls.cert&&(n.cert=l.readFileSync(e.tls.cert)),e.tls.ca&&(n.ca=[l.readFileSync(e.tls.ca)]),!1!==e.verify&&!1!==e.tls.verify||(n.rejectUnauthorized=!1)),"tls"===n.transport&&(n.servername=n.host),n}function b(e){return e.get_id_string?e.get_id_string():e.localAddress+":"+e.localPort+" -> "+e.remoteAddress+":"+e.remotePort}function y(e,t){if(e){var n,r=e;return function(i){return n!==i&&(r=e,n=i),r--?t(i):-1}}return t}function w(e){if(void 0===e.transport||"tcp"===e.transport)return m.connect;if("tls"===e.transport||"ssl"===e.transport)return _.connect;throw Error("Unrecognised transport: "+e.transport)}var E=["container_id","hostname","max_frame_size","channel_max","idle_time_out","outgoing_locales","incoming_locales","offered_capabilities","desired_capabilities","properties"];function S(e,t){if("boolean"==typeof e)if(e){var n=t.get_option("initial_reconnect_delay",100),r=t.get_option("max_reconnect_delay",6e4);t.options.reconnect=y(t.get_option("reconnect_limit"),function(e,t){var n,r=e;return function(i){n!==i&&(r=e,n=i);var o=r,s=2*r;return r=t>s?s:t,o}}(n,r))}else t.options.reconnect=!1;else if("number"==typeof e){var i=t.options.reconnect;t.options.reconnect=y(t.get_option("reconnect_limit"),(function(){return i}))}}var O=1,C=function(e,t){if(this.options={},e){for(var n in e)this.options[n]=e[n];"tls"!==e.transport&&"ssl"!==e.transport||void 0!==e.servername||void 0===e.host||(this.options.servername=e.host)}else this.options=g();if(this.container=t,this.options.id||(this.options.id="connection-"+O++),this.options.container_id||(this.options.container_id=t?t.id:c.generate_uuid()),!this.options.connection_details){var r=this;this.options.connection_details=function(){return function(e){var t={};return t.connect=e.connect?e.connect:w(e),t.host=e.host?e.host:"localhost",t.port=e.port?e.port:5672,t.options=e,t}(r.options)}}var i,s,a,h;S(this.get_option("reconnect",!0),this),this.registered=!1,this.state=new u,this.local_channel_map={},this.remote_channel_map={},this.local={},this.remote={},this.local.open=o.open((i=this.options,s={},E.forEach((function(e){void 0!==i[e]&&(s[e]=i[e])})),s)),this.local.close=o.close({}),this.session_policy=(a=this,h=null,{get_session:function(){return h||((h=a.create_session()).observers.on("session_close",(function(){h=null})),h.begin()),h}}),this.amqp_transport=new d(this.options.id,0,o.TYPE_AMQP,this),this.sasl_transport=void 0,this.transport=this.amqp_transport,this.conn_established_counter=0,this.heartbeat_out=void 0,this.heartbeat_in=void 0,this.abort_idle=void 0,this.socket_ready=!1,this.scheduled_reconnect=void 0,this.default_sender=void 0,this.closed_with_non_fatal_error=!1;r=this;E.forEach((function(e){var t;Object.defineProperty(r,e,{get:(t=e,function(){return this.remote.open?this.remote.open[t]:void 0})})})),Object.defineProperty(this,"error",{get:function(){return this.remote.close?this.remote.close.error:void 0}})};function I(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&delete e[t]}function k(e){C.prototype["on_"+e]=function(t){var n=this.remote_channel_map[t.channel];if(!n)throw new i.ProtocolError(e+" received on invalid channel "+t.channel);n["on_"+e](t)}}(C.prototype=Object.create(v.prototype)).constructor=C,C.prototype.dispatch=function(e){return s.events("[%s] Connection got event: %s",this.options.id,e),this.listeners(e).length?(v.prototype.emit.apply(this,arguments),!0):!!this.container&&this.container.dispatch.apply(this.container,arguments)},C.prototype._disconnect=function(){for(var e in this.state.disconnected(),this.local_channel_map)this.local_channel_map[e]._disconnect();this.socket_ready=!1},C.prototype._reconnect=function(){this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0,this.local.close.error=void 0,this.state=new u,this.state.open()),this.state.reconnect(),this._reset_remote_state()},C.prototype._reset_remote_state=function(){this.amqp_transport=new d(this.options.id,0,o.TYPE_AMQP,this),this.sasl_transport=void 0,this.transport=this.amqp_transport,this.remote={},this.remote_channel_map={};var e=this.local_channel_map;for(var t in e)e[t]._reconnect()},C.prototype.connect=function(){return this.is_server=!1,this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0),this._reset_remote_state(),this._connect(this.options.connection_details(this.conn_established_counter)),this.open(),this},C.prototype.reconnect=function(){return this.scheduled_reconnect=void 0,s.reconnect("[%s] reconnecting...",this.options.id),this._reconnect(),this._connect(this.options.connection_details(this.conn_established_counter)),t.nextTick(this._process.bind(this)),this},C.prototype.set_reconnect=function(e){S(e,this)},C.prototype._connect=function(e){return e.connect?this.init(e.connect(e.port,e.host,e.options,this.connected.bind(this))):this.init(w(e)(e.port,e.host,e.options,this.connected.bind(this))),this},C.prototype.accept=function(e){return this.is_server=!0,s.io("[%s] client accepted: %s",this.id,b(e)),this.socket_ready=!0,this.init(e)},C.prototype.abort_socket=function(e){e===this.socket&&(this.abort_idle=void 0,s.io("[%s] aborting socket",this.options.id),this.socket.end(),this.socket.removeAllListeners&&(this.socket.removeAllListeners("data"),this.socket.removeAllListeners("error"),this.socket.removeAllListeners("end")),"function"==typeof this.socket.destroy&&this.socket.destroy(),this._disconnected())},C.prototype.init=function(e){if(this.socket=e,this.get_option("tcp_no_delay",!1)&&this.socket.setNoDelay&&this.socket.setNoDelay(!0),this.socket.on("data",this.input.bind(this)),this.socket.on("error",this.on_error.bind(this)),this.socket.on("end",this.eof.bind(this)),this.is_server){var t;if(this.container&&Object.getOwnPropertyNames(this.container.sasl_server_mechanisms).length&&(t=this.container.sasl_server_mechanisms),this.socket.encrypted&&this.socket.authorized&&this.get_option("enable_sasl_external",!1)&&(t=a.server_add_external(t?c.clone(t):{})),t)void 0===t.ANONYMOUS||this.get_option("require_sasl",!1)?this.sasl_transport=new a.Server(this,t):this.sasl_transport=new a.Selective(this,t);else if(!this.get_option("disable_sasl",!1)){var n=a.server_mechanisms();n.enable_anonymous(),this.sasl_transport=new a.Selective(this,n)}}else{var r=this.get_option("sasl_mechanisms");if(!r){var i=this.get_option("username"),o=this.get_option("password"),s=this.get_option("token");i&&(r=a.client_mechanisms(),o?r.enable_plain(i,o):s?r.enable_xoauth2(i,s):r.enable_anonymous(i))}this.socket.encrypted&&this.options.cert&&this.get_option("enable_sasl_external",!1)&&(r||(r=a.client_mechanisms()),r.enable_external()),r&&(this.sasl_transport=new a.Client(this,r,this.options.sasl_init_hostname||this.options.servername||this.options.host))}return this.transport=this.sasl_transport?this.sasl_transport:this.amqp_transport,this},C.prototype.attach_sender=function(e){return this.session_policy.get_session().attach_sender(e)},C.prototype.open_sender=C.prototype.attach_sender,C.prototype.attach_receiver=function(e){return this.get_option("tcp_no_delay",!0)&&this.socket.setNoDelay&&this.socket.setNoDelay(!0),this.session_policy.get_session().attach_receiver(e)},C.prototype.open_receiver=C.prototype.attach_receiver,C.prototype.get_option=function(e,t){return void 0!==this.options[e]?this.options[e]:this.container?this.container.get_option(e,t):t},C.prototype.send=function(e){return void 0===this.default_sender&&(this.default_sender=this.open_sender({target:{}})),this.default_sender.send(e)},C.prototype.connected=function(){this.socket_ready=!0,this.conn_established_counter++,s.io("[%s] connected %s",this.options.id,b(this.socket)),this.output()},C.prototype.sasl_failed=function(e,t){this.transport_error=new i.ConnectionError(e,t||"amqp:unauthorized-access",this),this._handle_error(),this.socket.end()},C.prototype._is_fatal=function(e){return!this.get_option("all_errors_non_fatal",!1)&&this.get_option("non_fatal_errors",["amqp:connection:forced"]).indexOf(e)<0},C.prototype._handle_error=function(){var e=this.get_error();if(e){var t=this.dispatch("connection_error",this._context({error:e}));return t=this.dispatch("connection_close",this._context({error:e}))||t,this._is_fatal(e.condition)?t||this.dispatch("error",new i.ConnectionError(e.description,e.condition,this)):this.state.local_open&&(this.closed_with_non_fatal_error=!0),!0}return!1},C.prototype.get_error=function(){return this.transport_error?this.transport_error:this.remote.close&&this.remote.close.error?new i.ConnectionError(this.remote.close.error.description,this.remote.close.error.condition,this):void 0},C.prototype._get_peer_details=function(){var e="";return this.remote.open&&this.remote.open.container&&(e+=this.remote.open.container+" "),this.remote.open&&this.remote.open.properties&&(e+=JSON.stringify(this.remote.open.properties)),e},C.prototype.output=function(){try{this.socket&&this.socket_ready&&(this.heartbeat_out&&clearTimeout(this.heartbeat_out),this.transport.write(this.socket),(this.is_closed()&&this.state.has_settled()||this.abort_idle||this.transport_error)&&!this.transport.has_writes_pending()?this.socket.end():this.is_open()&&this.remote.open.idle_time_out&&(this.heartbeat_out=setTimeout(this._write_frame.bind(this),this.remote.open.idle_time_out/2)),this.local.open.idle_time_out&&void 0===this.heartbeat_in&&(this.heartbeat_in=setTimeout(this.idle.bind(this),this.local.open.idle_time_out)))}catch(e){this.saved_error=e,"ProtocolError"===e.name?(console.error("["+this.options.id+"] error on write: "+e+" "+this._get_peer_details()+" "+e.name),this.dispatch("protocol_error",e)||console.error("["+this.options.id+"] error on write: "+e+" "+this._get_peer_details())):this.dispatch("error",e),this.socket.end()}},C.prototype.input=function(e){var t;try{this.heartbeat_in&&clearTimeout(this.heartbeat_in),s.io("[%s] read %d bytes",this.options.id,e.length),this.previous_input?(t=r.concat([this.previous_input,e],this.previous_input.length+e.length),this.previous_input=null):t=e;var n=this.transport.read(t,this);n<t.length&&(this.previous_input=t.slice(n)),this.local.open.idle_time_out&&(this.heartbeat_in=setTimeout(this.idle.bind(this),this.local.open.idle_time_out)),this.transport.has_writes_pending()?this.output():this.is_closed()&&this.state.has_settled()?this.socket.end():this.is_open()&&this.remote.open.idle_time_out&&!this.heartbeat_out&&(this.heartbeat_out=setTimeout(this._write_frame.bind(this),this.remote.open.idle_time_out/2))}catch(e){this.saved_error=e,"ProtocolError"===e.name?this.dispatch("protocol_error",e)||console.error("["+this.options.id+"] error on read: "+e+" "+this._get_peer_details()+" (buffer:"+function(e){for(var t,n=[],r=0;r<e.length;r++)n.push((t=e[r])<16?"0x0"+Number(t).toString(16):"0x"+Number(t).toString(16));return n.join(",")}(t)+")"):this.dispatch("error",e),this.socket.end()}},C.prototype.idle=function(){this.is_closed()||(this.closed_with_non_fatal_error=!0,this.local.close.error={condition:"amqp:resource-limit-exceeded",description:"max idle time exceeded"},this.close(),this.abort_idle=setTimeout(this.abort_socket.bind(this,this.socket),1e3))},C.prototype.on_error=function(e){this._disconnected(e)},C.prototype.eof=function(e){var t=e||this.saved_error;this.saved_error=void 0,this._disconnected(t)},C.prototype._disconnected=function(e){this.heartbeat_out&&(clearTimeout(this.heartbeat_out),this.heartbeat_out=void 0),this.heartbeat_in&&(clearTimeout(this.heartbeat_in),this.heartbeat_in=void 0),this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0);var t=this.closed_with_non_fatal_error;if(this.closed_with_non_fatal_error&&(this.closed_with_non_fatal_error=!1,this.options.reconnect&&this.open()),(!this.is_closed()||t)&&void 0===this.scheduled_reconnect){this._disconnect();var n={};if(e&&(n.error=e),!this.is_server&&!this.transport_error&&this.options.reconnect){var r=this.options.reconnect(this.conn_established_counter);r>=0?(s.reconnect("[%s] Scheduled reconnect in "+r+"ms",this.options.id),this.scheduled_reconnect=setTimeout(this.reconnect.bind(this),r),n.reconnecting=!0):n.reconnecting=!1}this.dispatch("disconnected",this._context(n))||console.warn("["+this.options.id+"] disconnected %s",n.error||"")}},C.prototype.open=function(){this.state.open()&&this._register()},C.prototype.close=function(e){e&&(this.local.close.error=e),this.state.close()&&this._register()},C.prototype.is_open=function(){return this.state.is_open()},C.prototype.is_remote_open=function(){return this.state.remote_open},C.prototype.is_closed=function(){return this.state.is_closed()},C.prototype.create_session=function(){for(var e=0;this.local_channel_map[e];)e++;var t=new h(this,e);return this.local_channel_map[e]=t,t},C.prototype.find_sender=function(e){return this.find_link(c.sender_filter(e))},C.prototype.find_receiver=function(e){return this.find_link(c.receiver_filter(e))},C.prototype.find_link=function(e){for(var t in this.local_channel_map){var n=this.local_channel_map[t].find_link(e);if(n)return n}},C.prototype.each_receiver=function(e,t){this.each_link(e,c.receiver_filter(t))},C.prototype.each_sender=function(e,t){this.each_link(e,c.sender_filter(t))},C.prototype.each_link=function(e,t){for(var n in this.local_channel_map){this.local_channel_map[n].each_link(e,t)}},C.prototype.on_open=function(e){if(!this.state.remote_opened())throw new i.ProtocolError("Open already received");this.remote.open=e.performative,this.open(),this.dispatch("connection_open",this._context())},C.prototype.on_close=function(e){if(!this.state.remote_closed())throw new i.ProtocolError("Close already received");this.remote.close=e.performative,this.remote.close.error?this._handle_error():this.dispatch("connection_close",this._context()),this.heartbeat_out&&clearTimeout(this.heartbeat_out);var n=this;t.nextTick((function(){n.close()}))},C.prototype._register=function(){this.registered||(this.registered=!0,t.nextTick(this._process.bind(this)))},C.prototype._process=function(){this.registered=!1;do{this.state.need_open()&&this._write_open();var e=this.local_channel_map;for(var t in e)e[t]._process();this.state.need_close()&&this._write_close()}while(!this.state.has_settled())},C.prototype._write_frame=function(e,t,n){this.amqp_transport.encode(o.amqp_frame(e,t,n)),this.output()},C.prototype._write_open=function(){this._write_frame(0,this.local.open)},C.prototype._write_close=function(){this._write_frame(0,this.local.close),this.local.close.error=void 0},C.prototype.on_begin=function(e){var t;if(null===e.performative.remote_channel||void 0===e.performative.remote_channel)(t=this.create_session()).local.begin.remote_channel=e.channel;else if(!(t=this.local_channel_map[e.performative.remote_channel]))throw new i.ProtocolError("Invalid value for remote channel "+e.performative.remote_channel);t.on_begin(e),this.remote_channel_map[e.channel]=t},C.prototype.get_peer_certificate=function(){return this.socket&&this.socket.getPeerCertificate?this.socket.getPeerCertificate():void 0},C.prototype.get_tls_socket=function(){return!this.socket||"tls"!==this.options.transport&&"ssl"!==this.options.transport?void 0:this.socket},C.prototype._context=function(e){var t=e||{};return t.connection=this,this.container&&(t.container=this.container),t},C.prototype.remove_session=function(e){this.remote_channel_map[e.remote.channel]===e&&delete this.remote_channel_map[e.remote.channel],this.local_channel_map[e.local.channel]===e&&delete this.local_channel_map[e.local.channel]},C.prototype.remove_all_sessions=function(){I(this.remote_channel_map),I(this.local_channel_map)},k("end"),k("attach"),k("detach"),k("transfer"),k("disposition"),k("flow"),e.exports=C}).call(this,n(12),n(13).Buffer)},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),s=r[0],a=r[1],c=new o(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),h=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[h++]=t>>16&255,c[h++]=t>>8&255,c[h++]=255&t;2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[h++]=255&t);1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[h++]=t>>8&255,c[h++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(h(e,s,s+16383>a?a:s+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function h(e,t,n){for(var i,o,s=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,h=-7,d=n?i-1:0,l=n?-1:1,p=e[t+d];for(d+=l,o=p&(1<<-h)-1,p>>=-h,h+=a;h>0;o=256*o+e[t+d],d+=l,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+e[t+d],d+=l,h-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=u}return(p?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,h=(1<<u)-1,d=h>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?l/c:l*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=h?(a=0,s=h):s+d>=1?(a=(t*c-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+p]=255&a,p+=f,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+p]=255&s,p+=f,s/=256,u-=8);e[n+p-f]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";e.exports=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=s,a=Number(new Date),c=a-(n||a);o.diff=c,o.prev=n,o.curr=a,n=a,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return e;u++;var i=r.formatters[n];if("function"==typeof i){var s=t[u];e=i.call(o,s),t.splice(u,1),u--}return e})),r.formatArgs.call(o,t);var h=o.log||r.log;h.apply(o,t)}}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function i(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){return r(this.namespace+(void 0===t?":":t)+e)}return r.debug=r,r.default=r,r.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var o=r.instances[t];o.enabled=r.enabled(o.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(68),Object.keys(e).forEach((function(t){r[t]=e[t]})),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t){var n=1e3,r=6e4,i=60*r,o=24*i;function s(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===a&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=o)return s(e,t,o,"day");if(t>=i)return s(e,t,i,"hour");if(t>=r)return s(e,t,r,"minute");if(t>=n)return s(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=o)return Math.round(e/o)+"d";if(t>=i)return Math.round(e/i)+"h";if(t>=r)return Math.round(e/r)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";(function(t,r){var i=n(25),o=n(70),s=n(20),a=n(36),c=n(18),u=n(19),h=n(35),d=n(21).EventEmitter;function l(e,t,n){Error.call(this),Error.captureStackTrace(this,this.constructor),this.message=e,this.condition=t,this.description=e,Object.defineProperty(this,"session",{value:n})}n(34).inherits(l,Error);var p=function(e){this.capacity=e,this.size=0,this.head=0,this.tail=0,this.entries=[]};function f(e){var t,n,r,o,s;for(o=0;o<e.length;o++)s=e[o],void 0===t&&(t=s,n=s,r=s.id),t!==n&&!a.are_outcomes_equivalent(n.state,s.state)||n.settled!==s.settled||r!==s.id?(t.link.session.output(i.disposition({role:t.link.is_receiver(),first:t.id,last:n.id,state:t.state,settled:t.settled})),t=s,n=s,r=s.id):(n.id!==s.id&&(n=s),r++);void 0!==t&&void 0!==n&&t.link.session.output(i.disposition({role:t.link.is_receiver(),first:t.id,last:n.id,state:t.state,settled:t.settled}))}p.prototype.available=function(){return this.capacity-this.size},p.prototype.push=function(e){if(!(this.size<this.capacity))throw Error("circular buffer overflow: head="+this.head+" tail="+this.tail+" size="+this.size+" capacity="+this.capacity);this.entries[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++},p.prototype.pop_if=function(e){for(var t=0;this.size&&e(this.entries[this.head]);)this.entries[this.head]=void 0,this.head=(this.head+1)%this.capacity,this.size--,t++;return t},p.prototype.by_id=function(e){if(this.size>0){var t=e-this.entries[this.head].id;if(t<this.size)return this.entries[(this.head+t)%this.capacity]}},p.prototype.get_head=function(){return this.size>0?this.entries[this.head]:void 0},p.prototype.get_tail=function(){return this.size>0?this.entries[(this.head+this.size-1)%this.capacity]:void 0};var m=function(e){this.deliveries=new p(2048),this.updated=[],this.pending_dispositions=[],this.next_delivery_id=0,this.next_pending_delivery=0,this.next_transfer_id=0,this.window=c.MAX_UINT,this.remote_next_transfer_id=void 0,this.remote_window=void 0,this.connection=e};m.prototype.available=function(){return this.deliveries.available()},m.prototype.compute_max_payload=function(e){return this.connection.max_frame_size?this.connection.max_frame_size-(50+e.length):void 0},m.prototype.send=function(e,t,n,r){var i=[],o=this.compute_max_payload(t);if(o&&n.length>o)for(var s=0;s<n.length;){var a=Math.min(s+o,n.length);i.push(n.slice(s,a)),s=a}else i.push(n);var c={id:this.next_delivery_id++,tag:t,link:e,data:i,format:r||0,sent:!1,settled:!1,state:void 0,remote_settled:!1,remote_state:void 0},u=this;return c.update=function(e,t){u.update(c,e,t)},this.deliveries.push(c),c},m.prototype.on_begin=function(e){this.remote_window=e.incoming_window},m.prototype.on_flow=function(e){this.remote_next_transfer_id=e.next_incoming_id,this.remote_window=e.incoming_window},m.prototype.on_disposition=function(e){for(var t=e.last?e.last:e.first,n=e.first;n<=t;n++){var r=this.deliveries.by_id(n);if(r&&!r.remote_settled){var i=!1;e.settled&&(r.remote_settled=e.settled,i=!0),e.state&&e.state!==r.remote_state&&(r.remote_state=a.unwrap_outcome(e.state),i=!0),i&&this.updated.push(r)}}},m.prototype.update=function(e,t,n){e&&(e.settled=t,void 0!==n&&(e.state=n),e.remote_settled||this.pending_dispositions.push(e),e.link.connection._register())},m.prototype.transfer_window=function(){return this.remote_window?this.remote_window-(this.next_transfer_id-this.remote_next_transfer_id):0},m.prototype.process=function(){for(var e;this.next_pending_delivery<this.next_delivery_id;){if(!(e=this.deliveries.by_id(this.next_pending_delivery))){console.error("ERROR: Next pending delivery not found: "+this.next_pending_delivery);break}if(!e.link.has_credit()){s.flow("[%s] Link has no credit",this.connection.options.id);break}if(!(this.transfer_window()>=e.data.length)){s.flow("[%s] Incoming window of peer preventing sending further transfers: remote_window=%d, remote_next_transfer_id=%d, next_transfer_id=%d",this.connection.options.id,this.remote_window,this.remote_next_transfer_id,this.next_transfer_id);break}this.window-=e.data.length;for(var t=0;t<e.data.length;t++){this.next_transfer_id++;var n=t+1<e.data.length,r=i.transfer({handle:e.link.local.handle,message_format:e.format,delivery_id:e.id,delivery_tag:e.tag,settled:e.settled,more:n});e.link.session.output(r,e.data[t]),e.settled&&(e.remote_settled=!0)}e.link.credit--,e.link.delivery_count++,this.next_pending_delivery++}for(t=0;t<this.updated.length;t++)(e=this.updated[t]).remote_state&&e.remote_state.constructor.composite_type&&e.link.dispatch(e.remote_state.constructor.composite_type,e.link._context({delivery:e})),e.remote_settled&&e.link.dispatch("settled",e.link._context({delivery:e}));this.updated=[],this.pending_dispositions.length&&(f(this.pending_dispositions),this.pending_dispositions=[]),this.deliveries.pop_if((function(e){return e.settled&&e.remote_settled}))};var _=function(){this.deliveries=new p(2048),this.updated=[],this.next_transfer_id=0,this.next_delivery_id=void 0,Object.defineProperty(this,"window",{get:function(){return this.deliveries.available()}}),this.remote_next_transfer_id=void 0,this.remote_window=void 0,this.max_transfer_id=this.next_transfer_id+this.window};_.prototype.update=function(e,t,n){e&&(e.settled=t,void 0!==n&&(e.state=n),e.remote_settled||this.updated.push(e),e.link.connection._register())},_.prototype.on_transfer=function(e,n){if(this.next_transfer_id++,!n.is_remote_open())throw Error("transfer after detach");var r,i;if(void 0===this.next_delivery_id&&(this.next_delivery_id=e.performative.delivery_id),n._incomplete){if(r=n._incomplete,u.is_defined(e.performative.delivery_id)&&r.id!==e.performative.delivery_id)throw Error("frame sequence error: delivery "+r.id+" not complete, got "+e.performative.delivery_id);i=e.payload?t.concat([r.data,e.payload],r.data.length+e.payload.length):r.data}else{if(this.next_delivery_id!==e.performative.delivery_id)throw Error("frame sequence error: expected "+this.next_delivery_id+", got "+e.performative.delivery_id);r={id:e.performative.delivery_id,tag:e.performative.delivery_tag,format:e.performative.message_format,link:n,settled:!1,state:void 0,remote_settled:void 0!==e.performative.settled&&e.performative.settled,remote_state:e.performative.state};var o=this;r.update=function(e,t){var i=e;void 0===i&&(i=1!==n.local.attach.rcv_settle_mode),o.update(r,i,t)},r.accept=function(){this.update(void 0,a.accepted().described())},r.release=function(e){e?this.update(void 0,a.modified(e).described()):this.update(void 0,a.released().described())},r.reject=function(e){this.update(void 0,a.rejected({error:e}).described())},r.modified=function(e){this.update(void 0,a.modified(e).described())},this.deliveries.push(r),this.next_delivery_id++,i=e.payload}if(r.incomplete=e.performative.more,r.incomplete)n._incomplete=r,r.data=i;else{n._incomplete=void 0,n.credit>0?n.credit--:console.error("Received transfer when credit was %d",n.credit),n.delivery_count++;var s=0===r.format?{message:a.decode(i),delivery:r}:{message:i,delivery:r,format:r.format};n.dispatch("message",n._context(s))}},_.prototype.process=function(e){this.updated.length>0&&(f(this.updated),this.updated=[]),this.deliveries.pop_if((function(e){return e.settled})),this.max_transfer_id-this.next_transfer_id<this.window/2&&e._write_flow()},_.prototype.on_begin=function(e){this.remote_window=e.outgoing_window,this.remote_next_transfer_id=e.next_outgoing_id},_.prototype.on_flow=function(e){this.remote_next_transfer_id=e.next_outgoing_id,this.remote_window=e.outgoing_window},_.prototype.on_disposition=function(e){for(var t=e.last?e.last:e.first,n=e.first;n<=t;n++){var r=this.deliveries.by_id(n);r&&!r.remote_settled&&(e.state&&e.state!==r.remote_state&&(r.remote_state=a.unwrap_outcome(e.state)),e.settled&&(r.remote_settled=e.settled,r.link.dispatch("settled",r.link._context({delivery:r}))))}};var v=function(e,t){this.connection=e,this.outgoing=new m(e),this.incoming=new _,this.state=new h,this.local={channel:t,handles:{}},this.local.begin=i.begin({next_outgoing_id:this.outgoing.next_transfer_id,incoming_window:this.incoming.window,outgoing_window:this.outgoing.window}),this.local.end=i.end(),this.remote={handles:{}},this.links={},this.options={},Object.defineProperty(this,"error",{get:function(){return this.remote.end?this.remote.end.error:void 0}}),this.observers=new d};function g(e,t,n,r){var i=Object.create(r||{});"string"==typeof t?i[n]=t:t&&function e(t,n){for(var r in n)"properties"===r&&t.properties?e(t.properties,n.properties):t[r]=n[r]}(i,t),i.name||(i.name=u.generate_uuid());var o=e(i.name,i);for(var s in{source:0,target:0})i[s]&&("string"==typeof i[s]&&(i[s]={address:i[s]}),o["set_"+s](i[s]));return o.is_sender()&&void 0===i.source&&(i.source=o.set_source({})),o.is_receiver()&&void 0===i.target&&(i.target=o.set_target({})),o.attach(),o}function b(e){e.dispatch("sendable",e._context())}function y(e){return e.is_open()&&e.sendable()}(v.prototype=Object.create(d.prototype)).constructor=v,v.prototype._disconnect=function(){for(var e in this.state.disconnected(),this.links)this.links[e]._disconnect();this.state.was_open||this.remove()},v.prototype._reconnect=function(){for(var e in this.state.reconnect(),this.outgoing=new m(this.connection),this.incoming=new _,this.remote={handles:{}},this.links)this.links[e]._reconnect()},v.prototype.dispatch=function(e){return s.events("[%s] Session got event: %s",this.connection.options.id,e),d.prototype.emit.apply(this.observers,arguments),this.listeners(e).length?(d.prototype.emit.apply(this,arguments),!0):this.connection.dispatch.apply(this.connection,arguments)},v.prototype.output=function(e,t){this.connection._write_frame(this.local.channel,e,t)},v.prototype.create_sender=function(e,t){return t||(t=this.get_option("sender_options",{})),this.create_link(e,o.Sender,t)},v.prototype.create_receiver=function(e,t){return t||(t=this.get_option("receiver_options",{})),this.create_link(e,o.Receiver,t)},v.prototype.get_option=function(e,t){return void 0!==this.options[e]?this.options[e]:this.connection.get_option(e,t)},v.prototype.attach_sender=function(e){return g(this.create_sender.bind(this),e,"target",this.get_option("sender_options",{}))},v.prototype.open_sender=v.prototype.attach_sender,v.prototype.attach_receiver=function(e){return g(this.create_receiver.bind(this),e,"source",this.get_option("receiver_options",{}))},v.prototype.open_receiver=v.prototype.attach_receiver,v.prototype.find_sender=function(e){return this.find_link(u.sender_filter(e))},v.prototype.find_receiver=function(e){return this.find_link(u.receiver_filter(e))},v.prototype.find_link=function(e){for(var t in this.links){var n=this.links[t];if(e(n))return n}},v.prototype.each_receiver=function(e,t){this.each_link(e,u.receiver_filter(t))},v.prototype.each_sender=function(e,t){this.each_link(e,u.sender_filter(t))},v.prototype.each_link=function(e,t){for(var n in this.links){var r=this.links[n];(void 0===t||t(r))&&e(r)}},v.prototype.create_link=function(e,t,n){for(var r=0;this.local.handles[r];)r++;var i=new t(this,e,r,n);return this.links[e]=i,this.local.handles[r]=i,i},v.prototype.begin=function(){this.state.open()&&this.connection._register()},v.prototype.open=v.prototype.begin,v.prototype.end=function(e){e&&(this.local.end.error=e),this.state.close()&&this.connection._register()},v.prototype.close=v.prototype.end,v.prototype.is_open=function(){return this.connection.is_open()&&this.state.is_open()},v.prototype.is_remote_open=function(){return this.connection.is_remote_open()&&this.state.remote_open},v.prototype.is_itself_closed=function(){return this.state.is_closed()},v.prototype.is_closed=function(){return this.connection.is_closed()||this.is_itself_closed()},v.prototype._process=function(){do{this.state.need_open()&&this.output(this.local.begin);var e=0===this.outgoing.deliveries.available();for(var t in this.outgoing.process(),e&&this.outgoing.deliveries.available()&&this.each_sender(b,y),this.incoming.process(this),this.links)this.links[t]._process();this.state.need_close()&&this.output(this.local.end)}while(!this.state.has_settled())},v.prototype.send=function(e,t,n,r){var i=this.outgoing.send(e,t,n,r);return this.connection._register(),i},v.prototype._write_flow=function(e){var t={next_incoming_id:this.incoming.next_transfer_id,incoming_window:this.incoming.window,next_outgoing_id:this.outgoing.next_transfer_id,outgoing_window:this.outgoing.window};this.incoming.max_transfer_id=t.next_incoming_id+t.incoming_window,e&&(e._get_drain()&&(t.drain=!0),t.delivery_count=e.delivery_count,t.handle=e.local.handle,t.link_credit=e.credit),this.output(i.flow(t))},v.prototype.on_begin=function(e){if(!this.state.remote_opened())throw Error("Begin already received");this.remote.channel||(this.remote.channel=e.channel),this.remote.begin=e.performative,this.outgoing.on_begin(e.performative),this.incoming.on_begin(e.performative),this.open(),this.dispatch("session_open",this._context())},v.prototype.on_end=function(e){if(!this.state.remote_closed())throw Error("End already received");this.remote.end=e.performative;var t=this.remote.end.error;if(t){var n=this.dispatch("session_error",this._context());(n=this.dispatch("session_close",this._context())||n)||d.prototype.emit.call(this.connection.container,"error",new l(t.description,t.condition,this))}else this.dispatch("session_close",this._context());var i=this,o=this.state.mark();r.nextTick((function(){i.state.marker===o&&(i.close(),r.nextTick((function(){i.remove()})))}))},v.prototype.on_attach=function(e){var t=e.performative.name,n=this.links[t];n||(n=e.performative.role?this.create_sender(t):this.create_receiver(t)),this.remote.handles[e.performative.handle]=n,n.on_attach(e),n.remote.attach=e.performative},v.prototype.on_disposition=function(e){e.performative.role?(s.events("[%s] Received disposition for outgoing transfers",this.connection.options.id),this.outgoing.on_disposition(e.performative)):(s.events("[%s] Received disposition for incoming transfers",this.connection.options.id),this.incoming.on_disposition(e.performative)),this.connection._register()},v.prototype.on_flow=function(e){this.outgoing.on_flow(e.performative),this.incoming.on_flow(e.performative),u.is_defined(e.performative.handle)&&this._get_link(e).on_flow(e),this.connection._register()},v.prototype._context=function(e){var t=e||{};return t.session=this,this.connection._context(t)},v.prototype._get_link=function(e){var t=e.performative.handle,n=this.remote.handles[t];if(!n)throw Error("Invalid handle "+t);return n},v.prototype.on_detach=function(e){this._get_link(e).on_detach(e)},v.prototype.remove_link=function(e){delete this.remote.handles[e.remote.handle],delete this.local.handles[e.local.handle],delete this.links[e.name]},v.prototype.remove=function(){this.connection.remove_session(this)},v.prototype.on_transfer=function(e){this.incoming.on_transfer(e,this._get_link(e))},e.exports=v}).call(this,n(13).Buffer,n(12))},function(e,t,n){"use strict";(function(t,r){var i=n(25),o=n(20),s=n(36),a=n(71),c=n(35),u=function(e){this.window=e};function h(e){e.delivery.settled=!0}function d(e){e.delivery.update(void 0,s.accepted().described())}function l(e,t,n){Error.call(this),Error.captureStackTrace(this,this.constructor),this.message=e,this.condition=t,this.description=e,Object.defineProperty(this,"link",{value:n})}u.prototype.update=function(e){var t=this.window-e.receiver.credit;t>=this.window/4&&e.receiver.flow(t)},n(34).inherits(l,Error);var p=n(21).EventEmitter,f=Object.create(p.prototype);function m(e){switch(e){case"name":case"handle":case"role":case"initial_delivery_count":return!0;default:return!1}}f.dispatch=function(e){return o.events("[%s] Link got event: %s",this.connection.options.id,e),p.prototype.emit.apply(this.observers,arguments),this.listeners(e).length?(p.prototype.emit.apply(this,arguments),!0):this.session.dispatch.apply(this.session,arguments)},f.set_source=function(e){this.local.attach.source=a.source(e).described()},f.set_target=function(e){this.local.attach.target=a.target(e).described()},f.attach=function(){this.state.open()&&this.connection._register()},f.open=f.attach,f.detach=function(){this.local.detach.closed=!1,this.state.close()&&this.connection._register()},f.close=function(e){e&&(this.local.detach.error=e),this.local.detach.closed=!0,this.state.close()&&this.connection._register()},f.remove=function(){this.session.remove_link(this)},f.is_open=function(){return this.session.is_open()&&this.state.is_open()},f.is_remote_open=function(){return this.session.is_remote_open()&&this.state.remote_open},f.is_itself_closed=function(){return this.state.is_closed()},f.is_closed=function(){return this.session.is_closed()||this.is_itself_closed()},f._process=function(){do{this.state.need_open()&&this.session.output(this.local.attach),this.issue_flow&&this.state.local_open&&(this.session._write_flow(this),this.issue_flow=!1),this.state.need_close()&&this.session.output(this.local.detach)}while(!this.state.has_settled())},f.on_attach=function(e){if(!this.state.remote_opened())throw Error("Attach already received");this.remote.handle||(this.remote.handle=e.handle),e.performative.source=a.unwrap(e.performative.source),e.performative.target=a.unwrap(e.performative.target),this.remote.attach=e.performative,this.open(),this.dispatch(this.is_receiver()?"receiver_open":"sender_open",this._context())},f.prefix_event=function(e){return(this.local.attach.role?"receiver_":"sender_")+e},f.on_detach=function(e){if(!this.state.remote_closed())throw Error("Detach already received");this._incomplete&&(this._incomplete.settled=!0),this.remote.detach=e.performative;var n=this.remote.detach.error;if(n){var r=this.dispatch(this.prefix_event("error"),this._context());(r=this.dispatch(this.prefix_event("close"),this._context())||r)||p.prototype.emit.call(this.connection.container,"error",new l(n.description,n.condition,this))}else this.dispatch(this.prefix_event("close"),this._context());var i=this,o=this.state.mark();t.nextTick((function(){i.state.marker===o&&(i.close(),t.nextTick((function(){i.remove()})))}))};var _=["snd_settle_mode","rcv_settle_mode","source","target","max_message_size","offered_capabilities","desired_capabilities","properties"];function v(e){return function(){return this.remote.attach?this.remote.attach[e]:void 0}}f.init=function(e,t,n,r,o){for(var s in this.session=e,this.connection=e.connection,this.name=t,this.options=void 0===r?{}:r,this.state=new c,this.issue_flow=!1,this.local={handle:n},this.local.attach=i.attach({handle:n,name:t,role:o}),this.local.attach)m(s)||void 0===this.options[s]||(this.local.attach[s]=this.options[s]);this.local.detach=i.detach({handle:n,closed:!0}),this.remote={handle:void 0},this.delivery_count=0,this.credit=0,this.observers=new p;var a=this;_.forEach((function(e){Object.defineProperty(a,e,{get:v(e)})})),Object.defineProperty(this,"error",{get:function(){return this.remote.detach?this.remote.detach.error:void 0}})},f._disconnect=function(){this.state.disconnected(),this.state.was_open||this.remove()},f._reconnect=function(){this.state.reconnect(),this.remote={handle:void 0},this.delivery_count=0,this.credit=0},f.has_credit=function(){return this.credit>0},f.is_receiver=function(){return this.local.attach.role},f.is_sender=function(){return!this.is_receiver()},f._context=function(e){var t=e||{};return this.is_receiver()?t.receiver=this:t.sender=this,this.session._context(t)},f.get_option=function(e,t){return void 0!==this.options[e]?this.options[e]:this.session.get_option(e,t)};var g=function(e,t,n,r){this.init(e,t,n,r,!1),this._draining=!1,this._drained=!1,this.local.attach.initial_delivery_count=0,this.tag=0,this.get_option("autosettle",!0)&&this.observers.on("settled",h);var i=this;this.get_option("treat_modified_as_released",!0)&&this.observers.on("modified",(function(e){i.dispatch("released",e)}))};(g.prototype=Object.create(f)).constructor=g,g.prototype._get_drain=function(){if(this._draining&&this._drained&&this.credit){for(;this.credit;)++this.delivery_count,--this.credit;return!0}return!1},g.prototype.set_drained=function(e){this._drained=e,this._draining&&this._drained&&(this.issue_flow=!0)},g.prototype.next_tag=function(){return r.from(new String(this.tag++))},g.prototype.sendable=function(){return Boolean(this.credit&&this.session.outgoing.available())},g.prototype.on_flow=function(e){var t=e.performative;this.credit=t.delivery_count+t.link_credit-this.delivery_count,this._draining=t.drain,this._drained=this.credit>0,this.is_open()&&(this.dispatch("sender_flow",this._context()),this._draining&&this.dispatch("sender_draining",this._context()),this.sendable()&&this.dispatch("sendable",this._context()))},g.prototype.on_transfer=function(){throw Error("got transfer on sending link")},g.prototype.send=function(e,t,n){var r=void 0===n?s.encode(e):e,i=this.session.send(this,t||this.next_tag(),r,n);return 1===this.local.attach.snd_settle_mode&&(i.settled=!0),i};var b=function(e,t,n,r){this.init(e,t,n,r,!0),this.drain=!1,this.set_credit_window(this.get_option("credit_window",1e3)),this.get_option("autoaccept",!0)&&this.observers.on("message",d),1===this.local.attach.rcv_settle_mode&&this.get_option("autosettle",!0)&&this.observers.on("settled",h)};(b.prototype=Object.create(f)).constructor=b,b.prototype.on_flow=function(e){this.dispatch("receiver_flow",this._context()),e.performative.drain&&(this.credit=e.performative.link_credit,this.delivery_count=e.performative.delivery_count,e.performative.link_credit>0?console.error("ERROR: received flow with drain set, but non zero credit"):this.dispatch("receiver_drained",this._context()))},b.prototype.flow=function(e){e>0&&(this.credit+=e,this.issue_flow=!0,this.connection._register())},b.prototype.drain_credit=function(){this.drain=!0,this.issue_flow=!0,this.connection._register()},b.prototype.add_credit=b.prototype.flow,b.prototype._get_drain=function(){return this.drain},b.prototype.set_credit_window=function(e){if(e>0){var t=new u(e),n=t.update.bind(t);this.observers.on("message",n),this.observers.on("receiver_open",n)}},e.exports={Sender:g,Receiver:b}}).call(this,n(12),n(13).Buffer)},function(e,t,n){"use strict";var r=n(18),i={},o={};function s(e){var t=r.define_composite(e);i[e.name]=t.create,o[Number(t.descriptor.numeric).toString(10)]=t,o[t.descriptor.symbolic]=t}i.unwrap=function(e){if(e&&e.descriptor){var t=o[e.descriptor.value];if(t)return new t(e.value);console.warn("Unknown terminus: "+e.descriptor)}return null},s({name:"source",code:40,fields:[{name:"address",type:"string"},{name:"durable",type:"uint",default_value:0},{name:"expiry_policy",type:"symbol",default_value:"session-end"},{name:"timeout",type:"uint",default_value:0},{name:"dynamic",type:"boolean",default_value:!1},{name:"dynamic_node_properties",type:"symbolic_map"},{name:"distribution_mode",type:"symbol"},{name:"filter",type:"symbolic_map"},{name:"default_outcome",type:"*"},{name:"outcomes",type:"symbol",multiple:!0},{name:"capabilities",type:"symbol",multiple:!0}]}),s({name:"target",code:41,fields:[{name:"address",type:"string"},{name:"durable",type:"uint",default_value:0},{name:"expiry_policy",type:"symbol",default_value:"session-end"},{name:"timeout",type:"uint",default_value:0},{name:"dynamic",type:"boolean",default_value:!1},{name:"dynamic_node_properties",type:"symbolic_map"},{name:"capabilities",type:"symbol",multiple:!0}]}),e.exports=i},function(e,t){},function(e,t){t.endianness=function(){return"LE"},t.hostname=function(){return"undefined"!=typeof location?location.hostname:""},t.loadavg=function(){return[]},t.uptime=function(){return 0},t.freemem=function(){return Number.MAX_VALUE},t.totalmem=function(){return Number.MAX_VALUE},t.cpus=function(){return[]},t.type=function(){return"Browser"},t.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},t.networkInterfaces=t.getNetworkInterfaces=function(){return{}},t.arch=function(){return"javascript"},t.platform=function(){return"browser"},t.tmpdir=t.tmpDir=function(){return"/tmp"},t.EOL="\n",t.homedir=function(){return"/"}},function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var s=o>=0?arguments[o]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(t=s+"/"+t,i="/"===s.charAt(0))}return(i?"/":"")+(t=n(r(t.split("/"),(function(e){return!!e})),!i).join("/"))||"."},t.normalize=function(e){var o=t.isAbsolute(e),s="/"===i(e,-1);return(e=n(r(e.split("/"),(function(e){return!!e})),!o).join("/"))||o||(e="."),e&&s&&(e+="/"),(o?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var i=r(e.split("/")),o=r(n.split("/")),s=Math.min(i.length,o.length),a=s,c=0;c<s;c++)if(i[c]!==o[c]){a=c;break}var u=[];for(c=a;c<i.length;c++)u.push("..");return(u=u.concat(o.slice(a))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,i=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!i){r=o;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){n=t+1;break}}else-1===r&&(i=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,i=!0,o=0,s=e.length-1;s>=0;--s){var a=e.charCodeAt(s);if(47!==a)-1===r&&(i=!1,r=s+1),46===a?-1===t?t=s:1!==o&&(o=1):-1!==t&&(o=-1);else if(!i){n=s+1;break}}return-1===t||-1===r||0===o||1===o&&t===r-1&&t===n+1?"":e.slice(t,r)};var i="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n(12))},function(e,t,n){"use strict";var r,i,o,s;!function(e){e.message="message",e.receiverOpen="receiver_open",e.receiverDrained="receiver_drained",e.receiverFlow="receiver_flow",e.receiverError="receiver_error",e.receiverClose="receiver_close",e.settled="settled"}(r||(r={})),function(e){e.sendable="sendable",e.senderOpen="sender_open",e.senderDraining="sender_draining",e.senderFlow="sender_flow",e.senderError="sender_error",e.senderClose="sender_close",e.accepted="accepted",e.released="released",e.rejected="rejected",e.modified="modified",e.settled="settled"}(i||(i={})),function(e){e.sessionOpen="session_open",e.sessionError="session_error",e.sessionClose="session_close",e.settled="settled"}(o||(o={})),function(e){e.connectionOpen="connection_open",e.connectionClose="connection_close",e.connectionError="connection_error",e.protocolError="protocol_error",e.error="error",e.disconnected="disconnected",e.settled="settled"}(s||(s={})),e.exports={ReceiverEvents:r,SenderEvents:i,SessionEvents:o,ConnectionEvents:s}},function(e,t,n){"use strict";(function(t){function n(e){return e}function r(e){return e instanceof ArrayBuffer?t.from(new Uint8Array(e)):t.from(e)}function i(e){return new Uint8Array(e)}function o(e){var t=n,o=n;return e.binaryType&&(e.binaryType="arraybuffer",t=r,o=i),{end:function(){e.close()},write:function(t){try{e.send(o(t),{binary:!0})}catch(t){e.onerror(t)}},on:function(n,r){"data"===n?e.onmessage=function(e){r(t(e.data))}:"end"===n?e.onclose=r:"error"===n?e.onerror=r:console.error("ERROR: Attempt to set unrecognised handler on websocket wrapper: "+n)},get_id_string:function(){return e.url}}}e.exports={connect:function(e){return function(t,n,r){return function(){return{connect:function(i,s,a,c){var u=new e(t,n,r);return u.onopen=c,o(u)}}}}},wrap:o}}).call(this,n(13).Buffer)},function(e,t,n){"use strict";var r=n(18);e.exports={selector:function(e){return{"jms-selector":r.wrap_described(e,77567109365764)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOperationTimeoutInSeconds=60},function(e,t,n){"use strict";n.r(t),n.d(t,"EventHubConsumerClient",(function(){return Et})),n.d(t,"EventHubProducerClient",(function(){return kt})),n.d(t,"EventHubBufferedProducerClient",(function(){return Mt})),n.d(t,"latestEventPosition",(function(){return h})),n.d(t,"earliestEventPosition",(function(){return u})),n.d(t,"CloseReason",(function(){return f})),n.d(t,"MessagingError",(function(){return a.c})),n.d(t,"RetryMode",(function(){return _.a})),n.d(t,"logger",(function(){return i.b})),n.d(t,"parseEventHubConnectionString",(function(){return ut})),n.d(t,"createEventDataAdapter",(function(){return Nt}));var r=n(33),i=n(0);class o{constructor(e,t,n){this._eventHandlers=e,this._checkpointStore=t,this._context=n}get lastEnqueuedEventProperties(){return this._lastEnqueuedEventProperties}set lastEnqueuedEventProperties(e){this._lastEnqueuedEventProperties=e}get fullyQualifiedNamespace(){return this._context.fullyQualifiedNamespace}get consumerGroup(){return this._context.consumerGroup}get eventHubName(){return this._context.eventHubName}get partitionId(){return this._context.partitionId}get eventProcessorId(){return this._context.eventProcessorId}async initialize(){this._eventHandlers.processInitialize&&await this._eventHandlers.processInitialize(this)}async close(e){this._eventHandlers.processClose&&await this._eventHandlers.processClose(e,this)}async processEvents(e){await this._eventHandlers.processEvents(e,this)}async processError(e){if(this._eventHandlers.processError)try{await this._eventHandlers.processError(e,this)}catch(e){i.b.verbose("Error thrown from user's processError handler : "+e)}}async updateCheckpoint(e){const t={fullyQualifiedNamespace:this._context.fullyQualifiedNamespace,eventHubName:this._context.eventHubName,consumerGroup:this._context.consumerGroup,partitionId:this._context.partitionId,sequenceNumber:e.sequenceNumber,offset:e.offset};await this._checkpointStore.updateCheckpoint(t)}}var s=n(4),a=n(7),c=n(1);const u={offset:-1},h={offset:"@latest"};function d(e){if(!Object(c.b)(e))return;const t=Object.keys(e);if(!t.length)throw new TypeError("Invalid value for EventPosition found. Pass an object with either of offset, sequenceNumber or enqueuedOn properties set.");if(l(e))return void p(e);const n=e;for(let e=0;e<t.length;e++)Object.prototype.hasOwnProperty.call(n,t[e])&&p(n[t[e]])}function l(e){return!!e&&(!(!Object(c.d)(e,"offset")||!Object(c.b)(e.offset))||(!(!Object(c.d)(e,"sequenceNumber")||!Object(c.b)(e.sequenceNumber))||!(!Object(c.d)(e,"enqueuedOn")||!Object(c.b)(e.enqueuedOn))))}function p(e){if(!Object(c.b)(e))return;const t=Object(c.b)(e.offset),n=Object(c.b)(e.sequenceNumber),r=Object(c.b)(e.enqueuedOn);if(t&&n||t&&r||r&&n)throw new TypeError("Invalid value for EventPosition found. Set only one of offset, sequenceNumber or enqueuedOn properties.");if(!t&&!r&&!n)throw new TypeError("Invalid value for EventPosition found. Pass an object with either of offset, sequenceNumber or enqueuedOn properties set.")}var f;!function(e){e.OwnershipLost="OwnershipLost",e.Shutdown="Shutdown"}(f||(f={}));var m=n(11),_=n(58),v=n(2),g=n(3);const b={toRheaMessageHeader(e){const t={};return null!=e.deliveryCount&&(t.delivery_count=e.deliveryCount),null!=e.durable&&(t.durable=e.durable),null!=e.firstAcquirer&&(t.first_acquirer=e.firstAcquirer),null!=e.priority&&(t.priority=e.priority),null!=e.timeToLive&&(t.ttl=e.timeToLive),g.b.verbose("To RheaMessageHeader: %O",t),t},fromRheaMessageHeader(e){const t={};return null!=e.delivery_count&&(t.deliveryCount=e.delivery_count),null!=e.durable&&(t.durable=e.durable),null!=e.first_acquirer&&(t.firstAcquirer=e.first_acquirer),null!=e.priority&&(t.priority=e.priority),null!=e.ttl&&(t.timeToLive=e.ttl),g.b.verbose("From RheaMessageHeader: %O",t),t}},y={toRheaMessageProperties(e){const t={};return null!=e.absoluteExpiryTime&&(t.absolute_expiry_time=new Date(e.absoluteExpiryTime)),null!=e.contentEncoding&&(t.content_encoding=e.contentEncoding),null!=e.contentType&&(t.content_type=e.contentType),null!=e.correlationId&&(t.correlation_id=e.correlationId),null!=e.creationTime&&(t.creation_time=new Date(e.creationTime)),null!=e.groupId&&(t.group_id=e.groupId),null!=e.groupSequence&&(t.group_sequence=e.groupSequence),null!=e.messageId&&(t.message_id=e.messageId),null!=e.replyTo&&(t.reply_to=e.replyTo),null!=e.replyToGroupId&&(t.reply_to_group_id=e.replyToGroupId),null!=e.subject&&(t.subject=e.subject),null!=e.to&&(t.to=e.to),g.b.verbose("To RheaMessageProperties: %O",t),t},fromRheaMessageProperties(e){const t={};return null!=e.absolute_expiry_time&&(t.absoluteExpiryTime=e.absolute_expiry_time.getTime()),null!=e.content_encoding&&(t.contentEncoding=e.content_encoding),null!=e.content_type&&(t.contentType=e.content_type),null!=e.correlation_id&&(t.correlationId=e.correlation_id),null!=e.creation_time&&(t.creationTime=e.creation_time.getTime()),null!=e.group_id&&(t.groupId=e.group_id),null!=e.group_sequence&&(t.groupSequence=e.group_sequence),null!=e.message_id&&(t.messageId=e.message_id),null!=e.reply_to&&(t.replyTo=e.reply_to),null!=e.reply_to_group_id&&(t.replyToGroupId=e.reply_to_group_id),null!=e.subject&&(t.subject=e.subject),null!=e.to&&(t.to=e.to),g.b.verbose("From RheaMessageProperties: %O",t),t}},w={fromRheaMessage:e=>({header:b.fromRheaMessageHeader(e),footer:e.footer,messageAnnotations:e.message_annotations,deliveryAnnotations:e.delivery_annotations,applicationProperties:e.application_properties,properties:y.fromRheaMessageProperties(e),body:e.body}),toRheaMessage:e=>Object.assign(Object.assign(Object.assign({},y.toRheaMessageProperties(e.properties||{})),b.toRheaMessageHeader(e.header||{})),{body:e.body,message_annotations:e.messageAnnotations,delivery_annotations:e.deliveryAnnotations,application_properties:e.applicationProperties,footer:e.footer})};var E=n(13),S=n(43),O=n.n(S);const C={encode(e,t){let n;if(void 0===e&&(e=null),"value"===t)n=v.message.data_section(e),n.typecode=119;else if("sequence"===t)n=v.message.sequence_section(e);else if(O()(e)||e instanceof Uint8Array)n=v.message.data_section(e);else if(null===e&&"data"===t)n=v.message.data_section(null);else try{const t=JSON.stringify(e);n=v.message.data_section(E.Buffer.from(t,"utf8"))}catch(t){const n="An error occurred while executing JSON.stringify() on the given body "+e+(t?t.stack:JSON.stringify(t));throw i.b.warning("[encode] "+n),Object(i.a)(t),new Error(n)}return n},decode(e,t){try{if(null==(n=e)||"number"!=typeof n.typecode||117!==n.typecode&&119!==n.typecode&&118!==n.typecode)return O()(e)?{body:t?e:I(e),bodyType:"data"}:{body:e,bodyType:"value"};switch(e.typecode){case 117:return{body:t?e.content:I(e.content),bodyType:"data"};case 118:return{body:e.content,bodyType:"sequence"};case 119:return{body:e.content,bodyType:"value"}}}catch(e){throw i.b.verbose("[decode] An error occurred while decoding the received message body. The error is: %O",e),e}var n}};function I(e){let t=e;try{const e=t.toString("utf8");t=JSON.parse(e)}catch(e){i.b.verbose("[decode] An error occurred while trying JSON.parse() on the received body. The error is %O",e)}return t}var k=n(5),P=n(8);function x(e,t,n,r){var i,o;const s=L(e)?e.applicationProperties:e.properties;if(Boolean(null==s?void 0:s["Diagnostic-Id"]))return{event:e,spanContext:void 0};const{span:a,updatedOptions:c}=P.b.startSpan("message",t,Object(P.a)({entityPath:n,host:r},"producer"));try{if(!a.isRecording())return{event:e,spanContext:void 0};const t=P.b.createRequestHeaders(null===(i=c.tracingOptions)||void 0===i?void 0:i.tracingContext).traceparent;if(t){const n=Object.assign({},s);e=L(e)?Object.assign(Object.assign({},e),{applicationProperties:n}):Object.assign(Object.assign({},e),{properties:n}),n["Diagnostic-Id"]=t}return{event:e,spanContext:null===(o=c.tracingOptions)||void 0===o?void 0:o.tracingContext}}finally{a.end()}}function T(e){if(!e.properties||!e.properties["Diagnostic-Id"])return;const t=e.properties["Diagnostic-Id"];return P.b.parseTraceparentHeader(t)}var A=n(6);function R(e){return Object(c.c)(e,["count","sizeInBytes","tryAdd"])&&"function"==typeof e.tryAdd&&"number"==typeof e.count&&"number"==typeof e.sizeInBytes}class j{constructor(e,t,n,r,i){this._encodedMessages=[],this._spanContexts=[],this._context=e,this._maxSizeInBytes=t,this._isIdempotent=n,this._partitionKey=Object(c.b)(r)?String(r):r,this._partitionId=Object(c.b)(i)?String(i):i,this._sizeInBytes=0,this._count=0}get maxSizeInBytes(){return this._maxSizeInBytes}get partitionKey(){return this._partitionKey}get partitionId(){return this._partitionId}get sizeInBytes(){return this._sizeInBytes}get count(){return this._count}get startingPublishedSequenceNumber(){return this._startingPublishSequenceNumber}get _messageSpanContexts(){return this._spanContexts}_generateBatch(e,t,n){if(this._isIdempotent&&n){const t=e.map(v.message.decode);e=this._decorateRheaMessagesWithPublishingProps(t,n).map(v.message.encode)}const r={body:v.message.data_sections(e)};return t&&(r.message_annotations=t),v.message.encode(r)}_decorateRheaMessagesWithPublishingProps(e,t){if(!this._isIdempotent)return e;const{lastPublishedSequenceNumber:n=0,ownerLevel:r,producerGroupId:i}=t,o=n+1;for(let t=0;t<e.length;t++){$(e[t],{isIdempotentPublishingEnabled:this._isIdempotent,ownerLevel:r,producerGroupId:i,publishSequenceNumber:o+t})}return this._pendingStartingSequenceNumber=o,e}_decorateRheaMessageWithPlaceholderIdempotencyProps(e){return this._isIdempotent?(e.message_annotations||(e.message_annotations={}),$(e,{isIdempotentPublishingEnabled:this._isIdempotent,ownerLevel:0,publishSequenceNumber:0,producerGroupId:0}),e):e}_generateMessage(e){return this._generateBatch(this._encodedMessages,this._batchAnnotations,e)}_commitPublish(){this._startingPublishSequenceNumber=this._pendingStartingSequenceNumber}tryAdd(e,t={}){Object(A.d)(this._context.connectionId,"tryAdd","eventData",e);const{entityPath:n,host:r}=this._context.config,{event:i,spanContext:o}=x(e,t,n,r),s=N(i,this._partitionKey),a=s.message_annotations&&Object.assign({},s.message_annotations);this._decorateRheaMessageWithPlaceholderIdempotencyProps(s);const c=v.message.encode(s);let u=this._sizeInBytes;0===this.count&&(a&&(this._batchAnnotations=a),u+=this._generateBatch([],this._batchAnnotations).length);const h=c.length;return u+=h+(h<=255?5:8),!(u>this._maxSizeInBytes)&&(this._encodedMessages.push(c),o&&this._spanContexts.push(o),this._sizeInBytes=u,this._count++,!0)}}const M={message_id:"messageId",user_id:"userId",to:"to",subject:"subject",reply_to:"replyTo",correlation_id:"correlationId",content_type:"contentType",content_encoding:"contentEncoding",absolute_expiry_time:"absoluteExpiryTime",creation_time:"creationTime",group_id:"groupId",group_sequence:"groupSequence",reply_to_group_id:"replyToGroupId"};function N(e,t){var n,r;let i;if(L(e))i=Object.assign(Object.assign({},w.toRheaMessage(e)),{body:C.encode(e.body,null!==(n=e.bodyType)&&void 0!==n?n:"data")});else{let n="data";if("function"==typeof e.getRawAmqpMessage&&(n=null!==(r=e.getRawAmqpMessage().bodyType)&&void 0!==r?r:"data"),i={body:C.encode(e.body,n)},i.message_annotations={},e.properties&&(i.application_properties=e.properties),Object(c.b)(t)&&(i.message_annotations[s.a.partitionKey]=t,i.durable=!0),null!=e.contentType&&(i.content_type=e.contentType),null!=e.correlationId&&(i.correlation_id=e.correlationId),null!=e.messageId){if("string"==typeof e.messageId&&e.messageId.length>s.a.maxMessageIdLength)throw new Error(`Length of 'messageId' property on the event cannot be greater than ${s.a.maxMessageIdLength} characters.`);i.message_id=e.messageId}}return i}function L(e){return Object(c.c)(e,["body","bodyType"])&&!Object(c.d)(e,"getRawAmqpMessage")}function q(e){if(!Object(c.b)(e))return e;if("object"==typeof e&&Object(c.d)(e,"getTime")&&"function"==typeof e.getTime)return e.getTime();if(Array.isArray(e))return e.map(q);if("object"==typeof e&&Object(c.b)(e)){e=Object.assign({},e);for(const t of Object.keys(e))e[t]=q(e[t])}return e}function $(e,{isIdempotentPublishingEnabled:t,ownerLevel:n,producerGroupId:r,publishSequenceNumber:i}){if(!t)return;const o=e.message_annotations||{};e.message_annotations||(e.message_annotations=o),Object(c.b)(n)&&(o[k.b.epoch]=v.types.wrap_short(n)),Object(c.b)(r)&&(o[k.b.producerId]=v.types.wrap_long(r)),Object(c.b)(i)&&(o[k.b.producerSequenceNumber]=v.types.wrap_int(i))}var U=n(23),B=n(14);class H extends U.a{constructor(e,t,n,r,i={}){super(e,{partitionId:n,name:e.config.getReceiverAddress(n,t)}),this._checkpoint=-1,this._internalQueue=[],this._usingInternalQueue=!1,this._isReceivingMessages=!1,this._isStreaming=!1,this._isClosed=!1,this.consumerGroup=t,this.address=e.config.getReceiverAddress(n,this.consumerGroup),this.audience=e.config.getReceiverAudience(n,this.consumerGroup),this.ownerLevel=i.ownerLevel,this.eventPosition=r,this.options=i,this.runtimeInfo={}}get checkpoint(){return this._checkpoint}get isReceivingMessages(){return this._isReceivingMessages}get isClosed(){return this._isClosed}get lastEnqueuedEventProperties(){return this.runtimeInfo}_onAmqpMessage(e){if(!e.message)return;const t=function(e,t){const n=w.fromRheaMessage(e),{body:r,bodyType:i}=C.decode(e.body,t);n.bodyType=i;const o={body:r,getRawAmqpMessage:()=>n};if(e.message_annotations)for(const t of Object.keys(e.message_annotations))switch(t){case s.a.partitionKey:o.partitionKey=e.message_annotations[t];break;case s.a.sequenceNumber:o.sequenceNumber=e.message_annotations[t];break;case s.a.enqueuedTime:o.enqueuedTimeUtc=new Date(e.message_annotations[t]);break;case s.a.offset:o.offset=e.message_annotations[t];break;default:o.systemProperties||(o.systemProperties={}),o.systemProperties[t]=q(e.message_annotations[t])}e.application_properties&&(o.properties=q(e.application_properties)),e.delivery_annotations&&(o.lastEnqueuedOffset=e.delivery_annotations.last_enqueued_offset,o.lastSequenceNumber=e.delivery_annotations.last_enqueued_sequence_number,o.lastEnqueuedTime=new Date(e.delivery_annotations.last_enqueued_time_utc),o.retrievalTime=new Date(e.delivery_annotations.runtime_info_retrieval_time_utc));const a=Object.keys(M);for(const t of a)o.systemProperties||(o.systemProperties={}),null!=e[t]&&(o.systemProperties[M[t]]=q(e[t]));return null!=e.content_type&&(o.contentType=e.content_type),null!=e.correlation_id&&(o.correlationId=e.correlation_id),null!=e.message_id&&(o.messageId=e.message_id),o}(e.message,!!this.options.skipParsingBodyAsJson),n=t.getRawAmqpMessage(),r={body:t.body,properties:t.properties,offset:t.offset,sequenceNumber:t.sequenceNumber,enqueuedTimeUtc:t.enqueuedTimeUtc,partitionKey:t.partitionKey,systemProperties:t.systemProperties,getRawAmqpMessage:()=>n};null!=t.correlationId&&(r.correlationId=t.correlationId),null!=t.contentType&&(r.contentType=t.contentType),null!=t.messageId&&(r.messageId=t.messageId),this._checkpoint=r.sequenceNumber,this.options.trackLastEnqueuedEventProperties&&t&&(this.runtimeInfo.sequenceNumber=t.lastSequenceNumber,this.runtimeInfo.enqueuedOn=t.lastEnqueuedTime,this.runtimeInfo.offset=t.lastEnqueuedOffset,this.runtimeInfo.retrievedOn=t.retrievalTime),!this._onMessage||this._usingInternalQueue?this._internalQueue.push(r):(this._isStreaming&&this._addCredit(1),this._onMessage(r))}_onAmqpError(e){const t=this._receiver||e.receiver,n=t&&t.error;if(i.b.verbose("[%s] 'receiver_error' event occurred on the receiver '%s' with address '%s'. The associated error is: %O",this._context.connectionId,this.name,this.address,n),this._onError&&n){const e=Object(a.e)(n);Object(i.a)(e),this._onError(e)}}_onAmqpSessionError(e){const t=e.session&&e.session.error;if(i.b.verbose("[%s] 'session_error' event occurred on the session of receiver '%s' with address '%s'. The associated error is: %O",this._context.connectionId,this.name,this.address,t),this._onError&&t){const e=Object(a.e)(t);Object(i.a)(e),this._onError(e)}}async _onAmqpClose(e){const t=this._receiver||e.receiver;i.b.verbose("[%s] 'receiver_close' event occurred on the receiver '%s' with address '%s'. Value for isItselfClosed on the receiver is: '%s' Value for isConnecting on the session is: '%s'.",this._context.connectionId,this.name,this.address,t?t.isItselfClosed().toString():void 0,this.isConnecting),t&&!this.isConnecting&&await t.close().catch(e=>{i.b.verbose("[%s] Error when closing receiver [%s] after 'receiver_close' event: %O",this._context.connectionId,this.name,e)})}async _onAmqpSessionClose(e){const t=this._receiver||e.receiver;i.b.verbose("[%s] 'session_close' event occurred on the session of receiver '%s' with address '%s'. Value for isSessionItselfClosed on the session is: '%s' Value for isConnecting on the session is: '%s'.",this._context.connectionId,this.name,this.address,t?t.isSessionItselfClosed().toString():void 0,this.isConnecting),t&&!this.isConnecting&&await t.close().catch(e=>{i.b.verbose("[%s] Error when closing receiver [%s] after 'session_close' event: %O",this._context.connectionId,this.name,e)})}async abort(){const e=`[${this._context.connectionId}] The receive operation on the Receiver "${this.name}" with address "${this.address}" has been cancelled by the user.`;if(i.b.info(e),this._onError){const e=new r.b(s.b);this._onError(e)}this.clearHandlers(),await this.close()}clearHandlers(){this._abortSignal&&this._onAbort&&this._abortSignal.removeEventListener("abort",this._onAbort),this._abortSignal=void 0,this._onAbort=void 0,this._onError=void 0,this._onMessage=void 0,this._isReceivingMessages=!1,this._isStreaming=!1}async close(){try{if(this.clearHandlers(),!this._receiver)return;const e=this._receiver;this._deleteFromCache(),await this._closeLink(e)}catch(e){const t=`[${this._context.connectionId}] An error occurred while closing receiver ${this.name}: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`;throw i.b.warning(t),Object(i.a)(e),e}finally{this._isClosed=!0}}isOpen(){const e=Boolean(this._receiver&&this._receiver.isOpen());return i.b.verbose("[%s] Receiver '%s' with address '%s' is open? -> %s",this._context.connectionId,this.name,this.address,e),e}registerHandlers(e,t,n,r,o,s){this._abortSignal=o,this._onAbort=s,this._onError=t,this._onMessage=e,this._isStreaming=r,this._isReceivingMessages=!0,this._useInternalQueue(e,o).then(async s=>{if(this._onMessage!==e)return;if(!r&&n-s<=0)return;if(this.isOpen())i.b.verbose("[%s] Receiver link already present, hence reusing it.",this._context.connectionId);else try{await this.initialize({abortSignal:o,timeoutInMs:Object(B.a)(this.options.retryOptions)})}catch(e){return void(this._onError===t&&t(e))}const a=this._receiver?this._receiver.credit:0,c=r?0:s,u=Math.max(n-(a+c),0);this._addCredit(u)}).catch(e=>{this._onError===t&&t(e)})}_addCredit(e){this._receiver&&this._receiver.addCredit(e)}_deleteFromCache(){this._receiver=void 0,delete this._context.receivers[this.name],i.b.verbose("[%s] Deleted the receiver '%s' from the client cache.",this._context.connectionId,this.name)}async _useInternalQueue(e,t){let n=0;for(await Object(m.b)(0),this._usingInternalQueue=!0;this._internalQueue.length&&this._onMessage&&(!t||!t.aborted)&&this._onMessage===e;){n++,e(this._internalQueue.splice(0,1)[0]),await Object(m.b)(0)}return this._usingInternalQueue=!1,n}async initialize({abortSignal:e,timeoutInMs:t}){try{if(this.isOpen()||this.isConnecting)i.b.verbose("[%s] The receiver '%s' with address '%s' is open -> %s and is connecting -> %s. Hence not reconnecting.",this._context.connectionId,this.name,this.address,this.isOpen(),this.isConnecting);else{this.isConnecting=!0,await this._context.readyToOpenLink(),await this._negotiateClaim({setTokenRenewal:!1,abortSignal:e,timeoutInMs:t});const n={onClose:e=>this._onAmqpClose(e),onError:e=>this._onAmqpError(e),onMessage:e=>this._onAmqpMessage(e),onSessionClose:e=>this._onAmqpSessionClose(e),onSessionError:e=>this._onAmqpSessionError(e)};this.checkpoint>-1&&(n.eventPosition={sequenceNumber:this.checkpoint});const r=this._createReceiverOptions(n);i.b.verbose("[%s] Trying to create receiver '%s' with options %O",this._context.connectionId,this.name,r),this._receiver=await this._context.connection.createReceiver(Object.assign(Object.assign({},r),{abortSignal:e})),this.isConnecting=!1,i.b.verbose("[%s] Receiver '%s' created with receiver options: %O",this._context.connectionId,this.name,r),this._context.receivers[this.name]=this,this._ensureTokenRenewal()}}catch(e){this.isConnecting=!1;const t=Object(a.e)(e);throw i.b.warning("[%s] An error occured while creating the receiver '%s': %s",this._context.connectionId,this.name,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(i.a)(e),t}}_createReceiverOptions(e){const t={name:this.name,autoaccept:!0,source:{address:this.address},credit_window:0,onMessage:e.onMessage,onError:e.onError,onClose:e.onClose,onSessionError:e.onSessionError,onSessionClose:e.onSessionClose};"number"==typeof this.ownerLevel&&(t.properties={[s.a.attachEpoch]:v.types.wrap_long(this.ownerLevel)}),this.options.trackLastEnqueuedEventProperties&&(t.desired_capabilities=s.a.enableReceiverRuntimeMetricName);const n=e.eventPosition||this.eventPosition;if(n){const e=function(e){let t;if(Object(c.b)(e.offset))t=e.isInclusive?`${s.a.offsetAnnotation} >= '${e.offset}'`:`${s.a.offsetAnnotation} > '${e.offset}'`;else if(Object(c.b)(e.sequenceNumber))t=e.isInclusive?`${s.a.sequenceNumberAnnotation} >= '${e.sequenceNumber}'`:`${s.a.sequenceNumberAnnotation} > '${e.sequenceNumber}'`;else if(Object(c.b)(e.enqueuedOn)){const n=e.enqueuedOn instanceof Date?e.enqueuedOn.getTime():e.enqueuedOn;t=`${s.a.enqueuedTimeAnnotation} > '${n}'`}if(!t)throw Object(a.e)({condition:a.b.ArgumentError,description:"No starting position was set in the EventPosition."});return t}(n);e&&(t.source.filter={"apache.org:selector-filter:string":v.types.wrap_described(e,77567109365764)})}return t}async receiveBatch(e,t=60,n){const o=[],a=this.options.retryOptions||{},c=Object.defineProperties({operation:()=>new Promise((a,c)=>{if(this._isClosed||this._context.wasConnectionCloseCalled)return a(o);let u;const h=()=>{const e=this.name,t=this.address,n=`[${this._context.connectionId}] The request operation on the Receiver "${e}" with address "${t}" has been cancelled by the user.`;i.b.info(n)},d=async()=>{h();try{await this.close()}finally{c(new r.b(s.b))}};if(n&&n.aborted)return d();const l=Math.max(e-o.length,0);if(0===l)return a(o);i.b.verbose("[%s] Receiver '%s', setting the prefetch count to %d.",this._context.connectionId,this.name,l);const p=()=>{this.clearHandlers(),clearTimeout(u)},f=()=>{clearTimeout(u),d()};this.registerHandlers(n=>{o.push(n),o.length===e&&(i.b.info("[%s] Batching Receiver '%s', %d messages received within %d seconds.",this._context.connectionId,this.name,o.length,t),p(),a(o))},e=>{for(;o.length;)this._internalQueue.unshift(o.pop());p(),"AbortError"===e.name?d():c(e)},e-o.length,!1,n,f);(()=>{i.b.verbose("[%s] Setting the wait timer for %d seconds for receiver '%s'.",this._context.connectionId,t,this.name),u=setTimeout(()=>{i.b.info("[%s] Batching Receiver '%s', %d messages received when max wait time in seconds %d is over.",this._context.connectionId,this.name,o.length,t),p(),a(o)},1e3*t)})(),n&&!n.aborted&&n.addEventListener("abort",f)}),operationType:_.b.receiveMessage,abortSignal:n,retryOptions:a},{connectionId:{enumerable:!0,get:()=>this._context.connectionId},connectionHost:{enumerable:!0,get:()=>this._context.config.host}});return Object(_.c)(c)}}class F{constructor(e,t,n,i){this._context=e,this._startPosition=n,this._isReceiving=!1,this._isStopped=!1,this._partitionProcessor=t,this._processorOptions=i,this._abortController=new r.a}get isReceiving(){return this._isReceiving}async start(){this._isReceiving=!0;try{await this._partitionProcessor.initialize()}catch(e){this._partitionProcessor.processError(e)}this._receiveEvents(this._partitionProcessor.partitionId),i.b.info(`Successfully started the receiver for partition "${this._partitionProcessor.partitionId}".`)}_setOrReplaceReceiver(e,t){const n=t>=0?{sequenceNumber:t,isInclusive:!1}:this._startPosition;return this._receiver=new H(this._context,this._partitionProcessor.consumerGroup,e,n,{ownerLevel:this._processorOptions.ownerLevel,trackLastEnqueuedEventProperties:this._processorOptions.trackLastEnqueuedEventProperties,retryOptions:this._processorOptions.retryOptions,skipParsingBodyAsJson:this._processorOptions.skipParsingBodyAsJson}),this._receiver}async _receiveEvents(e){let t=-1,n=this._setOrReplaceReceiver(e,t);for(;this._isReceiving;)try{n.isClosed&&(n=this._setOrReplaceReceiver(e,t));const r=await n.receiveBatch(this._processorOptions.maxBatchSize,this._processorOptions.maxWaitTimeInSeconds,this._abortController.signal);if(this._processorOptions.trackLastEnqueuedEventProperties&&n.lastEnqueuedEventProperties&&(this._partitionProcessor.lastEnqueuedEventProperties=n.lastEnqueuedEventProperties),!this._isReceiving)return;r.length&&(t=r[r.length-1].sequenceNumber),await P.b.withSpan("PartitionPump.process",{},()=>this._partitionProcessor.processEvents(r),z(r,this._context.config))}catch(e){if(!this._isReceiving)return;i.b.warning(`An error was thrown while receiving or processing events on partition "${this._partitionProcessor.partitionId}"`),Object(i.a)(e);try{await this._partitionProcessor.processError(e)}catch(e){i.b.verbose("An error was thrown by user's processError method: ",e)}if("object"!=typeof e||!e.retryable)try{return"ReceiverDisconnectedError"===e.code?await this.stop(f.OwnershipLost):await this.stop(f.Shutdown)}catch(e){i.b.verbose(`An error occurred while closing the receiver with reason ${f.Shutdown}: `,e)}}}async stop(e){if(!this._isStopped){this._isStopped=!0,this._isReceiving=!1;try{this._abortController.abort(),this._receiver&&await this._receiver.close(),await this._partitionProcessor.close(e)}catch(e){throw i.b.warning(`An error occurred while closing the receiver: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(i.a)(e),this._partitionProcessor.processError(e),e}}}}function z(e,t){const n=[];for(const t of e){const e=T(t);e&&n.push({tracingContext:e,attributes:{enqueuedTime:t.enqueuedTimeUtc.getTime()}})}return Object.assign({spanLinks:n,spanKind:"consumer"},Object(P.a)(t))}class D{constructor(e,t){this._partitionIdToPumps={},this._eventProcessorName=e,this._options=t}receivingFromPartitions(){return Object.keys(this._partitionIdToPumps).filter(e=>{const t=this._partitionIdToPumps[e];return Boolean(t&&t.isReceiving)})}isReceivingFromPartition(e){const t=this._partitionIdToPumps[e];return Boolean(t&&t.isReceiving)}async createPump(e,t,n,r){const o=n.partitionId;if(r.aborted)return void i.b.verbose(`${this._eventProcessorName}] The subscription was closed before creating the pump for partition ${o}.`);const s=this._partitionIdToPumps[o];if(s){if(s.isReceiving)return void i.b.verbose(`[${this._eventProcessorName}] [${o}] The existing pump is running.`);i.b.verbose(`[${this._eventProcessorName}] [${o}] The existing pump is not running.`),await this.removePump(o,f.OwnershipLost)}i.b.verbose(`[${this._eventProcessorName}] [${o}] Creating a new pump.`);const a=new F(t,n,e,this._options);try{this._partitionIdToPumps[o]=a,await a.start()}catch(e){i.b.verbose(`[${this._eventProcessorName}] [${o}] An error occured while adding/updating a pump: ${e}`),Object(i.a)(e)}}async removePump(e,t){try{const n=this._partitionIdToPumps[e];n?(delete this._partitionIdToPumps[e],i.b.verbose(`[${this._eventProcessorName}] [${e}] Stopping the pump.`),await n.stop(t)):i.b.verbose(`[${this._eventProcessorName}] [${e}] No pump was found to remove.`)}catch(t){i.b.verbose(`[${this._eventProcessorName}] [${e}] An error occured while removing a pump: ${t}`),Object(i.a)(t)}}async removeAllPumps(e){const t=Object.keys(this._partitionIdToPumps);i.b.verbose(`[${this._eventProcessorName}] Removing all pumps due to reason ${e}.`);const n=[];for(const r of t){const t=this._partitionIdToPumps[r];t&&n.push(t.stop(e))}try{await Promise.all(n)}catch(e){i.b.verbose(`[${this._eventProcessorName}] An error occured while removing all pumps: ${e}`),Object(i.a)(e)}finally{this._partitionIdToPumps={}}}}async function Y(e,t){try{await Object(m.b)(e,t)}catch(e){}}var K=n(32);class Q{constructor(e,t,n,r,o){this._consumerGroup=e,this._context=t,this._subscriptionEventHandlers=n,this._checkpointStore=r,this._isRunning=!1,o.ownerId?(this._id=o.ownerId,i.b.verbose("Starting event processor with ID "+this._id)):(this._id=Object(K.a)(),i.b.verbose("Starting event processor with autogenerated ID "+this._id)),this._eventHubName=this._context.config.entityPath,this._fullyQualifiedNamespace=this._context.config.host,this._processorOptions=o,this._pumpManager=o.pumpManager||new D(this._id,this._processorOptions),this._processingTarget=o.processingTarget,this._loopIntervalInMs=o.loopIntervalInMs,this._loadBalancingStrategy=o.loadBalancingStrategy}get id(){return this._id}_createPartitionOwnershipRequest(e,t){const n=e.get(t);return{ownerId:this._id,partitionId:t,fullyQualifiedNamespace:this._fullyQualifiedNamespace,consumerGroup:this._consumerGroup,eventHubName:this._eventHubName,etag:n?n.etag:void 0}}async _claimOwnership(e,t){if(t.aborted)i.b.verbose(`[${this._id}] Subscription was closed before claiming ownership of ${e.partitionId}.`);else{i.b.info(`[${this._id}] Attempting to claim ownership of partition ${e.partitionId}.`);try{if(!(await this._checkpointStore.claimOwnership([e])).length)return;i.b.info(`[${this._id}] Successfully claimed ownership of partition ${e.partitionId}.`),await this._startPump(e.partitionId,t)}catch(t){i.b.warning(`[${this.id}] Failed to claim ownership of partition ${e.partitionId}`),Object(i.a)(t),await this._handleSubscriptionError(t)}}}async _startPump(e,t){if(t.aborted)return void i.b.verbose(`[${this._id}] The subscription was closed before starting to read from ${e}.`);if(this._pumpManager.isReceivingFromPartition(e))return void i.b.verbose(`[${this._id}] There is already an active partitionPump for partition "${e}", skipping pump creation.`);i.b.verbose(`[${this._id}] [${e}] Calling user-provided PartitionProcessorFactory.`);const n=new o(this._subscriptionEventHandlers,this._checkpointStore,{fullyQualifiedNamespace:this._fullyQualifiedNamespace,eventHubName:this._eventHubName,consumerGroup:this._consumerGroup,partitionId:e,eventProcessorId:this.id}),r=await this._getStartingPosition(e);await this._pumpManager.createPump(r,this._context,n,t),i.b.verbose(`[${this._id}] PartitionPump created successfully.`)}async _getStartingPosition(e){const t=(await this._checkpointStore.listCheckpoints(this._fullyQualifiedNamespace,this._eventHubName,this._consumerGroup)).filter(t=>t.partitionId===e);return t.length>0?{offset:t[0].offset}:(i.b.verbose(`No checkpoint found for partition ${e}. Looking for fallback.`),function(e,t){if(null==t)return h;if(l(t))return t;const n=t[e];if(null==n)return h;return n}(e,this._processorOptions.startPosition))}async _runLoopForSinglePartition(e,t){for(;!t.aborted;)try{await this._startPump(e,t)}catch(e){i.b.warning(`[${this._id}] An error occured within the EventProcessor loop: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(i.a)(e),await this._handleSubscriptionError(e)}finally{i.b.verbose(`[${this._id}] Pausing the EventProcessor loop for ${this._loopIntervalInMs} ms.`),await Y(this._loopIntervalInMs,t)}this._isRunning=!1}async _runLoopWithLoadBalancing(e,t){let n;const r=new Promise(e=>{n=e,t.aborted?e():t.addEventListener("abort",e)});for(;!t.aborted;){const n=Date.now();try{const{partitionIds:r}=await this._context.managementSession.getEventHubProperties({abortSignal:t});await this._performLoadBalancing(e,r,t)}catch(e){i.b.warning(`[${this._id}] An error occured within the EventProcessor loop: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(i.a)(e),await Promise.race([this._handleSubscriptionError(e),r])}finally{const e=Date.now()-n,r=Math.max(this._loopIntervalInMs-e,0);i.b.verbose(`[${this._id}] Pausing the EventProcessor loop for ${r} ms.`),await Y(r,t)}}n&&t.removeEventListener("abort",n),this._isRunning=!1}async _performLoadBalancing(e,t,n){if(n.aborted)throw new r.b("The operation was aborted.");const i=await this._checkpointStore.listOwnership(this._fullyQualifiedNamespace,this._eventHubName,this._consumerGroup);if(n.aborted)throw new r.b("The operation was aborted.");const o=new Map,s=new Map,a=[];for(const e of i)o.set(e.partitionId,e),G(e)||s.set(e.partitionId,e),e.ownerId===this._id&&this._pumpManager.isReceivingFromPartition(e.partitionId)&&a.push(e.partitionId);const c=e.getPartitionsToCliam(this._id,s,t);c.push(...a);const u=new Set(c);for(const e of u){const t=this._createPartitionOwnershipRequest(o,e);await this._claimOwnership(t,n)}}async _handleSubscriptionError(e){if("AbortError"!==e.name&&this._subscriptionEventHandlers.processError)try{await this._subscriptionEventHandlers.processError(e,{fullyQualifiedNamespace:this._fullyQualifiedNamespace,eventHubName:this._eventHubName,consumerGroup:this._consumerGroup,partitionId:"",updateCheckpoint:async()=>{}})}catch(e){i.b.verbose(`[${this._id}] An error was thrown from the user's processError handler: ${e}`)}}start(){this._isRunning?i.b.verbose(`[${this._id}] Attempted to start an already running EventProcessor.`):(this._isRunning=!0,this._abortController=new r.a,i.b.verbose(`[${this._id}] Starting an EventProcessor.`),this._processingTarget?(i.b.verbose(`[${this._id}] Single partition target: ${this._processingTarget}`),this._loopTask=this._runLoopForSinglePartition(this._processingTarget,this._abortController.signal)):(i.b.verbose(`[${this._id}] Multiple partitions, using load balancer`),this._loopTask=this._runLoopWithLoadBalancing(this._loadBalancingStrategy,this._abortController.signal)))}isRunning(){return this._isRunning}async stop(){i.b.verbose(`[${this._id}] Stopping an EventProcessor.`),this._abortController&&this._abortController.abort();try{await this._pumpManager.removeAllPumps(f.Shutdown),this._loopTask&&await this._loopTask}catch(e){i.b.verbose(`[${this._id}] An error occured while stopping the EventProcessor: ${e}`)}finally{i.b.verbose(`[${this._id}] EventProcessor stopped.`)}this._processingTarget?i.b.verbose(`[${this._id}] No partitions owned, skipping abandoning.`):await this.abandonPartitionOwnerships()}async abandonPartitionOwnerships(){i.b.verbose(`[${this._id}] Abandoning owned partitions`);const e=(await this._checkpointStore.listOwnership(this._fullyQualifiedNamespace,this._eventHubName,this._consumerGroup)).filter(e=>e.ownerId===this._id);for(const t of e)t.ownerId="";return this._checkpointStore.claimOwnership(e)}}function G(e){return""===e.ownerId}function W(){if("undefined"==typeof self)return"";return self.navigator.appVersion}var J=n(42);class V{constructor(e,t){this.endpoint=s.a.cbsEndpoint,this.replyTo=`${s.a.cbsReplyTo}-${Object(v.generate_uuid)()}`,this.cbsLock=`${s.a.negotiateCbsKey}-${Object(v.generate_uuid)()}`,this.connection=e,this.connectionLock=t}async init(e={}){const{abortSignal:t,timeoutInMs:n}=e;try{if(null==t?void 0:t.aborted)throw new r.b(s.b);if(this.connection.isOpen()||(g.b.verbose("The CBS client is trying to establish an AMQP connection."),await m.a.acquire(this.connectionLock,()=>this.connection.open({abortSignal:t}),{abortSignal:t,timeoutInMs:n})),this.isOpen())g.b.verbose("[%s] CBS session is already present. Reusing the cbs sender '%s' and receiver '%s' links over cbs session.",this.connection.id,this._cbsSenderReceiverLink.sender.name,this._cbsSenderReceiverLink.receiver.name);else{const e={source:{address:this.endpoint},name:this.replyTo,onSessionError:e=>{const t=e.connection.options.id,n=Object(a.e)(e.session.error);g.b.verbose("[%s] An error occurred on the session for request/response links for $cbs: %O",t,n)}},n={target:{address:this.endpoint}};g.b.verbose("[%s] Creating sender/receiver links on a session for $cbs endpoint.",this.connection.id),this._cbsSenderReceiverLink=await J.a.create(this.connection,n,e,{abortSignal:t}),this._cbsSenderReceiverLink.sender.on(v.SenderEvents.senderError,e=>{const t=e.connection.options.id,n=Object(a.e)(e.sender.error);g.b.verbose("[%s] An error occurred on the cbs sender link.. %O",t,n)}),this._cbsSenderReceiverLink.receiver.on(v.ReceiverEvents.receiverError,e=>{const t=e.connection.options.id,n=Object(a.e)(e.receiver.error);g.b.verbose("[%s] An error occurred on the cbs receiver link.. %O",t,n)}),g.b.verbose("[%s] Successfully created the cbs sender '%s' and receiver '%s' links over cbs session.",this.connection.id,this._cbsSenderReceiverLink.sender.name,this._cbsSenderReceiverLink.receiver.name)}}catch(e){const t=Object(a.e)(e);throw g.b.warning("[%s] An error occurred while establishing the cbs links: %s",this.connection.id,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(g.a)(t),t}}async negotiateClaim(e,t,n,i={}){const{abortSignal:o,timeoutInMs:a}=i;try{if(null==o?void 0:o.aborted)throw new r.b(s.b);if(!this._cbsSenderReceiverLink)throw new Error("Attempted to negotiate a claim but the CBS link does not exist.");const i={body:t,message_id:Object(v.generate_uuid)(),reply_to:this.replyTo,to:this.endpoint,application_properties:{operation:s.a.operationPutToken,name:e,type:n}},c=await this._cbsSenderReceiverLink.sendRequest(i,{abortSignal:o,timeoutInMs:a,requestName:"negotiateClaim"});return g.b.verbose("[%s] The CBS response is: %O",this.connection.id,c),this._fromRheaMessageResponse(c)}catch(e){throw g.b.warning("[%s] An error occurred while negotiating the cbs claim: %s",this.connection.id,`${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(g.a)(e),e}}async close(){try{if(this.isOpen()){const e=this._cbsSenderReceiverLink;this._cbsSenderReceiverLink=void 0,await e.close(),g.b.verbose("[%s] Successfully closed the cbs session.",this.connection.id)}}catch(e){const t=`An error occurred while closing the cbs link: ${e.stack||JSON.stringify(e)}.`;throw g.b.verbose("[%s] %s",this.connection.id,t),new Error(t)}}remove(){try{if(this._cbsSenderReceiverLink){const e=this._cbsSenderReceiverLink;this._cbsSenderReceiverLink=void 0,e.remove(),g.b.verbose("[%s] Successfully removed the cbs session.",this.connection.id)}}catch(e){const t=`An error occurred while removing the cbs link: ${e.stack||JSON.stringify(e)}.`;throw g.b.verbose("[%s] %s",this.connection.id,t),new Error(t)}}isOpen(){var e;return Boolean(null===(e=this._cbsSenderReceiverLink)||void 0===e?void 0:e.isOpen())}_fromRheaMessageResponse(e){const t={correlationId:e.correlation_id,statusCode:e.application_properties?e.application_properties["status-code"]:"",statusDescription:e.application_properties?e.application_properties["status-description"]:""};return g.b.verbose("[%s] The deserialized CBS response is: %o",this.connection.id,t),t}}var X=n(10);const Z={create(e,t){e=String(e);const n=Object(m.f)(e);if(!n.Endpoint)throw new TypeError("Missing Endpoint in Connection String.");n.Endpoint.endsWith("/")||(n.Endpoint+="/");const r={connectionString:e,endpoint:n.Endpoint,host:n&&n.Endpoint?(n.Endpoint.match(".*://([^/]*)")||[])[1]:"",sharedAccessKeyName:n.SharedAccessKeyName,sharedAccessKey:n.SharedAccessKey};return(t||n.EntityPath)&&(r.entityPath=t||n.EntityPath),r},validate(e,t){if(t||(t={}),!e)throw new TypeError("Missing configuration");if(!e.endpoint)throw new TypeError("Missing 'endpoint' in configuration");if(e.endpoint=String(e.endpoint),!e.host)throw new TypeError("Missing 'host' in configuration");if(e.host=String(e.host),t.isEntityPathRequired&&!e.entityPath)throw new TypeError("Missing 'entityPath' in configuration");if(Object(X.a)(e.entityPath)&&(e.entityPath=String(e.entityPath)),null==e.connectionString.match(/;{0,1}SharedAccessSignature=SharedAccessSignature /)){if(!e.sharedAccessKeyName)throw new TypeError("Missing 'sharedAccessKeyName' in configuration");if(e.sharedAccessKeyName=String(e.sharedAccessKeyName),!e.sharedAccessKey)throw new TypeError("Missing 'sharedAccessKey' in configuration");e.sharedAccessKey=String(e.sharedAccessKey)}}};class ee extends v.Connection{async createSender(e){const t=await super.createSender(e);return t.setMaxListeners(1e3),t}async createAwaitableSender(e){const t=await super.createAwaitableSender(e);return t.setMaxListeners(1e3),t}async createReceiver(e){const t=await super.createReceiver(e);return t.setMaxListeners(1e3),t}}const te={create(e){var t,n,r;Z.validate(e.config,{isEntityPathRequired:e.isEntityPathRequired||!1});const i=e.connectionProperties.userAgent;if(i.length>s.a.maxUserAgentLength)throw new Error(`The user-agent string cannot be more than ${s.a.maxUserAgentLength} characters in length.The given user-agent string is: ${i} with length: ${i.length}`);const o={transport:s.a.TLS,host:e.config.host,hostname:null!==(t=e.config.amqpHostname)&&void 0!==t?t:e.config.host,username:e.config.sharedAccessKeyName,port:null!==(n=e.config.port)&&void 0!==n?n:5671,reconnect:!1,properties:{product:e.connectionProperties.product,version:e.connectionProperties.version,"user-agent":i,platform:`(javascript-Browser-${W()})`,framework:"Browser/"+W()},idle_time_out:s.a.defaultConnectionIdleTimeoutInMs,operationTimeoutInSeconds:e.operationTimeoutInMs?e.operationTimeoutInMs/1e3:void 0};if(e.config.webSocket||!m.c&&"undefined"!=typeof self&&self.WebSocket){const t=e.config.webSocket||self.WebSocket,n=e.config.host,i=e.config.webSocketEndpointPath||"",s=e.config.webSocketConstructorOptions||{},a=null!==(r=e.config.port)&&void 0!==r?r:443;o.webSocketOptions={webSocket:t,url:`wss://${n}:${a}/${i}`,protocol:["AMQPWSB10"],options:s}}const a=new ee(o),c=`${s.a.establishConnection}-${Object(v.generate_uuid)()}`;return{wasConnectionCloseCalled:!1,connectionLock:c,negotiateClaimLock:`${s.a.negotiateClaim}-${Object(v.generate_uuid)()}`,connection:a,connectionId:a.id,cbsSession:new V(a,c),config:e.config,refreshConnection(){const e=new ee(o),t=`${s.a.establishConnection}-${Object(v.generate_uuid)()}`;this.wasConnectionCloseCalled=!1,this.connectionLock=t,this.negotiateClaimLock=`${s.a.negotiateClaim} - ${Object(v.generate_uuid)()}`,this.connection=e,this.connectionId=e.id,this.cbsSession=new V(e,t)}}}};var ne=n(81),re=n(82);const ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function oe(e,t,n,r){let i,o,s;const a=t||[0],c=(n=n||0)>>>3,u=-1===r?3:0;for(i=0;i<e.length;i+=1)s=i+c,o=s>>>2,a.length<=o&&a.push(0),a[o]|=e[i]<<8*(u+r*(s%4));return{value:a,binLen:8*e.length+n}}function se(e,t,n){switch(t){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw new Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(e){case"HEX":return function(e,t,r){return function(e,t,n,r){let i,o,s,a;if(0!=e.length%2)throw new Error("String of HEX type must be in byte increments");const c=t||[0],u=(n=n||0)>>>3,h=-1===r?3:0;for(i=0;i<e.length;i+=2){if(o=parseInt(e.substr(i,2),16),isNaN(o))throw new Error("String of HEX type contains invalid characters");for(a=(i>>>1)+u,s=a>>>2;c.length<=s;)c.push(0);c[s]|=o<<8*(h+r*(a%4))}return{value:c,binLen:4*e.length+n}}(e,t,r,n)};case"TEXT":return function(e,r,i){return function(e,t,n,r,i){let o,s,a,c,u,h,d,l,p=0;const f=n||[0],m=(r=r||0)>>>3;if("UTF8"===t)for(d=-1===i?3:0,a=0;a<e.length;a+=1)for(o=e.charCodeAt(a),s=[],128>o?s.push(o):2048>o?(s.push(192|o>>>6),s.push(128|63&o)):55296>o||57344<=o?s.push(224|o>>>12,128|o>>>6&63,128|63&o):(a+=1,o=65536+((1023&o)<<10|1023&e.charCodeAt(a)),s.push(240|o>>>18,128|o>>>12&63,128|o>>>6&63,128|63&o)),c=0;c<s.length;c+=1){for(h=p+m,u=h>>>2;f.length<=u;)f.push(0);f[u]|=s[c]<<8*(d+i*(h%4)),p+=1}else for(d=-1===i?2:0,l="UTF16LE"===t&&1!==i||"UTF16LE"!==t&&1===i,a=0;a<e.length;a+=1){for(o=e.charCodeAt(a),!0===l&&(c=255&o,o=c<<8|o>>>8),h=p+m,u=h>>>2;f.length<=u;)f.push(0);f[u]|=o<<8*(d+i*(h%4)),p+=2}return{value:f,binLen:8*p+r}}(e,t,r,i,n)};case"B64":return function(e,t,r){return function(e,t,n,r){let i,o,s,a,c,u,h,d=0;const l=t||[0],p=(n=n||0)>>>3,f=-1===r?3:0,m=e.indexOf("=");if(-1===e.search(/^[a-zA-Z0-9=+/]+$/))throw new Error("Invalid character in base-64 string");if(e=e.replace(/=/g,""),-1!==m&&m<e.length)throw new Error("Invalid '=' found in base-64 string");for(o=0;o<e.length;o+=4){for(c=e.substr(o,4),a=0,s=0;s<c.length;s+=1)i=ie.indexOf(c.charAt(s)),a|=i<<18-6*s;for(s=0;s<c.length-1;s+=1){for(h=d+p,u=h>>>2;l.length<=u;)l.push(0);l[u]|=(a>>>16-8*s&255)<<8*(f+r*(h%4)),d+=1}}return{value:l,binLen:8*d+n}}(e,t,r,n)};case"BYTES":return function(e,t,r){return function(e,t,n,r){let i,o,s,a;const c=t||[0],u=(n=n||0)>>>3,h=-1===r?3:0;for(o=0;o<e.length;o+=1)i=e.charCodeAt(o),a=o+u,s=a>>>2,c.length<=s&&c.push(0),c[s]|=i<<8*(h+r*(a%4));return{value:c,binLen:8*e.length+n}}(e,t,r,n)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch(e){throw new Error("ARRAYBUFFER not supported by this environment")}return function(e,t,r){return function(e,t,n,r){return oe(new Uint8Array(e),t,n,r)}(e,t,r,n)};case"UINT8ARRAY":try{new Uint8Array(0)}catch(e){throw new Error("UINT8ARRAY not supported by this environment")}return function(e,t,r){return oe(e,t,r,n)};default:throw new Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}function ae(e,t,n,r){switch(e){case"HEX":return function(e){return function(e,t,n,r){let i,o,s="";const a=t/8,c=-1===n?3:0;for(i=0;i<a;i+=1)o=e[i>>>2]>>>8*(c+n*(i%4)),s+="0123456789abcdef".charAt(o>>>4&15)+"0123456789abcdef".charAt(15&o);return r.outputUpper?s.toUpperCase():s}(e,t,n,r)};case"B64":return function(e){return function(e,t,n,r){let i,o,s,a,c,u="";const h=t/8,d=-1===n?3:0;for(i=0;i<h;i+=3)for(a=i+1<h?e[i+1>>>2]:0,c=i+2<h?e[i+2>>>2]:0,s=(e[i>>>2]>>>8*(d+n*(i%4))&255)<<16|(a>>>8*(d+n*((i+1)%4))&255)<<8|c>>>8*(d+n*((i+2)%4))&255,o=0;o<4;o+=1)u+=8*i+6*o<=t?ie.charAt(s>>>6*(3-o)&63):r.b64Pad;return u}(e,t,n,r)};case"BYTES":return function(e){return function(e,t,n){let r,i,o="";const s=t/8,a=-1===n?3:0;for(r=0;r<s;r+=1)i=e[r>>>2]>>>8*(a+n*(r%4))&255,o+=String.fromCharCode(i);return o}(e,t,n)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch(e){throw new Error("ARRAYBUFFER not supported by this environment")}return function(e){return function(e,t,n){let r;const i=t/8,o=new ArrayBuffer(i),s=new Uint8Array(o),a=-1===n?3:0;for(r=0;r<i;r+=1)s[r]=e[r>>>2]>>>8*(a+n*(r%4))&255;return o}(e,t,n)};case"UINT8ARRAY":try{new Uint8Array(0)}catch(e){throw new Error("UINT8ARRAY not supported by this environment")}return function(e){return function(e,t,n){let r;const i=t/8,o=-1===n?3:0,s=new Uint8Array(i);for(r=0;r<i;r+=1)s[r]=e[r>>>2]>>>8*(o+n*(r%4))&255;return s}(e,t,n)};default:throw new Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}const ce=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],ue=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],he=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],de="Chosen SHA variant is not supported";function le(e,t){let n,r;const i=e.binLen>>>3,o=t.binLen>>>3,s=i<<3,a=4-i<<3;if(i%4!=0){for(n=0;n<o;n+=4)r=i+n>>>2,e.value[r]|=t.value[n>>>2]<<s,e.value.push(0),e.value[r+1]|=t.value[n>>>2]>>>a;return(e.value.length<<2)-4>=o+i&&e.value.pop(),{value:e.value,binLen:e.binLen+t.binLen}}return{value:e.value.concat(t.value),binLen:e.binLen+t.binLen}}function pe(e){const t={outputUpper:!1,b64Pad:"=",outputLen:-1},n=e||{},r="Output length must be a multiple of 8";if(t.outputUpper=n.outputUpper||!1,n.b64Pad&&(t.b64Pad=n.b64Pad),n.outputLen){if(n.outputLen%8!=0)throw new Error(r);t.outputLen=n.outputLen}else if(n.shakeLen){if(n.shakeLen%8!=0)throw new Error(r);t.outputLen=n.shakeLen}if("boolean"!=typeof t.outputUpper)throw new Error("Invalid outputUpper formatting option");if("string"!=typeof t.b64Pad)throw new Error("Invalid b64Pad formatting option");return t}function fe(e,t,n,r){const i=e+" must include a value and format";if(!t){if(!r)throw new Error(i);return r}if(void 0===t.value||!t.format)throw new Error(i);return se(t.format,t.encoding||"UTF8",n)(t.value)}class me{constructor(e,t,n){const r=n||{};if(this.t=t,this.i=r.encoding||"UTF8",this.numRounds=r.numRounds||1,isNaN(this.numRounds)||this.numRounds!==parseInt(this.numRounds,10)||1>this.numRounds)throw new Error("numRounds must a integer >= 1");this.s=e,this.o=[],this.h=0,this.u=!1,this.l=0,this.A=!1,this.H=[],this.S=[]}update(e){let t,n=0;const r=this.p>>>5,i=this.m(e,this.o,this.h),o=i.binLen,s=i.value,a=o>>>5;for(t=0;t<a;t+=r)n+this.p<=o&&(this.C=this.R(s.slice(t,t+r),this.C),n+=this.p);this.l+=n,this.o=s.slice(n>>>5),this.h=o%this.p,this.u=!0}getHash(e,t){let n,r,i=this.U;const o=pe(t);if(this.v){if(-1===o.outputLen)throw new Error("Output length must be specified in options");i=o.outputLen}const s=ae(e,i,this.K,o);if(this.A&&this.T)return s(this.T(o));for(r=this.F(this.o.slice(),this.h,this.l,this.g(this.C),i),n=1;n<this.numRounds;n+=1)this.v&&i%32!=0&&(r[r.length-1]&=16777215>>>24-i%32),r=this.F(r,i,0,this.B(this.s),i);return s(r)}setHMACKey(e,t,n){if(!this.L)throw new Error("Variant does not support HMAC");if(this.u)throw new Error("Cannot set MAC key after calling update");const r=se(t,(n||{}).encoding||"UTF8",this.K);this.M(r(e))}M(e){const t=this.p>>>3,n=t/4-1;let r;if(1!==this.numRounds)throw new Error("Cannot set numRounds with MAC");if(this.A)throw new Error("MAC key already set");for(t<e.binLen/8&&(e.value=this.F(e.value,e.binLen,0,this.B(this.s),this.U));e.value.length<=n;)e.value.push(0);for(r=0;r<=n;r+=1)this.H[r]=909522486^e.value[r],this.S[r]=1549556828^e.value[r];this.C=this.R(this.H,this.C),this.l=this.p,this.A=!0}getHMAC(e,t){const n=pe(t);return ae(e,this.U,this.K,n)(this.k())}k(){let e;if(!this.A)throw new Error("Cannot call getHMAC without first setting MAC key");const t=this.F(this.o.slice(),this.h,this.l,this.g(this.C),this.U);return e=this.R(this.S,this.B(this.s)),e=this.F(t,this.U,this.p,e,this.U),e}}function _e(e,t){return e<<t|e>>>32-t}function ve(e,t){return e>>>t|e<<32-t}function ge(e,t){return e>>>t}function be(e,t,n){return e^t^n}function ye(e,t,n){return e&t^~e&n}function we(e,t,n){return e&t^e&n^t&n}function Ee(e){return ve(e,2)^ve(e,13)^ve(e,22)}function Se(e,t){const n=(65535&e)+(65535&t);return(65535&(e>>>16)+(t>>>16)+(n>>>16))<<16|65535&n}function Oe(e,t,n,r){const i=(65535&e)+(65535&t)+(65535&n)+(65535&r);return(65535&(e>>>16)+(t>>>16)+(n>>>16)+(r>>>16)+(i>>>16))<<16|65535&i}function Ce(e,t,n,r,i){const o=(65535&e)+(65535&t)+(65535&n)+(65535&r)+(65535&i);return(65535&(e>>>16)+(t>>>16)+(n>>>16)+(r>>>16)+(i>>>16)+(o>>>16))<<16|65535&o}function Ie(e){return ve(e,7)^ve(e,18)^ge(e,3)}function ke(e){return ve(e,6)^ve(e,11)^ve(e,25)}function Pe(e){return[1732584193,4023233417,2562383102,271733878,3285377520]}function xe(e,t){let n,r,i,o,s,a,c;const u=[];for(n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],c=0;c<80;c+=1)u[c]=c<16?e[c]:_e(u[c-3]^u[c-8]^u[c-14]^u[c-16],1),a=c<20?Ce(_e(n,5),ye(r,i,o),s,1518500249,u[c]):c<40?Ce(_e(n,5),be(r,i,o),s,1859775393,u[c]):c<60?Ce(_e(n,5),we(r,i,o),s,2400959708,u[c]):Ce(_e(n,5),be(r,i,o),s,3395469782,u[c]),s=o,o=i,i=_e(r,30),r=n,n=a;return t[0]=Se(n,t[0]),t[1]=Se(r,t[1]),t[2]=Se(i,t[2]),t[3]=Se(o,t[3]),t[4]=Se(s,t[4]),t}function Te(e,t,n,r){let i;const o=15+(t+65>>>9<<4),s=t+n;for(;e.length<=o;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[o]=4294967295&s,e[o-1]=s/4294967296|0,i=0;i<e.length;i+=16)r=xe(e.slice(i,i+16),r);return r}class Ae extends me{constructor(e,t,n){if("SHA-1"!==e)throw new Error(de);super(e,t,n);const r=n||{};this.L=!0,this.T=this.k,this.K=-1,this.m=se(this.t,this.i,this.K),this.R=xe,this.g=function(e){return e.slice()},this.B=Pe,this.F=Te,this.C=[1732584193,4023233417,2562383102,271733878,3285377520],this.p=512,this.U=160,this.v=!1,r.hmacKey&&this.M(fe("hmacKey",r.hmacKey,this.K))}}function Re(e){let t;return t="SHA-224"==e?ue.slice():he.slice(),t}function je(e,t){let n,r,i,o,s,a,c,u,h,d,l;const p=[];for(n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],l=0;l<64;l+=1)p[l]=l<16?e[l]:Oe(ve(f=p[l-2],17)^ve(f,19)^ge(f,10),p[l-7],Ie(p[l-15]),p[l-16]),h=Ce(u,ke(s),ye(s,a,c),ce[l],p[l]),d=Se(Ee(n),we(n,r,i)),u=c,c=a,a=s,s=Se(o,h),o=i,i=r,r=n,n=Se(h,d);var f;return t[0]=Se(n,t[0]),t[1]=Se(r,t[1]),t[2]=Se(i,t[2]),t[3]=Se(o,t[3]),t[4]=Se(s,t[4]),t[5]=Se(a,t[5]),t[6]=Se(c,t[6]),t[7]=Se(u,t[7]),t}class Me extends me{constructor(e,t,n){if("SHA-224"!==e&&"SHA-256"!==e)throw new Error(de);super(e,t,n);const r=n||{};this.T=this.k,this.L=!0,this.K=-1,this.m=se(this.t,this.i,this.K),this.R=je,this.g=function(e){return e.slice()},this.B=Re,this.F=function(t,n,r,i){return function(e,t,n,r,i){let o,s;const a=15+(t+65>>>9<<4),c=t+n;for(;e.length<=a;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[a]=4294967295&c,e[a-1]=c/4294967296|0,o=0;o<e.length;o+=16)r=je(e.slice(o,o+16),r);return s="SHA-224"===i?[r[0],r[1],r[2],r[3],r[4],r[5],r[6]]:r,s}(t,n,r,i,e)},this.C=Re(e),this.p=512,this.U="SHA-224"===e?224:256,this.v=!1,r.hmacKey&&this.M(fe("hmacKey",r.hmacKey,this.K))}}class Ne{constructor(e,t){this.Y=e,this.N=t}}function Le(e,t){let n;return t>32?(n=64-t,new Ne(e.N<<t|e.Y>>>n,e.Y<<t|e.N>>>n)):0!==t?(n=32-t,new Ne(e.Y<<t|e.N>>>n,e.N<<t|e.Y>>>n)):e}function qe(e,t){let n;return t<32?(n=32-t,new Ne(e.Y>>>t|e.N<<n,e.N>>>t|e.Y<<n)):(n=64-t,new Ne(e.N>>>t|e.Y<<n,e.Y>>>t|e.N<<n))}function $e(e,t){return new Ne(e.Y>>>t,e.N>>>t|e.Y<<32-t)}function Ue(e,t,n){return new Ne(e.Y&t.Y^e.Y&n.Y^t.Y&n.Y,e.N&t.N^e.N&n.N^t.N&n.N)}function Be(e){const t=qe(e,28),n=qe(e,34),r=qe(e,39);return new Ne(t.Y^n.Y^r.Y,t.N^n.N^r.N)}function He(e,t){let n,r;n=(65535&e.N)+(65535&t.N),r=(e.N>>>16)+(t.N>>>16)+(n>>>16);const i=(65535&r)<<16|65535&n;return n=(65535&e.Y)+(65535&t.Y)+(r>>>16),r=(e.Y>>>16)+(t.Y>>>16)+(n>>>16),new Ne((65535&r)<<16|65535&n,i)}function Fe(e,t,n,r){let i,o;i=(65535&e.N)+(65535&t.N)+(65535&n.N)+(65535&r.N),o=(e.N>>>16)+(t.N>>>16)+(n.N>>>16)+(r.N>>>16)+(i>>>16);const s=(65535&o)<<16|65535&i;return i=(65535&e.Y)+(65535&t.Y)+(65535&n.Y)+(65535&r.Y)+(o>>>16),o=(e.Y>>>16)+(t.Y>>>16)+(n.Y>>>16)+(r.Y>>>16)+(i>>>16),new Ne((65535&o)<<16|65535&i,s)}function ze(e,t,n,r,i){let o,s;o=(65535&e.N)+(65535&t.N)+(65535&n.N)+(65535&r.N)+(65535&i.N),s=(e.N>>>16)+(t.N>>>16)+(n.N>>>16)+(r.N>>>16)+(i.N>>>16)+(o>>>16);const a=(65535&s)<<16|65535&o;return o=(65535&e.Y)+(65535&t.Y)+(65535&n.Y)+(65535&r.Y)+(65535&i.Y)+(s>>>16),s=(e.Y>>>16)+(t.Y>>>16)+(n.Y>>>16)+(r.Y>>>16)+(i.Y>>>16)+(o>>>16),new Ne((65535&s)<<16|65535&o,a)}function De(e,t){return new Ne(e.Y^t.Y,e.N^t.N)}function Ye(e){const t=qe(e,19),n=qe(e,61),r=$e(e,6);return new Ne(t.Y^n.Y^r.Y,t.N^n.N^r.N)}function Ke(e){const t=qe(e,1),n=qe(e,8),r=$e(e,7);return new Ne(t.Y^n.Y^r.Y,t.N^n.N^r.N)}function Qe(e){const t=qe(e,14),n=qe(e,18),r=qe(e,41);return new Ne(t.Y^n.Y^r.Y,t.N^n.N^r.N)}const Ge=[new Ne(ce[0],3609767458),new Ne(ce[1],602891725),new Ne(ce[2],3964484399),new Ne(ce[3],2173295548),new Ne(ce[4],4081628472),new Ne(ce[5],3053834265),new Ne(ce[6],2937671579),new Ne(ce[7],3664609560),new Ne(ce[8],2734883394),new Ne(ce[9],1164996542),new Ne(ce[10],1323610764),new Ne(ce[11],3590304994),new Ne(ce[12],4068182383),new Ne(ce[13],991336113),new Ne(ce[14],633803317),new Ne(ce[15],3479774868),new Ne(ce[16],2666613458),new Ne(ce[17],944711139),new Ne(ce[18],2341262773),new Ne(ce[19],2007800933),new Ne(ce[20],1495990901),new Ne(ce[21],1856431235),new Ne(ce[22],3175218132),new Ne(ce[23],2198950837),new Ne(ce[24],3999719339),new Ne(ce[25],766784016),new Ne(ce[26],2566594879),new Ne(ce[27],3203337956),new Ne(ce[28],1034457026),new Ne(ce[29],2466948901),new Ne(ce[30],3758326383),new Ne(ce[31],168717936),new Ne(ce[32],1188179964),new Ne(ce[33],1546045734),new Ne(ce[34],1522805485),new Ne(ce[35],2643833823),new Ne(ce[36],2343527390),new Ne(ce[37],1014477480),new Ne(ce[38],1206759142),new Ne(ce[39],344077627),new Ne(ce[40],1290863460),new Ne(ce[41],3158454273),new Ne(ce[42],3505952657),new Ne(ce[43],106217008),new Ne(ce[44],3606008344),new Ne(ce[45],1432725776),new Ne(ce[46],1467031594),new Ne(ce[47],851169720),new Ne(ce[48],3100823752),new Ne(ce[49],1363258195),new Ne(ce[50],3750685593),new Ne(ce[51],3785050280),new Ne(ce[52],3318307427),new Ne(ce[53],3812723403),new Ne(ce[54],2003034995),new Ne(ce[55],3602036899),new Ne(ce[56],1575990012),new Ne(ce[57],1125592928),new Ne(ce[58],2716904306),new Ne(ce[59],442776044),new Ne(ce[60],593698344),new Ne(ce[61],3733110249),new Ne(ce[62],2999351573),new Ne(ce[63],3815920427),new Ne(3391569614,3928383900),new Ne(3515267271,566280711),new Ne(3940187606,3454069534),new Ne(4118630271,4000239992),new Ne(116418474,1914138554),new Ne(174292421,2731055270),new Ne(289380356,3203993006),new Ne(460393269,320620315),new Ne(685471733,587496836),new Ne(852142971,1086792851),new Ne(1017036298,365543100),new Ne(1126000580,2618297676),new Ne(1288033470,3409855158),new Ne(1501505948,4234509866),new Ne(1607167915,987167468),new Ne(1816402316,1246189591)];function We(e){return"SHA-384"===e?[new Ne(3418070365,ue[0]),new Ne(1654270250,ue[1]),new Ne(2438529370,ue[2]),new Ne(355462360,ue[3]),new Ne(1731405415,ue[4]),new Ne(41048885895,ue[5]),new Ne(3675008525,ue[6]),new Ne(1203062813,ue[7])]:[new Ne(he[0],4089235720),new Ne(he[1],2227873595),new Ne(he[2],4271175723),new Ne(he[3],1595750129),new Ne(he[4],2917565137),new Ne(he[5],725511199),new Ne(he[6],4215389547),new Ne(he[7],327033209)]}function Je(e,t){let n,r,i,o,s,a,c,u,h,d,l,p;const f=[];for(n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],l=0;l<80;l+=1)l<16?(p=2*l,f[l]=new Ne(e[p],e[p+1])):f[l]=Fe(Ye(f[l-2]),f[l-7],Ke(f[l-15]),f[l-16]),h=ze(u,Qe(s),(_=a,v=c,new Ne((m=s).Y&_.Y^~m.Y&v.Y,m.N&_.N^~m.N&v.N)),Ge[l],f[l]),d=He(Be(n),Ue(n,r,i)),u=c,c=a,a=s,s=He(o,h),o=i,i=r,r=n,n=He(h,d);var m,_,v;return t[0]=He(n,t[0]),t[1]=He(r,t[1]),t[2]=He(i,t[2]),t[3]=He(o,t[3]),t[4]=He(s,t[4]),t[5]=He(a,t[5]),t[6]=He(c,t[6]),t[7]=He(u,t[7]),t}class Ve extends me{constructor(e,t,n){if("SHA-384"!==e&&"SHA-512"!==e)throw new Error(de);super(e,t,n);const r=n||{};this.T=this.k,this.L=!0,this.K=-1,this.m=se(this.t,this.i,this.K),this.R=Je,this.g=function(e){return e.slice()},this.B=We,this.F=function(t,n,r,i){return function(e,t,n,r,i){let o,s;const a=31+(t+129>>>10<<5),c=t+n;for(;e.length<=a;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[a]=4294967295&c,e[a-1]=c/4294967296|0,o=0;o<e.length;o+=32)r=Je(e.slice(o,o+32),r);return s="SHA-384"===i?[(r=r)[0].Y,r[0].N,r[1].Y,r[1].N,r[2].Y,r[2].N,r[3].Y,r[3].N,r[4].Y,r[4].N,r[5].Y,r[5].N]:[r[0].Y,r[0].N,r[1].Y,r[1].N,r[2].Y,r[2].N,r[3].Y,r[3].N,r[4].Y,r[4].N,r[5].Y,r[5].N,r[6].Y,r[6].N,r[7].Y,r[7].N],s}(t,n,r,i,e)},this.C=We(e),this.p=1024,this.U="SHA-384"===e?384:512,this.v=!1,r.hmacKey&&this.M(fe("hmacKey",r.hmacKey,this.K))}}const Xe=[new Ne(0,1),new Ne(0,32898),new Ne(2147483648,32906),new Ne(2147483648,2147516416),new Ne(0,32907),new Ne(0,2147483649),new Ne(2147483648,2147516545),new Ne(2147483648,32777),new Ne(0,138),new Ne(0,136),new Ne(0,2147516425),new Ne(0,2147483658),new Ne(0,2147516555),new Ne(2147483648,139),new Ne(2147483648,32905),new Ne(2147483648,32771),new Ne(2147483648,32770),new Ne(2147483648,128),new Ne(0,32778),new Ne(2147483648,2147483658),new Ne(2147483648,2147516545),new Ne(2147483648,32896),new Ne(0,2147483649),new Ne(2147483648,2147516424)],Ze=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];function et(e){let t;const n=[];for(t=0;t<5;t+=1)n[t]=[new Ne(0,0),new Ne(0,0),new Ne(0,0),new Ne(0,0),new Ne(0,0)];return n}function tt(e){let t;const n=[];for(t=0;t<5;t+=1)n[t]=e[t].slice();return n}function nt(e,t){let n,r,i,o;const s=[],a=[];if(null!==e)for(r=0;r<e.length;r+=2)t[(r>>>1)%5][(r>>>1)/5|0]=De(t[(r>>>1)%5][(r>>>1)/5|0],new Ne(e[r+1],e[r]));for(n=0;n<24;n+=1){for(o=et(),r=0;r<5;r+=1)s[r]=(c=t[r][0],u=t[r][1],h=t[r][2],d=t[r][3],l=t[r][4],new Ne(c.Y^u.Y^h.Y^d.Y^l.Y,c.N^u.N^h.N^d.N^l.N));for(r=0;r<5;r+=1)a[r]=De(s[(r+4)%5],Le(s[(r+1)%5],1));for(r=0;r<5;r+=1)for(i=0;i<5;i+=1)t[r][i]=De(t[r][i],a[r]);for(r=0;r<5;r+=1)for(i=0;i<5;i+=1)o[i][(2*r+3*i)%5]=Le(t[r][i],Ze[r][i]);for(r=0;r<5;r+=1)for(i=0;i<5;i+=1)t[r][i]=De(o[r][i],new Ne(~o[(r+1)%5][i].Y&o[(r+2)%5][i].Y,~o[(r+1)%5][i].N&o[(r+2)%5][i].N));t[0][0]=De(t[0][0],Xe[n])}var c,u,h,d,l;return t}function rt(e){let t,n,r=0;const i=[0,0],o=[4294967295&e,e/4294967296&2097151];for(t=6;t>=0;t--)n=o[t>>2]>>>8*t&255,0===n&&0===r||(i[r+1>>2]|=n<<8*(r+1),r+=1);return r=0!==r?r:1,i[0]|=r,{value:r+1>4?i:[i[0]],binLen:8+8*r}}function it(e){return le(rt(e.binLen),e)}function ot(e,t){let n,r=rt(t);r=le(r,e);const i=t>>>2,o=(i-r.value.length%i)%i;for(n=0;n<o;n++)r.value.push(0);return r.value}class st extends me{constructor(e,t,n){let r=6,i=0;super(e,t,n);const o=n||{};if(1!==this.numRounds){if(o.kmacKey||o.hmacKey)throw new Error("Cannot set numRounds with MAC");if("CSHAKE128"===this.s||"CSHAKE256"===this.s)throw new Error("Cannot set numRounds for CSHAKE variants")}switch(this.K=1,this.m=se(this.t,this.i,this.K),this.R=nt,this.g=tt,this.B=et,this.C=et(),this.v=!1,e){case"SHA3-224":this.p=i=1152,this.U=224,this.L=!0,this.T=this.k;break;case"SHA3-256":this.p=i=1088,this.U=256,this.L=!0,this.T=this.k;break;case"SHA3-384":this.p=i=832,this.U=384,this.L=!0,this.T=this.k;break;case"SHA3-512":this.p=i=576,this.U=512,this.L=!0,this.T=this.k;break;case"SHAKE128":r=31,this.p=i=1344,this.U=-1,this.v=!0,this.L=!1,this.T=null;break;case"SHAKE256":r=31,this.p=i=1088,this.U=-1,this.v=!0,this.L=!1,this.T=null;break;case"KMAC128":r=4,this.p=i=1344,this.I(n),this.U=-1,this.v=!0,this.L=!1,this.T=this.X;break;case"KMAC256":r=4,this.p=i=1088,this.I(n),this.U=-1,this.v=!0,this.L=!1,this.T=this.X;break;case"CSHAKE128":this.p=i=1344,r=this._(n),this.U=-1,this.v=!0,this.L=!1,this.T=null;break;case"CSHAKE256":this.p=i=1088,r=this._(n),this.U=-1,this.v=!0,this.L=!1,this.T=null;break;default:throw new Error(de)}this.F=function(e,t,n,o,s){return function(e,t,n,r,i,o,s){let a,c,u=0;const h=[],d=i>>>5,l=t>>>5;for(a=0;a<l&&t>=i;a+=d)r=nt(e.slice(a,a+d),r),t-=i;for(e=e.slice(a),t%=i;e.length<d;)e.push(0);for(a=t>>>3,e[a>>2]^=o<<a%4*8,e[d-1]^=2147483648,r=nt(e,r);32*h.length<s&&(c=r[u%5][u/5|0],h.push(c.N),!(32*h.length>=s));)h.push(c.Y),u+=1,0==64*u%i&&(nt(null,r),u=0);return h}(e,t,0,o,i,r,s)},o.hmacKey&&this.M(fe("hmacKey",o.hmacKey,this.K))}_(e,t){const n=function(e){const t=e||{};return{funcName:fe("funcName",t.funcName,1,{value:[],binLen:0}),customization:fe("Customization",t.customization,1,{value:[],binLen:0})}}(e||{});t&&(n.funcName=t);const r=le(it(n.funcName),it(n.customization));if(0!==n.customization.binLen||0!==n.funcName.binLen){const e=ot(r,this.p>>>3);for(let t=0;t<e.length;t+=this.p>>>5)this.C=this.R(e.slice(t,t+(this.p>>>5)),this.C),this.l+=this.p;return 4}return 31}I(e){const t=function(e){const t=e||{};return{kmacKey:fe("kmacKey",t.kmacKey,1),funcName:{value:[1128353099],binLen:32},customization:fe("Customization",t.customization,1,{value:[],binLen:0})}}(e||{});this._(e,t.funcName);const n=ot(it(t.kmacKey),this.p>>>3);for(let e=0;e<n.length;e+=this.p>>>5)this.C=this.R(n.slice(e,e+(this.p>>>5)),this.C),this.l+=this.p;this.A=!0}X(e){const t=le({value:this.o.slice(),binLen:this.h},function(e){let t,n,r=0;const i=[0,0],o=[4294967295&e,e/4294967296&2097151];for(t=6;t>=0;t--)n=o[t>>2]>>>8*t&255,0===n&&0===r||(i[r>>2]|=n<<8*r,r+=1);return r=0!==r?r:1,i[r>>2]|=r<<8*r,{value:r+1>4?i:[i[0]],binLen:8+8*r}}(e.outputLen));return this.F(t.value,t.binLen,this.l,this.g(this.C),e.outputLen)}}function at(e){return Object(ne.a)(e)||Object(re.a)(e)?new ct(e):Object(X.b)(e,["sharedAccessKeyName","sharedAccessKey"])?new ct({name:e.sharedAccessKeyName,key:e.sharedAccessKey}):new ct({signature:e.sharedAccessSignature})}class ct{constructor(e){this._credential=e}get isSasTokenProvider(){return!0}getToken(e){return Object(ne.a)(this._credential)?function(e,t,n,r){r=encodeURIComponent(r),e=encodeURIComponent(e);const i=r+"\n"+n,o=new class{constructor(e,t,n){if("SHA-1"==e)this.O=new Ae(e,t,n);else if("SHA-224"==e||"SHA-256"==e)this.O=new Me(e,t,n);else if("SHA-384"==e||"SHA-512"==e)this.O=new Ve(e,t,n);else{if("SHA3-224"!=e&&"SHA3-256"!=e&&"SHA3-384"!=e&&"SHA3-512"!=e&&"SHAKE128"!=e&&"SHAKE256"!=e&&"CSHAKE128"!=e&&"CSHAKE256"!=e&&"KMAC128"!=e&&"KMAC256"!=e)throw new Error(de);this.O=new st(e,t,n)}}update(e){this.O.update(e)}getHash(e,t){return this.O.getHash(e,t)}setHMACKey(e,t,n){this.O.setHMACKey(e,t,n)}getHMAC(e,t){return this.O.getHMAC(e,t)}}("SHA-256","TEXT");o.setHMACKey(t,"TEXT"),o.update(i);const s=encodeURIComponent(o.getHMAC("B64"));return{token:`SharedAccessSignature sr=${r}&sig=${s}&se=${n}&skn=${e}`,expiresOnTimestamp:n}}(this._credential.name,this._credential.key,Math.floor(Date.now()/1e3)+3600,e):{token:this._credential.signature,expiresOnTimestamp:0}}}function ut(e){const t=Object(m.f)(e);!function(e,t,n,r){if(!e)throw new Error("Connection string should have an Endpoint key.");if(t){if(n||r)throw new Error("Connection string cannot have both SharedAccessSignature and SharedAccessKey keys.")}else{if(n&&!r)throw new Error("Connection string with SharedAccessKey should have SharedAccessKeyName.");if(!n&&r)throw new Error("Connection string with SharedAccessKeyName should have SharedAccessKey as well.")}}(t.Endpoint,t.SharedAccessSignature,t.SharedAccessKey,t.SharedAccessKeyName);const n={fullyQualifiedNamespace:(t.Endpoint.match(".*://([^/]*)")||[])[1],endpoint:t.Endpoint};return t.EntityPath&&(n.eventHubName=t.EntityPath),t.SharedAccessSignature&&(n.sharedAccessSignature=t.SharedAccessSignature),t.SharedAccessKey&&t.SharedAccessKeyName&&(n.sharedAccessKey=t.SharedAccessKey,n.sharedAccessKeyName=t.SharedAccessKeyName),n}var ht=n(56);const dt={create(e,t){const n=Z.create(e,t);if(!n.entityPath)throw new TypeError(`Either provide "path" or the "connectionString": "${e}", must contain EntityPath="<path-to-the-entity>".`);return dt.createFromConnectionConfig(n)},createFromConnectionConfig:e=>(Z.validate(e,{isEntityPathRequired:!0}),e.getManagementAudience=()=>`${e.endpoint}${e.entityPath}/$management`,e.getManagementAddress=()=>e.entityPath+"/$management",e.getSenderAudience=t=>null!=t?`${e.endpoint}${e.entityPath}/Partitions/${t}`:`${e.endpoint}${e.entityPath}`,e.getSenderAddress=t=>null!=t?`${e.entityPath}/Partitions/${t}`:""+e.entityPath,e.getReceiverAudience=(t,n)=>(n||(n="$default"),`${e.endpoint}${e.entityPath}/ConsumerGroups/${n}/Partitions/`+t),e.getReceiverAddress=(t,n)=>(n||(n="$default"),`${e.entityPath}/ConsumerGroups/${n}/Partitions/${t}`),e),setCustomEndpointAddress(e,t){e.amqpHostname=e.host;const{hostname:n,port:r}=function(e){const t=e.match(/.*:\/\/([^/]*)/);if(!t)throw new TypeError("Invalid endpoint missing host: "+e);const[,n]=t,[r,i]=n.split(":");return{host:n,hostname:r,port:i}}(t);e.host=n,r&&(e.port=parseInt(r,10))},validate:e=>Z.validate(e,{isEntityPathRequired:!0})};function lt(){return"BROWSER-VERSION; Browser "+function(){if("undefined"==typeof self)return"";return self.navigator.appVersion}()}var pt;function ft(e,t,n,r){let i,o,s;if(e=String(e),Object(c.a)(n)){const r=t;let a=e;if(s=Object(ne.a)(n)||Object(re.a)(n)?at(n):n,!r)throw new TypeError('"eventHubName" is missing');a.endsWith("/")||(a+="/"),i=`Endpoint=sb://${a};SharedAccessKeyName=defaultKeyName;SharedAccessKey=defaultKeyValue;EntityPath=${r}`,o=dt.create(i)}else{const a=ut(e);if(!(a.eventHubName||"string"==typeof t&&t))throw new TypeError(`Either provide "eventHubName" or the "connectionString": "${e}", must contain "EntityPath=<your-event-hub-name>".`);if(a.eventHubName&&"string"==typeof t&&t&&a.eventHubName!==t)throw new TypeError(`The entity path "${a.eventHubName}" in connectionString: "${e}" doesn't match with eventHubName: "${t}".`);if(i=e,"string"!=typeof t)o=dt.create(i),r=t;else{const e=t;o=dt.create(i,e),r=n}s=at(ut(i))}return(null==r?void 0:r.customEndpointAddress)&&dt.setCustomEndpointAddress(o,r.customEndpointAddress),Z.validate(o),pt.create(o,s,r)}function mt(e,t,n,r){if(!n.length)return[];const o=function(e,t){const n=new Map;return e.forEach((e,r)=>{if(void 0===e.lastModifiedTimeInMs||null===e.lastModifiedTimeInMs)return;Date.now()-e.lastModifiedTimeInMs<t&&e.ownerId&&n.set(r,e)}),n}(t,r);if(i.b.verbose(`[${e}] Number of active ownership records: ${o.size}.`),0===o.size)return n;const s=new Map;for(const e of o.values()){const t=s.get(e.ownerId)||[];t.push(e),s.set(e.ownerId,t)}s.has(e)||s.set(e,[]),i.b.info(`[${e}] Number of active event processors: ${s.size}.`);const{minPartitionsPerOwner:a,requiredNumberOfOwnersWithExtraPartition:c}=function(e,t){return{minPartitionsPerOwner:Math.floor(t.length/e.size),requiredNumberOfOwnersWithExtraPartition:t.length%e.size}}(s,n);i.b.verbose(`[${e}] Expected minimum number of partitions per event processor: ${a},expected number of event processors with additional partition: ${c}.`);const u=function(e,t){const n={haveRequiredPartitions:0,haveAdditionalPartition:0,haveTooManyPartitions:0};for(const r of t.values()){const t=r.length;t===e?n.haveRequiredPartitions++:t===e+1?n.haveAdditionalPartition++:t>e+1&&n.haveTooManyPartitions++}return n}(a,s);if(function(e,t,{haveAdditionalPartition:n,haveRequiredPartitions:r}){return n===e&&r+n===t}(c,s.size,u))return[];let h=function(e,t,n,{haveAdditionalPartition:r,haveTooManyPartitions:i}){let o=e;return t>0&&r+i<t&&(o=e+1),o-n}(a,c,s.get(e).length,u);if(h<=0)return[];const d=[],l=n.filter(e=>!o.has(e));for(;Math.min(h,l.length);){const e=Math.floor(Math.random()*l.length);d.push(l.splice(e,1)[0]),h--}if(0===h)return d;const p=function(e,t,n,r,i){const o=[],s=[];i.forEach((e,n)=>{n===r||e.length<=t||s.push(e)}),s.sort((e,t)=>e.length>t.length?-1:e.length<t.length?1:0);let a=0,c=s.shift();for(;e>0&&c;){let r=t;a<n&&r++,a++;let i=c.length-r;for(;Math.min(e,i);){const t=Math.floor(Math.random()*c.length);o.push(c.splice(t,1)[0].partitionId),e--,i--}c=s.shift()}return o}(h,a,c,e,s);return d.concat(p)}!function(e){const t=`azsdk-js-azureeventhubs/${k.c.version} (${lt()})`;function n(e){const n=e.userAgent?`${t},${e.userAgent}`:t;if(n.length>s.a.maxUserAgentLength)throw new Error(`The user-agent string cannot be more than ${s.a.maxUserAgentLength} characters in length.The given user-agent string is: ${n} with length: ${n.length}`);return n}e.getUserAgent=n,e.create=function(e,t,r){r||(r={}),e.webSocket=r.webSocketOptions&&r.webSocketOptions.webSocket,e.webSocketEndpointPath="$servicebus/websocket",e.webSocketConstructorOptions=r.webSocketOptions&&r.webSocketOptions.webSocketConstructorOptions;const o={config:e,isEntityPathRequired:!0,connectionProperties:{product:"MSJSClient",userAgent:n(r),version:k.c.version}},s=te.create(o);s.tokenCredential=t,s.wasConnectionCloseCalled=!1,s.senders={},s.receivers={};const a={address:r.managementSessionAddress,audience:r.managementSessionAudience};let c,u;s.managementSession=new ht.a(s,a),Object.assign(s,{isConnectionClosing(){return Boolean(!this.connection.isOpen()&&this.connection.isRemoteOpen())},async readyToOpenLink(){this.isConnectionClosing()&&await this.waitForDisconnectedEvent(),await this.waitForConnectionReset()},waitForDisconnectedEvent(){return new Promise(e=>{i.b.verbose(`[${this.connectionId}] Attempting to reinitialize connection but the connection is in the process of closing. Waiting for the disconnect event before continuing.`),this.connection.once(v.ConnectionEvents.disconnected,e)})},waitForConnectionReset:()=>u||Promise.resolve(),async close(){var e;try{this.connection.isOpen()&&(await Promise.all(Object.keys(s.senders).map(e=>{var t;return null===(t=s.senders[e])||void 0===t?void 0:t.close().catch(()=>{})})),await Promise.all(Object.keys(s.receivers).map(e=>{var t;return null===(t=s.receivers[e])||void 0===t?void 0:t.close().catch(()=>{})})),await this.cbsSession.close(),await(null===(e=this.managementSession)||void 0===e?void 0:e.close()),await this.connection.close(),this.wasConnectionCloseCalled=!0,i.b.info("Closed the amqp connection '%s' on the client.",this.connectionId))}catch(e){const t=e instanceof Error?`${e.name}: ${e.message}`:JSON.stringify(e);throw i.b.warning(`An error occurred while closing the connection "${this.connectionId}":\n${t}`),Object(i.a)(e),e}}});const h=()=>{s.wasConnectionCloseCalled=!1,i.b.verbose("[%s] setting 'wasConnectionCloseCalled' property of connection context to %s.",s.connection.id,s.wasConnectionCloseCalled)},d=async e=>{var t,n;if(!u){u=new Promise(e=>{c=e});try{i.b.verbose("[%s] 'disconnected' event occurred on the amqp connection.",s.connection.id),e.connection&&e.connection.error&&i.b.verbose("[%s] Accompanying error on the context.connection: %O",s.connection.id,e.connection&&e.connection.error),e.error&&i.b.verbose("[%s] Accompanying error on the context: %O",s.connection.id,e.error);const r={wasConnectionCloseCalled:s.wasConnectionCloseCalled,numSenders:Object.keys(s.senders).length,numReceivers:Object.keys(s.receivers).length};i.b.verbose("[%s] Closing all open senders and receivers in the state: %O",s.connection.id,r),s.connection.removeAllSessions(),await(null===(t=s.cbsSession)||void 0===t?void 0:t.close().catch(()=>{})),await(null===(n=s.managementSession)||void 0===n?void 0:n.close().catch(()=>{})),(r.numSenders||r.numReceivers)&&(await Promise.all(Object.keys(s.senders).map(e=>{var t;return null===(t=s.senders[e])||void 0===t?void 0:t.close().catch(()=>{})})),await Promise.all(Object.keys(s.receivers).map(e=>{var t;return null===(t=s.receivers[e])||void 0===t?void 0:t.close().catch(()=>{})})))}catch(e){i.b.verbose(`[${s.connectionId}] An error occurred while closing the connection in 'disconnected'. %O`,e)}try{await async function(e){const t=e.connectionId;try{await function(e){return e.connection.removeListener(v.ConnectionEvents.connectionOpen,h),e.connection.removeListener(v.ConnectionEvents.disconnected,d),e.connection.removeListener(v.ConnectionEvents.protocolError,l),e.connection.removeListener(v.ConnectionEvents.error,p),e.connection.close()}(e)}catch(t){i.b.verbose(`[${e.connectionId}] There was an error closing the connection before reconnecting: %O`,t)}e.refreshConnection(),f(e.connection),i.b.verbose(`The connection "${t}" has been updated to "${e.connectionId}".`)}(s)}catch(e){i.b.verbose(`[${s.connectionId}] An error occurred while refreshing the connection in 'disconnected'. %O`,e)}finally{c(),u=void 0}}},l=async e=>{i.b.verbose("[%s] 'protocol_error' event occurred on the amqp connection.",s.connection.id),e.connection&&e.connection.error&&i.b.verbose("[%s] Accompanying error on the context.connection: %O",s.connection.id,e.connection&&e.connection.error),e.error&&i.b.verbose("[%s] Accompanying error on the context: %O",s.connection.id,e.error)},p=async e=>{i.b.verbose("[%s] 'error' event occurred on the amqp connection.",s.connection.id),e.connection&&e.connection.error&&i.b.verbose("[%s] Accompanying error on the context.connection: %O",s.connection.id,e.connection&&e.connection.error),e.error&&i.b.verbose("[%s] Accompanying error on the context: %O",s.connection.id,e.error)};function f(e){e.on(v.ConnectionEvents.connectionOpen,h),e.on(v.ConnectionEvents.disconnected,d),e.on(v.ConnectionEvents.protocolError,l),e.on(v.ConnectionEvents.error,p)}return f(s.connection),i.b.verbose("[%s] Created connection context successfully.",s.connectionId),s}}(pt||(pt={}));class _t{constructor(e){this._partitionOwnershipExpirationIntervalInMs=e}getPartitionsToCliam(e,t,n){const r=mt(e,t,n,this._partitionOwnershipExpirationIntervalInMs);if(!r.length)return[];return[r[Math.floor(Math.random()*r.length)]]}}class vt{constructor(e){this._partitionOwnershipExpirationIntervalInMs=e}getPartitionsToCliam(e,t,n){return mt(e,t,n,this._partitionOwnershipExpirationIntervalInMs)}}class gt{constructor(){this._partitionOwnershipMap=new Map,this._committedCheckpoints=new Map}async listOwnership(e,t,n){const r=[];for(const e of this._partitionOwnershipMap.values())r.push(Object.assign({},e));return r}async claimOwnership(e){const t=[];for(const n of e)if(!this._partitionOwnershipMap.has(n.partitionId)||this._partitionOwnershipMap.get(n.partitionId).etag===n.etag){const e=new Date,r=Object.assign(Object.assign({},n),{etag:Object(v.generate_uuid)(),lastModifiedTimeInMs:e.getTime()});this._partitionOwnershipMap.set(r.partitionId,r),t.push(r)}return t}async updateCheckpoint(e){Object(A.d)("","updateCheckpoint","sequenceNumber",e.sequenceNumber),Object(A.d)("","updateCheckpoint","offset",e.offset),e=Object.assign({},e);const t=this._partitionOwnershipMap.get(e.partitionId);if(t){t.etag=Object(v.generate_uuid)();const n=`${e.fullyQualifiedNamespace}:${e.eventHubName}:${e.consumerGroup}`;let r=this._committedCheckpoints.get(n);null==r&&(r=new Map,this._committedCheckpoints.set(n,r)),r.set(e.partitionId,e)}}async listCheckpoints(e,t,n){const r=`${e}:${t}:${n}`,i=this._committedCheckpoints.get(r);if(null==i)return[];const o=[];for(const e of i.values())o.push(Object.assign({},e));return o}}class bt{constructor(){this._partitions=new Set}add(e){if("all"===e&&this._partitions.size>0||this._partitions.has(e)||this._partitions.has("all"))throw new Error("Partition already has a subscriber.");this._partitions.add(e)}remove(e){this._partitions.delete(e)}}class yt{getPartitionsToCliam(e,t,n){return n}}const wt={maxBatchSize:1,maxWaitTimeInSeconds:60};class Et{constructor(e,t,n,r,o,s){var a;this._consumerGroup=e,this._partitionGate=new bt,this._id=Object(K.a)(),this._subscriptions=new Set,Object(c.a)(r)?(i.b.info("Creating EventHubConsumerClient with TokenCredential."),St(o)?(this._checkpointStore=o,this._userChoseCheckpointStore=!0,this._clientOptions=s||{}):(this._checkpointStore=new gt,this._userChoseCheckpointStore=!1,this._clientOptions=o||{}),this._context=ft(t,n,r,this._clientOptions)):"string"==typeof n?(i.b.info("Creating EventHubConsumerClient with connection string and event hub name."),St(r)?(this._checkpointStore=r,this._userChoseCheckpointStore=!0,this._clientOptions=o||{}):(this._checkpointStore=new gt,this._userChoseCheckpointStore=!1,this._clientOptions=r||{}),this._context=ft(t,n,this._clientOptions)):(i.b.info("Creating EventHubConsumerClient with connection string."),St(n)?(this._checkpointStore=n,this._userChoseCheckpointStore=!0,this._clientOptions=r||{}):(this._checkpointStore=new gt,this._userChoseCheckpointStore=!1,this._clientOptions=n||{}),this._context=ft(t,this._clientOptions)),this._loadBalancingOptions=Object.assign({strategy:"balanced",updateIntervalInMs:1e4,partitionOwnershipExpirationIntervalInMs:6e4},null===(a=this._clientOptions)||void 0===a?void 0:a.loadBalancingOptions)}get eventHubName(){return this._context.config.entityPath}get fullyQualifiedNamespace(){return this._context.config.host}async close(){const e=Array.from(this._subscriptions);return await Promise.all(e.map(e=>e.close())),this._context.close()}getPartitionIds(e={}){return this._context.managementSession.getEventHubProperties(Object.assign(Object.assign({},e),{retryOptions:this._clientOptions.retryOptions})).then(e=>e.partitionIds)}getPartitionProperties(e,t={}){return this._context.managementSession.getPartitionProperties(e,Object.assign(Object.assign({},t),{retryOptions:this._clientOptions.retryOptions}))}getEventHubProperties(e={}){return this._context.managementSession.getEventHubProperties(Object.assign(Object.assign({},e),{retryOptions:this._clientOptions.retryOptions}))}subscribe(e,t,n){let r,i;if(Ot(e)){const n=t;n&&n.startPosition&&d(n.startPosition),({targetedPartitionId:i,eventProcessor:r}=this.createEventProcessorForAllPartitions(e,n))}else{if(!Ot(t))throw new TypeError("Unhandled subscribe() overload");{const o=n;o&&o.startPosition&&d(o.startPosition),({targetedPartitionId:i,eventProcessor:r}=this.createEventProcessorForSinglePartition(String(e),t,n))}}r.start();const o={get isRunning(){return r.isRunning()},close:()=>(this._partitionGate.remove(i),this._subscriptions.delete(o),r.stop())};return this._subscriptions.add(o),o}_getLoadBalancingStrategy(){var e;if(!this._userChoseCheckpointStore)return new yt;const t=this._loadBalancingOptions.partitionOwnershipExpirationIntervalInMs;return"greedy"===(null===(e=this._loadBalancingOptions)||void 0===e?void 0:e.strategy)?new vt(t):new _t(t)}createEventProcessorForAllPartitions(e,t){this._partitionGate.add("all"),this._userChoseCheckpointStore?i.b.verbose("EventHubConsumerClient subscribing to all partitions, using a checkpoint store."):i.b.verbose("EventHubConsumerClient subscribing to all partitions, no checkpoint store.");const n=this._getLoadBalancingStrategy();return{targetedPartitionId:"all",eventProcessor:this._createEventProcessor(this._context,e,this._checkpointStore,Object.assign(Object.assign(Object.assign({},wt),t),{ownerLevel:Ct(t,this._userChoseCheckpointStore),ownerId:this._id,retryOptions:this._clientOptions.retryOptions,loadBalancingStrategy:n,loopIntervalInMs:this._loadBalancingOptions.updateIntervalInMs}))}}createEventProcessorForSinglePartition(e,t,n){var r;this._partitionGate.add(e);const o=n;this._userChoseCheckpointStore?i.b.verbose(`EventHubConsumerClient subscribing to specific partition (${e}), using a checkpoint store.`):i.b.verbose(`EventHubConsumerClient subscribing to specific partition (${e}), no checkpoint store.`);return{targetedPartitionId:e,eventProcessor:this._createEventProcessor(this._context,t,this._checkpointStore,Object.assign(Object.assign(Object.assign({},wt),n),{processingTarget:e,ownerLevel:Ct(o,this._userChoseCheckpointStore),retryOptions:this._clientOptions.retryOptions,loadBalancingStrategy:new yt,loopIntervalInMs:null!==(r=this._loadBalancingOptions.updateIntervalInMs)&&void 0!==r?r:1e4}))}}_createEventProcessor(e,t,n,r){return new Q(this._consumerGroup,e,t,n,r)}}function St(e){if(!e)return!1;const t=e;return"function"==typeof t.claimOwnership&&"function"==typeof t.listCheckpoints&&"function"==typeof t.listOwnership&&"function"==typeof t.updateCheckpoint}function Ot(e){return"function"==typeof e.processEvents}function Ct(e,t){return e&&e.ownerLevel?e.ownerLevel:t?0:void 0}Et.defaultConsumerGroupName=s.a.defaultConsumerGroup;class It extends U.a{constructor(e,{partitionId:t,enableIdempotentProducer:n,partitionPublishingOptions:r}){super(e,{name:e.config.getSenderAddress(t),partitionId:t}),this.senderLock="sender-"+Object(K.a)(),this.address=e.config.getSenderAddress(t),this.audience=e.config.getSenderAudience(t),this._isIdempotentProducer=n,this._userProvidedPublishingOptions=r,this._onAmqpError=e=>{const t=e.sender&&e.sender.error;i.b.verbose("[%s] 'sender_error' event occurred on the sender '%s' with address '%s'. The associated error is: %O",this._context.connectionId,this.name,this.address,t)},this._onSessionError=e=>{const t=e.session&&e.session.error;i.b.verbose("[%s] 'session_error' event occurred on the session of sender '%s' with address '%s'. The associated error is: %O",this._context.connectionId,this.name,this.address,t)},this._onAmqpClose=async e=>{const t=this._sender||e.sender;i.b.verbose("[%s] 'sender_close' event occurred on the sender '%s' with address '%s'. Value for isItselfClosed on the receiver is: '%s' Value for isConnecting on the session is: '%s'.",this._context.connectionId,this.name,this.address,t?t.isItselfClosed().toString():void 0,this.isConnecting),t&&!this.isConnecting&&await t.close().catch(e=>{i.b.verbose("[%s] Error when closing sender [%s] after 'sender_close' event: %O",this._context.connectionId,this.name,e)})},this._onSessionClose=async e=>{const t=this._sender||e.sender;i.b.verbose("[%s] 'session_close' event occurred on the session of sender '%s' with address '%s'. Value for isSessionItselfClosed on the session is: '%s' Value for isConnecting on the session is: '%s'.",this._context.connectionId,this.name,this.address,t?t.isSessionItselfClosed().toString():void 0,this.isConnecting),t&&!this.isConnecting&&await t.close().catch(e=>{i.b.verbose("[%s] Error when closing sender [%s] after 'session_close' event: %O",this._context.connectionId,this.name,e)})}}async close(){try{if(this._sender){i.b.info("[%s] Closing the Sender for the entity '%s'.",this._context.connectionId,this._context.config.entityPath);const e=this._sender;this._deleteFromCache(),await this._closeLink(e)}}catch(e){const t=`[${this._context.connectionId}] An error occurred while closing sender ${this.name}: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`;throw i.b.warning(t),Object(i.a)(e),e}}isOpen(){const e=Boolean(this._sender&&this._sender.isOpen());return i.b.verbose("[%s] Sender '%s' with address '%s' is open? -> %s",this._context.connectionId,this.name,this.address,e),e}async getMaxMessageSize(e={}){return(await this._getLink(e)).maxMessageSize}async getPartitionPublishingProperties(e={}){var t,n;if(this._localPublishingProperties)return Object.assign({},this._localPublishingProperties);const r={isIdempotentPublishingEnabled:this._isIdempotentProducer,partitionId:null!==(t=this.partitionId)&&void 0!==t?t:""};if(this._isIdempotentProducer){if(this._sender=await this._getLink(e),!this._sender)throw new Error(`Failed to retrieve partition publishing properties for partition "${this.partitionId}".`);const{[k.b.epoch]:t,[k.b.producerId]:i,[k.b.producerSequenceNumber]:o}=null!==(n=this._sender.properties)&&void 0!==n?n:{};r.ownerLevel=parseInt(t,10),r.producerGroupId=parseInt(i,10),r.lastPublishedSequenceNumber=parseInt(o,10)}return this._localPublishingProperties=r,Object.assign({},r)}async send(e,t){try{if(i.b.info("[%s] Sender '%s', trying to send EventData[].",this._context.connectionId,this.name),this._isIdempotentProducer&&this._hasPendingSend)throw new Error('There can only be 1 "sendBatch" call in-flight per partition while "enableIdempotentRetries" is set to true.');const n=R(e)?e.count:e.length;if(0===n)return void i.b.info(`[${this._context.connectionId}] No events were passed to sendBatch.`);if(this._isIdempotentProducer&&(this._hasPendingSend=!0),i.b.info("[%s] Sender '%s', sending encoded batch message.",this._context.connectionId,this.name),await this._trySendBatch(e,t),this._isIdempotentProducer&&(function(e){if(R(e))e._commitPublish();else for(const t of e)t._publishedSequenceNumber=t[k.a],delete t[k.a]}(e),this._localPublishingProperties)){const{lastPublishedSequenceNumber:e=0}=this._localPublishingProperties;this._localPublishingProperties.lastPublishedSequenceNumber=e+n}return}catch(t){throw function(e){if(R(e));else for(const t of e)delete t[k.a]}(e),i.b.warning(`An error occurred while sending the batch message ${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(i.a)(t),t}finally{this._isIdempotentProducer&&(this._hasPendingSend=!1)}}_populateLocalPublishingProperties(e){var t,n;const{[k.b.epoch]:r,[k.b.producerId]:i,[k.b.producerSequenceNumber]:o}=null!==(t=e.properties)&&void 0!==t?t:{};this._localPublishingProperties={isIdempotentPublishingEnabled:this._isIdempotentProducer,partitionId:null!==(n=this.partitionId)&&void 0!==n?n:"",lastPublishedSequenceNumber:o,ownerLevel:r,producerGroupId:i}}_deleteFromCache(){this._sender=void 0,delete this._context.senders[this.name],i.b.verbose("[%s] Deleted the sender '%s' with address '%s' from the client cache.",this._context.connectionId,this.name,this.address)}_createSenderOptions(e){e&&(this.name=""+Object(K.a)());const t={name:this.name,target:{address:this.address},onError:this._onAmqpError,onClose:this._onAmqpClose,onSessionError:this._onSessionError,onSessionClose:this._onSessionClose};if(this._isIdempotentProducer){t.desired_capabilities=k.b.capability;const e=function(e,t){let n,r,i;if(t)n=t.ownerLevel,r=t.producerGroupId,i=t.lastPublishedSequenceNumber;else{if(!e)return{};n=e.ownerLevel,r=e.producerGroupId,i=e.startingSequenceNumber}return{[k.b.epoch]:Object(c.b)(n)?v.types.wrap_short(n):null,[k.b.producerId]:Object(c.b)(r)?v.types.wrap_long(r):null,[k.b.producerSequenceNumber]:Object(c.b)(i)?v.types.wrap_int(i):null}}(this._userProvidedPublishingOptions,this._localPublishingProperties);t.properties=e}return i.b.verbose("Creating sender with options: %O",t),t}async _trySendBatch(e,t={}){const n=t.abortSignal,r=t.retryOptions||{},o=Object(B.a)(r);r.timeoutInMs=o;const s={operation:async()=>{var r,s;const c=Date.now(),u=await this._getLink(t),h=await this.getPartitionPublishingProperties(t),d=Date.now()-c;i.b.verbose("[%s] Sender '%s', credit: %d available: %d",this._context.connectionId,this.name,u.credit,u.session.outgoing.available());let l=1e3;if(!u.sendable()&&o-d>l?(i.b.verbose("%s Sender '%s', waiting for 1 second for sender to become sendable",this._context.connectionId,this.name),await Object(m.b)(l),i.b.verbose("%s Sender '%s' after waiting for a second, credit: %d available: %d",this._context.connectionId,this.name,u.credit,null===(s=null===(r=u.session)||void 0===r?void 0:r.outgoing)||void 0===s?void 0:s.available())):l=0,!u.sendable()){const e=`[${this._context.connectionId}] Sender "${this.name}", cannot send the message right now. Please try later.`;i.b.warning(e);const t={condition:a.b.SenderBusyError,description:e};throw Object(a.e)(t)}if(i.b.verbose("[%s] Sender '%s', sending message with id '%s'.",this._context.connectionId,this.name),o<=d+l){const e=`${this._context.connectionId} Sender "${this.name}" with address "${this.address}", was not able to send the message right now, due to operation timeout.`;i.b.warning(e);const t={condition:a.b.ServiceUnavailableError,description:e};throw Object(a.e)(t)}try{const r=function(e,t,n={}){var r;if(R(e))return e._generateMessage(t);{const i=e.length,o=[],s=null!==(r=n.tracingProperties)&&void 0!==r?r:[];for(let r=0;r<i;r++){const i=e[r],a=s[r],c=N(Object.assign(Object.assign({},i),{properties:Object.assign(Object.assign({},i.properties),a)}),n.partitionKey),{lastPublishedSequenceNumber:u=0}=t,h=u+1+r;$(c,Object.assign(Object.assign({},t),{publishSequenceNumber:h})),t.isIdempotentPublishingEnabled&&(i[k.a]=h),o.push(c)}const a={body:v.message.data_sections(o.map(v.message.encode))};return o[0].message_annotations&&(a.message_annotations=Object.assign({},o[0].message_annotations)),v.message.encode(a)}}(e,h,t),s=await u.send(r,{format:2147563264,timeoutInSeconds:(o-d-l)/1e3,abortSignal:n});i.b.info("[%s] Sender '%s', sent message with delivery id: %d",this._context.connectionId,this.name,s.id)}catch(e){const t=e.innerError||e;throw Object(A.e)(t)}},connectionId:this._context.connectionId,operationType:_.b.sendMessage,abortSignal:n,retryOptions:r};try{await Object(_.c)(s)}catch(e){const t=Object(a.e)(e);throw i.b.warning("[%s] Sender '%s', An error occurred while sending the message %s",this._context.connectionId,this.name,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(i.a)(t),t}}async _getLink(e={}){if(this.isOpen()&&this._sender)return this._sender;const t=e.retryOptions||{},n=Object(B.a)(t);t.timeoutInMs=n;const r=this._createSenderOptions(),o=Date.now(),s={operation:async()=>m.a.acquire(this.senderLock,()=>{const t=Date.now(),i=n-(t-o);return this._init(Object.assign(Object.assign({},r),{abortSignal:e.abortSignal,timeoutInMs:i}))},{abortSignal:e.abortSignal,timeoutInMs:n}),connectionId:this._context.connectionId,operationType:_.b.senderLink,abortSignal:e.abortSignal,retryOptions:t};try{return await Object(_.c)(s)}catch(e){const t=Object(a.e)(e);throw i.b.warning("[%s] An error occurred while creating the sender %s: %s",this._context.connectionId,this.name,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(i.a)(t),t}}async _init(e){try{if(this.isOpen()&&this._sender)return i.b.verbose("[%s] The sender '%s' with address '%s' is open -> %s. Hence not reconnecting.",this._context.connectionId,this.name,this.address,this.isOpen()),this._sender;{await this._context.readyToOpenLink(),await this._negotiateClaim({setTokenRenewal:!1,abortSignal:e.abortSignal,timeoutInMs:e.timeoutInMs}),i.b.verbose("[%s] Trying to create sender '%s'...",this._context.connectionId,this.name);const t=await this._context.connection.createAwaitableSender(e);return t.setMaxListeners(1e3),this._sender=t,this._populateLocalPublishingProperties(this._sender),this.isConnecting=!1,i.b.verbose("[%s] Sender '%s' created with sender options: %O",this._context.connectionId,this.name,e),this._context.senders[this.name]||(this._context.senders[this.name]=this),this._ensureTokenRenewal(),t}}catch(e){const t=Object(a.e)(e);throw i.b.warning("[%s] An error occurred while creating the sender %s: %s",this._context.connectionId,this.name,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(i.a)(t),t}}static create(e,t){const n=new It(e,t);return e.senders[n.name]||(e.senders[n.name]=n),e.senders[n.name]}}class kt{constructor(e,t,n,r){this._context=ft(e,t,n,r),"string"!=typeof t?this._clientOptions=t||{}:Object(c.a)(n)?this._clientOptions=r||{}:this._clientOptions=n||{},this._sendersMap=new Map}get eventHubName(){return this._context.config.entityPath}get fullyQualifiedNamespace(){return this._context.config.host}async createBatch(e={}){var t;Object(A.c)(this._context);const n=Object(c.b)(e.partitionId)?String(e.partitionId):void 0;Object(A.f)({enableIdempotentRetries:this._enableIdempotentRetries,partitionId:n,partitionKey:e.partitionKey});let r=this._sendersMap.get(n||"");if(!r){const e=Object(c.b)(n)?null===(t=this._partitionOptions)||void 0===t?void 0:t[n]:void 0;r=It.create(this._context,{enableIdempotentProducer:Boolean(this._enableIdempotentRetries),partitionId:n,partitionPublishingOptions:e}),this._sendersMap.set(n||"",r)}let o=await r.getMaxMessageSize({retryOptions:this._clientOptions.retryOptions,abortSignal:e.abortSignal});if(e.maxSizeInBytes){if(e.maxSizeInBytes>o){const t=new Error(`Max message size (${e.maxSizeInBytes} bytes) is greater than maximum message size (${o} bytes) on the AMQP sender link.`);throw i.b.warning(`[${this._context.connectionId}] ${t.message}`),Object(i.a)(t),t}o=e.maxSizeInBytes}return new j(this._context,o,Boolean(this._enableIdempotentRetries),e.partitionKey,n)}async getPartitionPublishingProperties(e,t={}){var n;if(!Object(c.b)(e))throw new TypeError('getPartitionPublishingProperties called without required argument "partitionId"');"number"==typeof e&&(e=String(e));let r=this._sendersMap.get(e);return r||(r=It.create(this._context,{enableIdempotentProducer:Boolean(this._enableIdempotentRetries),partitionId:e,partitionPublishingOptions:null===(n=this._partitionOptions)||void 0===n?void 0:n[e]}),this._sendersMap.set(e,r)),r.getPartitionPublishingProperties(t)}async sendBatch(e,t={}){let n,r;Object(A.c)(this._context),Object(A.d)(this._context.connectionId,"sendBatch","batch",e);const i=[];let o=[];if(R(e)){if(this._enableIdempotentRetries&&Object(c.b)(e.startingPublishedSequenceNumber))throw new Error(A.a);const i=function(e,t){const n={},r=e.partitionId,i=e.partitionKey,{partitionId:o,partitionKey:s}=Pt(t);if(s&&i!==s)throw new Error(`The partitionKey (${s}) set on sendBatch does not match the partitionKey (${i}) set when creating the batch.`);if(o&&o!==r)throw new Error(`The partitionId (${o}) set on sendBatch does not match the partitionId (${r}) set when creating the batch.`);Object(c.b)(r)&&(n.partitionId=String(r));Object(c.b)(i)&&(n.partitionKey=String(i));return n}(e,t);n=i.partitionId,r=i.partitionKey,o=e._messageSpanContexts}else{if(Array.isArray(e)||(e=[e]),e.some(e=>Object(c.b)(e._publishedSequenceNumber)))throw new Error(A.b);const o=Pt(t);n=o.partitionId,r=o.partitionKey;for(let n=0;n<e.length;n++)e[n]=x(e[n],t,this._context.config.entityPath,this._context.config.host).event,i[n]=e[n].properties}return Object(A.f)({enableIdempotentRetries:this._enableIdempotentRetries,partitionId:n,partitionKey:r}),P.b.withSpan(`${kt.name}.${this.sendBatch.name}`,t,t=>{var i;let o=this._sendersMap.get(n||"");if(!o){const e=Object(c.b)(n)?null===(i=this._partitionOptions)||void 0===i?void 0:i[n]:void 0;o=It.create(this._context,{enableIdempotentProducer:Boolean(this._enableIdempotentRetries),partitionId:n,partitionPublishingOptions:e}),this._sendersMap.set(n||"",o)}return o.send(e,Object.assign(Object.assign({},t),{partitionId:n,partitionKey:r,retryOptions:this._clientOptions.retryOptions}))},Object.assign({spanLinks:o.map(e=>({tracingContext:e}))},Object(P.a)(this._context.config,"client")))}async close(){await this._context.close();for(const e of this._sendersMap)await e[1].close();this._sendersMap.clear()}getEventHubProperties(e={}){return this._context.managementSession.getEventHubProperties(Object.assign(Object.assign({},e),{retryOptions:this._clientOptions.retryOptions}))}getPartitionIds(e={}){return this._context.managementSession.getEventHubProperties(Object.assign(Object.assign({},e),{retryOptions:this._clientOptions.retryOptions})).then(e=>e.partitionIds)}getPartitionProperties(e,t={}){return this._context.managementSession.getPartitionProperties(e,Object.assign(Object.assign({},t),{retryOptions:this._clientOptions.retryOptions}))}}function Pt(e={}){const t={},{partitionId:n,partitionKey:r}=e;return Object(c.b)(n)&&(t.partitionId=String(n)),Object(c.b)(r)&&(t.partitionKey=String(r)),t}class xt{constructor(){this._resolvers=[],this._items=[]}size(){return this._items.length}shift(){const e=this._items.shift();return void 0!==e?Promise.resolve(e):new Promise(e=>this._resolvers.push(e))}push(e){this._resolveNextItem(e)||this._items.push(e)}_resolveNextItem(e){const t=this._resolvers.shift();return!!t&&(t(e),!0)}}function Tt(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}}class At{constructor({loopAbortSignal:e,maxBufferSize:t,maxWaitTimeInMs:n,onSendEventsErrorHandler:r,onSendEventsSuccessHandler:i,partitionId:o,producer:s}){this._eventQueue=new xt,this._batchedEvents=[],this._bufferCount=0,this._readyQueue=[],this._flushState={isFlushing:!1},this._isRunning=!1,this._lastBatchCreationTime=0,this._loopAbortSignal=e,this._maxBufferSize=t,this._maxWaitTimeInMs=n,this._onSendEventsErrorHandler=r,this._onSendEventsSuccessHandler=i,this._partitionId=o,this._producer=s}getCurrentBufferedCount(){return this._bufferCount}async enqueueEvent(e){await this._ready(),this._eventQueue.push(e),this._bufferCount++,this._isRunning||(this._isRunning=!0,this._startPublishLoop().catch(e=>{i.b.error("The following error occured during batch creation or sending: "+JSON.stringify(e,void 0,"  "))}))}async flush(e={}){const t=this._flushState;if(t.isFlushing)return t.currentPromise;if(0===this.getCurrentBufferedCount())return Promise.resolve();const{promise:n,resolve:r}=Tt();return this._flushState={isFlushing:!0,currentPromise:n,resolve:r},n}_ready(){if(this.getCurrentBufferedCount()<this._maxBufferSize&&!this._readyQueue.length&&!this._flushState.isFlushing)return Promise.resolve();const{promise:e,reject:t,resolve:n}=Tt();return this._readyQueue.push({resolve:n,reject:t}),e}async _startPublishLoop(){let e,t,n=this._eventQueue.shift();for(;!this._loopAbortSignal.aborted;)try{Object(c.b)(e)||(e=await this._createBatch());const r=Date.now()-this._lastBatchCreationTime,i=e.count?Math.max(this._maxWaitTimeInMs-r,0):this._maxWaitTimeInMs,o=null!=t?t:await Promise.race([n,Object(m.b)(i)]);if(!o){e.count&&(await this._producer.sendBatch(e),this._reportSuccess(),e=await this._createBatch());continue}t||(t=o,n=this._eventQueue.shift());const s=e.tryAdd(o);s&&(this._batchedEvents.push(o),t=void 0),(s&&e.count>=this._maxBufferSize||!s&&e.count)&&(await this._producer.sendBatch(e),this._reportSuccess(),e=await this._createBatch()),s||e.tryAdd(o)?s||this._batchedEvents.push(o):this._reportFailure(new Error("Placeholder for max message size exceeded"),o),t=void 0}catch(t){Object(c.c)(t,["name"])&&"AbortError"===t.name||(this._reportFailure(t),e=void 0,this._batchedEvents=[])}}async _createBatch(){this._lastBatchCreationTime=Date.now(),this._batchedEvents=[];const e=await this._producer.createBatch({partitionId:this._partitionId});return this._incrementReadiness(),e}_incrementReadiness(){var e;if(this._flushState.isFlushing)return;const t=this.getCurrentBufferedCount(),n=Math.min(this._maxBufferSize-t,this._readyQueue.length);for(let t=0;t<n;t++)null===(e=this._readyQueue.shift())||void 0===e||e.resolve()}_reportSuccess(){var e;this._bufferCount=this._bufferCount-this._batchedEvents.length,this._updateFlushState();try{null===(e=this._onSendEventsSuccessHandler)||void 0===e||e.call(this,{events:this._batchedEvents,partitionId:this._partitionId})}catch(e){i.b.error("The following error occurred in the onSendEventsSuccessHandler: "+JSON.stringify(e,void 0,"  "))}}_reportFailure(e,t){this._bufferCount=this._bufferCount-(t?1:this._batchedEvents.length),this._updateFlushState();try{this._onSendEventsErrorHandler({error:e,events:t?[t]:this._batchedEvents,partitionId:this._partitionId})}catch(e){i.b.error("The following error occurred in the onSendEventsErrorHandler: "+JSON.stringify(e,void 0,"  "))}}_updateFlushState(){const e=this._flushState;e.isFlushing&&0===this.getCurrentBufferedCount()&&(e.resolve(),this._flushState={isFlushing:!1},this._incrementReadiness())}}var Rt=n(57);class jt{constructor(){this._partitions=[],this._lastRoundRobinPartitionIndex=-1}setPartitionIds(e){this._partitions=e}assignPartition({partitionId:e,partitionKey:t}){if(Object(c.b)(e)&&Object(c.b)(t))throw new Error(`The partitionId (${e}) and partitionKey (${t}) cannot both be specified.`);if(!this._partitions.length)throw new Error("Unable to determine partitionIds, can't assign partitionId.");return Object(c.b)(e)&&this._partitions.includes(e)?e:Object(c.b)(t)?Object(Rt.a)(t,this._partitions.length).toString():this._assignRoundRobinPartition()}_assignRoundRobinPartition(){const e=this._partitions.length-1,t=this._lastRoundRobinPartitionIndex+1,n=t>e?0:t;return this._lastRoundRobinPartitionIndex=n,this._partitions[n]}}class Mt{constructor(e,t,n,i){this._abortController=new r.a,this._isClosed=!1,this._partitionAssigner=new jt,this._partitionIds=[],this._partitionChannels=new Map,this._backgroundManagementInterval=1e4,this._isBackgroundManagementRunning=!1,"string"!=typeof t?(this._producer=new kt(e,t),this._clientOptions=Object.assign({},t)):Object(c.a)(n)?(this._producer=new kt(e,t,n,i),this._clientOptions=Object.assign({},i)):(this._producer=new kt(e,t,n),this._clientOptions=Object.assign({},n)),this._producer._enableIdempotentRetries=this._clientOptions.enableIdempotentRetries}get eventHubName(){return this._producer.eventHubName}get fullyQualifiedNamespace(){return this._producer.fullyQualifiedNamespace}async close(e={}){i.b.verbose("closing buffered producer client..."),Object(c.b)(e.flush)&&!0!==e.flush||await this.flush(e),this._abortController.abort(),await this._producer.close(),this._isClosed=!0}async enqueueEvent(e,t={}){if(this._isClosed)throw new Error("This EventHubBufferedProducerClient has already been closed. Create a new client to enqueue events.");this._partitionIds.length||await this._updatePartitionIds(),this._isBackgroundManagementRunning||(this._startPartitionIdsUpdateLoop().catch(e=>{i.b.error("The following error occured during batch creation or sending: "+JSON.stringify(e,void 0,"  "))}),this._isBackgroundManagementRunning=!0);const n=this._partitionAssigner.assignPartition({partitionId:t.partitionId,partitionKey:t.partitionKey}),r=this._getPartitionChannel(n);return await r.enqueueEvent(e),this._getTotalBufferedEventsCount()}async enqueueEvents(e,t={}){for(const n of e)await this.enqueueEvent(n,t);return this._getTotalBufferedEventsCount()}async flush(e={}){await Promise.all(Array.from(this._partitionChannels.values()).map(t=>t.flush(e)))}getEventHubProperties(e={}){return this._producer.getEventHubProperties(e)}getPartitionIds(e={}){return this._producer.getPartitionIds(e)}getPartitionProperties(e,t={}){return this._producer.getPartitionProperties(e,t)}_getPartitionChannel(e){var t;const n=null!==(t=this._partitionChannels.get(e))&&void 0!==t?t:new At({loopAbortSignal:this._abortController.signal,maxBufferSize:this._clientOptions.maxEventBufferLengthPerPartition||1500,maxWaitTimeInMs:this._clientOptions.maxWaitTimeInMs||1e3,onSendEventsErrorHandler:this._clientOptions.onSendEventsErrorHandler,onSendEventsSuccessHandler:this._clientOptions.onSendEventsSuccessHandler,partitionId:e,producer:this._producer});return this._partitionChannels.set(e,n),n}_getTotalBufferedEventsCount(){let e=0;for(const[t,n]of this._partitionChannels)e+=n.getCurrentBufferedCount();return e}async _updatePartitionIds(){i.b.verbose("Checking for partition Id updates...");const e=await this.getPartitionIds();this._partitionIds.length!==e.length&&(i.b.verbose("Applying partition Id updates"),this._partitionIds=e,this._partitionAssigner.setPartitionIds(this._partitionIds))}async _startPartitionIdsUpdateLoop(){for(i.b.verbose("Starting a background loop to check and apply partition id updates...");!this._abortController.signal.aborted&&!this._isClosed;)await Object(m.b)(this._backgroundManagementInterval),this._isClosed||await this._updatePartitionIds()}}function Nt(e={}){return{produce:({data:t,contentType:n})=>Object.assign(Object.assign({},e),{body:t,contentType:n}),consume:e=>{const{body:t,contentType:n}=e;if(void 0===t)throw new Error("Expected the body field to be defined");if(void 0===n)throw new Error("Expected the contentType field to be defined");return{data:"object"==typeof t?Uint8Array.from(Object.values(t)):t,contentType:n}}}}},,function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(30);function i(e){return Object(r.a)(e,["name","key"])&&"string"==typeof e.key&&"string"==typeof e.name}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(30);function i(e){return Object(r.a)(e,["signature"])&&"string"==typeof e.signature}}]);