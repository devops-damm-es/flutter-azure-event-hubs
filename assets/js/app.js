!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=86)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));var r=n(15),o=n(1);const i=Object(r.a)("event-hubs");function s(e){Object(o.c)(e,["stack"])&&e.stack&&i.verbose(e.stack)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return c}));var r=n(123),o=n(124);function i(e){return null!=e}function s(e,t){if(!i(e)||"object"!=typeof e)return!1;for(const n of t)if(!a(e,n))return!1;return!0}function a(e,t){return"object"==typeof e&&t in e}function c(e){return function(e){const t=e;return t&&"function"==typeof t.getToken&&(void 0===t.signRequest||t.getToken.length>0)}(e)||Object(r.a)(e)||Object(o.a)(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(25);t.types=r.types,t.message=r.message,t.filter=r.filter,t.uuid_to_string=r.uuid_to_string,t.generate_uuid=r.generate_uuid,t.string_to_uuid=r.string_to_uuid,t.ReceiverEvents=r.ReceiverEvents,t.SenderEvents=r.SenderEvents,t.ConnectionEvents=r.ConnectionEvents,t.SessionEvents=r.SessionEvents,t.Typed=r.Typed;var o=n(73);t.EventContext=o.EventContext;var i=n(76);t.Container=i.Container;var s=n(54);t.Connection=s.Connection;var a=n(55);t.Session=a.Session;var c=n(74);t.Receiver=c.Receiver;var u=n(58);t.Sender=u.Sender,t.SenderSendOptions=u.SenderSendOptions;var l=n(75);t.AwaitableSender=l.AwaitableSender;var d=n(43);t.AmqpResponseStatusCode=d.AmqpResponseStatusCode,t.isAmqpError=d.isAmqpError,t.delay=d.delay,t.messageHeader=d.messageHeader,t.messageProperties=d.messageProperties,t.parseConnectionString=d.parseConnectionString;var h=n(44);t.InsufficientCreditError=h.InsufficientCreditError,t.OperationTimeoutError=h.OperationTimeoutError,t.SendOperationFailedError=h.SendOperationFailedError},function(e,t,n){"use strict";(function(e){n.d(t,"d",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return c}));var r=n(15);const o=Object(r.a)("identity");function i(e){return`SUCCESS. Scopes: ${Array.isArray(e)?e.join(", "):e}.`}function s(e,t){let n="ERROR.";return(null==e?void 0:e.length)&&(n+=` Scopes: ${Array.isArray(e)?e.join(", "):e}.`),`${n} Error message: ${"string"==typeof t?t:t.message}.`}function a(e,t,n=o){const r=t?`${t.fullTitle} ${e}`:e;return{title:e,fullTitle:r,info:function(e){n.info(r+" =>",e)}}}function c(e,t=o){const n=a(e,void 0,t);return Object.assign(Object.assign({},n),{getToken:a("=> getToken()",n,t)})}}).call(this,n(16))},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));var r=n(15),o=n(13);const i=Object(r.a)("core-amqp");function s(e){Object(o.b)(e,["stack"])&&i.verbose(e.stack)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));const r={associatedLinkName:"associated-link-name",partitionKey:"x-opt-partition-key",sequenceNumber:"x-opt-sequence-number",enqueueSequenceNumber:"x-opt-enqueue-sequence-number",enqueuedTime:"x-opt-enqueued-time",scheduledEnqueueTime:"x-opt-scheduled-enqueue-time",offset:"x-opt-offset",lockedUntil:"x-opt-locked-until",partitionIdName:"x-opt-partition-id",publisher:"x-opt-publisher-name",viaPartitionKey:"x-opt-via-partition-key",deadLetterSource:"x-opt-deadletter-source",messageState:"x-opt-message-state",enqueuedTimeAnnotation:"amqp.annotation.x-opt-enqueued-time",offsetAnnotation:"amqp.annotation.x-opt-offset",sequenceNumberAnnotation:"amqp.annotation.x-opt-sequence-number",guidSize:16,message:"message",error:"error",statusCode:"status-code",statusDescription:"status-description",errorCondition:"error-condition",management:"$management",partition:"partition",partitionId:"partitionId",readOperation:"READ",TLS:"tls",establishConnection:"establishConnection",defaultConsumerGroup:"$default",eventHub:"eventhub",cbsEndpoint:"$cbs",cbsReplyTo:"cbs",operationPutToken:"put-token",aadEventHubsAudience:"https://eventhubs.azure.net/",aadEventHubsScope:"https://eventhubs.azure.net//.default",aadServiceBusAudience:"https://servicebus.azure.net/",aadServiceBusScope:"https://servicebus.azure.net//.default",maxUserAgentLength:512,vendorString:"com.microsoft",attachEpoch:"com.microsoft:epoch",receiverIdentifierName:"com.microsoft:receiver-name",enableReceiverRuntimeMetricName:"com.microsoft:enable-receiver-runtime-metric",timespan:"com.microsoft:timespan",uri:"com.microsoft:uri",dateTimeOffset:"com.microsoft:datetime-offset",sessionFilterName:"com.microsoft:session-filter",receiverError:"receiver_error",senderError:"sender_error",sessionError:"session_error",connectionError:"connection_error",defaultOperationTimeoutInMs:6e4,defaultConnectionIdleTimeoutInMs:6e4,managementRequestKey:"managementRequest",negotiateCbsKey:"negotiateCbs",negotiateClaim:"negotiateClaim",ensureContainerAndBlob:"ensureContainerAndBlob",defaultPrefetchCount:1e3,reconnectLimit:100,maxMessageIdLength:128,maxPartitionKeyLength:128,maxSessionIdLength:128,pathDelimiter:"/",ruleNameMaximumLength:50,maximumSqlFilterStatementLength:1024,maximumSqlRuleActionStatementLength:1024,maxDeadLetterReasonLength:4096,maxDurationValue:922337203685477,minDurationValue:-922337203685477,maxAbsoluteExpiryTime:new Date("9999-12-31T07:59:59.000Z").getTime(),aadTokenValidityMarginInMs:5e3,connectionReconnectDelay:300,defaultMaxRetries:3,defaultMaxRetriesForConnection:150,defaultDelayBetweenOperationRetriesInMs:3e4,defaultMaxDelayForExponentialRetryInMs:9e4,receiverSettleMode:"receiver-settle-mode",dispositionStatus:"disposition-status",fromSequenceNumber:"from-sequence-number",messageCount:"message-count",lockTokens:"lock-tokens",messageIdMapKey:"message-id",sequenceNumberMapKey:"sequence-number",lockTokenMapKey:"lock-token",sessionIdMapKey:"session-id",sequenceNumbers:"sequence-numbers",deadLetterReason:"deadletter-reason",deadLetterDescription:"deadletter-description",propertiesToModify:"properties-to-modify",deadLetterName:"com.microsoft:dead-letter",trackingId:"com.microsoft:tracking-id",serverTimeout:"com.microsoft:server-timeout",operations:{putToken:"put-token",read:"READ",cancelScheduledMessage:"com.microsoft:cancel-scheduled-message",scheduleMessage:"com.microsoft:schedule-message",renewLock:"com.microsoft:renew-lock",peekMessage:"com.microsoft:peek-message",receiveBySequenceNumber:"com.microsoft:receive-by-sequence-number",updateDisposition:"com.microsoft:update-disposition",renewSessionLock:"com.microsoft:renew-session-lock",setSessionState:"com.microsoft:set-session-state",getSessionState:"com.microsoft:get-session-state",enumerateSessions:"com.microsoft:get-message-sessions",addRule:"com.microsoft:add-rule",removeRule:"com.microsoft:remove-rule",enumerateRules:"com.microsoft:enumerate-rules"},descriptorCodes:{ruleDescriptionList:1335734829060,sqlFilterList:83483426822,correlationFilterList:83483426825,sqlRuleActionList:1335734829062,trueFilterList:83483426823,falseFilterList:83483426824}},o="The operation was aborted."},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i}));const r={name:"@azure/event-hubs",version:"5.8.0"},o={capability:"com.microsoft:idempotent-producer",epoch:"com.microsoft:producer-epoch",producerId:"com.microsoft:producer-id",producerSequenceNumber:"com.microsoft:producer-sequence-number"},i=Symbol.for("@azure/event-hubs.pendingPublishSequenceNumber")},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));const r="$",o="_"},function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return o})),n.d(t,"__assign",(function(){return i})),n.d(t,"__rest",(function(){return s})),n.d(t,"__decorate",(function(){return a})),n.d(t,"__param",(function(){return c})),n.d(t,"__metadata",(function(){return u})),n.d(t,"__awaiter",(function(){return l})),n.d(t,"__generator",(function(){return d})),n.d(t,"__createBinding",(function(){return h})),n.d(t,"__exportStar",(function(){return p})),n.d(t,"__values",(function(){return f})),n.d(t,"__read",(function(){return m})),n.d(t,"__spread",(function(){return g})),n.d(t,"__spreadArrays",(function(){return y})),n.d(t,"__spreadArray",(function(){return v})),n.d(t,"__await",(function(){return b})),n.d(t,"__asyncGenerator",(function(){return _})),n.d(t,"__asyncDelegator",(function(){return w})),n.d(t,"__asyncValues",(function(){return E})),n.d(t,"__makeTemplateObject",(function(){return S})),n.d(t,"__importStar",(function(){return C})),n.d(t,"__importDefault",(function(){return I})),n.d(t,"__classPrivateFieldGet",(function(){return T})),n.d(t,"__classPrivateFieldSet",(function(){return A})),n.d(t,"__classPrivateFieldIn",(function(){return k}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function a(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var h=Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function p(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||h(t,e,n)}function f(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function m(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function g(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(m(arguments[t]));return e}function y(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r}function v(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function b(e){return this instanceof b?(this.v=e,this):new b(e)}function _(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof b?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function w(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,o){t[r]=e[r]?function(t){return(n=!n)?{value:b(e[r](t)),done:"return"===r}:o?o(t):t}:o}}function E(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=f(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}function S(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var O=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function C(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&h(t,e,n);return O(t,e),t}function I(e){return e&&e.__esModule?e:{default:e}}function T(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function A(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n}function k(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}},function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return p})),n.d(t,"f",(function(){return f}));var r,o=n(0),i=n(1),s=n(2),a=n(10);function c(e){if(e&&e.wasConnectionCloseCalled){const t=new Error("The underlying AMQP connection is closed.");throw o.b.warning(`[${e.connectionId}] ${t.name}: ${t.message}`),Object(o.a)(t),t}}function u(e,t,n,r){if(!Object(i.b)(r)){const r=new TypeError(`${t} called without required argument "${n}"`);throw o.b.warning(`[${e}] ${r.name}: ${r.message}`),Object(o.a)(r),r}}!function(e){e["com.microsoft:out-of-order-sequence"]="SequenceOutOfOrderError",e["com.microsoft:producer-epoch-stolen"]="ProducerDisconnectedError"}(r||(r={}));const l=new Set(["ProducerDisconnectedError","SequenceOutOfOrderError"]);function d(e){const t=Object(a.e)(e);if(!Object(a.d)(t)||!Object(s.isAmqpError)(e)||t.code)return t;const n=e.condition;return n?(t.code=r[n],t.code&&(t.retryable=!l.has(t.code)),t):t}const h="These events have already been successfully published. When idempotent publishing is enabled, events that were acknowledged by the Event Hubs service may not be published again.",p="1 or more of these events have already been successfully published. When idempotent publishing is enabled, events that were acknowledged by the Event Hubs service may not be published again.";function f({enableIdempotentRetries:e,partitionId:t,partitionKey:n}){if(e&&(Object(i.b)(n)||!Object(i.b)(t)))throw new Error('The "partitionId" must be supplied and "partitionKey" must not be provided when the EventHubProducerClient has "enableIdempotentRetries" set to true.');if(Object(i.b)(t)&&Object(i.b)(n))throw new Error(`The partitionId (${t}) and partitionKey (${n}) cannot both be specified.`)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"e",(function(){return m}));var r,o,i,s=n(2),a=n(13),c=n(14);!function(e){e[e["com.microsoft:timeout"]=408]="com.microsoft:timeout",e[e["amqp:not-found"]=404]="amqp:not-found",e[e["amqp:not-implemented"]=501]="amqp:not-implemented",e[e["com.microsoft:entity-already-exists"]=409]="com.microsoft:entity-already-exists",e[e["com.microsoft:message-lock-lost"]=410]="com.microsoft:message-lock-lost",e[e["com.microsoft:session-lock-lost"]=410]="com.microsoft:session-lock-lost",e[e["com.microsoft:no-matching-subscription"]=500]="com.microsoft:no-matching-subscription",e[e["amqp:link:message-size-exceeded"]=403]="amqp:link:message-size-exceeded",e[e["com.microsoft:server-busy"]=503]="com.microsoft:server-busy",e[e["com.microsoft:argument-error"]=400]="com.microsoft:argument-error",e[e["com.microsoft:argument-out-of-range"]=400]="com.microsoft:argument-out-of-range",e[e["com.microsoft:store-lock-lost"]=410]="com.microsoft:store-lock-lost",e[e["com.microsoft:session-cannot-be-locked"]=410]="com.microsoft:session-cannot-be-locked",e[e["com.microsoft:partition-not-owned"]=410]="com.microsoft:partition-not-owned",e[e["com.microsoft:entity-disabled"]=400]="com.microsoft:entity-disabled",e[e["com.microsoft:publisher-revoked"]=401]="com.microsoft:publisher-revoked",e[e["amqp:link:stolen"]=410]="amqp:link:stolen",e[e["amqp:not-allowed"]=400]="amqp:not-allowed",e[e["amqp:unauthorized-access"]=401]="amqp:unauthorized-access",e[e["amqp:resource-limit-exceeded"]=403]="amqp:resource-limit-exceeded"}(r||(r={})),function(e){e["com.microsoft:address-already-in-use"]="AddressAlreadyInUseError",e["com.microsoft:store-lock-lost"]="StoreLockLostError",e["com.microsoft:no-matching-subscription"]="NoMatchingSubscriptionError",e["com.microsoft:partition-not-owned"]="PartitionNotOwnedError",e["com.microsoft:publisher-revoked"]="PublisherRevokedError",e["com.microsoft:entity-already-exists"]="MessagingEntityAlreadyExistsError",e["com.microsoft:entity-disabled"]="MessagingEntityDisabledError",e["com.microsoft:message-lock-lost"]="MessageLockLostError",e["com.microsoft:session-lock-lost"]="SessionLockLostError",e["com.microsoft:session-cannot-be-locked"]="SessionCannotBeLockedError",e["amqp:internal-error"]="InternalServerError",e["amqp:not-found"]="ServiceCommunicationError",e["com.microsoft:message-not-found"]="MessageNotFoundError",e["com.microsoft:relay-not-found"]="RelayNotFoundError",e["amqp:not-implemented"]="NotImplementedError",e["amqp:not-allowed"]="InvalidOperationError",e["amqp:resource-limit-exceeded"]="QuotaExceededError",e["amqp:unauthorized-access"]="UnauthorizedError",e["com.microsoft:auth-failed"]="UnauthorizedError",e["com.microsoft:timeout"]="ServiceUnavailableError",e["com.microsoft:message-wait-timeout"]="MessageWaitTimeout",e["com.microsoft:argument-out-of-range"]="ArgumentOutOfRangeError",e["amqp:precondition-failed"]="PreconditionFailedError",e["com.microsoft:precondition-failed"]="PreconditionFailedError",e["amqp:decode-error"]="DecodeError",e["amqp:invalid-field"]="InvalidFieldError",e["amqp:resource-locked"]="ResourceLockedError",e["amqp:resource-deleted"]="ResourceDeletedError",e["amqp:illegal-state"]="IllegalStateError",e["amqp:frame-size-too-small"]="FrameSizeTooSmallError",e["amqp:link:detach-forced"]="DetachForcedError",e["amqp:link:transfer-limit-exceeded"]="TransferLimitExceededError",e["amqp:link:message-size-exceeded"]="MessageTooLargeError",e["amqp:link:redirect"]="LinkRedirectError",e["amqp:link:stolen"]="ReceiverDisconnectedError",e["amqp:session:window-violation"]="SessionWindowViolationError",e["amqp:session:errant-link"]="ErrantLinkError",e["amqp:session:handle-in-use"]="HandleInUseError",e["amqp:session:unattached-handle"]="UnattachedHandleError",e["amqp:connection:forced"]="ConnectionForcedError",e["amqp:connection:framing-error"]="FramingError",e["amqp:connection:redirect"]="ConnectionRedirectError",e["com.microsoft:server-busy"]="ServerBusyError",e["com.microsoft:argument-error"]="ArgumentError",e["com.microsoft:operation-cancelled"]="OperationCancelledError",e["client.sender:not-enough-link-credit"]="SenderBusyError",e["system:error"]="SystemError"}(o||(o={})),function(e){e.AddressAlreadyInUseError="com.microsoft:address-already-in-use",e.StoreLockLostError="com.microsoft:store-lock-lost",e.NoMatchingSubscriptionError="com.microsoft:no-matching-subscription",e.PartitionNotOwnedError="com.microsoft:partition-not-owned",e.PublisherRevokedError="com.microsoft:publisher-revoked",e.MessagingEntityAlreadyExistsError="com.microsoft:entity-already-exists",e.MessagingEntityDisabledError="com.microsoft:entity-disabled",e.MessageLockLostError="com.microsoft:message-lock-lost",e.SessionLockLostError="com.microsoft:session-lock-lost",e.SessionCannotBeLockedError="com.microsoft:session-cannot-be-locked",e.InternalServerError="amqp:internal-error",e.ServiceCommunicationError="amqp:not-found",e.MessageNotFoundError="com.microsoft:message-not-found",e.RelayNotFoundError="com.microsoft:relay-not-found",e.NotImplementedError="amqp:not-implemented",e.InvalidOperationError="amqp:not-allowed",e.QuotaExceededError="amqp:resource-limit-exceeded",e.UnauthorizedError="amqp:unauthorized-access",e.ServiceUnavailableError="com.microsoft:timeout",e.MessageWaitTimeout="com.microsoft:message-wait-timeout",e.ArgumentOutOfRangeError="com.microsoft:argument-out-of-range",e.PreconditionFailedError="amqp:precondition-failed",e.DecodeError="amqp:decode-error",e.InvalidFieldError="amqp:invalid-field",e.ResourceLockedError="amqp:resource-locked",e.ResourceDeletedError="amqp:resource-deleted",e.IllegalStateError="amqp:illegal-state",e.FrameSizeTooSmallError="amqp:frame-size-too-small",e.DetachForcedError="amqp:link:detach-forced",e.TransferLimitExceededError="amqp:link:transfer-limit-exceeded",e.MessageTooLargeError="amqp:link:message-size-exceeded",e.LinkRedirectError="amqp:link:redirect",e.ReceiverDisconnectedError="amqp:link:stolen",e.SessionWindowViolationError="amqp:session:window-violation",e.ErrantLinkError="amqp:session:errant-link",e.HandleInUseError="amqp:session:handle-in-use",e.UnattachedHandleError="amqp:session:unattached-handle",e.ConnectionForcedError="amqp:connection:forced",e.FramingError="amqp:connection:framing-error",e.ConnectionRedirectError="amqp:connection:redirect",e.ServerBusyError="com.microsoft:server-busy",e.ArgumentError="com.microsoft:argument-error",e.OperationCancelledError="com.microsoft:operation-cancelled",e.SenderBusyError="client.sender:not-enough-link-credit",e.SystemError="system:error"}(i||(i={}));const u=["address","code","errno","info","port","stack","syscall"];function l(e){return"MessagingError"===e.name}class d extends Error{constructor(e,t){if(super(e),this.name="MessagingError",this.retryable=!0,t)for(const e of u)null!=t[e]&&(this[e]=t[e])}}const h=["InternalServerError","ServerBusyError","ServiceUnavailableError","OperationCancelledError","UnauthorizedError","OperationTimeoutError","SenderBusyError","MessagingError","DetachForcedError","ConnectionForcedError","TransferLimitExceededError","InsufficientCreditError"];var p;!function(e){e.ENOTFOUND="amqp:not-found",e.EBUSY="com.microsoft:server-busy",e.ECONNREFUSED="amqp:connection:forced",e.ETIMEDOUT="com.microsoft:timeout",e.ECONNRESET="com.microsoft:timeout",e.ENETDOWN="com.microsoft:timeout",e.EHOSTDOWN="com.microsoft:timeout",e.ENETRESET="com.microsoft:timeout",e.ENETUNREACH="com.microsoft:timeout",e.ENONET="com.microsoft:timeout"}(p||(p={}));const f=["OperationTimeoutError","InsufficientCreditError","SendOperationFailedError"];function m(e){if(!Object(a.a)(e))return new Error("Unknown error encountered.");if("object"!=typeof e)return new Error(e);if(e instanceof TypeError||e instanceof RangeError)return e;if(t=e,Object(s.isAmqpError)(t)){const t=e.condition,n=e.description,r=new d(n);return e.stack&&(r.stack=e.stack),r.info=e.info,t&&(r.code=o[t]),n&&(n.includes("status-code: 404")||null!==n.match(/The messaging entity .* could not be found.*/i))&&(r.code="MessagingEntityNotFoundError"),r.code&&-1===h.indexOf(r.code)&&(r.retryable=!1),r}var t;if("MessagingError"===e.name)return e;if(function(e){return!!Object(a.b)(e,["code","syscall","errno"])&&(!(!Object(c.e)(e.code)||!Object(c.e)(e.syscall))&&!(!Object(c.e)(e.errno)&&!Object(c.d)(e.errno)))}(e)){const t=e.code,n=e.message,r=new d(n,e);let i="SystemError";if(t){const e=p[t];i=o[e]}return-1===h.indexOf(i)&&(r.retryable=!1),r}if(function(e){let t=!1;return!c.c&&self&&"error"===e.type&&e.target instanceof self.WebSocket&&(t=!0),t}(e)){const e=new d("Websocket connection failed.");return e.code=o[i.ServiceCommunicationError],e.retryable=!1,e}if(-1!==f.indexOf(e.name)){const t=new d(e.message,e);return t.code=e.name,t.code&&-1===h.indexOf(t.code)&&(t.retryable=!1),t}return e}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));var r=n(120),o=n(6);const i=Object(r.a)({namespace:"Microsoft.EventHub",packageName:o.c.name,packageVersion:o.c.version});function s(e,t){const n={spanAttributes:{"message_bus.destination":e.entityPath,"peer.address":e.host}};return t&&(n.spanKind=t),n}},,function(e,t,n){"use strict";function r(e){return null!=e}function o(e,t){if(!r(e)||"object"!=typeof e)return!1;for(const n of t)if(!i(e,n))return!1;return!0}function i(e,t){return"object"==typeof e&&t in e}function s(e){return o(e,["isSasTokenProvider"])&&!0===e.isSasTokenProvider}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s}))},function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return p}));var r,o=n(45),i=n(80),s=n(5),a=n(13);const c=void 0!==e&&Boolean(e.version)&&Boolean(null===(r=e.versions)||void 0===r?void 0:r.node);function u(e){const t={},n=e.trim().split(";");for(let e of n){if(e=e.trim(),""===e)continue;const n=e.indexOf("=");if(-1===n)throw new Error("Connection string malformed: each part of the connection string must have an `=` assignment.");const r=e.substring(0,n).trim();if(""===r)throw new Error("Connection string malformed: missing key for assignment");const o=e.substring(n+1).trim();t[r]=o}return t}const l=new i.a;function d(e,t,n,r){return new Promise((i,c)=>{let u=void 0,l=void 0;const d=()=>c(new o.b(n||s.b)),h=()=>{t&&l&&t.removeEventListener("abort",l)};if(l=()=>(Object(a.a)(u)&&clearTimeout(u),h(),d()),t&&t.aborted)return d();u=setTimeout(()=>{h(),i(r)},e),t&&t.addEventListener("abort",l)})}function h(e){return"string"==typeof e}function p(e){return"number"==typeof e}}).call(this,n(16))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var r=n(38);const o=new Set,i=void 0!==e&&e.env&&e.env.AZURE_LOG_LEVEL||void 0;let s;const a=Object(r.a)("azure");a.log=(...e)=>{r.a.log(...e)};const c=["verbose","info","warning","error"];i&&(f(i)?function(e){if(e&&!f(e))throw new Error(`Unknown log level '${e}'. Acceptable values: ${c.join(",")}`);s=e;const t=[];for(const e of o)p(e)&&t.push(e.namespace);r.a.enable(t.join(","))}(i):console.error(`AZURE_LOG_LEVEL set to unknown log level '${i}'; logging is not enabled. Acceptable values: ${c.join(", ")}.`));const u={verbose:400,info:300,warning:200,error:100};function l(e){const t=a.extend(e);return d(a,t),{error:h(t,"error"),warning:h(t,"warning"),info:h(t,"info"),verbose:h(t,"verbose")}}function d(e,t){t.log=(...t)=>{e.log(...t)}}function h(e,t){const n=Object.assign(e.extend(t),{level:t});if(d(e,n),p(n)){const e=r.a.disable();r.a.enable(e+","+n.namespace)}return o.add(n),n}function p(e){return!!(s&&u[e.level]<=u[s])}function f(e){return c.includes(e)}}).call(this,n(16))},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&p())}function p(){if(!l){var e=a(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new f(e,t)),1!==u.length||l||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"d",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return a}));class r extends Error{}const o="AuthenticationError";class i extends Error{constructor(e,t){let n={error:"unknown",errorDescription:"An unknown error occurred and no additional details are available."};if(function(e){return e&&"string"==typeof e.error&&"string"==typeof e.error_description}(t))n=c(t);else if("string"==typeof t)try{n=c(JSON.parse(t))}catch(r){n=400===e?{error:"authority_not_found",errorDescription:"The specified authority URL was not found."}:{error:"unknown_error",errorDescription:"An unknown error has occurred. Response body:\n\n"+t}}else n={error:"unknown_error",errorDescription:"An unknown error occurred and no additional details are available."};super(`${n.error}(status code ${e}).\nMore details:\n${n.errorDescription}`),this.statusCode=e,this.errorResponse=n,this.name=o}}const s="AggregateAuthenticationError";class a extends Error{constructor(e,t){super(`${t}\n\n${e.join("\n")}`),this.errors=e,this.name=s}}function c(e){return{error:e.error,errorDescription:e.error_description,correlationId:e.correlation_id,errorCodes:e.error_codes,timestamp:e.timestamp,traceId:e.trace_id}}},,function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(88),o=n(89),i=n(90);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|f(t,n),o=(e=a(e,r)).write(t,n);o!==r&&(e=e.slice(0,o));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):h(e,t);if("Buffer"===t.type&&i(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=a(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|p(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function f(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return D(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(r)return D(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return T(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,o);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,o){var i,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var l=-1;for(i=n;i<a;i++)if(u(e,i)===u(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*s}else-1!==l&&(i-=i-l),l=-1}else for(n+c>a&&(n=a-c),i=n;i>=0;i--){for(var d=!0,h=0;h<c;h++)if(u(e,i+h)!==u(t,h)){d=!1;break}if(d)return i}return-1}function b(e,t,n,r){n=Number(n)||0;var o=e.length-n;r?(r=Number(r))>o&&(r=o):r=o;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function _(e,t,n,r){return $(D(t,e.length-n),e,n,r)}function w(e,t,n,r){return $(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function E(e,t,n,r){return w(e,t,n,r)}function S(e,t,n,r){return $(z(t),e,n,r)}function O(e,t,n,r){return $(function(e,t){for(var n,r,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(t,e.length-n),e,n,r)}function C(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var r=[],o=t;o<n;){var i,s,a,c,u=e[o],l=null,d=u>239?4:u>223?3:u>191?2:1;if(o+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(i=e[o+1]))&&(c=(31&u)<<6|63&i)>127&&(l=c);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&(c=(15&u)<<12|(63&i)<<6|63&s)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),o+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,o),o+=s.length}return r},c.byteLength=f,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,o){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(i,s),u=this.slice(r,o),l=e.slice(t,n),d=0;d<a;++d)if(u[d]!==l[d]){i=u[d],s=l[d];break}return i<s?-1:s<i?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return _(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function T(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function k(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=t;i<n;++i)o+=H(e[i]);return o}function P(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function R(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,n,r,o,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function N(e,t,n,r){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-n,2);o<i;++o)e[n+o]=(t&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function j(e,t,n,r){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-n,4);o<i;++o)e[n+o]=t>>>8*(r?o:3-o)&255}function M(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function q(e,t,n,r,i){return i||M(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function L(e,t,n,r,i){return i||M(e,0,n,8),o.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var o=t-e;n=new c(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=this[e+--t],o=1;t>0&&(o*=256);)r+=this[e+--t]*o;return r},c.prototype.readUInt8=function(e,t){return t||R(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||R(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||R(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=t,o=1,i=this[e+--r];r>0&&(o*=256);)i+=this[e+--r]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||R(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||R(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||R(e,4,this.length),o.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||R(e,4,this.length),o.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||R(e,8,this.length),o.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||R(e,8,this.length),o.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||x(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||x(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):j(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):j(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);x(this,e,t,n,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);x(this,e,t,n,o-1,-o)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):j(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):j(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return q(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return q(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o,i=r-n;if(this===e&&n<t&&t<r)for(o=i-1;o>=0;--o)e[o+t]=this[o+n];else if(i<1e3||!c.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=c.isBuffer(e)?e:D(new c(e,r).toString()),a=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function H(e){return e<16?"0"+e.toString(16):e.toString(16)}function D(e,t){var n;t=t||1/0;for(var r=e.length,o=null,i=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function z(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function $(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}}).call(this,n(67))},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));class r{spanContext(){return{spanId:"",traceId:"",traceFlags:0}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}addEvent(e,t){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}recordException(e,t){}}class o{startSpan(e,t){return new r}getCurrentSpan(){return new r}withSpan(e,t){return t()}bind(e,t){return e}}const i=Symbol.for("@azure/core-tracing.tracerCache4");let s,a;function c(){const e=self;e[i]||(e[i]={tracer:void 0}),s=e[i]}function u(){return s||c(),s}function l(){const e=u();return e.tracer?e.tracer:(a||(a=new o),a)}var d=n(39);const h=(p={packagePrefix:"Azure.Identity",namespace:"Microsoft.AAD"},function(e,t){const n=l(),r=(null==t?void 0:t.tracingOptions)||{},o=Object.assign({kind:d.a.INTERNAL},r.spanOptions),i=p.packagePrefix?`${p.packagePrefix}.${e}`:e,s=n.startSpan(i,o,r.tracingContext);p.namespace&&s.setAttribute("az.namespace",p.namespace);let a=r.spanOptions||{};s.isRecording()&&p.namespace&&(a=Object.assign(Object.assign({},r.spanOptions),{attributes:Object.assign(Object.assign({},o.attributes),{"az.namespace":p.namespace})}));const c=Object.assign(Object.assign({},r),{spanOptions:a,tracingContext:Object(d.d)(r.tracingContext||d.c.active(),s)});return{span:s,updatedOptions:Object.assign(Object.assign({},t),{tracingOptions:c})}});var p},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(5),o=n(1);function i(e){return!Object(o.b)(e)||"number"!=typeof e.timeoutInMs||!isFinite(e.timeoutInMs)||e.timeoutInMs<r.a.defaultOperationTimeoutInMs?r.a.defaultOperationTimeoutInMs:e.timeoutInMs}},function(e,t,n){"use strict";function r(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function o(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return y}));var i=n(7),s=n(37);class a{constructor(e={},t=!1){this.modelMappers=e,this.isXML=t}validateConstraints(e,t,n){const r=(e,r)=>{throw new Error(`"${n}" with value "${t}" should satisfy the constraint "${e}": ${r}.`)};if(e.constraints&&null!=t){const{ExclusiveMaximum:n,ExclusiveMinimum:o,InclusiveMaximum:i,InclusiveMinimum:s,MaxItems:a,MaxLength:c,MinItems:u,MinLength:l,MultipleOf:d,Pattern:h,UniqueItems:p}=e.constraints;if(void 0!==n&&t>=n&&r("ExclusiveMaximum",n),void 0!==o&&t<=o&&r("ExclusiveMinimum",o),void 0!==i&&t>i&&r("InclusiveMaximum",i),void 0!==s&&t<s&&r("InclusiveMinimum",s),void 0!==a&&t.length>a&&r("MaxItems",a),void 0!==c&&t.length>c&&r("MaxLength",c),void 0!==u&&t.length<u&&r("MinItems",u),void 0!==l&&t.length<l&&r("MinLength",l),void 0!==d&&t%d!=0&&r("MultipleOf",d),h){const e="string"==typeof h?new RegExp(h):h;"string"==typeof t&&null!==t.match(e)||r("Pattern",h)}p&&t.some((e,t,n)=>n.indexOf(e)!==t)&&r("UniqueItems",p)}}serialize(e,t,n,o={xml:{}}){var a,c,p;const g={xml:{rootName:null!==(a=o.xml.rootName)&&void 0!==a?a:"",includeRoot:null!==(c=o.xml.includeRoot)&&void 0!==c&&c,xmlCharKey:null!==(p=o.xml.xmlCharKey)&&void 0!==p?p:i.b}};let y={};const v=e.type.name;n||(n=e.serializedName),null!==v.match(/^Sequence$/i)&&(y=[]),e.isConstant&&(t=e.defaultValue);const{required:b,nullable:_}=e;if(b&&_&&void 0===t)throw new Error(n+" cannot be undefined.");if(b&&!_&&null==t)throw new Error(n+" cannot be null or undefined.");if(!b&&!1===_&&null===t)throw new Error(n+" cannot be null.");if(null==t)y=t;else if(this.validateConstraints(e,t,n),null!==v.match(/^any$/i))y=t;else if(null!==v.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i))y=function(e,t,n){if(null!=n)if(null!==e.match(/^Number$/i)){if("number"!=typeof n)throw new Error(`${t} with value ${n} must be of type number.`)}else if(null!==e.match(/^String$/i)){if("string"!=typeof n.valueOf())throw new Error(`${t} with value "${n}" must be of type string.`)}else if(null!==e.match(/^Uuid$/i)){if("string"!=typeof n.valueOf()||!Object(s.c)(n))throw new Error(`${t} with value "${n}" must be of type string and a valid uuid.`)}else if(null!==e.match(/^Boolean$/i)){if("boolean"!=typeof n)throw new Error(`${t} with value ${n} must be of type boolean.`)}else if(null!==e.match(/^Stream$/i)){if(!("string"===typeof n||"function"==typeof n.pipe||n instanceof ArrayBuffer||ArrayBuffer.isView(n)||("function"==typeof Blob||"object"==typeof Blob)&&n instanceof Blob))throw new Error(t+" must be a string, Blob, ArrayBuffer, ArrayBufferView, or NodeJS.ReadableStream.")}return n}(v,n,t);else if(null!==v.match(/^Enum$/i)){y=function(e,t,n){if(!t)throw new Error(`Please provide a set of allowedValues to validate ${e} as an Enum Type.`);if(!t.some(e=>"string"==typeof e.valueOf()?e.toLowerCase()===n.toLowerCase():e===n))throw new Error(`${n} is not a valid value for ${e}. The valid values are: ${JSON.stringify(t)}.`);return n}(n,e.type.allowedValues,t)}else null!==v.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i)?y=function(e,t,n){if(null!=t)if(null!==e.match(/^Date$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in ISO8601 format.");t=t instanceof Date?t.toISOString().substring(0,10):new Date(t).toISOString().substring(0,10)}else if(null!==e.match(/^DateTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in ISO8601 format.");t=t instanceof Date?t.toISOString():new Date(t).toISOString()}else if(null!==e.match(/^DateTimeRfc1123$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in RFC-1123 format.");t=t instanceof Date?t.toUTCString():new Date(t).toUTCString()}else if(null!==e.match(/^UnixTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(n+" must be an instanceof Date or a string in RFC-1123/ISO8601 format for it to be serialized in UnixTime/Epoch format.");t=function(e){if(!e)return;"string"==typeof e.valueOf()&&(e=new Date(e));return Math.floor(e.getTime()/1e3)}(t)}else if(null!==e.match(/^TimeSpan$/i)&&!Object(s.b)(t))throw new Error(`${n} must be a string in ISO 8601 format. Instead was "${t}".`);return t}(v,t,n):null!==v.match(/^ByteArray$/i)?y=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(e+" must be of type Uint8Array.");t=r(t)}return t}(n,t):null!==v.match(/^Base64Url$/i)?y=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(e+" must be of type Uint8Array.");t=function(e){if(!e)return;if(!(e instanceof Uint8Array))throw new Error("Please provide an input of type Uint8Array for converting to Base64Url.");return function(e,t){let n=e.length;for(;n-1>=0&&e[n-1]===t;)--n;return e.substr(0,n)}(r(e),"=").replace(/\+/g,"-").replace(/\//g,"_")}(t)}return t}(n,t):null!==v.match(/^Sequence$/i)?y=function(e,t,n,r,o,s){var a;if(!Array.isArray(n))throw new Error(r+" must be of type Array.");let c=t.type.element;if(!c||"object"!=typeof c)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}.`);"Composite"===c.type.name&&c.type.className&&(c=null!==(a=e.modelMappers[c.type.className])&&void 0!==a?a:c);const u=[];for(let t=0;t<n.length;t++){const a=e.serialize(c,n[t],r,s);if(o&&c.xmlNamespace){const e=c.xmlNamespacePrefix?"xmlns:"+c.xmlNamespacePrefix:"xmlns";"Composite"===c.type.name?(u[t]=Object.assign({},a),u[t][i.a]={[e]:c.xmlNamespace}):(u[t]={},u[t][s.xml.xmlCharKey]=a,u[t][i.a]={[e]:c.xmlNamespace})}else u[t]=a}return u}(this,e,t,n,Boolean(this.isXML),g):null!==v.match(/^Dictionary$/i)?y=function(e,t,n,r,o,s){if("object"!=typeof n)throw new Error(r+" must be of type object.");const a=t.type.value;if(!a||"object"!=typeof a)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}.`);const c={};for(const t of Object.keys(n)){const i=e.serialize(a,n[t],r,s);c[t]=h(a,i,o,s)}if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?"xmlns:"+t.xmlNamespacePrefix:"xmlns",n=c;return n[i.a]={[e]:t.xmlNamespace},n}return c}(this,e,t,n,Boolean(this.isXML),g):null!==v.match(/^Composite$/i)&&(y=function(e,t,n,r,o,s){m(e,t)&&(t=f(e,t,n,"clientName"));if(null!=n){const a={},c=d(e,t,r);for(const l of Object.keys(c)){const d=c[l];if(d.readOnly)continue;let p,f=a;if(e.isXML)p=d.xmlIsWrapped?d.xmlName:d.xmlElementName||d.xmlName;else{const e=u(d.serializedName);p=e.pop();for(const t of e){const e=f[t];null==e&&(void 0!==n[l]&&null!==n[l]||void 0!==d.defaultValue)&&(f[t]={}),f=f[t]}}if(null!=f){if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?"xmlns:"+t.xmlNamespacePrefix:"xmlns";f[i.a]=Object.assign(Object.assign({},f[i.a]),{[e]:t.xmlNamespace})}const a=""!==d.serializedName?r+"."+d.serializedName:r;let c=n[l];const u=m(e,t);u&&u.clientName===l&&null==c&&(c=t.serializedName);const g=e.serialize(d,c,a,s);if(void 0!==g&&null!=p){const e=h(d,g,o,s);o&&d.xmlIsAttribute?(f[i.a]=f[i.a]||{},f[i.a][p]=g):o&&d.xmlIsWrapped?f[p]={[d.xmlElementName]:e}:f[p]=e}}}const p=function(e,t,n){const r=t.type.additionalProperties;if(!r&&t.type.className){const r=l(e,t,n);return null==r?void 0:r.type.additionalProperties}return r}(e,t,r);if(p){const t=Object.keys(c);for(const o in n){t.every(e=>e!==o)&&(a[o]=e.serialize(p,n[o],r+'["'+o+'"]',s))}}return a}return n}(this,e,t,n,Boolean(this.isXML),g));return y}deserialize(e,t,n,r={xml:{}}){var s,a,c;const l={xml:{rootName:null!==(s=r.xml.rootName)&&void 0!==s?s:"",includeRoot:null!==(a=r.xml.includeRoot)&&void 0!==a&&a,xmlCharKey:null!==(c=r.xml.xmlCharKey)&&void 0!==c?c:i.b}};if(null==t)return this.isXML&&"Sequence"===e.type.name&&!e.xmlIsWrapped&&(t=[]),void 0!==e.defaultValue&&(t=e.defaultValue),t;let h;const g=e.type.name;if(n||(n=e.serializedName),null!==g.match(/^Composite$/i))h=function(e,t,n,r,o){var s;m(e,t)&&(t=f(e,t,n,"serializedName"));const a=d(e,t,r);let c={};const l=[];for(const d of Object.keys(a)){const h=a[d],p=u(a[d].serializedName);l.push(p[0]);const{serializedName:f,xmlName:m,xmlElementName:g}=h;let y=r;""!==f&&void 0!==f&&(y=r+"."+f);const v=h.headerCollectionPrefix;if(v){const t={};for(const r of Object.keys(n))r.startsWith(v)&&(t[r.substring(v.length)]=e.deserialize(h.type.value,n[r],y,o)),l.push(r);c[d]=t}else if(e.isXML)if(h.xmlIsAttribute&&n[i.a])c[d]=e.deserialize(h,n[i.a][m],y,o);else{const t=g||m||f;if(h.xmlIsWrapped){const t=n[m],r=null!==(s=null==t?void 0:t[g])&&void 0!==s?s:[];c[d]=e.deserialize(h,r,y,o)}else{const r=n[t];c[d]=e.deserialize(h,r,y,o)}}else{let r,i=n;for(const e of p){if(!i)break;i=i[e]}r=i;const s=t.type.polymorphicDiscriminator;let u;if(s&&d===s.clientName&&null==r&&(r=t.serializedName),Array.isArray(n[d])&&""===a[d].serializedName){r=n[d];const t=e.deserialize(h,r,y,o);for(const[e,n]of Object.entries(c))Object.prototype.hasOwnProperty.call(t,e)||(t[e]=n);c=t}else void 0===r&&void 0===h.defaultValue||(u=e.deserialize(h,r,y,o),c[d]=u)}}const h=t.type.additionalProperties;if(h){const t=e=>{for(const t in a){if(u(a[t].serializedName)[0]===e)return!1}return!0};for(const i in n)t(i)&&(c[i]=e.deserialize(h,n[i],r+'["'+i+'"]',o))}else if(n)for(const e of Object.keys(n))void 0!==c[e]||l.includes(e)||p(e,o)||(c[e]=n[e]);return c}(this,e,t,n,l);else{if(this.isXML){const e=l.xml.xmlCharKey;void 0!==t[i.a]&&void 0!==t[e]&&(t=t[e])}null!==g.match(/^Number$/i)?(h=parseFloat(t),isNaN(h)&&(h=t)):null!==g.match(/^Boolean$/i)?h="true"===t||"false"!==t&&t:null!==g.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i)?h=t:null!==g.match(/^(Date|DateTime|DateTimeRfc1123)$/i)?h=new Date(t):null!==g.match(/^UnixTime$/i)?h=function(e){if(!e)return;return new Date(1e3*e)}(t):null!==g.match(/^ByteArray$/i)?h=o(t):null!==g.match(/^Base64Url$/i)?h=function(e){if(!e)return;if(e&&"string"!=typeof e.valueOf())throw new Error("Please provide an input of type string for converting to Uint8Array");return o(e=e.replace(/-/g,"+").replace(/_/g,"/"))}(t):null!==g.match(/^Sequence$/i)?h=function(e,t,n,r,o){var i;let s=t.type.element;if(!s||"object"!=typeof s)throw new Error('element" metadata for an Array must be defined in the mapper and it must of type "object" in '+r);if(n){Array.isArray(n)||(n=[n]),"Composite"===s.type.name&&s.type.className&&(s=null!==(i=e.modelMappers[s.type.className])&&void 0!==i?i:s);const t=[];for(let i=0;i<n.length;i++)t[i]=e.deserialize(s,n[i],`${r}[${i}]`,o);return t}return n}(this,e,t,n,l):null!==g.match(/^Dictionary$/i)&&(h=function(e,t,n,r,o){const i=t.type.value;if(!i||"object"!=typeof i)throw new Error('"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in '+r);if(n){const t={};for(const s of Object.keys(n))t[s]=e.deserialize(i,n[s],r,o);return t}return n}(this,e,t,n,l))}return e.isConstant&&(h=e.defaultValue),h}}function c(e={},t=!1){return new a(e,t)}function u(e){const t=[];let n="";if(e){const r=e.split(".");for(const e of r)"\\"===e.charAt(e.length-1)?n+=e.substr(0,e.length-1)+".":(n+=e,t.push(n),n="")}return t}function l(e,t,n){const r=t.type.className;if(!r)throw new Error(`Class name for model "${n}" is not provided in the mapper "${JSON.stringify(t,void 0,2)}".`);return e.modelMappers[r]}function d(e,t,n){let r=t.type.modelProperties;if(!r){const o=l(e,t,n);if(!o)throw new Error(`mapper() cannot be null or undefined for model "${t.type.className}".`);if(r=null==o?void 0:o.type.modelProperties,!r)throw new Error(`modelProperties cannot be null or undefined in the mapper "${JSON.stringify(o)}" of type "${t.type.className}" for object "${n}".`)}return r}function h(e,t,n,r){if(!n||!e.xmlNamespace)return t;const o={[e.xmlNamespacePrefix?"xmlns:"+e.xmlNamespacePrefix:"xmlns"]:e.xmlNamespace};if(["Composite"].includes(e.type.name)){if(t[i.a])return t;{const e=Object.assign({},t);return e[i.a]=o,e}}const s={};return s[r.xml.xmlCharKey]=t,s[i.a]=o,s}function p(e,t){return[i.a,t.xml.xmlCharKey].includes(e)}function f(e,t,n,r){const o=m(e,t);if(o){let i=o[r];if(i){"serializedName"===r&&(i=i.replace(/\\/gi,""));const o=n[i];if(null!=o){const n=t.type.uberParent||t.type.className,r=o===n?o:n+"."+o,i=e.modelMappers.discriminators[r];i&&(t=i)}}}return t}function m(e,t){return t.type.polymorphicDiscriminator||g(e,t.type.uberParent)||g(e,t.type.className)}function g(e,t){return t&&e.modelMappers[t]&&e.modelMappers[t].type.polymorphicDiscriminator}const y={Base64Url:"Base64Url",Boolean:"Boolean",ByteArray:"ByteArray",Composite:"Composite",Date:"Date",DateTime:"DateTime",DateTimeRfc1123:"DateTimeRfc1123",Dictionary:"Dictionary",Enum:"Enum",Number:"Number",Object:"Object",Sequence:"Sequence",String:"String",Stream:"Stream",TimeSpan:"TimeSpan",UnixTime:"UnixTime"}},function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s}));const r="04b07795-8ddb-461a-bbee-02f9e1bf7b46",o="common";var i;!function(e){e.AzureChina="https://login.chinacloudapi.cn",e.AzureGermany="https://login.microsoftonline.de",e.AzureGovernment="https://login.microsoftonline.us",e.AzurePublicCloud="https://login.microsoftonline.com"}(i||(i={}));const s=i.AzurePublicCloud},,function(e,t,n){"use strict";(function(t){var r=n(87),o=n(30),i=n(69),s=n(29),a=n(101),c=n(71),u=n(72),l=n(31).EventEmitter,d=function(e){this.options=e?Object.create(e):{},this.options.id||(this.options.id=s.generate_uuid()),this.id=this.options.id,this.sasl_server_mechanisms=i.server_mechanisms()};(d.prototype=Object.create(l.prototype)).constructor=d,d.prototype.dispatch=function(e){return o.events("[%s] Container got event: "+e,this.id),l.prototype.emit.apply(this,arguments),!!this.listeners(e).length},d.prototype.connect=function(e){return new r(e,this).connect()},d.prototype.create_connection=function(e){return new r(e,this)},d.prototype.listen=function(e){var n,o=this;if(void 0===e.transport||"tcp"===e.transport)(n=c.createServer()).on("connection",(function(t){new r(e,o).accept(t)}));else{if("tls"!==e.transport&&"ssl"!==e.transport)throw Error("Unrecognised transport: "+e.transport);(n=u.createServer(e)).on("secureConnection",(function(t){new r(e,o).accept(t)}))}return t.version.match(/v0\.10\.\d+/)?n.listen(e.port,e.host):n.listen(e),n},d.prototype.create_container=function(e){return new d(e)},d.prototype.get_option=function(e,t){return void 0!==this.options[e]?this.options[e]:t},d.prototype.generate_uuid=s.generate_uuid,d.prototype.string_to_uuid=s.string_to_uuid,d.prototype.uuid_to_string=s.uuid_to_string;var h=n(102);d.prototype.websocket_accept=function(e,t){new r(t,this).accept(h.wrap(e))},d.prototype.websocket_connect=h.connect,d.prototype.filter=n(103),d.prototype.types=n(28),d.prototype.message=n(53),d.prototype.sasl=i,d.prototype.ReceiverEvents=a.ReceiverEvents,d.prototype.SenderEvents=a.SenderEvents,d.prototype.SessionEvents=a.SessionEvents,d.prototype.ConnectionEvents=a.ConnectionEvents,e.exports=new d}).call(this,n(16))},function(e,t,n){"use strict";function r(e){return e.toLowerCase()}n.d(t,"a",(function(){return i}));class o{constructor(e){if(this._headersMap=new Map,e)for(const t of Object.keys(e))this.set(t,e[t])}set(e,t){this._headersMap.set(r(e),{name:e,value:String(t)})}get(e){var t;return null===(t=this._headersMap.get(r(e)))||void 0===t?void 0:t.value}has(e){return this._headersMap.has(r(e))}delete(e){this._headersMap.delete(r(e))}toJSON(e={}){const t={};if(e.preserveCase)for(const e of this._headersMap.values())t[e.name]=e.value;else for(const[e,n]of this._headersMap)t[e]=n.value;return t}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return function*(e){for(const t of e.values())yield[t.name,t.value]}(this._headersMap)}}function i(e){return new o(e)}},function(e,t,n){"use strict";var r=n(51);function o(e){Error.call(this),this.message=e,this.name="ProtocolError"}function i(e){o.call(this,e),this.message=e,this.name="TypeError"}function s(e,t,n){Error.call(this,e),this.message=e,this.name="ConnectionError",this.condition=t,this.description=e,Object.defineProperty(this,"connection",{value:n})}r.inherits(o,Error),r.inherits(i,o),r.inherits(s,Error),s.prototype.toJSON=function(){return{type:this.name,code:this.condition,message:this.description}},e.exports={ProtocolError:o,TypeError:i,ConnectionError:s}},function(e,t,n){"use strict";(function(t){var r=n(27),o=n(29);function i(e,t,n,r){this.type=e,this.value=t,n&&(this.array_constructor={typecode:n},r&&(this.array_constructor.descriptor=r))}function s(e,t,n,r){this.name=e,this.typecode=t;var o=t>>>4;switch(o){case 4:this.width=0,this.category=1;break;case 5:this.width=1,this.category=1;break;case 6:this.width=2,this.category=1;break;case 7:this.width=4,this.category=1;break;case 8:this.width=8,this.category=1;break;case 9:this.width=16,this.category=1;break;case 10:this.width=1,this.category=2;break;case 11:this.width=4,this.category=2;break;case 12:this.width=1,this.category=3;break;case 13:this.width=4,this.category=3;break;case 14:this.width=1,this.category=4;break;case 15:this.width=4,this.category=4}n&&(n.read&&(this.read=n.read),n.write&&(this.write=n.write),n.encoding&&(this.encoding=n.encoding));var s=this;this.create=4===o?function(){return new i(s,r)}:14===o||15===o?function(e,t,n){return new i(s,e,t,n)}:function(e){return new i(s,e)}}function a(e){return Number(e).toString(16)}i.prototype.toString=function(){return this.value?this.value.toString():null},i.prototype.toLocaleString=function(){return this.value?this.value.toLocaleString():null},i.prototype.valueOf=function(){return this.value},i.prototype.toJSON=function(){return this.value&&this.value.toJSON?this.value.toJSON():this.value},i.prototype.toRheaTyped=function(){return this},s.prototype.toString=function(){return this.name+"#"+a(this.typecode)};var c={by_code:{}};function u(e,t,n,r){var o=new s(e,t,n,r);o.create.typecode=o.typecode,c.by_code[o.typecode]=o,c[e]=o.create}Object.defineProperty(c,"MAX_UINT",{value:4294967295,writable:!1,configurable:!1}),Object.defineProperty(c,"MAX_USHORT",{value:65535,writable:!1,configurable:!1});function l(e,t,n){if("number"==typeof t||t instanceof Number){var r=Math.abs(t),o=Math.floor(r/4294967296),i=r%4294967296;if(e.writeInt32BE(o,n),e.writeUInt32BE(i,n+4),t<0)for(var s=1,a=0;a<8;a++){var c=n+(7-a),u=(255^e[c])+s;e[c]=255&u,s=u>>8}}else t.copy(e,n)}function d(e,t){var n=e.readInt32BE(t),r=e.readUInt32BE(t+4);return n<2097153&&n>-2097153?4294967296*n+r:e.slice(t,t+8)}function h(e,t){for(var n=0;n<t.length;n++)if(e.type.typecode===t[n].typecode)return!0;return!1}function p(e,t,n){for(var r=0;r<t&&r<e.length;r++)if(e[r]!==(n?255:0))return!1;return!0}function f(e){for(var t={},n=0;n+1<e.length;)t[e[n++]]=e[n++];return t}u("Null",64,void 0,null),u("Boolean",86,{read:function(e,t){return e.readUInt8(t)},write:function(e,t,n){e.writeUInt8(t,n)}}),u("True",65,void 0,!0),u("False",66,void 0,!1),u("Ubyte",80,{read:function(e,t){return e.readUInt8(t)},write:function(e,t,n){e.writeUInt8(t,n)}}),u("Ushort",96,{read:function(e,t){return e.readUInt16BE(t)},write:function(e,t,n){e.writeUInt16BE(t,n)}}),u("Uint",112,{read:function(e,t){return e.readUInt32BE(t)},write:function(e,t,n){e.writeUInt32BE(t,n)}}),u("SmallUint",82,{read:function(e,t){return e.readUInt8(t)},write:function(e,t,n){e.writeUInt8(t,n)}}),u("Uint0",67,void 0,0),u("Ulong",128,{write:function(e,t,n){if("number"==typeof t||t instanceof Number){var r=Math.floor(t/4294967296),o=t%4294967296;e.writeUInt32BE(r,n),e.writeUInt32BE(o,n+4)}else t.copy(e,n)},read:function(e,t){var n=e.readUInt32BE(t),r=e.readUInt32BE(t+4);return n<2097153?4294967296*n+r:e.slice(t,t+8)}}),u("SmallUlong",83,{read:function(e,t){return e.readUInt8(t)},write:function(e,t,n){e.writeUInt8(t,n)}}),u("Ulong0",68,void 0,0),u("Byte",81,{read:function(e,t){return e.readInt8(t)},write:function(e,t,n){e.writeInt8(t,n)}}),u("Short",97,{read:function(e,t){return e.readInt16BE(t)},write:function(e,t,n){e.writeInt16BE(t,n)}}),u("Int",113,{read:function(e,t){return e.readInt32BE(t)},write:function(e,t,n){e.writeInt32BE(t,n)}}),u("SmallInt",84,{read:function(e,t){return e.readInt8(t)},write:function(e,t,n){e.writeInt8(t,n)}}),u("Long",129,{write:l,read:d}),u("SmallLong",85,{read:function(e,t){return e.readInt8(t)},write:function(e,t,n){e.writeInt8(t,n)}}),u("Float",114,{read:function(e,t){return e.readFloatBE(t)},write:function(e,t,n){e.writeFloatBE(t,n)}}),u("Double",130,{read:function(e,t){return e.readDoubleBE(t)},write:function(e,t,n){e.writeDoubleBE(t,n)}}),u("Decimal32",116),u("Decimal64",132),u("Decimal128",148),u("CharUTF32",115,{read:function(e,t){return e.readUInt32BE(t)},write:function(e,t,n){e.writeUInt32BE(t,n)}}),u("Timestamp",131,{write:function(e,t,n){return"object"==typeof t&&null!==t&&"function"==typeof t.getTime&&(t=t.getTime()),l(e,t,n)},read:function(e,t){const n=d(e,t);return new Date(n)}}),u("Uuid",152),u("Vbin8",160),u("Vbin32",176),u("Str8",161,{encoding:"utf8"}),u("Str32",177,{encoding:"utf8"}),u("Sym8",163,{encoding:"ascii"}),u("Sym32",179,{encoding:"ascii"}),u("List0",69,void 0,[]),u("List8",192),u("List32",208),u("Map8",193),u("Map32",209),u("Array8",224),u("Array32",240),c.is_ulong=function(e){return h(e,[c.Ulong,c.Ulong0,c.SmallUlong])},c.is_string=function(e){return h(e,[c.Str8,c.Str32])},c.is_symbol=function(e){return h(e,[c.Sym8,c.Sym32])},c.is_list=function(e){return h(e,[c.List0,c.List8,c.List32])},c.is_map=function(e){return h(e,[c.Map8,c.Map32])},c.wrap_boolean=function(e){return e?c.True():c.False()},c.wrap_ulong=function(e){return t.isBuffer(e)?p(e,8,!1)?c.Ulong0():p(e,7,!1)?c.SmallUlong(e[7]):c.Ulong(e):0===e?c.Ulong0():e>255?c.Ulong(e):c.SmallUlong(e)},c.wrap_uint=function(e){return 0===e?c.Uint0():e>255?c.Uint(e):c.SmallUint(e)},c.wrap_ushort=function(e){return c.Ushort(e)},c.wrap_ubyte=function(e){return c.Ubyte(e)},c.wrap_long=function(e){if(t.isBuffer(e)){var n=0!=(128&e[0]);return p(e,7,n)&&(128&e[7])==(n?128:0)?c.SmallLong(n?-(1+(255^e[7])):e[7]):c.Long(e)}return e>127||e<-128?c.Long(e):c.SmallLong(e)},c.wrap_int=function(e){return e>127||e<-128?c.Int(e):c.SmallInt(e)},c.wrap_short=function(e){return c.Short(e)},c.wrap_byte=function(e){return c.Byte(e)},c.wrap_float=function(e){return c.Float(e)},c.wrap_double=function(e){return c.Double(e)},c.wrap_timestamp=function(e){return c.Timestamp(e)},c.wrap_char=function(e){return c.CharUTF32(e)},c.wrap_uuid=function(e){return c.Uuid(e)},c.wrap_binary=function(e){return e.length>255?c.Vbin32(e):c.Vbin8(e)},c.wrap_string=function(e){return t.byteLength(e)>255?c.Str32(e):c.Str8(e)},c.wrap_symbol=function(e){return t.byteLength(e)>255?c.Sym32(e):c.Sym8(e)},c.wrap_list=function(e){if(0===e.length)return c.List0();var t=e.map(c.wrap);return c.List32(t)},c.wrap_set_as_list=function(e){if(0===e.size)return c.List0();var t=Array.from(e,c.wrap);return c.List32(t)},c.wrap_map=function(e,t){var n=[];for(var r in e)n.push(t?t(r):c.wrap(r)),n.push(c.wrap(e[r]));return c.Map32(n)},c.wrap_map_as_map=function(e){var t=[];for(var[n,r]of e)t.push(c.wrap(n)),t.push(c.wrap(r));return c.Map32(t)},c.wrap_symbolic_map=function(e){return c.wrap_map(e,c.wrap_symbol)},c.wrap_array=function(e,t,n){if(t)return c.Array32(e,t,n);throw console.trace("An array must specify a type for its elements"),new r.TypeError("An array must specify a type for its elements")},c.wrap=function(e){var n=typeof e;return"object"===n&&null!==e&&"function"==typeof e.toRheaTyped?e.toRheaTyped():"string"===n?c.wrap_string(e):"boolean"===n?e?c.True():c.False():"number"===n||e instanceof Number?isNaN(e)?c.Null():Math.floor(e)-e!=0?c.Double(e):e>0?e<4294967296?c.wrap_uint(e):c.wrap_ulong(e):e>-2147483647?c.wrap_int(e):c.wrap_long(e):e instanceof Date?c.wrap_timestamp(e.getTime()):e instanceof t||e instanceof Uint8Array?c.wrap_binary(e):"undefined"===n||null===e?c.Null():Array.isArray(e)?c.wrap_list(e):e instanceof Map?c.wrap_map_as_map(e):e instanceof Set?c.wrap_set_as_list(e):c.wrap_map(e)},c.wrap_described=function(e,t){var n=c.wrap(e);return t&&("string"==typeof t?n=c.described(c.wrap_symbol(t),n):("number"==typeof t||t instanceof Number)&&(n=c.described(c.wrap_ulong(t),n))),n},c.wrap_message_id=function(e){var n=typeof e;if("string"===n)return c.wrap_string(e);if("number"===n||e instanceof Number)return c.wrap_ulong(e);if(t.isBuffer(e))return c.wrap_uuid(e);throw new r.TypeError("invalid message id:"+e)};var m,g,y={};function v(e){var t=c.by_code[e];if(!t)throw new r.TypeError("Unrecognised typecode: "+a(e));return t}function b(e,t){if(null!=t){if(Array.isArray(t)){if(!e.multiple)throw new r.TypeError("Field "+e.name+" does not support multiple values, got "+JSON.stringify(t));var n=function(e){if("symbol"===e)return{typecode:c.Sym8.typecode};throw new r.TypeError("TODO: Array of type "+e+" not yet supported")}(e.type);return c.wrap_array(t,n.typecode,n.descriptor)}if("*"===e.type)return t;var o=c["wrap_"+e.type];if(o)return o(t);throw new r.TypeError("No wrapper for field "+e.name+" of type "+e.type)}if(e.mandatory)throw new r.TypeError("Field "+e.name+" is mandatory");return c.Null()}function _(e,t){return{get:"*"===t.type?function(){return this.value[e]}:function(){return c.unwrap(this.value[e])},set:function(n){this.value[e]=b(t,n)},enumerable:!0,configurable:!1}}c.unwrap_map_simple=function(e){return f(e.value.map((function(e){return c.unwrap(e,!0)})))},c.unwrap=function(e,t){if(e instanceof i){if(e.descriptor){var n=y[e.descriptor.value];if(n)return new n(e.value);if(t)return e}var r=c.unwrap(e.value,!0);return c.is_map(e)?f(r):r}return Array.isArray(e)?e.map((function(e){return c.unwrap(e,!0)})):e},c.described_nc=function(e,t){return e.length?(t.descriptor=e.shift(),c.described(e,t)):(t.descriptor=e,t)},c.described=c.described_nc,c.Reader=function(e){this.buffer=e,this.position=0},c.Reader.prototype.read_typecode=function(){return this.read_uint(1)},c.Reader.prototype.read_uint=function(e){var t=this.position;if(this.position+=e,1===e)return this.buffer.readUInt8(t);if(2===e)return this.buffer.readUInt16BE(t);if(4===e)return this.buffer.readUInt32BE(t);throw new r.TypeError("Unexpected width for uint "+e)},c.Reader.prototype.read_fixed_width=function(e){var t=this.position;return this.position+=e.width,e.read?e.read(this.buffer,t):this.buffer.slice(t,this.position)},c.Reader.prototype.read_variable_width=function(e){var t=this.read_uint(e.width),n=this.read_bytes(t);return e.encoding?n.toString(e.encoding):n},c.Reader.prototype.read=function(){var e=this.read_constructor(),t=this.read_value(v(e.typecode));return e.descriptor?c.described_nc(e.descriptor,t):t},c.Reader.prototype.read_constructor=function(e){var t=this.read_typecode();return 0===t?(void 0===e&&(e=[]),e.push(this.read()),this.read_constructor(e)):void 0===e?{typecode:t}:1===e.length?{typecode:t,descriptor:e[0]}:{typecode:t,descriptor:e[0],descriptors:e}},c.Reader.prototype.read_value=function(e){if(0===e.width)return e.create();if(1===e.category)return e.create(this.read_fixed_width(e));if(2===e.category)return e.create(this.read_variable_width(e));if(3===e.category)return this.read_compound(e);if(4===e.category)return this.read_array(e);throw new r.TypeError("Invalid category for type: "+e)},c.Reader.prototype.read_array_items=function(e,t){for(var n=[];n.length<e;)n.push(this.read_value(t));return n},c.Reader.prototype.read_n=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this.read();return t},c.Reader.prototype.read_size_count=function(e){return{size:this.read_uint(e),count:this.read_uint(e)}},c.Reader.prototype.read_compound=function(e){var t=this.read_size_count(e.width);return e.create(this.read_n(t.count))},c.Reader.prototype.read_array=function(e){var t=this.read_size_count(e.width),n=this.read_constructor();return e.create(this.read_array_items(t.count,v(n.typecode)),n.typecode,n.descriptor)},c.Reader.prototype.toString=function(){var e="buffer@"+this.position;this.position&&(e+=": ");for(var t=this.position;t<this.buffer.length;t++)t>0&&(e+=","),e+="0x"+Number(this.buffer[t]).toString(16);return e},c.Reader.prototype.reset=function(){this.position=0},c.Reader.prototype.skip=function(e){this.position+=e},c.Reader.prototype.read_bytes=function(e){var t=this.position;return this.position+=e,this.buffer.slice(t,this.position)},c.Reader.prototype.remaining=function(){return this.buffer.length-this.position},c.Writer=function(e){this.buffer=e||o.allocate_buffer(1024),this.position=0},c.Writer.prototype.toBuffer=function(){return this.buffer.slice(0,this.position)},c.Writer.prototype.ensure=function(e){if(this.buffer.length<e){var t=o.allocate_buffer((n=2*this.buffer.length)>(r=e)?n:r);this.buffer.copy(t),this.buffer=t}var n,r},c.Writer.prototype.write_typecode=function(e){this.write_uint(e,1)},c.Writer.prototype.write_uint=function(e,t){var n=this.position;if(this.ensure(this.position+t),this.position+=t,1===t)return this.buffer.writeUInt8(e,n);if(2===t)return this.buffer.writeUInt16BE(e,n);if(4===t)return this.buffer.writeUInt32BE(e,n);throw new r.TypeError("Unexpected width for uint "+t)},c.Writer.prototype.write_fixed_width=function(e,t){var n=this.position;if(this.ensure(this.position+e.width),this.position+=e.width,e.write)e.write(this.buffer,t,n);else{if(!t.copy)throw new r.TypeError("Cannot handle write for "+e);t.copy(this.buffer,n)}},c.Writer.prototype.write_variable_width=function(e,n){var r=e.encoding?t.from(n,e.encoding):t.from(n);this.write_uint(r.length,e.width),this.write_bytes(r)},c.Writer.prototype.write_bytes=function(e){var t=this.position;this.ensure(this.position+e.length),this.position+=e.length,e.copy(this.buffer,t)},c.Writer.prototype.write_constructor=function(e,t){t&&(this.write_typecode(0),this.write(t)),this.write_typecode(e)},c.Writer.prototype.write=function(e){if(void 0===e.type){if(!e.described)throw new r.TypeError("Cannot write "+JSON.stringify(e));this.write(e.described())}else this.write_constructor(e.type.typecode,e.descriptor),this.write_value(e.type,e.value,e.array_constructor)},c.Writer.prototype.write_value=function(e,t,n){if(0!==e.width)if(1===e.category)this.write_fixed_width(e,t);else if(2===e.category)this.write_variable_width(e,t);else if(3===e.category)this.write_compound(e,t);else{if(4!==e.category)throw new r.TypeError("Invalid category "+e.category+" for type: "+e);this.write_array(e,t,n)}},c.Writer.prototype.backfill_size=function(e,t){var n=this.position-t;this.position=t,this.write_uint(n-e,e),this.position+=n-e},c.Writer.prototype.write_compound=function(e,t){var n=this.position;this.position+=e.width,this.write_uint(t.length,e.width);for(var r=0;r<t.length;r++)void 0===t[r]||null===t[r]?this.write(c.Null()):this.write(t[r]);this.backfill_size(e.width,n)},c.Writer.prototype.write_array=function(e,t,n){var r=this.position;this.position+=e.width,this.write_uint(t.length,e.width),this.write_constructor(n.typecode,n.descriptor);for(var o=v(n.typecode),i=0;i<t.length;i++)this.write_value(o,t[i]);this.backfill_size(e.width,r)},c.Writer.prototype.toString=function(){var e="buffer@"+this.position;this.position&&(e+=": ");for(var t=0;t<this.position;t++)t>0&&(e+=","),e+=("00"+Number(this.buffer[t]).toString(16)).slice(-2);return e},c.Writer.prototype.skip=function(e){this.ensure(this.position+e),this.position+=e},c.Writer.prototype.clear=function(){this.buffer.fill(0),this.position=0},c.Writer.prototype.remaining=function(){return this.buffer.length-this.position},c.define_composite=function(e){var t=function(e){this.value=e||[]};t.descriptor={numeric:e.code,symbolic:"amqp:"+e.name+":list"},t.prototype.dispatch=function(t,n){t["on_"+e.name](n)};for(var n=0;n<e.fields.length;n++){var r=e.fields[n];Object.defineProperty(t.prototype,r.name,_(n,r))}return t.toString=function(){return e.name+"#"+Number(e.code).toString(16)},t.prototype.toJSON=function(){var e={};for(var t in this)"value"!==t&&this[t]&&(e[t]=this[t]);return e},t.create=function(e){var n=new t;for(var r in e)n[r]=e[r];return n},t.prototype.described=function(){return c.described_nc(c.wrap_ulong(t.descriptor.numeric),c.wrap_list(this.value))},t},m={name:"error",code:29,fields:[{name:"condition",type:"symbol",mandatory:!0},{name:"description",type:"string"},{name:"info",type:"map"}]},g=c.define_composite(m),c["wrap_"+m.name]=function(e){return g.create(e).described()},y[Number(g.descriptor.numeric).toString(10)]=g,y[g.descriptor.symbolic]=g,e.exports=c}).call(this,n(19).Buffer)},function(e,t,n){"use strict";(function(t){var r=n(27),o={allocate_buffer:function(e){return t.alloc?t.alloc(e):new t(e)},generate_uuid:function(){return o.uuid_to_string(o.uuid4())},uuid4:function(){for(var e=o.allocate_buffer(16),t=0;t<e.length;t++)e[t]=255*Math.random()|0;return e[7]&=15,e[7]|=64,e[8]&=63,e[8]|=128,e},uuid_to_string:function(e){if(16===e.length)return[e.slice(0,4),e.slice(4,6),e.slice(6,8),e.slice(8,10),e.slice(10,16)].map((function(e){return e.toString("hex")})).join("-");throw new r.TypeError("Not a UUID, expecting 16 byte buffer")}},i=/^([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})$/;o.string_to_uuid=function(e){var n=i.exec(e.toLowerCase());if(n)return t.from(n.slice(1).join(""),"hex");throw new r.TypeError("Not a valid UUID string: "+e)},o.clone=function(e){for(var t=Object.create(e.prototype||{}),n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var o=n[r];t[o]=e[o]}return t},o.and=function(e,t){return void 0===t?e:function(n){return e(n)&&t(n)}},o.is_sender=function(e){return e.is_sender()},o.is_receiver=function(e){return e.is_receiver()},o.sender_filter=function(e){return o.and(o.is_sender,e)},o.receiver_filter=function(e){return o.and(o.is_receiver,e)},o.is_defined=function(e){return null!=e},e.exports=o}).call(this,n(19).Buffer)},function(e,t,n){"use strict";var r=n(68);r.formatters&&(r.formatters.h=function(e){return e.toString("hex")}),e.exports={config:r("rhea:config"),frames:r("rhea:frames"),raw:r("rhea:raw"),reconnect:r("rhea:reconnect"),events:r("rhea:events"),message:r("rhea:message"),flow:r("rhea:flow"),io:r("rhea:io")}},function(e,t,n){"use strict";var r,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function o(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}y(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&y(e,"error",t,n)}(e,o,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var o,i,s,a;if(u(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=l(e))>0&&s.length>o&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=h.bind(r);return o.listener=n,r.wrapFn=o,o}function f(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):g(o,o.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(i){r.once&&e.removeEventListener(t,o),n(i)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var u=c.length,l=g(c,u);for(n=0;n<u;++n)i(l[n],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,o,i,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},a.prototype.listenerCount=m,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(68);t.container=r("rhea-promise:container"),t.connection=r("rhea-promise:connection"),t.session=r("rhea-promise:session"),t.sender=r("rhea-promise:sender"),t.receiver=r("rhea-promise:receiver"),t.error=r("rhea-promise:error"),t.eventHandler=r("rhea-promise:eventhandler"),t.contextTranslator=r("rhea-promise:translate")},function(e,t,n){"use strict";var r=n(105),o=n(115),i=n(61);e.exports={formats:i,parse:o,stringify:r}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}));var r=n(45);function o(e,t,n){return new Promise((o,i)=>{let s=void 0,a=void 0;const c=()=>i(new r.b((null==n?void 0:n.abortErrorMsg)?null==n?void 0:n.abortErrorMsg:"The operation was aborted.")),u=()=>{(null==n?void 0:n.abortSignal)&&a&&n.abortSignal.removeEventListener("abort",a)};if(a=()=>(s&&clearTimeout(s),u(),c()),(null==n?void 0:n.abortSignal)&&n.abortSignal.aborted)return c();s=setTimeout(()=>{u(),o(t)},e),(null==n?void 0:n.abortSignal)&&n.abortSignal.addEventListener("abort",a)})}function i(e,t){const n=e.headers.get(t);if(!n)return;const r=Number(n);return Number.isNaN(r)?void 0:r}},function(e,t,n){"use strict";function r(e){return"adfs"===e?"oauth2/token":"oauth2/v2.0/token"}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r,o=n(14),i=n(13);!function(e){e.CbsTokenTypeJwt="jwt",e.CbsTokenTypeSas="servicebus.windows.net:sastoken"}(r||(r={}));var s=n(5),a=n(21),c=n(0),u=n(49);class l{constructor(e,t){this.isConnecting=!1,t||(t={}),this._context=e,this.address=t.address||"",this.audience=t.audience||"",this.name=`${t.name}-${Object(u.a)()}`,this.partitionId=t.partitionId}async _negotiateClaim({abortSignal:e,setTokenRenewal:t,timeoutInMs:n}){c.b.verbose("[%s] Acquiring cbs lock: '%s' for creating the cbs session while creating the %s: '%s' with address: '%s'.",this._context.connectionId,this._context.cbsSession.cbsLock,this._type,this.name,this.address);const a=Date.now();let u,l;if(this._context.cbsSession.isOpen()||await o.a.acquire(this._context.cbsSession.cbsLock,()=>this._context.cbsSession.init({abortSignal:e,timeoutInMs:n-(Date.now()-a)}),{abortSignal:e,timeoutInMs:n}),Object(i.c)(this._context.tokenCredential))u=this._context.tokenCredential.getToken(this.audience),l=r.CbsTokenTypeSas,this._tokenTimeoutInMs=27e5;else{const e=await this._context.tokenCredential.getToken(s.a.aadEventHubsScope);if(!e)throw new Error('Failed to get token from the provided "TokenCredential" object');u=e,l=r.CbsTokenTypeJwt,this._tokenTimeoutInMs=u.expiresOnTimestamp-Date.now()-12e4}c.b.verbose("[%s] %s: calling negotiateClaim for audience '%s'.",this._context.connectionId,this._type,this.audience),c.b.verbose("[%s] Acquiring cbs lock: '%s' for cbs auth for %s: '%s' with address '%s'.",this._context.connectionId,this._context.negotiateClaimLock,this._type,this.name,this.address),await o.a.acquire(this._context.negotiateClaimLock,()=>this._context.cbsSession.negotiateClaim(this.audience,u.token,l,{abortSignal:e,timeoutInMs:n-(Date.now()-a)}),{abortSignal:e,timeoutInMs:n-(Date.now()-a)}),c.b.verbose("[%s] Negotiated claim for %s '%s' with with address: %s",this._context.connectionId,this._type,this.name,this.address),t&&await this._ensureTokenRenewal()}_ensureTokenRenewal(){this._tokenTimeoutInMs&&(this._tokenRenewalTimer&&clearTimeout(this._tokenRenewalTimer),this._tokenRenewalTimer=setTimeout(async()=>{try{await this._negotiateClaim({setTokenRenewal:!0,abortSignal:void 0,timeoutInMs:Object(a.a)(void 0)})}catch(e){c.b.verbose("[%s] %s '%s' with address %s, an error occurred while renewing the token: %O",this._context.connectionId,this._type,this.name,this.address,e)}},this._tokenTimeoutInMs),c.b.verbose("[%s] %s '%s' with address %s, has next token renewal in %d milliseconds @(%s).",this._context.connectionId,this._type,this.name,this.address,this._tokenTimeoutInMs,new Date(Date.now()+this._tokenTimeoutInMs).toString()))}async _closeLink(e){if(clearTimeout(this._tokenRenewalTimer),e)try{await e.close(),c.b.verbose("[%s] %s '%s' with address '%s' closed.",this._context.connectionId,this._type,this.name,this.address)}catch(e){c.b.verbose("[%s] An error occurred while closing the %s '%s' with address '%s': %O",this._context.connectionId,this._type,this.name,this.address,e)}}get _type(){let e="LinkEntity";return this.constructor&&this.constructor.name&&(e=this.constructor.name),e}}},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return a}));const r=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function o(e){return r.test(e)}const i=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i;function s(e){return i.test(e)}function a(e,t){var n,r;const o=e.parsedHeaders;if("HEAD"===e.request.method)return Object.assign(Object.assign({},o),{body:e.parsedBody});const i=t&&t.bodyMapper,s=Boolean(null==i?void 0:i.nullable),a=null==i?void 0:i.type.name;if("Stream"===a)return Object.assign(Object.assign({},o),{blobBody:e.blobBody,readableStreamBody:e.readableStreamBody});const c="Composite"===a&&i.type.modelProperties||{},u=Object.keys(c).some(e=>""===c[e].serializedName);if("Sequence"===a||u){const t=null!==(n=e.parsedBody)&&void 0!==n?n:[];for(const n of Object.keys(c))c[n].serializedName&&(t[n]=null===(r=e.parsedBody)||void 0===r?void 0:r[n]);if(o)for(const e of Object.keys(o))t[e]=o[e];return!s||e.parsedBody||o||0!==Object.getOwnPropertyNames(c).length?t:null}return function(e){const t=Object.assign(Object.assign({},e.headers),e.body);return e.hasNullableType&&0===Object.getOwnPropertyNames(t).length?e.shouldWrapBody?{body:null}:null:e.shouldWrapBody?Object.assign(Object.assign({},e.headers),{body:e.body}):t}({body:e.parsedBody,headers:o,hasNullableType:s,shouldWrapBody:(l=e.parsedBody,d=a,"Composite"!==d&&"Dictionary"!==d&&("string"==typeof l||"number"==typeof l||"boolean"==typeof l||null!==(null==d?void 0:d.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i))||null==l))});var l,d}},function(e,t,n){"use strict";(function(e){var r=n(79);const o=void 0!==e&&e.env&&e.env.DEBUG||void 0;let i,s=[],a=[];const c=[];o&&l(o);const u=Object.assign(e=>h(e),{enable:l,enabled:d,disable:function(){const e=i||"";return l(""),e},log:r.a});function l(e){i=e,s=[],a=[];const t=/\*/g,n=e.split(",").map(e=>e.trim().replace(t,".*?"));for(const e of n)e.startsWith("-")?a.push(new RegExp(`^${e.substr(1)}$`)):s.push(new RegExp(`^${e}$`));for(const e of c)e.enabled=d(e.namespace)}function d(e){if(e.endsWith("*"))return!0;for(const t of a)if(t.test(e))return!1;for(const t of s)if(t.test(e))return!0;return!1}function h(e){const t=Object.assign((function(...n){if(!t.enabled)return;n.length>0&&(n[0]=`${e} ${n[0]}`);t.log(...n)}),{enabled:d(e),destroy:p,log:u.log,namespace:e,extend:f});return c.push(t),t}function p(){const e=c.indexOf(this);return e>=0&&(c.splice(e,1),!0)}function f(e){const t=h(`${this.namespace}:${e}`);return t.log=this.log,t}t.a=u}).call(this,n(16))},function(e,t,n){"use strict";n.d(t,"a",(function(){return oe})),n.d(t,"d",(function(){return ue})),n.d(t,"c",(function(){return le})),n.d(t,"b",(function(){return de}));var r=n(77),o=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var i=function(e){var t=new Set([e]),n=new Set,r=e.match(o);if(!r)return function(){return!1};var i=+r[1],s=+r[2],a=+r[3];if(null!=r[4])return function(t){return t===e};function c(e){return n.add(e),!1}function u(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(o);if(!r)return c(e);var l=+r[1],d=+r[2],h=+r[3];return null!=r[4]||i!==l?c(e):0===i?s===d&&a<=h?u(e):c(e):s<=d?u(e):c(e)}}("1.1.0"),s="1.1.0".split(".")[0],a=Symbol.for("opentelemetry.js.api."+s),c=r.a;function u(e,t,n,r){var o;void 0===r&&(r=!1);var i=c[a]=null!==(o=c[a])&&void 0!==o?o:{version:"1.1.0"};if(!r&&i[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(s.stack||s.message),!1}if("1.1.0"!==i.version){s=new Error("@opentelemetry/api: All API registration versions must match");return n.error(s.stack||s.message),!1}return i[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v1.1.0."),!0}function l(e){var t,n,r=null===(t=c[a])||void 0===t?void 0:t.version;if(r&&i(r))return null===(n=c[a])||void 0===n?void 0:n[e]}function d(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v1.1.0.");var n=c[a];n&&delete n[e]}var h,p=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f("verbose",this._namespace,e)},e}();function f(e,t,n){var r=l("diag");if(r)return n.unshift(t),r[e].apply(r,n)}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(h||(h={}));var m=function(){function e(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=l("diag");if(r)return r[e].apply(r,t)}}var t=this;t.setLogger=function(e,n){var r,o;if(void 0===n&&(n=h.INFO),e===t){var i=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=i.stack)&&void 0!==r?r:i.message),!1}var s=l("diag"),a=function(e,t){function n(n,r){var o=t[n];return"function"==typeof o&&e>=r?o.bind(t):function(){}}return e<h.NONE?e=h.NONE:e>h.ALL&&(e=h.ALL),t=t||{},{error:n("error",h.ERROR),warn:n("warn",h.WARN),info:n("info",h.INFO),debug:n("debug",h.DEBUG),verbose:n("verbose",h.VERBOSE)}}(n,e);if(s){var c=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";s.warn("Current logger will be overwritten from "+c),a.warn("Current logger will overwrite one already registered from "+c)}return u("diag",a,t,!0)},t.disable=function(){d("diag",t)},t.createComponentLogger=function(e){return new p(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),g=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){return[e[0],e[1]]}))},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=new e(this._entries),o=0,i=t;o<i.length;o++){var s=i[o];r._entries.delete(s)}return r},e.prototype.clear=function(){return new e},e}();Symbol("BaggageEntryMetadata"),m.instance();function y(e){return void 0===e&&(e={}),new g(new Map(Object.entries(e)))}var v={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},b={set:function(e,t,n){null!=e&&(e[t]=n)}};function _(e){return Symbol.for(e)}var w,E=new function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var o=new e(n._currentContext);return o._currentContext.set(t,r),o},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},S=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},O=function(){function e(){}return e.prototype.active=function(){return E},e.prototype.with=function(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];return t.call.apply(t,S([n],r))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),C=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},I=new O,T=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return u("context",e,m.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];return(r=this._getContextManager()).with.apply(r,C([e,t,n],o))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return l("context")||I},e.prototype.disable=function(){this._getContextManager().disable(),d("context",m.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(w||(w={}));var A={traceId:"00000000000000000000000000000000",spanId:"0000000000000000",traceFlags:w.NONE},k=function(){function e(e){void 0===e&&(e=A),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),P=_("OpenTelemetry Context Key SPAN");function R(e){return e.getValue(P)||void 0}function x(e,t){return e.setValue(P,t)}function N(e){return e.deleteValue(P)}function j(e,t){return x(e,new k(t))}function M(e){var t;return null===(t=R(e))||void 0===t?void 0:t.spanContext()}var q=/^([0-9a-f]{32})$/i,L=/^[0-9a-f]{16}$/i;function U(e){return n=e.traceId,q.test(n)&&"00000000000000000000000000000000"!==n&&(t=e.spanId,L.test(t)&&"0000000000000000"!==t);var t,n}function H(e){return new k(e)}var D=T.getInstance(),z=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(Boolean(null==t?void 0:t.root))return new k;var r,o=n&&M(n);return"object"==typeof(r=o)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&U(o)?new k(o):new k},e.prototype.startActiveSpan=function(e,t,n,r){var o,i,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(o=t,s=n):(o=t,i=n,s=r);var a=null!=i?i:D.active(),c=this.startSpan(e,o,a),u=x(a,c);return D.with(u,s,void 0,c)}},e}();var $,B,F,K=new z,G=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):K},e}(),Y=new(function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new z},e}()),W=function(){function e(){}return e.prototype.getTracer=function(e,t,n){var r;return null!==(r=this.getDelegateTracer(e,t,n))&&void 0!==r?r:new G(this,e,t,n)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:Y},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,n)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}($||($={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(B||(B={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(F||(F={}));var V=new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$"),Q=/^[ -~]{0,255}[!-~]$/,J=/,|=/;!function(){function e(e){this._internalState=new Map,e&&this._parse(e)}e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+"="+e.get(n)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,t.length);(function(e){return V.test(e)})(o)&&function(e){return Q.test(e)&&!J.test(e)}(i)&&e.set(o,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t}}();var X=function(){function e(){this._proxyTracerProvider=new W,this.wrapSpanContext=H,this.isSpanContextValid=U,this.deleteSpan=N,this.getSpan=R,this.getSpanContext=M,this.setSpan=x,this.setSpanContext=j}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=u("trace",this._proxyTracerProvider,m.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return l("trace")||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){d("trace",m.instance()),this._proxyTracerProvider=new W},e}(),Z=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),ee=_("OpenTelemetry Baggage Key");function te(e){return e.getValue(ee)||void 0}function ne(e,t){return e.setValue(ee,t)}function re(e){return e.deleteValue(ee)}var oe,ie=new Z,se=function(){function e(){this.createBaggage=y,this.getBaggage=te,this.setBaggage=ne,this.deleteBaggage=re}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return u("propagation",e,m.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=b),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=v),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){d("propagation",m.instance())},e.prototype._getGlobalPropagator=function(){return l("propagation")||ie},e}(),ae=T.getInstance(),ce=X.getInstance();se.getInstance(),m.instance();function ue(e,t){return ce.setSpan(e,t)}!function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(oe||(oe={}));const le=ae;var de;!function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(de||(de={}))},,,function(e,t,n){"use strict";var r=n(28),o=n(27),i={},s={};function a(e,t){var n=r.define_composite(t);i[t.name]=n.create,s[Number(n.descriptor.numeric).toString(10)]=n,s[n.descriptor.symbolic]=n}i.read_header=function(e){var t=4,n={};if("AMQP"!==e.toString("ascii",0,t))throw new o.ProtocolError("Invalid protocol header for AMQP: "+e.toString("hex",0,t));if(n.protocol_id=e.readUInt8(t++),n.major=e.readUInt8(t++),n.minor=e.readUInt8(t++),n.revision=e.readUInt8(t++),0===n.protocol_id&&0===n.major&&9===n.minor&&1===n.revision)throw new o.ProtocolError("Unsupported AMQP version: 0-9-1");if(1===n.protocol_id&&1===n.major&&0===n.minor&&10===n.revision)throw new o.ProtocolError("Unsupported AMQP version: 0-10");if(1!==n.major||0!==n.minor)throw new o.ProtocolError("Unsupported AMQP version: "+JSON.stringify(n));return n},i.write_header=function(e,t){var n=4;return e.write("AMQP",0,n,"ascii"),e.writeUInt8(t.protocol_id,n++),e.writeUInt8(t.major,n++),e.writeUInt8(t.minor,n++),e.writeUInt8(t.revision,n++),8},i.TYPE_AMQP=0,i.TYPE_SASL=1,i.read_frame=function(e){var t=new r.Reader(e),n={};if(n.size=t.read_uint(4),t.remaining()<n.size-4)return null;var a=t.read_uint(1);if(a<2)throw new o.ProtocolError("Invalid data offset, must be at least 2 was "+a);if(n.type=t.read_uint(1),n.type===i.TYPE_AMQP)n.channel=t.read_uint(2);else{if(n.type!==i.TYPE_SASL)throw new o.ProtocolError("Unknown frame type "+n.type);t.skip(2),n.channel=0}if(a>1&&t.skip(4*a-8),t.remaining()){n.performative=t.read();var c=s[n.performative.descriptor.value];c&&(n.performative=new c(n.performative.value)),t.remaining()&&(n.payload=t.read_bytes(t.remaining()))}return n},i.write_frame=function(e){var t=new r.Writer;if(t.skip(4),t.write_uint(2,1),t.write_uint(e.type,1),e.type===i.TYPE_AMQP)t.write_uint(e.channel,2);else{if(e.type!==i.TYPE_SASL)throw new o.ProtocolError("Unknown frame type "+e.type);t.write_uint(0,2)}e.performative&&(t.write(e.performative),e.payload&&t.write_bytes(e.payload));var n=t.toBuffer();return n.writeUInt32BE(n.length,0),n},i.amqp_frame=function(e,t,n){return{channel:e||0,type:i.TYPE_AMQP,performative:t,payload:n}},i.sasl_frame=function(e){return{channel:0,type:i.TYPE_SASL,performative:e}};a(i.TYPE_AMQP,{name:"open",code:16,fields:[{name:"container_id",type:"string",mandatory:!0},{name:"hostname",type:"string"},{name:"max_frame_size",type:"uint",default_value:4294967295},{name:"channel_max",type:"ushort",default_value:65535},{name:"idle_time_out",type:"uint"},{name:"outgoing_locales",type:"symbol",multiple:!0},{name:"incoming_locales",type:"symbol",multiple:!0},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]}),a(i.TYPE_AMQP,{name:"begin",code:17,fields:[{name:"remote_channel",type:"ushort"},{name:"next_outgoing_id",type:"uint",mandatory:!0},{name:"incoming_window",type:"uint",mandatory:!0},{name:"outgoing_window",type:"uint",mandatory:!0},{name:"handle_max",type:"uint",default_value:"4294967295"},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]}),a(i.TYPE_AMQP,{name:"attach",code:18,fields:[{name:"name",type:"string",mandatory:!0},{name:"handle",type:"uint",mandatory:!0},{name:"role",type:"boolean",mandatory:!0},{name:"snd_settle_mode",type:"ubyte",default_value:2},{name:"rcv_settle_mode",type:"ubyte",default_value:0},{name:"source",type:"*"},{name:"target",type:"*"},{name:"unsettled",type:"map"},{name:"incomplete_unsettled",type:"boolean",default_value:!1},{name:"initial_delivery_count",type:"uint"},{name:"max_message_size",type:"ulong"},{name:"offered_capabilities",type:"symbol",multiple:!0},{name:"desired_capabilities",type:"symbol",multiple:!0},{name:"properties",type:"symbolic_map"}]}),a(i.TYPE_AMQP,{name:"flow",code:19,fields:[{name:"next_incoming_id",type:"uint"},{name:"incoming_window",type:"uint",mandatory:!0},{name:"next_outgoing_id",type:"uint",mandatory:!0},{name:"outgoing_window",type:"uint",mandatory:!0},{name:"handle",type:"uint"},{name:"delivery_count",type:"uint"},{name:"link_credit",type:"uint"},{name:"available",type:"uint"},{name:"drain",type:"boolean",default_value:!1},{name:"echo",type:"boolean",default_value:!1},{name:"properties",type:"symbolic_map"}]}),a(i.TYPE_AMQP,{name:"transfer",code:20,fields:[{name:"handle",type:"uint",mandatory:!0},{name:"delivery_id",type:"uint"},{name:"delivery_tag",type:"binary"},{name:"message_format",type:"uint"},{name:"settled",type:"boolean"},{name:"more",type:"boolean",default_value:!1},{name:"rcv_settle_mode",type:"ubyte"},{name:"state",type:"delivery_state"},{name:"resume",type:"boolean",default_value:!1},{name:"aborted",type:"boolean",default_value:!1},{name:"batchable",type:"boolean",default_value:!1}]}),a(i.TYPE_AMQP,{name:"disposition",code:21,fields:[{name:"role",type:"boolean",mandatory:!0},{name:"first",type:"uint",mandatory:!0},{name:"last",type:"uint"},{name:"settled",type:"boolean",default_value:!1},{name:"state",type:"*"},{name:"batchable",type:"boolean",default_value:!1}]}),a(i.TYPE_AMQP,{name:"detach",code:22,fields:[{name:"handle",type:"uint",mandatory:!0},{name:"closed",type:"boolean",default_value:!1},{name:"error",type:"error"}]}),a(i.TYPE_AMQP,{name:"end",code:23,fields:[{name:"error",type:"error"}]}),a(i.TYPE_AMQP,{name:"close",code:24,fields:[{name:"error",type:"error"}]});a(i.TYPE_SASL,{name:"sasl_mechanisms",code:64,fields:[{name:"sasl_server_mechanisms",type:"symbol",multiple:!0,mandatory:!0}]}),a(i.TYPE_SASL,{name:"sasl_init",code:65,fields:[{name:"mechanism",type:"symbol",mandatory:!0},{name:"initial_response",type:"binary"},{name:"hostname",type:"string"}]}),a(i.TYPE_SASL,{name:"sasl_challenge",code:66,fields:[{name:"challenge",type:"binary",mandatory:!0}]}),a(i.TYPE_SASL,{name:"sasl_response",code:67,fields:[{name:"response",type:"binary",mandatory:!0}]}),a(i.TYPE_SASL,{name:"sasl_outcome",code:68,fields:[{name:"code",type:"ubyte",mandatory:!0},{name:"additional_data",type:"binary"}]}),e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(32),o=n(73);!function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.OK=200]="OK",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.Ambiguous=300]="Ambiguous",e[e.MultipleChoices=300]="MultipleChoices",e[e.Moved=301]="Moved",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.Redirect=302]="Redirect",e[e.RedirectMethod=303]="RedirectMethod",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.RedirectKeepVerb=307]="RedirectKeepVerb",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.RequestEntityTooLarge=413]="RequestEntityTooLarge",e[e.RequestUriTooLong=414]="RequestUriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RequestedRangeNotSatisfiable=416]="RequestedRangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported"}(t.AmqpResponseStatusCode||(t.AmqpResponseStatusCode={})),t.messageProperties=["message_id","reply_to","to","correlation_id","content_type","absolute_expiry_time","group_id","group_sequence","reply_to_group_id","content_encoding","creation_time","subject","user_id"],t.messageHeader=["first_acquirer","delivery_count","ttl","durable","priority"],t.isAmqpError=function(e){if(!e||"object"!=typeof e)throw new Error("err is a required parameter and must be of type 'object'.");let t=!1;return(e.condition&&"string"==typeof e.condition&&e.description&&"string"==typeof e.description||e.value&&Array.isArray(e.value)||e.constructor&&"c"===e.constructor.name)&&(t=!0),t},t.delay=function(e,t){return new Promise(n=>setTimeout(()=>n(t),e))},t.parseConnectionString=function(e,t){t||(t={});const n=t.entitySeperator||";",r=t.keyValueSeparator||"=";return e.split(n).reduce((e,t)=>{const n=t.indexOf(r);return Object.assign({},e,{[t.substring(0,n)]:t.substring(n+1)})},{})},t.emitEvent=function(e){const t=()=>{const t=e.emitter&&(e.emitter.id||e.emitter.name);r[e.emitterType]("[%s] %s '%s' got event: '%s'. Re-emitting the translated context.",e.connectionId,e.emitterType,t,e.eventName),e.emitter.emit(e.eventName,o.EventContext.translate(e.rheaContext,e.emitter,e.eventName))};-1!==e.eventName.indexOf("error")&&e.emitter.actionInitiated>0?(r[e.emitterType]("[%s] %s got event: '%s'. Will re-emit in the next tick, since this happened before the promise for create/close was resolved.",e.connectionId,e.emitterType,e.eventName),setTimeout(t)):t()},t.abortErrorName="AbortError",t.createAbortError=function(){const e=new Error("The operation was aborted.");return e.name=t.abortErrorName,e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e){super(e),this.name="OperationTimeoutError"}}t.OperationTimeoutError=r;class o extends Error{constructor(e){super(e),this.name="InsufficientCreditError"}}t.InsufficientCreditError=o;class i extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.innerError=n,this.name="SendOperationFailedError",this.code=t,this.innerError=n}}t.SendOperationFailedError=i},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return c}));const r=new WeakMap,o=new WeakMap;class i{constructor(){this.onabort=null,r.set(this,[]),o.set(this,!1)}get aborted(){if(!o.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");return o.get(this)}static get none(){return new i}addEventListener(e,t){if(!r.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");r.get(this).push(t)}removeEventListener(e,t){if(!r.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");const n=r.get(this),o=n.indexOf(t);o>-1&&n.splice(o,1)}dispatchEvent(e){throw new Error("This is a stub dispatchEvent implementation that should not be used.  It only exists for type-checking purposes.")}}function s(e){if(e.aborted)return;e.onabort&&e.onabort.call(e);const t=r.get(e);t&&t.slice().forEach(t=>{t.call(e,{type:"abort"})}),o.set(e,!0)}class a extends Error{constructor(e){super(e),this.name="AbortError"}}class c{constructor(e){if(this._signal=new i,e){Array.isArray(e)||(e=arguments);for(const t of e)t.aborted?this.abort():t.addEventListener("abort",()=>{this.abort()})}}get signal(){return this._signal}abort(){s(this._signal)}static timeout(e){const t=new i,n=setTimeout(s,e,t);return"function"==typeof n.unref&&n.unref(),t}}},,function(e,t,n){"use strict";function r(e,t){if(!function(e){return null!=e}(e)||"object"!=typeof e)return!1;for(const n of t)if(!o(e,n))return!1;return!0}function o(e,t){return"object"==typeof e&&t in e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return y}));var r=n(8),o=n(33),i=n.n(o),s=n(39),a=n(119),c=n(64),u=n(26),l=n(17),d=n(35),h=n(23),p=n(20),f=n(3),m=n(83);function g(e){if(!e)return{};try{return JSON.parse(e)}catch(e){return{}}}class y extends a.a{constructor(t){var n;const r=(null===(n=null==t?void 0:t.userAgentOptions)||void 0===n?void 0:n.userAgentPrefix)?t.userAgentOptions.userAgentPrefix+" azsdk-js-identity/1.5.2":"azsdk-js-identity/1.5.2",o=function(t){let n=null==t?void 0:t.authorityHost;return m.a&&(n=null!=n?n:e.env.AZURE_AUTHORITY_HOST),null!=n?n:h.b}(t);if(!o.startsWith("https:"))throw new Error("The authorityHost address must use the 'https' protocol.");super(Object.assign(Object.assign({requestContentType:"application/json; charset=utf-8"},t),{userAgentOptions:{userAgentPrefix:r},baseUri:o})),this.authorityHost=o}sendTokenRequest(e,t){var n;return Object(r.__awaiter)(this,void 0,void 0,(function*(){f.d.info(`IdentityClient: sending token request to [${e.url}]`);const r=yield this.sendRequest(e);if(t=t||(e=>Date.now()+1e3*e.expires_in),!r.bodyAsText||200!==r.status&&201!==r.status){const e=new l.c(r.status,r.bodyAsText);throw f.d.warning(`IdentityClient: authentication error. HTTP status: ${r.status}, ${e.errorResponse.errorDescription}`),e}{const o=g(r.bodyAsText),i={accessToken:{token:null!==(n=o.token)&&void 0!==n?n:o.access_token,expiresOnTimestamp:t(o)},refreshToken:o.refresh_token};return f.d.info(`IdentityClient: [${e.url}] token acquired, expires on ${i.accessToken.expiresOnTimestamp}`),i}}))}refreshAccessToken(e,t,n,o,a,h,m){var g,y;return Object(r.__awaiter)(this,void 0,void 0,(function*(){if(void 0===o)return null;f.d.info(`IdentityClient: refreshing access token with client ID: ${t}, scopes: ${n} started`);const{span:r,updatedOptions:v}=Object(p.a)("IdentityClient-refreshAccessToken",m),b={grant_type:"refresh_token",client_id:t,refresh_token:o,scope:n};void 0!==a&&(b.client_secret=a);try{const n=Object(d.a)(e),o=Object(c.a)({url:`${this.authorityHost}/${e}/${n}`,method:"POST",body:i.a.stringify(b),abortSignal:m&&m.abortSignal,headers:Object(u.a)({Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}),tracingOptions:{spanOptions:null===(g=null==v?void 0:v.tracingOptions)||void 0===g?void 0:g.spanOptions,tracingContext:null===(y=null==v?void 0:v.tracingOptions)||void 0===y?void 0:y.tracingContext}}),s=yield this.sendTokenRequest(o,h);return f.d.info("IdentityClient: refreshed token for client ID: "+t),s}catch(e){if(e.name===l.d&&"interaction_required"===e.errorResponse.error)return f.d.info("IdentityClient: interaction required for client ID: "+t),r.setStatus({code:s.b.ERROR,message:e.message}),null;throw f.d.warning(`IdentityClient: failed refreshing token for client ID: ${t}: ${e}`),r.setStatus({code:s.b.ERROR,message:e.message}),e}finally{r.end()}}))}sendGetRequestAsync(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){const n=Object(c.a)({url:e,method:"GET",body:null==t?void 0:t.body,headers:Object(u.a)(null==t?void 0:t.headers)}),r=yield this.sendRequest(n);return{body:g(r.bodyAsText),headers:r.headers.toJSON(),status:r.status}}))}sendPostRequestAsync(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){const n=Object(c.a)({url:e,method:"POST",body:null==t?void 0:t.body,headers:Object(u.a)(null==t?void 0:t.headers)}),r=yield this.sendRequest(n);return{body:g(r.bodyAsText),headers:r.headers.toJSON(),status:r.status}}))}}}).call(this,n(16))},function(e,t,n){"use strict";var r,o=new Uint8Array(16);function i(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var a=function(e){return"string"==typeof e&&s.test(e)},c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n};t.a=function(e,t,n){var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return l(r)}},,function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},o=/%[sdj%]/g;t.format=function(e){if(!y(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,s=String(e).replace(o,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),c=r[n];n<i;c=r[++n])m(c)||!_(c)?s+=" "+c:s+=" "+a(c);return s},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var o=!1;return function(){if(!o){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),o=!0}return n.apply(this,arguments)}};var i,s={};function a(e,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(n)?r.showHidden=n:n&&t._extend(r,n),v(r.showHidden)&&(r.showHidden=!1),v(r.depth)&&(r.depth=2),v(r.colors)&&(r.colors=!1),v(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),l(r,e,r.depth)}function c(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function u(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&S(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,e);return y(o)||(o=l(e,o,r)),o}var i=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(y(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(g(t))return e.stylize(""+t,"number");if(f(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,n);if(i)return i;var s=Object.keys(n),a=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(n)),E(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(n);if(0===s.length){if(S(n)){var c=n.name?": "+n.name:"";return e.stylize("[Function"+c+"]","special")}if(b(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(w(n))return e.stylize(Date.prototype.toString.call(n),"date");if(E(n))return d(n)}var u,_="",O=!1,C=["{","}"];(p(n)&&(O=!0,C=["[","]"]),S(n))&&(_=" [Function"+(n.name?": "+n.name:"")+"]");return b(n)&&(_=" "+RegExp.prototype.toString.call(n)),w(n)&&(_=" "+Date.prototype.toUTCString.call(n)),E(n)&&(_=" "+d(n)),0!==s.length||O&&0!=n.length?r<0?b(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),u=O?function(e,t,n,r,o){for(var i=[],s=0,a=t.length;s<a;++s)A(t,String(s))?i.push(h(e,t,n,r,String(s),!0)):i.push("");return o.forEach((function(o){o.match(/^\d+$/)||i.push(h(e,t,n,r,o,!0))})),i}(e,n,r,a,s):s.map((function(t){return h(e,n,r,a,t,O)})),e.seen.pop(),function(e,t,n){if(e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,_,C)):C[0]+_+C[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,r,o,i){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),A(r,o)||(s="["+o+"]"),a||(e.seen.indexOf(c.value)<0?(a=m(n)?l(e,c.value,null):l(e,c.value,n-1)).indexOf("\n")>-1&&(a=i?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),v(s)){if(i&&o.match(/^\d+$/))return a;(s=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function y(e){return"string"==typeof e}function v(e){return void 0===e}function b(e){return _(e)&&"[object RegExp]"===O(e)}function _(e){return"object"==typeof e&&null!==e}function w(e){return _(e)&&"[object Date]"===O(e)}function E(e){return _(e)&&("[object Error]"===O(e)||e instanceof Error)}function S(e){return"function"==typeof e}function O(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(v(i)&&(i=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!s[n])if(new RegExp("\\b"+n+"\\b","i").test(i)){var r=e.pid;s[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else s[n]=function(){};return s[n]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=f,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=y,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=v,t.isRegExp=b,t.isObject=_,t.isDate=w,t.isError=E,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(91);var I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(){var e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":");return[e.getDate(),I[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",T(),t.format.apply(t,arguments))},t.inherits=n(92),t._extend=function(e,t){if(!t||!_(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var k="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function P(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(k&&e[k]){var t;if("function"!=typeof(t=e[k]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,k,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,o)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),k&&Object.defineProperty(t,k,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=k,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var o=n.pop();if("function"!=typeof o)throw new TypeError("The last argument must be of type Function");var i=this,s=function(){return o.apply(i,arguments)};t.apply(this,n).then((function(t){e.nextTick(s,null,t)}),(function(t){e.nextTick(P,t,s)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(16))},function(e,t,n){"use strict";var r=function(){this.init()};r.prototype.init=function(){this.local_open=!1,this.remote_open=!1,this.open_requests=0,this.close_requests=0,this.initialised=!1,this.marker=void 0},r.prototype.mark=function(e){return this.marker=e||Date.now(),this.marker},r.prototype.open=function(){return this.marker=void 0,this.initialised=!0,!this.local_open&&(this.local_open=!0,this.open_requests++,!0)},r.prototype.close=function(){return this.marker=void 0,!!this.local_open&&(this.local_open=!1,this.close_requests++,!0)},r.prototype.disconnected=function(){var e=this.initialised;this.was_open=this.local_open,this.init(),this.initialised=e},r.prototype.reconnect=function(){this.was_open&&(this.open(),this.was_open=void 0)},r.prototype.remote_opened=function(){return!this.remote_open&&(this.remote_open=!0,!0)},r.prototype.remote_closed=function(){return!!this.remote_open&&(this.remote_open=!1,!0)},r.prototype.is_open=function(){return this.local_open&&this.remote_open},r.prototype.is_closed=function(){return this.initialised&&!(this.local_open||this.was_open)&&!this.remote_open},r.prototype.has_settled=function(){return 0===this.open_requests&&0===this.close_requests},r.prototype.need_open=function(){return this.open_requests>0&&(this.open_requests--,!0)},r.prototype.need_close=function(){return this.close_requests>0&&(this.close_requests--,!0)},e.exports=r},function(e,t,n){"use strict";var r=n(30),o=n(28),i={},s={},a=[],c={};function u(e,t,n){t.descriptor=e,s[e.symbolic]=t,s[Number(e.numeric).toString(10)]=t,n&&a.push(n)}function l(e){var t=o.define_composite(e);c[e.name]=t.create,i[Number(t.descriptor.numeric).toString(10)]=t,i[t.descriptor.symbolic]=t;u(t.descriptor,(function(n,r){for(var o=new t(r.value),i=0;i<e.fields.length;i++){var s=e.fields[i],a=o[s.name];null!=a&&(n[s.name]=a)}}),(function(e,n){e.push(t.create(n).described())}))}function d(e,t){var n=t?o.wrap_symbolic_map:o.wrap_map,r={numeric:e.code};r.symbolic="amqp:"+e.name.replace(/_/g,"-")+":map";u(r,(function(t,n){t[e.name]=o.unwrap_map_simple(n)}),(function(t,i){i[e.name]&&t.push(o.described_nc(o.wrap_ulong(r.numeric),n(i[e.name])))}))}function h(e,t,n){this.typecode=e,this.content=t,this.multiple=n}function p(e,t,n){void 0===e.body?e.body=new h(n,o.unwrap(t)):e.body.constructor===h&&e.body.typecode===n&&(e.body.multiple?e.body.content.push(o.unwrap(t)):(e.body.multiple=!0,e.body.content=[e.body.content,o.unwrap(t)]))}function f(e){e&&function e(t,n){for(var r in t){var o=t[r];"object"==typeof o?e(o,n[r]):n[r]=o}}(e,this)}h.prototype.described=function(e){return o.described(o.wrap_ulong(this.typecode),o.wrap(e||this.content))},h.prototype.collect_sections=function(e){if(this.multiple)for(var t=0;t<this.content.length;t++)e.push(this.described(this.content[t]));else e.push(this.described())},l({name:"header",code:112,fields:[{name:"durable",type:"boolean",default_value:!1},{name:"priority",type:"ubyte",default_value:4},{name:"ttl",type:"uint"},{name:"first_acquirer",type:"boolean",default_value:!1},{name:"delivery_count",type:"uint",default_value:0}]}),d({name:"delivery_annotations",code:113},!0),d({name:"message_annotations",code:114},!0),l({name:"properties",code:115,fields:[{name:"message_id",type:"message_id"},{name:"user_id",type:"binary"},{name:"to",type:"string"},{name:"subject",type:"string"},{name:"reply_to",type:"string"},{name:"correlation_id",type:"message_id"},{name:"content_type",type:"symbol"},{name:"content_encoding",type:"symbol"},{name:"absolute_expiry_time",type:"timestamp"},{name:"creation_time",type:"timestamp"},{name:"group_id",type:"string"},{name:"group_sequence",type:"uint"},{name:"reply_to_group_id",type:"string"}]}),d({name:"application_properties",code:116}),u({numeric:117,symbolic:"amqp:data:binary"},(function(e,t){p(e,t,117)})),u({numeric:118,symbolic:"amqp:amqp-sequence:list"},(function(e,t){p(e,t,118)})),u({numeric:119,symbolic:"amqp:value:*"},(function(e,t){e.body=o.unwrap(t)})),d({name:"footer",code:120}),a.push((function(e,t){t.body&&t.body.collect_sections?t.body.collect_sections(e):e.push(o.described(o.wrap_ulong(119),o.wrap(t.body)))})),c.data_section=function(e){return new h(117,e)},c.sequence_section=function(e){return new h(118,e)},c.data_sections=function(e){return new h(117,e,!0)},c.sequence_sections=function(e){return new h(118,e,!0)},f.prototype.toJSON=function(){var e={};for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e},f.prototype.toString=function(){return JSON.stringify(this.toJSON())},c.encode=function(e){var t=[];a.forEach((function(n){n(t,e)}));for(var n=new o.Writer,i=0;i<t.length;i++)r.message("Encoding section %d of %d: %o",i+1,t.length,t[i]),n.write(t[i]);var s=n.toBuffer();return r.message("encoded %d bytes",s.length),s},c.decode=function(e){for(var t=new f,n=new o.Reader(e);n.remaining();){var i=n.read();if(r.message("decoding section: %o of type: %o",i,i.descriptor),i.descriptor){var a=s[i.descriptor.value];a?a(t,i):console.warn("WARNING: did not recognise message section with descriptor "+i.descriptor)}else console.warn("WARNING: expected described message section got "+JSON.stringify(i))}return t};var m={};function g(e){var t=o.define_composite(e);t.composite_type=e.name,c[e.name]=t.create,m[Number(t.descriptor.numeric).toString(10)]=t,m[t.descriptor.symbolic]=t,c["is_"+e.name]=function(t){if(t&&t.descriptor){var n=m[t.descriptor.value];if(n)return n.descriptor.numeric===e.code}return!1}}c.unwrap_outcome=function(e){if(e&&e.descriptor){var t=m[e.descriptor.value];if(t)return new t(e.value)}return console.error("unrecognised outcome: "+JSON.stringify(e)),e},c.are_outcomes_equivalent=function(e,t){return void 0===e&&void 0===t||void 0!==e&&void 0!==t&&(e.descriptor.value===t.descriptor.value&&36===e.descriptor.value)},g({name:"received",code:35,fields:[{name:"section_number",type:"uint",mandatory:!0},{name:"section_offset",type:"ulong",mandatory:!0}]}),g({name:"accepted",code:36,fields:[]}),g({name:"rejected",code:37,fields:[{name:"error",type:"error"}]}),g({name:"released",code:38,fields:[]}),g({name:"modified",code:39,fields:[{name:"delivery_failed",type:"boolean"},{name:"undeliverable_here",type:"boolean"},{name:"message_annotations",type:"map"}]}),e.exports=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8),o=n(32),i=n(55),s=n(76),a=n(104),c=n(43),u=n(25),l=n(57),d=n(44);class h extends l.Entity{constructor(e){if(super(),e||(e={}),null==e.operationTimeoutInSeconds&&(e.operationTimeoutInSeconds=a.defaultOperationTimeoutInSeconds),(t=e)&&"object"==typeof t.container&&"object"==typeof t.rheaConnection)this._connection=e.rheaConnection,this.container=e.container;else{const t=e;if(t.webSocketOptions){const e=u.websocket_connect(t.webSocketOptions.webSocket);t.connection_details=e(t.webSocketOptions.url,t.webSocketOptions.protocol,t.webSocketOptions.options)}this._connection=u.create_connection(t),this.container=s.Container.copyFromContainerInstance(this._connection.container)}var t;this.options=this._connection.options,this.options.operationTimeoutInSeconds=e.operationTimeoutInSeconds,this._initializeEventListeners()}get id(){return this._connection.options.id}get properties(){return this._connection.properties}get maxFrameSize(){return this._connection.max_frame_size}get idleTimeout(){return this._connection.idle_time_out}get channelMax(){return this._connection.channel_max}get error(){return this._connection.error}removeSession(e){return e.remove()}open(e){return new Promise((t,n)=>{if(this.isOpen())return t(this);{let r,i,s;const a=e&&e.abortSignal;let l;const d=()=>{clearTimeout(l),this.actionInitiated--,this._connection.removeListener(u.ConnectionEvents.connectionOpen,r),this._connection.removeListener(u.ConnectionEvents.connectionClose,i),this._connection.removeListener(u.ConnectionEvents.disconnected,i),a&&a.removeEventListener("abort",s)};r=e=>(d(),o.connection("[%s] Resolving the promise with amqp connection.",this.id),t(this)),i=e=>{d();const t=e.error||e.connection.error||Error("Failed to connect");return o.error("[%s] Error occurred while establishing amqp connection: %O",this.id,t),n(t)},s=()=>{d(),this._connection.close();const e=c.createAbortError();return o.error("[%s] [%s]",this.id,e.message),n(e)};const h=()=>{d();const e=`Unable to open the amqp connection "${this.id}" due to operation timeout.`;return o.error("[%s] %s",this.id,e),n(new Error(e))};this._connection.once(u.ConnectionEvents.connectionOpen,r),this._connection.once(u.ConnectionEvents.connectionClose,i),this._connection.once(u.ConnectionEvents.disconnected,i),l=setTimeout(h,1e3*this.options.operationTimeoutInSeconds),o.connection("[%s] Trying to create a new amqp connection.",this.id),this._connection.connect(),this.actionInitiated++,a&&(a.aborted?s():a.addEventListener("abort",s))}})}close(e){return new Promise((t,n)=>{if(o.error("[%s] The connection is open ? -> %s",this.id,this.isOpen()),!this.isOpen())return t();{let r,i,s,a;const l=e&&e.abortSignal;let d;const h=()=>{clearTimeout(d),this.actionInitiated--,this._connection.removeListener(u.ConnectionEvents.connectionError,i),this._connection.removeListener(u.ConnectionEvents.connectionClose,r),this._connection.removeListener(u.ConnectionEvents.disconnected,s),l&&l.removeEventListener("abort",a)};r=e=>(h(),o.connection("[%s] Resolving the promise as the connection has been successfully closed.",this.id),t()),i=e=>(h(),o.error("[%s] Error occurred while closing amqp connection: %O.",this.id,e.connection.error),n(e.connection.error)),s=e=>{h();const t=e.connection&&e.connection.error?e.connection.error:e.error;o.error("[%s] Connection got disconnected while closing itself: %O.",this.id,t)},a=()=>{h();const e=c.createAbortError();return o.error("[%s] [%s]",this.id,e.message),n(e)};const p=()=>{h();const e=`Unable to close the amqp connection "${this.id}" due to operation timeout.`;return o.error("[%s] %s",this.id,e),n(new Error(e))};this._connection.once(u.ConnectionEvents.connectionClose,r),this._connection.once(u.ConnectionEvents.connectionError,i),this._connection.once(u.ConnectionEvents.disconnected,s),d=setTimeout(p,1e3*this.options.operationTimeoutInSeconds),this._connection.close(),this.actionInitiated++,l&&(l.aborted?a():l.addEventListener("abort",a))}})}isOpen(){let e=!1;return this._connection&&this._connection.is_open&&this._connection.is_open()&&(e=!0),e}removeAllSessions(){this._connection&&this._connection.remove_all_sessions()}isRemoteOpen(){return this._connection.is_remote_open()}getError(){return this._connection.get_error()}getPeerCertificate(){return this._connection.get_peer_certificate()}getTlsSocket(){return this._connection.get_tls_socket()}wasCloseInitiated(){return this._connection.is_closed()}createSession(e){return new Promise((t,n)=>{const r=e&&e.abortSignal;let s;if(r){const e=()=>{const e=c.createAbortError();return o.error("[%s] [%s]",this.id,e.message),n(e)};if(s=()=>(g(),a.is_open()?a.close():a.is_closed()||a.once(u.SessionEvents.sessionOpen,()=>{a.close()}),e()),r.aborted)return e();r.addEventListener("abort",s)}const a=this._connection.create_session(),l=new i.Session(this,a);let h,p,f,m;l.actionInitiated++;const g=()=>{clearTimeout(m),l.actionInitiated--,a.removeListener(u.SessionEvents.sessionOpen,h),a.removeListener(u.SessionEvents.sessionClose,p),a.connection.removeListener(u.ConnectionEvents.disconnected,f),r&&r.removeEventListener("abort",s)};h=e=>(g(),o.session("[%s] Resolving the promise with amqp session '%s'.",this.id,l.id),t(l)),p=e=>(g(),o.error("[%s] Error occurred while establishing a session over amqp connection: %O.",this.id,e.session.error),n(e.session.error)),f=e=>{g();const t=e.connection&&e.connection.error?e.connection.error:e.error;return o.error("[%s] Connection got disconnected while creating amqp session '%s': %O.",this.id,l.id,t),n(t)};a.once(u.SessionEvents.sessionOpen,h),a.once(u.SessionEvents.sessionClose,p),a.connection.once(u.ConnectionEvents.disconnected,f),o.session("[%s] Calling amqp session.begin().",this.id),m=setTimeout(()=>{g();const e="Unable to create the amqp session due to operation timeout.";return o.error("[%s] %s",this.id,e),n(new d.OperationTimeoutError(e))},1e3*this.options.operationTimeoutInSeconds),a.begin()})}createSender(e){return r.__awaiter(this,void 0,void 0,(function*(){if(e&&e.session&&e.session.createSender)return e.session.createSender(e);return(yield this.createSession({abortSignal:e&&e.abortSignal})).createSender(e)}))}createAwaitableSender(e){return r.__awaiter(this,void 0,void 0,(function*(){if(e&&e.session&&e.session.createAwaitableSender)return e.session.createAwaitableSender(e);return(yield this.createSession({abortSignal:e&&e.abortSignal})).createAwaitableSender(e)}))}createReceiver(e){return r.__awaiter(this,void 0,void 0,(function*(){if(e&&e.session&&e.session.createReceiver)return e.session.createReceiver(e);return(yield this.createSession({abortSignal:e&&e.abortSignal})).createReceiver(e)}))}createRequestResponseLink(e,t,n={}){return r.__awaiter(this,void 0,void 0,(function*(){if(!e)throw new Error("Please provide sender options.");if(!t)throw new Error("Please provide receiver options.");const{session:r,abortSignal:i}=n,s=r||(yield this.createSession({abortSignal:i})),[a,c]=yield Promise.all([s.createSender(Object.assign({},e,{abortSignal:i})),s.createReceiver(Object.assign({},t,{abortSignal:i}))]);return o.connection("[%s] Successfully created the sender '%s' and receiver '%s' on the same amqp session '%s'.",this.id,a.name,c.name,s.id),{session:s,sender:a,receiver:c}}))}_initializeEventListeners(){for(const e of Object.keys(u.ConnectionEvents))this._connection.on(u.ConnectionEvents[e],t=>{const n={rheaContext:t,emitter:this,eventName:u.ConnectionEvents[e],emitterType:"connection",connectionId:this.id};u.ConnectionEvents[e]===u.ConnectionEvents.protocolError&&o.connection("[%s] ProtocolError is: %O.",this.id,t),c.emitEvent(n)});this._connection.on(u.SenderEvents.senderError,e=>{const t={rheaContext:e,emitter:this,eventName:u.SenderEvents.senderError,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),this._connection.on(u.SenderEvents.senderClose,e=>{const t={rheaContext:e,emitter:this,eventName:u.SenderEvents.senderClose,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),this._connection.on(u.ReceiverEvents.receiverError,e=>{const t={rheaContext:e,emitter:this,eventName:u.ReceiverEvents.receiverError,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),this._connection.on(u.ReceiverEvents.receiverClose,e=>{const t={rheaContext:e,emitter:this,eventName:u.ReceiverEvents.receiverClose,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),this._connection.on(u.SessionEvents.sessionError,e=>{const t={rheaContext:e,emitter:this,eventName:u.SessionEvents.sessionError,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),this._connection.on(u.SessionEvents.sessionClose,e=>{const t={rheaContext:e,emitter:this,eventName:u.SessionEvents.sessionClose,emitterType:"connection",connectionId:this.id};c.emitEvent(t)}),"function"==typeof this._connection.eventNames&&o.eventHandler("[%s] rhea-promise 'connection' object is listening for events: %o emitted by rhea's 'connection' object.",this.id,this._connection.eventNames())}}t.Connection=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8),o=n(32),i=n(74),s=n(58),a=n(25),c=n(43),u=n(57),l=n(44),d=n(75);var h;!function(e){e.sender="sender",e.AwaitableSender="AwaitableSender"}(h||(h={}));class p extends u.Entity{constructor(e,t){super(),this._connection=e,this._session=t,this._initializeEventListeners()}get connection(){return this._connection}get incoming(){return this._session.incoming}get outgoing(){return this._session.outgoing}get error(){return this._session.error}get id(){let e="";const t=this._session;return t.local&&(e+=`local-${t.local.channel}_`),t.remote&&(e+=`remote-${t.remote.channel}_`),e&&(e+=""+this._connection.id),e}isOpen(){let e=!1;return this._connection.isOpen()&&this._session.is_open()&&(e=!0),e}isClosed(){return this._session.is_closed()}isItselfClosed(){return this._session.is_itself_closed()}remove(){this._session&&(this.removeAllListeners(),this._session.removeAllListeners(),this._session.remove())}begin(){this._session&&this._session.begin()}close(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=new Promise((t,n)=>{if(o.error("[%s] The amqp session '%s' is open ? -> %s",this.connection.id,this.id,this.isOpen()),!this.isOpen())return t();{let r,i,s,u;const d=e&&e.abortSignal;let h;const p=()=>{clearTimeout(h),this.actionInitiated--,this._session.removeListener(a.SessionEvents.sessionError,r),this._session.removeListener(a.SessionEvents.sessionClose,i),this._session.connection.removeListener(a.ConnectionEvents.disconnected,s),d&&d.removeEventListener("abort",u)};i=e=>(p(),o.session("[%s] Resolving the promise as the amqp session '%s' has been closed.",this.connection.id,this.id),t()),r=e=>{p(),o.error("[%s] Error occurred while closing amqp session '%s'.",this.connection.id,this.id,e.session.error),n(e.session.error)},s=e=>{p();const t=e.connection&&e.connection.error?e.connection.error:e.error;o.error("[%s] Connection got disconnected while closing amqp session '%s': %O.",this.connection.id,this.id,t)},u=()=>{p();const e=c.createAbortError();return o.error("[%s] [%s]",this.connection.id,e.message),n(e)};const f=()=>{p();const e=`Unable to close the amqp session ${this.id} due to operation timeout.`;o.error("[%s] %s",this.connection.id,e),n(new l.OperationTimeoutError(e))};this._session.once(a.SessionEvents.sessionClose,i),this._session.once(a.SessionEvents.sessionError,r),this._session.connection.once(a.ConnectionEvents.disconnected,s),o.session("[%s] Calling session.close() for amqp session '%s'.",this.connection.id,this.id),h=setTimeout(f,1e3*this.connection.options.operationTimeoutInSeconds),this._session.close(),this.actionInitiated++,d&&(d.aborted?u():d.addEventListener("abort",u))}});try{yield t}finally{this.removeAllListeners()}}))}createReceiver(e){return new Promise((t,n)=>{if(e&&(e.onMessage&&!e.onError||e.onError&&!e.onMessage)&&0!==e.credit_window)return n(new Error("Either provide both 'onMessage' and 'onError' handlers, or please set the credit_window to 0, if you want to provide only the 'onError' handler. This ensures no messages are lost between the receiver getting created  and the 'onMessage' handler being added."));const r=e&&e.abortSignal;let s;if(r){const e=()=>{const e=c.createAbortError();return o.error("[%s] [%s]",this.connection.id,e.message),n(e)};if(s=()=>(g(),u.is_open()?u.close():u.is_closed()||u.once(a.ReceiverEvents.receiverOpen,()=>{u.close()}),e()),r.aborted)return e();r.addEventListener("abort",s)}e&&e.onSessionError&&(this.on(a.SessionEvents.sessionError,e.onSessionError),o.session("[%s] Added event handler for event '%s' on rhea-promise 'session: %s', while creating the 'receiver'.",this.connection.id,a.SessionEvents.sessionError,this.id)),e&&e.onSessionClose&&(this.on(a.SessionEvents.sessionClose,e.onSessionClose),o.session("[%s] Added event handler for event '%s' on rhea-promise 'session: %s',  while creating the 'receiver'.",this.connection.id,a.SessionEvents.sessionClose,this.id));const u=this._session.attach_receiver(e),d=new i.Receiver(this,u,e);let h,p,f,m;d.actionInitiated++,e&&e.onMessage&&(d.on(a.ReceiverEvents.message,e.onMessage),o.receiver("[%s] Added event handler for event '%s' on rhea-promise 'receiver'.",this.connection.id,a.ReceiverEvents.message)),e&&e.onError&&(d.on(a.ReceiverEvents.receiverError,e.onError),o.receiver("[%s] Added event handler for event '%s' on rhea-promise 'receiver'.",this.connection.id,a.ReceiverEvents.receiverError)),e&&e.onClose&&(d.on(a.ReceiverEvents.receiverClose,e.onClose),o.receiver("[%s] Added event handler for event '%s' on rhea-promise 'receiver'.",this.connection.id,a.ReceiverEvents.receiverClose)),e&&e.onSettled&&(d.on(a.ReceiverEvents.settled,e.onSettled),o.receiver("[%s] Added event handler for event '%s' on rhea-promise 'receiver'.",this.connection.id,a.ReceiverEvents.settled));const g=()=>{clearTimeout(m),d.actionInitiated--,u.removeListener(a.ReceiverEvents.receiverOpen,h),u.removeListener(a.ReceiverEvents.receiverClose,p),u.session.connection.removeListener(a.ConnectionEvents.disconnected,f),r&&r.removeEventListener("abort",s)};h=e=>(g(),o.receiver("[%s] Resolving the promise with amqp receiver '%s' on amqp session '%s'.",this.connection.id,d.name,this.id),t(d)),p=e=>(g(),o.error("[%s] Error occurred while creating the amqp receiver '%s' on amqp session '%s' over amqp connection: %O.",this.connection.id,d.name,this.id,e.receiver.error),n(e.receiver.error)),f=e=>{g();const t=e.connection&&e.connection.error?e.connection.error:e.error;return o.error("[%s] Connection got disconnected while creating amqp receiver '%s' on amqp session '%s': %O.",this.connection.id,d.name,this.id,t),n(t)};u.once(a.ReceiverEvents.receiverOpen,h),u.once(a.ReceiverEvents.receiverClose,p),u.session.connection.on(a.ConnectionEvents.disconnected,f),m=setTimeout(()=>{g();const e=`Unable to create the amqp receiver '${d.name}' on amqp session '${this.id}' due to operation timeout.`;return o.error("[%s] %s",this.connection.id,e),n(new l.OperationTimeoutError(e))},1e3*this.connection.options.operationTimeoutInSeconds)})}createSender(e){return this._createSender(h.sender,e)}createAwaitableSender(e){return this._createSender(h.AwaitableSender,e)}_createSender(e,t){return new Promise((n,r)=>{const i=t&&t.abortSignal;let u;if(i){const e=()=>{const e=c.createAbortError();return o.error("[%s] [%s]",this.connection.id,e.message),r(e)};if(u=()=>(b(),p.is_open()?p.close():p.is_closed()||p.once(a.SenderEvents.senderOpen,()=>{p.close()}),e()),i.aborted)return e();i.addEventListener("abort",u)}t&&t.onSessionError&&(this.on(a.SessionEvents.sessionError,t.onSessionError),o.session("[%s] Added event handler for event '%s' on rhea-promise 'session: %s', while creating the sender.",this.connection.id,a.SessionEvents.sessionError,this.id)),t&&t.onSessionClose&&(this.on(a.SessionEvents.sessionClose,t.onSessionClose),o.session("[%s] Added event handler for event '%s' on rhea-promise 'session: %s', while creating the sender.",this.connection.id,a.SessionEvents.sessionClose,this.id));const p=this._session.attach_sender(t);let f,m,g,y,v;f=e===h.sender?new s.Sender(this,p,t):new d.AwaitableSender(this,p,t),f.actionInitiated++,t&&(t.onError&&f.on(a.SenderEvents.senderError,t.onError),t.onClose&&f.on(a.SenderEvents.senderClose,t.onClose),e===h.sender&&(t.onAccepted&&f.on(a.SenderEvents.accepted,t.onAccepted),t.onRejected&&f.on(a.SenderEvents.rejected,t.onRejected),t.onReleased&&f.on(a.SenderEvents.released,t.onReleased),t.onModified&&f.on(a.SenderEvents.modified,t.onModified)));const b=()=>{clearTimeout(v),f.actionInitiated--,p.removeListener(a.SenderEvents.senderOpen,m),p.removeListener(a.SenderEvents.senderClose,g),p.session.connection.removeListener(a.ConnectionEvents.disconnected,y),i&&i.removeEventListener("abort",u)};m=e=>(b(),o.sender("[%s] Resolving the promise with amqp sender '%s' on amqp session '%s'.",this.connection.id,f.name,this.id),n(f)),g=e=>(b(),o.error("[%s] Error occurred while creating the amqp sender '%s' on amqp session '%s' over amqp connection: %O.",this.connection.id,f.name,this.id,e.sender.error),r(e.sender.error)),y=e=>{b();const t=e.connection&&e.connection.error?e.connection.error:e.error;return o.error("[%s] Connection got disconnected while creating amqp sender '%s' on amqp session '%s': %O.",this.connection.id,f.name,this.id,t),r(t)};p.once(a.SenderEvents.sendable,m),p.once(a.SenderEvents.senderClose,g),p.session.connection.on(a.ConnectionEvents.disconnected,y),v=setTimeout(()=>{b();const e=`Unable to create the amqp sender '${f.name}' on amqp session '${this.id}' due to operation timeout.`;return o.error("[%s] %s",this.connection.id,e),r(new l.OperationTimeoutError(e))},1e3*this.connection.options.operationTimeoutInSeconds)})}_initializeEventListeners(){for(const e of Object.keys(a.SessionEvents))this._session.on(a.SessionEvents[e],t=>{const n={rheaContext:t,emitter:this,eventName:a.SessionEvents[e],emitterType:"session",connectionId:this.connection.id};c.emitEvent(n)});this._session.on(a.SenderEvents.senderError,e=>{const t={rheaContext:e,emitter:this,eventName:a.SenderEvents.senderError,emitterType:"session",connectionId:this.connection.id};c.emitEvent(t)}),this._session.on(a.SenderEvents.senderClose,e=>{const t={rheaContext:e,emitter:this,eventName:a.SenderEvents.senderClose,emitterType:"session",connectionId:this.connection.id};c.emitEvent(t)}),this._session.on(a.ReceiverEvents.receiverError,e=>{const t={rheaContext:e,emitter:this,eventName:a.ReceiverEvents.receiverError,emitterType:"session",connectionId:this.connection.id};c.emitEvent(t)}),this._session.on(a.ReceiverEvents.receiverClose,e=>{const t={rheaContext:e,emitter:this,eventName:a.ReceiverEvents.receiverClose,emitterType:"session",connectionId:this.connection.id};c.emitEvent(t)}),"function"==typeof this._session.eventNames&&o.eventHandler("[%s] rhea-promise 'session' object '%s' is listening for events: %o emitted by rhea's 'session' object.",this.connection.id,this.id,this._session.eventNames())}}t.Session=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8),o=n(32),i=n(25),s=n(43),a=n(57),c=n(44);var u;!function(e){e.sender="sender",e.receiver="receiver"}(u=t.LinkType||(t.LinkType={}));class l extends a.Entity{constructor(e,t,n,r){super(),this.type=e,this._session=t,this._link=n,this.linkOptions=r,this._initializeEventListeners()}get name(){return this._link.name}get error(){return this._link.error}get properties(){return this._link.properties}get sendSettleMode(){return this._link.snd_settle_mode}get receiveSettleMode(){return this._link.rcv_settle_mode}get source(){return this._link.source}set source(e){this._link.set_source(e)}get target(){return this._link.target}set target(e){this._link.set_source(e)}get maxMessageSize(){return this._link.max_message_size}get offeredCapabilities(){return this._link.offered_capabilities}get desiredCapabilities(){return this._link.desired_capabilities}get address(){return this.source.address}get credit(){return this._link.credit}get session(){return this._session}get connection(){return this._session.connection}isOpen(){let e=!1;return this._session.isOpen()&&this._link.is_open()&&(e=!0),e}isRemoteOpen(){return this._link.is_remote_open()}hasCredit(){return this._link.has_credit()}isSender(){return this._link.is_sender()}isReceiver(){return this._link.is_receiver()}isClosed(){return this._link.is_closed()}isItselfClosed(){return this._link.is_itself_closed()}isSessionClosed(){return this._session.isClosed()}isSessionItselfClosed(){return this._session.isItselfClosed()}remove(){this._link&&(this.removeAllListeners(),this._link.removeAllListeners(),this._link.remove()),this._session&&this._session.remove()}close(e){return r.__awaiter(this,void 0,void 0,(function*(){e||(e={}),null==e.closeSession&&(e.closeSession=!0);const t=new Promise((e,t)=>{if(o.error("[%s] The %s '%s' on amqp session '%s' is open ? -> %s",this.connection.id,this.type,this.name,this.session.id,this.isOpen()),!this.isOpen())return e();{const n=this.type===u.sender?i.SenderEvents.senderError:i.ReceiverEvents.receiverError,r=this.type===u.sender?i.SenderEvents.senderClose:i.ReceiverEvents.receiverClose;let s,a,l,d;const h=()=>{clearTimeout(d),this.actionInitiated--,this._link.removeListener(n,s),this._link.removeListener(r,a),this._link.connection.removeListener(i.ConnectionEvents.disconnected,l)};a=t=>(h(),o[this.type]("[%s] Resolving the promise as the %s '%s' on amqp session '%s' has been closed.",this.connection.id,this.type,this.name,this.session.id),e()),s=e=>{h();let n=e.session.error;return this.type===u.sender&&e.sender&&e.sender.error?n=e.sender.error:this.type===u.receiver&&e.receiver&&e.receiver.error&&(n=e.receiver.error),o.error("[%s] Error occurred while closing %s '%s' on amqp session '%s': %O.",this.connection.id,this.type,this.name,this.session.id,n),t(n)},l=e=>{h();const t=e.connection&&e.connection.error?e.connection.error:e.error;o.error("[%s] Connection got disconnected while closing amqp %s '%s' on amqp session '%s': %O.",this.connection.id,this.type,this.name,this.session.id,t)};const p=()=>{h();const e=`Unable to close the ${this.type} '${this.name}' on amqp session '${this.session.id}' due to operation timeout.`;return o.error("[%s] %s",this.connection.id,e),t(new c.OperationTimeoutError(e))};this._link.once(r,a),this._link.once(n,s),this._link.connection.once(i.ConnectionEvents.disconnected,l),d=setTimeout(p,1e3*this.connection.options.operationTimeoutInSeconds),this._link.close(),this.actionInitiated++}});try{yield t}finally{this.removeAllListeners()}if(e.closeSession)return o[this.type]("[%s] %s '%s' has been closed, now closing it's amqp session '%s'.",this.connection.id,this.type,this.name,this.session.id),this._session.close()}))}_initializeEventListeners(){const e=this.type===u.sender?i.SenderEvents:i.ReceiverEvents;for(const t of Object.keys(e))this._link.on(e[t],n=>{const r={rheaContext:n,emitter:this,eventName:e[t],emitterType:this.type,connectionId:this.connection.id};s.emitEvent(r)});"function"==typeof this._link.eventNames&&o.eventHandler("[%s] rhea-promise '%s' object is listening for events: %o emitted by rhea's '%s' object.",this.connection.id,this.type,this._link.eventNames(),this.type),"function"==typeof this._link.listenerCount&&o.eventHandler("[%s] ListenerCount for event '%s_error' on rhea's '%s' object is: %d.",this.connection.id,this.type,this.type,this._link.listenerCount(this.type+"_error"))}}t.Link=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(31);class o extends r.EventEmitter{constructor(){super(),this.actionInitiated=0}}t.Entity=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(56);class o extends r.Link{constructor(e,t,n){super(r.LinkType.sender,e,t,n)}setDrained(e){this._link.set_drained(e)}sendable(){return this._link.sendable()}}t.BaseSender=o;t.SenderSendOptions=class{};t.Sender=class extends o{constructor(e,t,n){super(e,t,n)}send(e,t={}){return this._link.send(e,t.tag,t.format)}}},function(e,t,n){"use strict";var r=SyntaxError,o=Function,i=TypeError,s=function(e){try{return o('"use strict"; return ('+e+").constructor;")()}catch(e){}},a=Object.getOwnPropertyDescriptor;if(a)try{a({},"")}catch(e){a=null}var c=function(){throw new i},u=a?function(){try{return c}catch(e){try{return a(arguments,"callee").get}catch(e){return c}}}():c,l=n(107)(),d=Object.getPrototypeOf||function(e){return e.__proto__},h={},p="undefined"==typeof Uint8Array?void 0:d(Uint8Array),f={"%AggregateError%":"undefined"==typeof AggregateError?void 0:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"%ArrayIteratorPrototype%":l?d([][Symbol.iterator]()):void 0,"%AsyncFromSyncIteratorPrototype%":void 0,"%AsyncFunction%":h,"%AsyncGenerator%":h,"%AsyncGeneratorFunction%":h,"%AsyncIteratorPrototype%":h,"%Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"%BigInt%":"undefined"==typeof BigInt?void 0:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?void 0:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?void 0:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":h,"%Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":l?d(d([][Symbol.iterator]())):void 0,"%JSON%":"object"==typeof JSON?JSON:void 0,"%Map%":"undefined"==typeof Map?void 0:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&l?d((new Map)[Symbol.iterator]()):void 0,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?void 0:Promise,"%Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?void 0:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&l?d((new Set)[Symbol.iterator]()):void 0,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":l?d(""[Symbol.iterator]()):void 0,"%Symbol%":l?Symbol:void 0,"%SyntaxError%":r,"%ThrowTypeError%":u,"%TypedArray%":p,"%TypeError%":i,"%Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?void 0:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet},m={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},g=n(60),y=n(110),v=g.call(Function.call,Array.prototype.concat),b=g.call(Function.apply,Array.prototype.splice),_=g.call(Function.call,String.prototype.replace),w=g.call(Function.call,String.prototype.slice),E=g.call(Function.call,RegExp.prototype.exec),S=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,O=/\\(\\)?/g,C=function(e){var t=w(e,0,1),n=w(e,-1);if("%"===t&&"%"!==n)throw new r("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new r("invalid intrinsic syntax, expected opening `%`");var o=[];return _(e,S,(function(e,t,n,r){o[o.length]=n?_(r,O,"$1"):t||e})),o},I=function(e,t){var n,o=e;if(y(m,o)&&(o="%"+(n=m[o])[0]+"%"),y(f,o)){var a=f[o];if(a===h&&(a=function e(t){var n;if("%AsyncFunction%"===t)n=s("async function () {}");else if("%GeneratorFunction%"===t)n=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=s("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&(n=d(o.prototype))}return f[t]=n,n}(o)),void 0===a&&!t)throw new i("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:o,value:a}}throw new r("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new i("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new i('"allowMissing" argument must be a boolean');if(null===E(/^%?[^%]*%?$/g,e))throw new r("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=C(e),o=n.length>0?n[0]:"",s=I("%"+o+"%",t),c=s.name,u=s.value,l=!1,d=s.alias;d&&(o=d[0],b(n,v([0,1],d)));for(var h=1,p=!0;h<n.length;h+=1){var m=n[h],g=w(m,0,1),_=w(m,-1);if(('"'===g||"'"===g||"`"===g||'"'===_||"'"===_||"`"===_)&&g!==_)throw new r("property names with quotes must have matching quotes");if("constructor"!==m&&p||(l=!0),y(f,c="%"+(o+="."+m)+"%"))u=f[c];else if(null!=u){if(!(m in u)){if(!t)throw new i("base intrinsic for "+e+" exists, but the property is not available.");return}if(a&&h+1>=n.length){var S=a(u,m);u=(p=!!S)&&"get"in S&&!("originalValue"in S.get)?S.get:u[m]}else p=y(u,m),u=u[m];p&&!l&&(f[c]=u)}}return u}},function(e,t,n){"use strict";var r=n(109);e.exports=Function.prototype.bind||r},function(e,t,n){"use strict";var r=String.prototype.replace,o=/%20/g,i="RFC1738",s="RFC3986";e.exports={default:s,formatters:{RFC1738:function(e){return r.call(e,o,"+")},RFC3986:function(e){return String(e)}},RFC1738:i,RFC3986:s}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(45),o=n(10),i=n(2),s=n(5),a=n(4),c=n(13);class u{constructor(e,t,n){this.session=e,this.sender=t,this.receiver=n,this._responsesMap=new Map,this.session=e,this.sender=t,this.receiver=n,this.receiver.on(i.ReceiverEvents.message,e=>{!function(e,t,n){const r=e.message;if(!r)return void a.b.verbose(`[${t}] "message" property on the EventContext is "undefined" which is unexpected, returning from the "onMessageReceived" handler without resolving or rejecting the promise upon encountering the message event.`);const i=r.correlation_id;if(!n.has(i))return void a.b.verbose(`[${t}] correlationId "${i}" property on the response does not match with any of the "request-id"s in the map, returning from the "onMessageReceived" handler without resolving or rejecting the promise upon encountering the message event.`);const c=n.get(i);c.cleanupBeforeResolveOrReject();const u=n.delete(i);a.b.verbose(`[${t}] Successfully deleted the response with id ${i} from the map. Delete result - `+u);const l=((e={})=>({statusCode:e[s.a.statusCode]||e.statusCode,statusDescription:e[s.a.statusDescription]||e.statusDescription,errorCondition:e[s.a.errorCondition]||e.errorCondition}))(r.application_properties);let d;l.statusCode||(d=new Error(`[${t}] No statusCode in the "application_properties" in the returned response with correlation-id: ${i}`));if(l.statusCode>199&&l.statusCode<300)return a.b.verbose(`[${t}] Resolving the response with correlation-id: ${i}`),c.resolve(r);if(!d){const e=l.errorCondition||o.a[l.statusCode]||"amqp:internal-error";d=Object(o.e)({condition:e,description:l.statusDescription}),a.b.warning(`${null==d?void 0:d.name}: ${null==d?void 0:d.message}`)}Object(a.a)(d),c.reject(d)}(e,this.connection.id,this._responsesMap)})}get connection(){return this.session.connection}isOpen(){return this.session.isOpen()&&this.sender.isOpen()&&this.receiver.isOpen()}sendRequest(e,t={}){const n=t.timeoutInMs||s.a.defaultOperationTimeoutInMs,u=t.abortSignal;return e.message_id||(e.message_id=Object(i.generate_uuid)()),new Promise((i,l)=>{let d=void 0;const h=()=>{this._responsesMap.delete(e.message_id);const n=this.receiver.address||"address",o=t.requestName,i=`[${this.connection.id}] The request "${o}" to "${n}" has been cancelled by the user.`;a.b.info(i);const c=new r.b(s.b);l(c)},p=()=>{Object(c.a)(d)&&clearTimeout(d),u.removeEventListener("abort",p),h()};if(u){if(u.aborted)return h();u.addEventListener("abort",p)}d=setTimeout(()=>{this._responsesMap.delete(e.message_id),u&&u.removeEventListener("abort",p);const t=this.receiver.address||"address",n={name:"OperationTimeoutError",message:`The request with message_id "${e.message_id}" to "${t}" endpoint timed out. Please try again later.`};return l(Object(o.e)(n))},n),this._responsesMap.set(e.message_id,{resolve:i,reject:l,cleanupBeforeResolveOrReject:()=>{u&&u.removeEventListener("abort",p),Object(c.a)(d)&&clearTimeout(d)}}),a.b.verbose("[%s] %s request sent: %O",this.connection.id,e.to||"$management",e),this.sender.send(e)})}async close(){await this.sender.close({closeSession:!1}),await this.receiver.close({closeSession:!1}),await this.session.close()}remove(){this.sender.remove(),this.receiver.remove(),this.session.remove()}static async create(e,t,n,r={}){const{abortSignal:o}=r,i=await e.createSession({abortSignal:o}),s=await i.createSender(Object.assign(Object.assign({},t),{abortSignal:o})),c=await i.createReceiver(Object.assign(Object.assign({},n),{abortSignal:o}));return a.b.verbose("[%s] Successfully created the sender and receiver links on the same session.",e.id),new u(i,s,c)}}},function(e,t){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(26),o=n(49);class i{constructor(e){var t,n,i,s,a,c,u;this.url=e.url,this.body=e.body,this.headers=null!==(t=e.headers)&&void 0!==t?t:Object(r.a)(),this.method=null!==(n=e.method)&&void 0!==n?n:"GET",this.timeout=null!==(i=e.timeout)&&void 0!==i?i:0,this.formData=e.formData,this.disableKeepAlive=null!==(s=e.disableKeepAlive)&&void 0!==s&&s,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=null!==(a=e.withCredentials)&&void 0!==a&&a,this.abortSignal=e.abortSignal,this.tracingOptions=e.tracingOptions,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||Object(o.a)(),this.allowInsecureConnection=null!==(c=e.allowInsecureConnection)&&void 0!==c&&c,this.enableBrowserStreams=null!==(u=e.enableBrowserStreams)&&void 0!==u&&u}}function s(e){return new i(e)}},,,function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(r){function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":o(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))})),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(93)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(16))},function(e,t,n){"use strict";var r=n(27),o=n(42),i=n(70),s=n(29),a=0,c=1,u=2,l=3,d=4;var h=function(e){this.callback=e,this.outcome=void 0,this.username=void 0};h.prototype.start=function(e,t){var n=function(e){for(var t=[],n=0,r=0;r<e.length;)0===e[r]?(r>n?t.push(e.toString("utf8",n,r)):t.push(null),n=++r):++r;return r>n?t.push(e.toString("utf8",n,r)):t.push(null),t}(e);if(3!==n.length)return Promise.reject("Unexpected response in PLAIN, got "+n.length+" fields, expected 3");var r=this;return Promise.resolve(this.callback(n[1],n[2],t)).then((function(e){e?(r.outcome=!0,r.username=n[1]):r.outcome=!1}))};var p=function(e,t){this.username=e,this.password=t};p.prototype.start=function(e){var t=s.allocate_buffer(1+this.username.length+1+this.password.length);t.writeUInt8(0,0),t.write(this.username,1),t.writeUInt8(0,1+this.username.length),t.write(this.password,1+this.username.length+1),e(void 0,t)};var f=function(){this.outcome=void 0,this.username=void 0};f.prototype.start=function(e){this.outcome=!0,this.username=e?e.toString("utf8"):"anonymous"};var m=function(e){this.username=e||"anonymous"};m.prototype.start=function(e){var t=s.allocate_buffer(1+this.username.length);t.writeUInt8(0,0),t.write(this.username,1),e(void 0,t)};var g=function(){this.outcome=void 0,this.username=void 0};g.prototype.start=function(){this.outcome=!0};var y=function(){this.username=void 0};y.prototype.start=function(e){e(void 0,"")},y.prototype.step=function(e){e(void 0,"")};var v=function(e,t){this.username=e,this.token=t};v.prototype.start=function(e){var t=s.allocate_buffer(this.username.length+this.token.length+5+12+3),n=0;t.write("user=",n),n+=5,t.write(this.username,n),n+=this.username.length,t.writeUInt8(1,n),n+=1,t.write("auth=Bearer ",n),n+=12,t.write(this.token,n),n+=this.token.length,t.writeUInt8(1,n),n+=1,t.writeUInt8(1,n),n+=1,e(void 0,t)};var b=function(e,t){this.connection=e,this.transport=new i(e.amqp_transport.identifier,3,o.TYPE_SASL,this),this.next=e.amqp_transport,this.mechanisms=t,this.mechanism=void 0,this.outcome=void 0,this.username=void 0;var n=Object.getOwnPropertyNames(t);this.transport.encode(o.sasl_frame(o.sasl_mechanisms({sasl_server_mechanisms:n})))};b.prototype.do_step=function(e){if(void 0===this.mechanism.outcome)this.transport.encode(o.sasl_frame(o.sasl_challenge({challenge:e}))),this.connection.output();else{this.outcome=this.mechanism.outcome?a:c;var t=o.sasl_frame(o.sasl_outcome({code:this.outcome}));this.transport.encode(t),this.connection.output(),this.outcome===a&&(this.username=this.mechanism.username,this.transport.write_complete=!0,this.transport.read_complete=!0)}},b.prototype.on_sasl_init=function(e){var t=this.mechanisms[e.performative.mechanism];t?(this.mechanism=t(),Promise.resolve(this.mechanism.start(e.performative.initial_response,e.performative.hostname)).then(this.do_step.bind(this)).catch(this.do_fail.bind(this))):(this.outcome=c,this.transport.encode(o.sasl_frame(o.sasl_outcome({code:this.outcome}))))},b.prototype.on_sasl_response=function(e){Promise.resolve(this.mechanism.step(e.performative.response)).then(this.do_step.bind(this)).catch(this.do_fail.bind(this))},b.prototype.do_fail=function(e){var t=o.sasl_frame(o.sasl_outcome({code:u}));this.transport.encode(t),this.connection.output();try{this.connection.sasl_failed("Sasl callback promise failed with "+e,"amqp:internal-error")}catch(e){console.error("Uncaught error: ",e.message)}},b.prototype.has_writes_pending=function(){return this.transport.has_writes_pending()||this.next.has_writes_pending()},b.prototype.write=function(e){return this.transport.write_complete&&0===this.transport.pending.length?this.next.write(e):this.transport.write(e)},b.prototype.read=function(e){return this.transport.read_complete?this.next.read(e):this.transport.read(e)};var _=function(e,t,n){this.connection=e,this.transport=new i(e.amqp_transport.identifier,3,o.TYPE_SASL,this),this.next=e.amqp_transport,this.mechanisms=t,this.mechanism=void 0,this.mechanism_name=void 0,this.hostname=n,this.failed=!1};_.prototype.on_sasl_mechanisms=function(e){var t=[];Array.isArray(e.performative.sasl_server_mechanisms)?t=e.performative.sasl_server_mechanisms:e.performative.sasl_server_mechanisms&&(t=[e.performative.sasl_server_mechanisms]);for(var n=0;void 0===this.mechanism&&n<t.length;n++){var r=t[n],i=this.mechanisms[r];i&&(this.mechanism="function"==typeof i?i():i,this.mechanism_name=r)}if(this.mechanism){var s=this;this.mechanism.start((function(e,t){if(e)s.failed=!0,s.connection.sasl_failed("SASL mechanism init failed: "+e);else{var n={mechanism:s.mechanism_name,initial_response:t};s.hostname&&(n.hostname=s.hostname),s.transport.encode(o.sasl_frame(o.sasl_init(n))),s.connection.output()}}))}else this.failed=!0,this.connection.sasl_failed("No suitable mechanism; server supports "+e.performative.sasl_server_mechanisms)},_.prototype.on_sasl_challenge=function(e){var t=this;this.mechanism.step(e.performative.challenge,(function(e,n){e?(t.failed=!0,t.connection.sasl_failed("SASL mechanism challenge failed: "+e)):(t.transport.encode(o.sasl_frame(o.sasl_response({response:n}))),t.connection.output())}))},_.prototype.on_sasl_outcome=function(e){switch(e.performative.code){case a:this.transport.read_complete=!0,this.transport.write_complete=!0;break;case u:case l:case d:this.transport.write_complete=!0,this.connection.sasl_failed("Failed to authenticate: "+e.performative.code,"amqp:internal-error");break;default:this.transport.write_complete=!0,this.connection.sasl_failed("Failed to authenticate: "+e.performative.code)}},_.prototype.has_writes_pending=function(){return this.transport.has_writes_pending()||this.next.has_writes_pending()},_.prototype.write=function(e){return this.transport.write_complete?this.next.write(e):this.transport.write(e)},_.prototype.read=function(e){return this.transport.read_complete?this.next.read(e):this.transport.read(e)};var w=function(e,t){this.header_received=!1,this.transports={0:e.amqp_transport,3:new b(e,t)},this.selected=void 0};w.prototype.has_writes_pending=function(){return this.header_received&&this.selected.has_writes_pending()},w.prototype.write=function(e){return this.selected?this.selected.write(e):0},w.prototype.read=function(e){if(!this.header_received){if(e.length<8)return 0;if(this.header_received=o.read_header(e),this.selected=this.transports[this.header_received.protocol_id],void 0===this.selected)throw new r.ProtocolError("Invalid AMQP protocol id "+this.header_received.protocol_id)}return this.selected.read(e)};var E={enable_anonymous:function(){this.ANONYMOUS=function(){return new f}},enable_plain:function(e){this.PLAIN=function(){return new h(e)}}},S={enable_anonymous:function(e){this.ANONYMOUS=function(){return new m(e)}},enable_plain:function(e,t){this.PLAIN=function(){return new p(e,t)}},enable_external:function(){this.EXTERNAL=function(){return new y}},enable_xoauth2:function(e,t){if(e&&t)this.XOAUTH2=function(){return new v(e,t)};else{if(void 0===t)throw Error("token must be specified");if(void 0===e)throw Error("username must be specified")}}};e.exports={Client:_,Server:b,Selective:w,server_mechanisms:function(){return Object.create(E)},client_mechanisms:function(){return Object.create(S)},server_add_external:function(e){return e.EXTERNAL=function(){return new g},e}}},function(e,t,n){"use strict";var r=n(27),o=n(42),i=n(30),s=n(29),a=function(e,t,n,r){this.identifier=e,this.protocol_id=t,this.frame_type=n,this.handler=r,this.pending=[],this.header_sent=void 0,this.header_received=void 0,this.write_complete=!1,this.read_complete=!1};a.prototype.has_writes_pending=function(){return this.pending.length>0||!this.header_sent},a.prototype.encode=function(e){this.pending.push(e)},a.prototype.write=function(e){if(!this.header_sent){var t=s.allocate_buffer(8),n={protocol_id:this.protocol_id,major:1,minor:0,revision:0};i.frames("[%s] -> %o",this.identifier,n),o.write_header(t,n),e.write(t),this.header_sent=n}for(var r=0;r<this.pending.length;r++){var a=this.pending[r];t=o.write_frame(a);e.write(t),a.performative?i.frames("[%s]:%s -> %s %j",this.identifier,a.channel,a.performative.constructor,a.performative,a.payload||""):i.frames("[%s]:%s -> empty",this.identifier,a.channel),i.raw("[%s] SENT: %d %h",this.identifier,t.length,t)}this.pending=[]},a.prototype.read=function(e){var t=0;if(!this.header_received){if(e.length<8)return t;if(this.header_received=o.read_header(e),i.frames("[%s] <- %o",this.identifier,this.header_received),this.header_received.protocol_id!==this.protocol_id)throw 3===this.protocol_id&&0===this.header_received.protocol_id?new r.ProtocolError("Expecting SASL layer"):0===this.protocol_id&&3===this.header_received.protocol_id?new r.ProtocolError("SASL layer not enabled"):new r.ProtocolError("Invalid AMQP protocol id "+this.header_received.protocol_id+" expecting: "+this.protocol_id);t=8}for(;t<e.length-4&&!this.read_complete;){var n=e.readUInt32BE(t);if(i.io("[%s] got frame of size %d",this.identifier,n),e.length<t+n){i.io("[%s] incomplete frame; have only %d of %d",this.identifier,e.length-t,n);break}var s=e.slice(t,t+n);i.raw("[%s] RECV: %d %h",this.identifier,s.length,s);var a=o.read_frame(s);if(a.performative?i.frames("[%s]:%s <- %s %j",this.identifier,a.channel,a.performative.constructor,a.performative,a.payload||""):i.frames("[%s]:%s <- empty",this.identifier,a.channel),a.type!==this.frame_type)throw new r.ProtocolError("Invalid frame type: "+a.type);t+=n,a.performative&&a.performative.dispatch(this.handler,a)}return t},e.exports=a},function(e,t){},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(54),o=n(55),i=n(56),s=n(32);!function(e){e.translate=function(e,t,n){const a=t instanceof r.Connection?t:t.connection;s.contextTranslator("[%s] Translating the context for event: '%s'.",a.id,n);const c=Object.assign({_context:e},e);return c.connection=a,c.container=a.container,t instanceof i.Link?(c.session=t.session,t.type===i.LinkType.receiver&&e.receiver?c.receiver=t:t.type===i.LinkType.sender&&e.sender&&(c.sender=t)):t instanceof o.Session&&(c.session=t),c}}(t.EventContext||(t.EventContext={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(56);class o extends r.Link{constructor(e,t,n){super(r.LinkType.receiver,e,t,n)}get drain(){return this._link.drain}set drain(e){this._link.drain=e}addCredit(e){this._link.add_credit(e)}drainCredit(){this._link.drain_credit()}setCreditWindow(e){this._link.set_credit_window(e)}}t.Receiver=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(25),o=n(32),i=n(58),s=n(25),a=n(44),c=n(43);class u extends i.BaseSender{constructor(e,t,n={}){super(e,t,n),this.deliveryDispositionMap=new Map;const i=e=>{const t=e.id;if(this.deliveryDispositionMap.has(e.id)){const n=this.deliveryDispositionMap.get(t);clearTimeout(n.timer);const r=this.deliveryDispositionMap.delete(t);return o.sender("[%s] Event: 'Accepted', Successfully deleted the delivery with id %d from the map of sender '%s' on amqp session '%s' and cleared the timer: %s.",this.connection.id,t,this.name,this.session.id,r),n.resolve(e)}},c=(e,t,n)=>{if(this.deliveryDispositionMap.has(t)){const r=this.deliveryDispositionMap.get(t);clearTimeout(r.timer);const i=this.deliveryDispositionMap.delete(t);o.sender("[%s] Event: '%s', Successfully deleted the delivery with id %d from the  map of sender '%s' on amqp session '%s' and cleared the timer: %s.",this.connection.id,e,t,this.name,this.session.id,i);const s=`Sender '${this.name}' on amqp session '${this.session.id}', received a '${e}' disposition. Hence we are rejecting the promise.`,c=new a.SendOperationFailedError(s,e,n);return o.error("[%s] %s",this.connection.id,s),r.reject(c)}},u=(e,t)=>{for(const n of this.deliveryDispositionMap.keys())c(e,n,t)};this.on(s.SenderEvents.accepted,e=>{i(e.delivery)}),this.on(s.SenderEvents.rejected,e=>{const t=e.delivery;c(s.SenderEvents.rejected,t.id,t.remote_state&&t.remote_state.error)}),this.on(s.SenderEvents.released,e=>{const t=e.delivery;c(s.SenderEvents.released,t.id,t.remote_state&&t.remote_state.error)}),this.on(s.SenderEvents.modified,e=>{const t=e.delivery;c(s.SenderEvents.modified,t.id,t.remote_state&&t.remote_state.error)}),n.onError||this.on(s.SenderEvents.senderError,e=>{u(s.SenderEvents.senderError,e.sender.error)}),n.onSessionError||this.session.on(r.SessionEvents.sessionError,e=>{u(r.SessionEvents.sessionError,e.session.error)})}send(e,t={}){return new Promise((n,r)=>{o.sender("[%s] Sender '%s' on amqp session '%s', credit: %d available: %d",this.connection.id,this.name,this.session.id,this.credit,this.session.outgoing.available());const i=t&&t.abortSignal,s=t.timeoutInSeconds||20;if(i&&i.aborted){const e=c.createAbortError();return o.error("[%s] %s",this.connection.id,e.message),r(e)}if(this.sendable()){const u=setTimeout(()=>{this.deliveryDispositionMap.delete(h.id);const e=`Sender '${this.name}' on amqp session '${this.session.id}', with address '${this.address}' was not able to send the message with delivery id ${h.id} right now, due to operation timeout.`;return o.error("[%s] %s",this.connection.id,e),r(new a.OperationTimeoutError(e))},1e3*s),l=()=>{if(this.deliveryDispositionMap.has(h.id)){const e=this.deliveryDispositionMap.get(h.id);clearTimeout(e.timer);const t=this.deliveryDispositionMap.delete(h.id);o.sender("[%s] Event: 'abort', Successfully deleted the delivery with id %d from the  map of sender '%s' on amqp session '%s' and cleared the timer: %s.",this.connection.id,h.id,this.name,this.session.id,t);const n=c.createAbortError();o.error("[%s] %s",this.connection.id,n.message),e.reject(n)}},d=()=>{i&&i.removeEventListener("abort",l)},h=this._link.send(e,t.tag,t.format);this.deliveryDispositionMap.set(h.id,{resolve:e=>{n(e),d()},reject:e=>{r(e),d()},timer:u}),i&&i.addEventListener("abort",l)}else{const e=`Sender "${this.name}" on amqp session "${this.session.id}", with address `+this.address+" cannot send the message right now as it does not have enough credit. Please try later.";o.error("[%s] %s",this.connection.id,e),r(new a.InsufficientCreditError(e))}})}}t.AwaitableSender=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8),o=n(25),i=n(31),s=n(54);class a extends i.EventEmitter{constructor(e){e||(e={}),super(),e.createdInstance?(this._container=e.createdInstance,delete e.createdInstance):this._container=o.create_container(e),this.options=this._container.options}get id(){return this._container.id}get filter(){return this._container.filter}get types(){return this._container.types}get message(){return this._container.message}get sasl(){return this._container.sasl}get saslServerMechanisms(){return this._container.sasl_server_mechanisms}createConnection(e){const t=this._container.create_connection(e);return new s.Connection({rheaConnection:t,container:this})}connect(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.createConnection(e).open()}))}listen(e){return this._container.listen(e)}generateUUid(){return this._container.generate_uuid()}stringToUuid(e){return this._container.string_to_uuid(e)}uuidToString(e){return this._container.uuid_to_string(e)}websocketAccept(e,t){return this._container.websocket_accept(e,t)}websocketConnect(e){return this._container.websocket_connect(e)}static create(e){return new a(e)}static copyFromContainerInstance(e){return new a({createdInstance:e})}}t.Container=a},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r}));var r="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e?e:{}}).call(this,n(67))},function(e,t,n){"use strict";var r=n(61),o=Object.prototype.hasOwnProperty,i=Array.isArray,s=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var o=t[r],s=o.obj[o.prop],a=Object.keys(s),c=0;c<a.length;++c){var u=a[c],l=s[u];"object"==typeof l&&null!==l&&-1===n.indexOf(l)&&(t.push({obj:s,prop:u}),n.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(i(n)){for(var r=[],o=0;o<n.length;++o)void 0!==n[o]&&r.push(n[o]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n,o,i){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",u=0;u<a.length;++u){var l=a.charCodeAt(u);45===l||46===l||95===l||126===l||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||i===r.RFC1738&&(40===l||41===l)?c+=a.charAt(u):l<128?c+=s[l]:l<2048?c+=s[192|l>>6]+s[128|63&l]:l<55296||l>=57344?c+=s[224|l>>12]+s[128|l>>6&63]+s[128|63&l]:(u+=1,l=65536+((1023&l)<<10|1023&a.charCodeAt(u)),c+=s[240|l>>18]+s[128|l>>12&63]+s[128|l>>6&63]+s[128|63&l])}return c},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(i(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},merge:function e(t,n,r){if(!n)return t;if("object"!=typeof n){if(i(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(r&&(r.plainObjects||r.allowPrototypes)||!o.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var s=t;return i(t)&&!i(n)&&(s=a(t,r)),i(t)&&i(n)?(n.forEach((function(n,i){if(o.call(t,i)){var s=t[i];s&&"object"==typeof s&&n&&"object"==typeof n?t[i]=e(s,n,r):t.push(n)}else t[i]=n})),t):Object.keys(n).reduce((function(t,i){var s=n[i];return o.call(t,i)?t[i]=e(t[i],s,r):t[i]=s,t}),s)}}},function(e,t,n){"use strict";function r(...e){if(e.length>0){const t=String(e[0]);t.includes(":error")?console.error(...e):t.includes(":warning")?console.warn(...e):t.includes(":info")?console.info(...e):(t.includes(":verbose"),console.debug(...e))}}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(45),o=n(2),i=n(5),s=n(4);class a{constructor(){this._keyMap=new Map,this._executionRunningSet=new Set}acquire(e,t,n){var a;const{abortSignal:c,timeoutInMs:u}=n;if(null==c?void 0:c.aborted)return Promise.reject(new r.b(i.b));const l=null!==(a=this._keyMap.get(e))&&void 0!==a?a:[];this._keyMap.set(e,l);const{promise:d,rejecter:h,resolver:p}=function(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolver:e,rejecter:t}}(),f={reject:h,resolve:p,task:t};if("number"==typeof u){const t=setTimeout(()=>{this._removeTaskDetails(e,f),h(new o.OperationTimeoutError("The task timed out waiting to acquire a lock for "+e))},u);f.tid=t}if(c){const t=()=>{this._removeTaskDetails(e,f),h(new r.b(i.b))};c.addEventListener("abort",t),f.abortSignal=c,f.abortListener=t}return l.push(f),s.b.verbose(`Called acquire() for lock "${e}". Lock "${e}" has ${l.length} pending tasks.`),this._execute(e),d}async _execute(e){if(this._executionRunningSet.has(e))return;const t=this._keyMap.get(e);if(t&&t.length){for(this._executionRunningSet.add(e);t.length;){const n=t.shift();if(n){try{s.b.verbose(`Acquired lock for "${e}", invoking task.`),c(n);const t=await n.task();n.resolve(t)}catch(e){n.reject(e)}s.b.verbose(`Task completed for lock "${e}". Lock "${e}" has ${t.length} pending tasks.`)}}this._executionRunningSet.delete(e)}}_removeTaskDetails(e,t){const n=this._keyMap.get(e);if(!n||!n.length)return;const r=n.indexOf(t);if(-1!==r){const[e]=n.splice(r,1);c(e)}}}function c(e){e.tid&&clearTimeout(e.tid),e.abortSignal&&e.abortListener&&e.abortSignal.removeEventListener("abort",e.abortListener)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g}));var r=n(5),o=n(13),i=n(10),s=n(62),a=n(14),c=n(84),u=n(2),l=n(0),d=n(9),h=n(36),p=n(11),f=n(21),m=n(49);class g extends h.a{constructor(e,t){super(e,{address:t&&t.address?t.address:r.a.management,audience:t&&t.audience?t.audience:e.config.getManagementAudience()}),this.managementLock=`${r.a.managementRequestKey}-${Object(m.a)()}`,this.replyTo=Object(m.a)(),this._context=e,this.entityPath=e.config.entityPath}async getSecurityToken(){if(Object(o.c)(this._context.tokenCredential)){const e=this.audience.split("/");e[e.length-1]===this.address&&e.pop();const t=e.join("/");return this._context.tokenCredential.getToken(t)}return this._context.tokenCredential.getToken(r.a.aadEventHubsScope)}async getEventHubProperties(t={}){return Object(d.c)(this._context),p.b.withSpan("ManagementClient.getEventHubProperties",t,async t=>{try{const n=await this.getSecurityToken(),o={body:e.from(JSON.stringify([])),message_id:Object(m.a)(),reply_to:this.replyTo,application_properties:{operation:r.a.readOperation,name:this.entityPath,type:`${r.a.vendorString}:${r.a.eventHub}`,security_token:null==n?void 0:n.token}},i=await this._makeManagementRequest(o,Object.assign(Object.assign({},t),{requestName:"getHubRuntimeInformation"})),s={name:i.name,createdOn:new Date(i.created_at),partitionIds:i.partition_ids};return l.b.verbose("[%s] The hub runtime info is: %O",this._context.connectionId,s),s}catch(e){throw l.b.warning(`An error occurred while getting the hub runtime information: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(l.a)(e),e}},Object(p.a)(this._context.config))}async getPartitionProperties(t,n={}){return Object(d.c)(this._context),Object(d.d)(this._context.connectionId,"getPartitionProperties","partitionId",t),t=String(t),p.b.withSpan("ManagementClient.getPartitionProperties",n,async n=>{try{const o=await this.getSecurityToken(),i={body:e.from(JSON.stringify([])),message_id:Object(m.a)(),reply_to:this.replyTo,application_properties:{operation:r.a.readOperation,name:this.entityPath,type:`${r.a.vendorString}:${r.a.partition}`,partition:""+t,security_token:null==o?void 0:o.token}},s=await this._makeManagementRequest(i,Object.assign(Object.assign({},n),{requestName:"getPartitionInformation"})),a={beginningSequenceNumber:s.begin_sequence_number,eventHubName:s.name,lastEnqueuedOffset:s.last_enqueued_offset,lastEnqueuedOnUtc:new Date(s.last_enqueued_time_utc),lastEnqueuedSequenceNumber:s.last_enqueued_sequence_number,partitionId:s.partition,isEmpty:s.is_partition_empty};return l.b.verbose("[%s] The partition info is: %O.",this._context.connectionId,a),a}catch(e){throw l.b.warning(`An error occurred while getting the partition information: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(l.a)(e),e}},Object(p.a)(this._context.config))}async close(){try{if(clearTimeout(this._tokenRenewalTimer),this._isMgmtRequestResponseLinkOpen()){const e=this._mgmtReqResLink;this._mgmtReqResLink=void 0,await e.close(),l.b.info("Successfully closed the management session.")}}catch(e){const t=`An error occurred while closing the management session: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`;throw l.b.warning(t),Object(l.a)(e),new Error(t)}}async _init({abortSignal:e,timeoutInMs:t}){try{if(!this._isMgmtRequestResponseLinkOpen()){await this._context.readyToOpenLink(),await this._negotiateClaim({setTokenRenewal:!1,abortSignal:e,timeoutInMs:t});const n={source:{address:this.address},name:this.replyTo,target:{address:this.replyTo},onSessionError:e=>{const t=e.connection.options.id,n=Object(i.e)(e.session.error);l.b.verbose("[%s] An error occurred on the session for request/response links for $management: %O",t,n)}},r={target:{address:this.address}};l.b.verbose("[%s] Creating sender/receiver links on a session for $management endpoint with srOpts: %o, receiverOpts: %O.",this._context.connectionId,r,n),this._mgmtReqResLink=await s.a.create(this._context.connection,r,n,{abortSignal:e}),this._mgmtReqResLink.sender.on(u.SenderEvents.senderError,e=>{const t=e.connection.options.id,n=Object(i.e)(e.sender.error);l.b.verbose("[%s] An error occurred on the $management sender link.. %O",t,n)}),this._mgmtReqResLink.receiver.on(u.ReceiverEvents.receiverError,e=>{const t=e.connection.options.id,n=Object(i.e)(e.receiver.error);l.b.verbose("[%s] An error occurred on the $management receiver link.. %O",t,n)}),l.b.verbose("[%s] Created sender '%s' and receiver '%s' links for $management endpoint.",this._context.connectionId,this._mgmtReqResLink.sender.name,this._mgmtReqResLink.receiver.name),await this._ensureTokenRenewal()}}catch(e){const t=Object(i.e)(e);throw l.b.warning(`[${this._context.connectionId}] An error occured while establishing the $management links: ${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(l.a)(t),t}}async _makeManagementRequest(e,t={}){const n=t.retryOptions||{};try{const r=t&&t.abortSignal,o=async()=>{const n=Object(f.a)(t.retryOptions);let o=0;if(!this._isMgmtRequestResponseLinkOpen()){l.b.verbose("[%s] Acquiring lock to get the management req res link.",this._context.connectionId);const e=Date.now();try{await a.a.acquire(this.managementLock,()=>{const t=Date.now(),o=n-(t-e);return this._init({abortSignal:r,timeoutInMs:o})},{abortSignal:r,timeoutInMs:n})}catch(e){const t=Object(i.e)(e);throw l.b.warning("[%s] An error occurred while creating the management link %s: %s",this._context.connectionId,this.name,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(l.a)(t),t}o=Date.now()-e}const s=n-o,c={abortSignal:t.abortSignal,requestName:t.requestName,timeoutInMs:s};return e.message_id||(e.message_id=Object(u.generate_uuid)()),this._mgmtReqResLink.sendRequest(e,c)},s=Object.defineProperties({operation:o,operationType:c.b.management,abortSignal:r,retryOptions:n},{connectionId:{enumerable:!0,get:()=>this._context.connectionId}});return(await Object(c.c)(s)).body}catch(e){const t=Object(i.e)(e);throw l.b.warning("[%s] An error occurred during send on management request-response link with address '%s': %s",this._context.connectionId,this.address,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(l.a)(t),t}}_isMgmtRequestResponseLinkOpen(){return this._mgmtReqResLink&&this._mgmtReqResLink.isOpen()}}}).call(this,n(19).Buffer)},function(e,t,n){"use strict";(function(e){function r(t,n){const r=function(t){const n=function(e,t=0,n=0){let r,i,s;r=i=s=3735928559+e.length+t,s+=n;let a=0,c=e.length;for(;c>12;)r+=o(e,a),i+=o(e,a+4),s+=o(e,a+8),r-=s,r^=s<<4|s>>>28,s+=i,i-=r,i^=r<<6|r>>>26,r+=s,s-=i,s^=i<<8|i>>>24,i+=r,r-=s,r^=s<<16|s>>>16,s+=i,i-=r,i^=r<<19|r>>>13,r+=s,s-=i,s^=i<<4|i>>>28,i+=r,a+=12,c-=12;let u=c;switch(u){case 12:r+=o(e,a),i+=o(e,a+4),s+=o(e,a+8);break;case 11:s+=e[a+10]<<16,u=10;case 10:s+=e[a+9]<<8,u=9;case 9:s+=e[a+8],u=8;case 8:i+=o(e,a+4),r+=o(e,a);break;case 7:i+=e[a+6]<<16,u=6;case 6:i+=e[a+5]<<8,u=5;case 5:i+=e[a+4],u=4;case 4:r+=o(e,a);break;case 3:r+=e[a+2]<<16,u=2;case 2:r+=e[a+1]<<8,u=1;case 1:r+=e[a];break;case 0:return{b:i>>>0,c:s>>>0}}return s^=i,s-=i<<14|i>>>18,r^=s,r-=s<<11|s>>>21,i^=r,i-=r<<25|r>>>7,s^=i,s-=i<<16|i>>>16,r^=s,r-=s<<4|s>>>28,i^=r,i-=r<<14|r>>>18,s^=i,s-=i<<24|i>>>8,{b:i>>>0,c:s>>>0}}(e.from(t,"utf8"));return r=n.c^n.b,new Int16Array([r])[0];var r}(t);return Math.abs(r%n)}function o(e,t){return e.readUInt32LE(t)}n.d(t,"a",(function(){return r}))}).call(this,n(19).Buffer)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r}));const r=void 0!==e&&!!e.version&&!!e.versions&&!!e.versions.node}).call(this,n(16))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return d}));var r=n(10),o=n(5);var i,s,a=n(14),c=n(4);function u(e){let t=!1;return e&&"number"==typeof e.id&&"boolean"==typeof e.settled&&"boolean"==typeof e.remote_settled&&"number"==typeof e.format&&(t=!0),t}function l(e,t,n,r){if(r===i.Exponential){const r=(.8*t+Math.floor(Math.random()*(1.2*t-.8*t)))*(Math.pow(2,e)-1);return Math.min(r,n)}return t}async function d(e){let t,n;!function(e){if(!e.operation)throw new TypeError("Missing 'operation' in retry configuration");if(!e.connectionId)throw new TypeError("Missing 'connectionId' in retry configuration");if(!e.operationType)throw new TypeError("Missing 'operationType' in retry configuration")}(e),e.retryOptions||(e.retryOptions={}),(null==e.retryOptions.maxRetries||e.retryOptions.maxRetries<0)&&(e.retryOptions.maxRetries=o.a.defaultMaxRetries),(null==e.retryOptions.retryDelayInMs||e.retryOptions.retryDelayInMs<0)&&(e.retryOptions.retryDelayInMs=o.a.defaultDelayBetweenOperationRetriesInMs),(null==e.retryOptions.maxRetryDelayInMs||e.retryOptions.maxRetryDelayInMs<0)&&(e.retryOptions.maxRetryDelayInMs=o.a.defaultMaxDelayForExponentialRetryInMs),null==e.retryOptions.mode&&(e.retryOptions.mode=i.Fixed);let s=!1;const d=e.retryOptions.maxRetries+1;for(let o=1;o<=d;o++){c.b.verbose("[%s] Attempt number for '%s': %d.",e.connectionId,e.operationType,o);try{n=await e.operation(),s=!0,c.b.verbose("[%s] Success for '%s', after attempt number: %d.",e.connectionId,e.operationType,o),n&&!u(n)&&c.b.verbose("[%s] Success result for '%s': %O",e.connectionId,e.operationType,n);break}catch(n){let i=n;if(i.translated||(i=Object(r.e)(i)),!i.retryable&&"ServiceCommunicationError"===i.name&&e.connectionHost){await(e.connectionHost,Promise.resolve(self.navigator.onLine))||(i.name="ConnectionLostError",i.retryable=!0)}if(t=i,c.b.verbose("[%s] Error occurred for '%s' in attempt number %d: %O",e.connectionId,e.operationType,o,i),t&&t.retryable&&d>o){const t=l(o,e.retryOptions.retryDelayInMs,e.retryOptions.maxRetryDelayInMs,e.retryOptions.mode);c.b.verbose("[%s] Sleeping for %d milliseconds for '%s'.",e.connectionId,t,e.operationType),await Object(a.b)(t,e.abortSignal,"The retry operation has been cancelled by the user.");continue}break}}if(s)return n;throw t}!function(e){e[e.Exponential=0]="Exponential",e[e.Fixed=1]="Fixed"}(i||(i={})),function(e){e.cbsAuth="cbsAuth",e.connection="connection",e.management="management",e.receiverLink="receiverLink",e.senderLink="senderLink",e.sendMessage="sendMessage",e.receiveMessage="receiveMessage",e.session="session",e.messageSettlement="settlement"}(s||(s={}))},,function(e,t,n){const{EventHubProducerClient:r,EventHubConsumerClient:o}=n(117),{ClientSecretCredential:i}=n(116),{SchemaRegistryClient:s}=n(118);flutterAzureEventHubs={},flutterAzureEventHubs.eventHubProducerClient=r,flutterAzureEventHubs.eventHubConsumerClient=o,flutterAzureEventHubs.clientSecretCredential=i,flutterAzureEventHubs.schemaRegistryClient=s,flutterAzureEventHubs.instances={},flutterAzureEventHubs.instances.eventHubProducerClientList=[],flutterAzureEventHubs.instances.eventHubConsumerClientList=[],flutterAzureEventHubs.instances.subscriptionList=[],flutterAzureEventHubs.instances.clientSecretCredentialList=[],flutterAzureEventHubs.instances.schemaRegistryClientList=[],flutterAzureEventHubs.api={},flutterAzureEventHubs.setEventHubProducerClient=function(e,t){flutterAzureEventHubs.instances.eventHubProducerClientList.push({key:e,value:t})},flutterAzureEventHubs.getEventHubProducerClientByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.eventHubProducerClientList.length;t++)if(flutterAzureEventHubs.instances.eventHubProducerClientList[t].key===e)return flutterAzureEventHubs.instances.eventHubProducerClientList[t].value},flutterAzureEventHubs.removeEventHubProducerClientByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.eventHubProducerClientList.length;t++)if(flutterAzureEventHubs.instances.eventHubProducerClientList[t].key===e){flutterAzureEventHubs.instances.eventHubProducerClientList.splice(t,1),t--;break}},flutterAzureEventHubs.setEventHubConsumerClient=function(e,t){flutterAzureEventHubs.instances.eventHubConsumerClientList.push({key:e,value:t})},flutterAzureEventHubs.getEventHubConsumerClientByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.eventHubConsumerClientList.length;t++)if(flutterAzureEventHubs.instances.eventHubConsumerClientList[t].key===e)return flutterAzureEventHubs.instances.eventHubConsumerClientList[t].value},flutterAzureEventHubs.removeEventHubConsumerClientByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.eventHubConsumerClientList.length;t++)if(flutterAzureEventHubs.instances.eventHubConsumerClientList[t].key===e){flutterAzureEventHubs.instances.eventHubConsumerClientList.splice(t,1),t--;break}},flutterAzureEventHubs.setSubscription=function(e,t){flutterAzureEventHubs.instances.subscriptionList.push({key:e,value:t})},flutterAzureEventHubs.getSubscriptionByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.subscriptionList.length;t++)if(flutterAzureEventHubs.instances.subscriptionList[t].key===e)return flutterAzureEventHubs.instances.subscriptionList[t].value},flutterAzureEventHubs.removeSubscriptionByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.subscriptionList.length;t++)if(flutterAzureEventHubs.instances.subscriptionList[t].key===e){flutterAzureEventHubs.instances.subscriptionList.splice(t,1),t--;break}},flutterAzureEventHubs.setClientSecretCredential=function(e,t){flutterAzureEventHubs.instances.clientSecretCredentialList.push({key:e,value:t})},flutterAzureEventHubs.getClientSecretCredentialByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.clientSecretCredentialList.length;t++)if(flutterAzureEventHubs.instances.clientSecretCredentialList[t].key===e)return flutterAzureEventHubs.instances.clientSecretCredentialList[t].value},flutterAzureEventHubs.removeClientSecretCredentialByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.clientSecretCredentialList.length;t++)if(flutterAzureEventHubs.instances.clientSecretCredentialList[t].key===e){flutterAzureEventHubs.instances.clientSecretCredentialList.splice(t,1),t--;break}},flutterAzureEventHubs.setSchemaRegistryClient=function(e,t){flutterAzureEventHubs.instances.schemaRegistryClientList.push({key:e,value:t})},flutterAzureEventHubs.getSchemaRegistryClientByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.schemaRegistryClientList.length;t++)if(flutterAzureEventHubs.instances.schemaRegistryClientList[t].key===e)return flutterAzureEventHubs.instances.schemaRegistryClientList[t].value},flutterAzureEventHubs.removeSchemaRegistryClientByKey=function(e){for(var t=0;t<flutterAzureEventHubs.instances.schemaRegistryClientList.length;t++)if(flutterAzureEventHubs.instances.schemaRegistryClientList[t].key===e){flutterAzureEventHubs.instances.schemaRegistryClientList.splice(t,1),t--;break}},flutterAzureEventHubs.api.createEventHubProducerClient=function(e,t,n,r,o){try{var i=new flutterAzureEventHubs.eventHubProducerClient(t,n);flutterAzureEventHubs.setEventHubProducerClient(e,i),proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:r,success:!0,result:""}))}catch(e){proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:r,success:!1,result:e.toString()}))}},flutterAzureEventHubs.api.sendEventDataBatch=function(e,t,n,r,o){var i=flutterAzureEventHubs.getEventHubProducerClientByKey(e);null!=i?i.sendBatch(t,n).then((function(){proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:r,success:!0,result:""}))})).catch((function(e){proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:r,success:!1,result:e.toString()}))})):proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:r,success:!1,result:"ERROR: EventHubProducerClient not found."}))},flutterAzureEventHubs.api.closeEventHubProducerClient=function(e,t,n){var r=flutterAzureEventHubs.getEventHubProducerClientByKey(e);null!=r?r.close().then((function(){flutterAzureEventHubs.removeEventHubProducerClientByKey(e),proxyInterop.postMessage(JSON.stringify({id:n,javascriptTransactionId:t,success:!0,result:""}))})).catch((function(e){proxyInterop.postMessage(JSON.stringify({id:n,javascriptTransactionId:t,success:!1,result:e.toString()}))})):proxyInterop.postMessage(JSON.stringify({id:n,javascriptTransactionId:t,success:!1,result:"ERROR: EventHubProducerClient not found."}))},flutterAzureEventHubs.api.createEventHubConsumerClient=function(e,t,n,r,o,i){try{var s=new flutterAzureEventHubs.eventHubConsumerClient(t,n,r);flutterAzureEventHubs.setEventHubConsumerClient(e,s),proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:o,success:!0,result:""}))}catch(e){proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:o,success:!1,result:e.toString()}))}},flutterAzureEventHubs.api.subscribe=function(e,t,n,r,o){var i=flutterAzureEventHubs.getEventHubConsumerClientByKey(e);if(null!=i)try{var s=i.subscribe({processEvents:function(e,n){var r={receivedEventDataList:[]};for(var i in e)r.receivedEventDataList.push({body:e[i].body,enqueuedTimeUtc:e[i].enqueuedTimeUtc,partitionKey:e[i].partitionKey,offset:e[i].offset,sequenceNumber:e[i].sequenceNumber});r.partitionContext={fullyQualifiedNamespace:n._context.fullyQualifiedNamespace,eventHubName:n._context.eventHubName,consumerGroup:n._context.consumerGroup,partitionId:n._context.partitionId},proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:t,success:!0,result:JSON.stringify(r)}))},processError:function(e){proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:t,success:!1,result:e.toString()}))}},n);flutterAzureEventHubs.setSubscription(t,s),proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:r,success:!0,result:""}))}catch(e){proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:r,success:!1,result:e.toString()}))}else proxyInterop.postMessage(JSON.stringify({id:o,javascriptTransactionId:r,success:!1,result:"ERROR: EventHubConsumerClient not found."}))},flutterAzureEventHubs.api.closeSubscription=function(e,t,n){var r=flutterAzureEventHubs.getSubscriptionByKey(e);null!=r?r.close().then((function(){flutterAzureEventHubs.removeSubscriptionByKey(e),proxyInterop.postMessage(JSON.stringify({id:n,javascriptTransactionId:t,success:!0,result:""}))})).catch((function(e){proxyInterop.postMessage(JSON.stringify({id:n,javascriptTransactionId:t,success:!1,result:e.toString()}))})):proxyInterop.postMessage(JSON.stringify({id:n,javascriptTransactionId:t,success:!1,result:"ERROR: Subscription not found."}))},flutterAzureEventHubs.api.closeEventHubConsumerClient=function(e,t,n,r){var o=flutterAzureEventHubs.getEventHubConsumerClientByKey(e);null!=o?o.close().then((function(){for(var o in t)flutterAzureEventHubs.removeSubscriptionByKey(t[o]);flutterAzureEventHubs.removeEventHubConsumerClientByKey(e),proxyInterop.postMessage(JSON.stringify({id:r,javascriptTransactionId:n,success:!0,result:""}))})).catch((function(e){proxyInterop.postMessage(JSON.stringify({id:r,javascriptTransactionId:n,success:!1,result:e.toString()}))})):proxyInterop.postMessage(JSON.stringify({id:r,javascriptTransactionId:n,success:!1,result:"ERROR: EventHubConsumerClient not found."}))},flutterAzureEventHubs.api.createClientSecretCredential=function(e,t,n,r,o,i,s){try{var a=new flutterAzureEventHubs.clientSecretCredential(t,n,r,o);flutterAzureEventHubs.setClientSecretCredential(e,a),proxyInterop.postMessage(JSON.stringify({id:s,javascriptTransactionId:i,success:!0,result:""}))}catch(e){proxyInterop.postMessage(JSON.stringify({id:s,javascriptTransactionId:i,success:!1,result:e.toString()}))}},flutterAzureEventHubs.api.createSchemaRegistryClient=function(e,t,n,r,o,i){var s=flutterAzureEventHubs.getClientSecretCredentialByKey(n);if(null!=s)try{var a=new flutterAzureEventHubs.schemaRegistryClient(t,s,r);flutterAzureEventHubs.setSchemaRegistryClient(e,a),proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:o,success:!0,result:""}))}catch(e){proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:o,success:!1,result:e.toString()}))}else proxyInterop.postMessage(JSON.stringify({id:i,javascriptTransactionId:o,success:!1,result:"ERROR: ClientSecretCredential not found."}))},flutterAzureEventHubs.api.getSchemaProperties=function(e,t,n,r){var o=flutterAzureEventHubs.getSchemaRegistryClientByKey(e);null!=o?o.getSchemaProperties(t).then((function(e){proxyInterop.postMessage(JSON.stringify({id:r,javascriptTransactionId:n,success:!0,result:JSON.stringify({id:e.id,format:e.format,groupName:e.groupName,name:e.name})}))})).catch((function(e){proxyInterop.postMessage(JSON.stringify({id:r,javascriptTransactionId:n,success:!1,result:e.toString()}))})):proxyInterop.postMessage(JSON.stringify({id:r,javascriptTransactionId:n,success:!1,result:"ERROR: SchemaRegistryClient not found."}))}},function(e,t,n){"use strict";(function(t,r){var o=n(27),i=n(42),s=n(30),a=n(69),c=n(29),u=n(52),l=n(95),d=n(70),h=n(98),p=n(99),f=n(100),m=n(71),g=n(72),y=n(31).EventEmitter;function v(){var e=function(){var e;e=t.env.MESSAGING_CONNECT_FILE?[t.env.MESSAGING_CONNECT_FILE]:[t.cwd(),f.join(p.homedir(),".config/messaging"),"/etc/messaging"].map((function(e){return f.join(e,"/connect.json")}));for(var n=0;n<e.length;n++)if(h.existsSync(e[n])){var r=JSON.parse(h.readFileSync(e[n],"utf8"));return s.config("using config from %s: %j",e[n],r),r}return{}}(),n={};return"amqps"===e.scheme&&(n.transport="tls"),e.host&&(n.host=e.host),"amqp"===e.port?n.port=5672:"amqps"===e.port?n.port=5671:n.port=e.port,e.sasl&&!1===e.sasl.enabled||(e.user?n.username=e.user:n.username="anonymous",e.password&&(n.password=e.password),e.sasl_mechanisms&&(n.sasl_mechanisms=e.sasl_mechanisms)),e.tls&&(e.tls.key&&(n.key=h.readFileSync(e.tls.key)),e.tls.cert&&(n.cert=h.readFileSync(e.tls.cert)),e.tls.ca&&(n.ca=[h.readFileSync(e.tls.ca)]),!1!==e.verify&&!1!==e.tls.verify||(n.rejectUnauthorized=!1)),"tls"===n.transport&&(n.servername=n.host),n}function b(e){return e.get_id_string?e.get_id_string():e.localAddress+":"+e.localPort+" -> "+e.remoteAddress+":"+e.remotePort}function _(e,t){if(e){var n,r=e;return function(o){return n!==o&&(r=e,n=o),r--?t(o):-1}}return t}function w(e){if(void 0===e.transport||"tcp"===e.transport)return m.connect;if("tls"===e.transport||"ssl"===e.transport)return g.connect;throw Error("Unrecognised transport: "+e.transport)}var E=["container_id","hostname","max_frame_size","channel_max","idle_time_out","outgoing_locales","incoming_locales","offered_capabilities","desired_capabilities","properties"];function S(e,t){if("boolean"==typeof e)if(e){var n=t.get_option("initial_reconnect_delay",100),r=t.get_option("max_reconnect_delay",6e4);t.options.reconnect=_(t.get_option("reconnect_limit"),function(e,t){var n,r=e;return function(o){n!==o&&(r=e,n=o);var i=r,s=2*r;return r=t>s?s:t,i}}(n,r))}else t.options.reconnect=!1;else if("number"==typeof e){var o=t.options.reconnect;t.options.reconnect=_(t.get_option("reconnect_limit"),(function(){return o}))}}var O=1,C=function(e,t){if(this.options={},e){for(var n in e)this.options[n]=e[n];"tls"!==e.transport&&"ssl"!==e.transport||void 0!==e.servername||void 0===e.host||(this.options.servername=e.host)}else this.options=v();if(this.container=t,this.options.id||(this.options.id="connection-"+O++),this.options.container_id||(this.options.container_id=t?t.id:c.generate_uuid()),!this.options.connection_details){var r=this;this.options.connection_details=function(){return function(e){var t={};return t.connect=e.connect?e.connect:w(e),t.host=e.host?e.host:"localhost",t.port=e.port?e.port:5672,t.options=e,t}(r.options)}}var o,s,a,l;S(this.get_option("reconnect",!0),this),this.registered=!1,this.state=new u,this.local_channel_map={},this.remote_channel_map={},this.local={},this.remote={},this.local.open=i.open((o=this.options,s={},E.forEach((function(e){void 0!==o[e]&&(s[e]=o[e])})),s)),this.local.close=i.close({}),this.session_policy=(a=this,l=null,{get_session:function(){return l||((l=a.create_session()).observers.on("session_close",(function(){l=null})),l.begin()),l}}),this.amqp_transport=new d(this.options.id,0,i.TYPE_AMQP,this),this.sasl_transport=void 0,this.transport=this.amqp_transport,this.conn_established_counter=0,this.heartbeat_out=void 0,this.heartbeat_in=void 0,this.abort_idle=void 0,this.socket_ready=!1,this.scheduled_reconnect=void 0,this.default_sender=void 0,this.closed_with_non_fatal_error=!1;r=this;E.forEach((function(e){var t;Object.defineProperty(r,e,{get:(t=e,function(){return this.remote.open?this.remote.open[t]:void 0})})})),Object.defineProperty(this,"error",{get:function(){return this.remote.close?this.remote.close.error:void 0}})};function I(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&delete e[t]}function T(e){C.prototype["on_"+e]=function(t){var n=this.remote_channel_map[t.channel];if(!n)throw new o.ProtocolError(e+" received on invalid channel "+t.channel);n["on_"+e](t)}}(C.prototype=Object.create(y.prototype)).constructor=C,C.prototype.dispatch=function(e){return s.events("[%s] Connection got event: %s",this.options.id,e),this.listeners(e).length?(y.prototype.emit.apply(this,arguments),!0):!!this.container&&this.container.dispatch.apply(this.container,arguments)},C.prototype._disconnect=function(){for(var e in this.state.disconnected(),this.local_channel_map)this.local_channel_map[e]._disconnect();this.socket_ready=!1},C.prototype._reconnect=function(){this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0,this.local.close.error=void 0,this.state=new u,this.state.open()),this.state.reconnect(),this._reset_remote_state()},C.prototype._reset_remote_state=function(){this.amqp_transport=new d(this.options.id,0,i.TYPE_AMQP,this),this.sasl_transport=void 0,this.transport=this.amqp_transport,this.remote={},this.remote_channel_map={};var e=this.local_channel_map;for(var t in e)e[t]._reconnect()},C.prototype.connect=function(){return this.is_server=!1,this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0),this._reset_remote_state(),this._connect(this.options.connection_details(this.conn_established_counter)),this.open(),this},C.prototype.reconnect=function(){return this.scheduled_reconnect=void 0,s.reconnect("[%s] reconnecting...",this.options.id),this._reconnect(),this._connect(this.options.connection_details(this.conn_established_counter)),t.nextTick(this._process.bind(this)),this},C.prototype.set_reconnect=function(e){S(e,this)},C.prototype._connect=function(e){return e.connect?this.init(e.connect(e.port,e.host,e.options,this.connected.bind(this))):this.init(w(e)(e.port,e.host,e.options,this.connected.bind(this))),this},C.prototype.accept=function(e){return this.is_server=!0,s.io("[%s] client accepted: %s",this.id,b(e)),this.socket_ready=!0,this.init(e)},C.prototype.abort_socket=function(e){e===this.socket&&(this.abort_idle=void 0,s.io("[%s] aborting socket",this.options.id),this.socket.end(),this.socket.removeAllListeners&&(this.socket.removeAllListeners("data"),this.socket.removeAllListeners("error"),this.socket.removeAllListeners("end")),"function"==typeof this.socket.destroy&&this.socket.destroy(),this._disconnected())},C.prototype.init=function(e){if(this.socket=e,this.get_option("tcp_no_delay",!1)&&this.socket.setNoDelay&&this.socket.setNoDelay(!0),this.socket.on("data",this.input.bind(this)),this.socket.on("error",this.on_error.bind(this)),this.socket.on("end",this.eof.bind(this)),this.is_server){var t;if(this.container&&Object.getOwnPropertyNames(this.container.sasl_server_mechanisms).length&&(t=this.container.sasl_server_mechanisms),this.socket.encrypted&&this.socket.authorized&&this.get_option("enable_sasl_external",!1)&&(t=a.server_add_external(t?c.clone(t):{})),t)void 0===t.ANONYMOUS||this.get_option("require_sasl",!1)?this.sasl_transport=new a.Server(this,t):this.sasl_transport=new a.Selective(this,t);else if(!this.get_option("disable_sasl",!1)){var n=a.server_mechanisms();n.enable_anonymous(),this.sasl_transport=new a.Selective(this,n)}}else{var r=this.get_option("sasl_mechanisms");if(!r){var o=this.get_option("username"),i=this.get_option("password"),s=this.get_option("token");o&&(r=a.client_mechanisms(),i?r.enable_plain(o,i):s?r.enable_xoauth2(o,s):r.enable_anonymous(o))}this.socket.encrypted&&this.options.cert&&this.get_option("enable_sasl_external",!1)&&(r||(r=a.client_mechanisms()),r.enable_external()),r&&(this.sasl_transport=new a.Client(this,r,this.options.sasl_init_hostname||this.options.servername||this.options.host))}return this.transport=this.sasl_transport?this.sasl_transport:this.amqp_transport,this},C.prototype.attach_sender=function(e){return this.session_policy.get_session().attach_sender(e)},C.prototype.open_sender=C.prototype.attach_sender,C.prototype.attach_receiver=function(e){return this.get_option("tcp_no_delay",!0)&&this.socket.setNoDelay&&this.socket.setNoDelay(!0),this.session_policy.get_session().attach_receiver(e)},C.prototype.open_receiver=C.prototype.attach_receiver,C.prototype.get_option=function(e,t){return void 0!==this.options[e]?this.options[e]:this.container?this.container.get_option(e,t):t},C.prototype.send=function(e){return void 0===this.default_sender&&(this.default_sender=this.open_sender({target:{}})),this.default_sender.send(e)},C.prototype.connected=function(){this.socket_ready=!0,this.conn_established_counter++,s.io("[%s] connected %s",this.options.id,b(this.socket)),this.output()},C.prototype.sasl_failed=function(e,t){this.transport_error=new o.ConnectionError(e,t||"amqp:unauthorized-access",this),this._handle_error(),this.socket.end()},C.prototype._is_fatal=function(e){return!this.get_option("all_errors_non_fatal",!1)&&this.get_option("non_fatal_errors",["amqp:connection:forced"]).indexOf(e)<0},C.prototype._handle_error=function(){var e=this.get_error();if(e){var t=this.dispatch("connection_error",this._context({error:e}));return t=this.dispatch("connection_close",this._context({error:e}))||t,this._is_fatal(e.condition)?t||this.dispatch("error",new o.ConnectionError(e.description,e.condition,this)):this.state.local_open&&(this.closed_with_non_fatal_error=!0),!0}return!1},C.prototype.get_error=function(){return this.transport_error?this.transport_error:this.remote.close&&this.remote.close.error?new o.ConnectionError(this.remote.close.error.description,this.remote.close.error.condition,this):void 0},C.prototype._get_peer_details=function(){var e="";return this.remote.open&&this.remote.open.container&&(e+=this.remote.open.container+" "),this.remote.open&&this.remote.open.properties&&(e+=JSON.stringify(this.remote.open.properties)),e},C.prototype.output=function(){try{this.socket&&this.socket_ready&&(this.heartbeat_out&&clearTimeout(this.heartbeat_out),this.transport.write(this.socket),(this.is_closed()&&this.state.has_settled()||this.abort_idle||this.transport_error)&&!this.transport.has_writes_pending()?this.socket.end():this.is_open()&&this.remote.open.idle_time_out&&(this.heartbeat_out=setTimeout(this._write_frame.bind(this),this.remote.open.idle_time_out/2)),this.local.open.idle_time_out&&void 0===this.heartbeat_in&&(this.heartbeat_in=setTimeout(this.idle.bind(this),this.local.open.idle_time_out)))}catch(e){this.saved_error=e,"ProtocolError"===e.name?(console.error("["+this.options.id+"] error on write: "+e+" "+this._get_peer_details()+" "+e.name),this.dispatch("protocol_error",e)||console.error("["+this.options.id+"] error on write: "+e+" "+this._get_peer_details())):this.dispatch("error",e),this.socket.end()}},C.prototype.input=function(e){var t;try{this.heartbeat_in&&clearTimeout(this.heartbeat_in),s.io("[%s] read %d bytes",this.options.id,e.length),this.previous_input?(t=r.concat([this.previous_input,e],this.previous_input.length+e.length),this.previous_input=null):t=e;var n=this.transport.read(t,this);n<t.length&&(this.previous_input=t.slice(n)),this.local.open.idle_time_out&&(this.heartbeat_in=setTimeout(this.idle.bind(this),this.local.open.idle_time_out)),this.transport.has_writes_pending()?this.output():this.is_closed()&&this.state.has_settled()?this.socket.end():this.is_open()&&this.remote.open.idle_time_out&&!this.heartbeat_out&&(this.heartbeat_out=setTimeout(this._write_frame.bind(this),this.remote.open.idle_time_out/2))}catch(e){this.saved_error=e,"ProtocolError"===e.name?this.dispatch("protocol_error",e)||console.error("["+this.options.id+"] error on read: "+e+" "+this._get_peer_details()+" (buffer:"+function(e){for(var t,n=[],r=0;r<e.length;r++)n.push((t=e[r])<16?"0x0"+Number(t).toString(16):"0x"+Number(t).toString(16));return n.join(",")}(t)+")"):this.dispatch("error",e),this.socket.end()}},C.prototype.idle=function(){this.is_closed()||(this.closed_with_non_fatal_error=!0,this.local.close.error={condition:"amqp:resource-limit-exceeded",description:"max idle time exceeded"},this.close(),this.abort_idle=setTimeout(this.abort_socket.bind(this,this.socket),1e3))},C.prototype.on_error=function(e){this._disconnected(e)},C.prototype.eof=function(e){var t=e||this.saved_error;this.saved_error=void 0,this._disconnected(t)},C.prototype._disconnected=function(e){this.heartbeat_out&&(clearTimeout(this.heartbeat_out),this.heartbeat_out=void 0),this.heartbeat_in&&(clearTimeout(this.heartbeat_in),this.heartbeat_in=void 0),this.abort_idle&&(clearTimeout(this.abort_idle),this.abort_idle=void 0);var t=this.closed_with_non_fatal_error;if(this.closed_with_non_fatal_error&&(this.closed_with_non_fatal_error=!1,this.options.reconnect&&this.open()),(!this.is_closed()||t)&&void 0===this.scheduled_reconnect){this._disconnect();var n={};if(e&&(n.error=e),!this.is_server&&!this.transport_error&&this.options.reconnect){var r=this.options.reconnect(this.conn_established_counter);r>=0?(s.reconnect("[%s] Scheduled reconnect in "+r+"ms",this.options.id),this.scheduled_reconnect=setTimeout(this.reconnect.bind(this),r),n.reconnecting=!0):n.reconnecting=!1}this.dispatch("disconnected",this._context(n))||console.warn("["+this.options.id+"] disconnected %s",n.error||"")}},C.prototype.open=function(){this.state.open()&&this._register()},C.prototype.close=function(e){e&&(this.local.close.error=e),this.state.close()&&this._register()},C.prototype.is_open=function(){return this.state.is_open()},C.prototype.is_remote_open=function(){return this.state.remote_open},C.prototype.is_closed=function(){return this.state.is_closed()},C.prototype.create_session=function(){for(var e=0;this.local_channel_map[e];)e++;var t=new l(this,e);return this.local_channel_map[e]=t,t},C.prototype.find_sender=function(e){return this.find_link(c.sender_filter(e))},C.prototype.find_receiver=function(e){return this.find_link(c.receiver_filter(e))},C.prototype.find_link=function(e){for(var t in this.local_channel_map){var n=this.local_channel_map[t].find_link(e);if(n)return n}},C.prototype.each_receiver=function(e,t){this.each_link(e,c.receiver_filter(t))},C.prototype.each_sender=function(e,t){this.each_link(e,c.sender_filter(t))},C.prototype.each_link=function(e,t){for(var n in this.local_channel_map){this.local_channel_map[n].each_link(e,t)}},C.prototype.on_open=function(e){if(!this.state.remote_opened())throw new o.ProtocolError("Open already received");this.remote.open=e.performative,this.open(),this.dispatch("connection_open",this._context())},C.prototype.on_close=function(e){if(!this.state.remote_closed())throw new o.ProtocolError("Close already received");this.remote.close=e.performative,this.remote.close.error?this._handle_error():this.dispatch("connection_close",this._context()),this.heartbeat_out&&clearTimeout(this.heartbeat_out);var n=this;t.nextTick((function(){n.close()}))},C.prototype._register=function(){this.registered||(this.registered=!0,t.nextTick(this._process.bind(this)))},C.prototype._process=function(){this.registered=!1;do{this.state.need_open()&&this._write_open();var e=this.local_channel_map;for(var t in e)e[t]._process();this.state.need_close()&&this._write_close()}while(!this.state.has_settled())},C.prototype._write_frame=function(e,t,n){this.amqp_transport.encode(i.amqp_frame(e,t,n)),this.output()},C.prototype._write_open=function(){this._write_frame(0,this.local.open)},C.prototype._write_close=function(){this._write_frame(0,this.local.close),this.local.close.error=void 0},C.prototype.on_begin=function(e){var t;if(null===e.performative.remote_channel||void 0===e.performative.remote_channel)(t=this.create_session()).local.begin.remote_channel=e.channel;else if(!(t=this.local_channel_map[e.performative.remote_channel]))throw new o.ProtocolError("Invalid value for remote channel "+e.performative.remote_channel);t.on_begin(e),this.remote_channel_map[e.channel]=t},C.prototype.get_peer_certificate=function(){return this.socket&&this.socket.getPeerCertificate?this.socket.getPeerCertificate():void 0},C.prototype.get_tls_socket=function(){return!this.socket||"tls"!==this.options.transport&&"ssl"!==this.options.transport?void 0:this.socket},C.prototype._context=function(e){var t=e||{};return t.connection=this,this.container&&(t.container=this.container),t},C.prototype.remove_session=function(e){this.remote_channel_map[e.remote.channel]===e&&delete this.remote_channel_map[e.remote.channel],this.local_channel_map[e.local.channel]===e&&delete this.local_channel_map[e.local.channel]},C.prototype.remove_all_sessions=function(){I(this.remote_channel_map),I(this.local_channel_map)},T("end"),T("attach"),T("detach"),T("transfer"),T("disposition"),T("flow"),e.exports=C}).call(this,n(16),n(19).Buffer)},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),s=r[0],a=r[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),l=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=o[e.charCodeAt(n)]<<18|o[e.charCodeAt(n+1)]<<12|o[e.charCodeAt(n+2)]<<6|o[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===a&&(t=o[e.charCodeAt(n)]<<2|o[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===a&&(t=o[e.charCodeAt(n)]<<10|o[e.charCodeAt(n+1)]<<4|o[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,o=n%3,i=[],s=0,a=n-o;s<a;s+=16383)i.push(l(e,s,s+16383>a?a:s+16383));1===o?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return i.join("")};for(var r=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],o[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var o,i,s=[],a=t;a<n;a+=3)o=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,o){var i,s,a=8*o-r-1,c=(1<<a)-1,u=c>>1,l=-7,d=n?o-1:0,h=n?-1:1,p=e[t+d];for(d+=h,i=p&(1<<-l)-1,p>>=-l,l+=a;l>0;i=256*i+e[t+d],d+=h,l-=8);for(s=i&(1<<-l)-1,i>>=-l,l+=r;l>0;s=256*s+e[t+d],d+=h,l-=8);if(0===i)i=1-u;else{if(i===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),i-=u}return(p?-1:1)*s*Math.pow(2,i-r)},t.write=function(e,t,n,r,o,i){var s,a,c,u=8*i-o-1,l=(1<<u)-1,d=l>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*c-1)*Math.pow(2,o),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),s=0));o>=8;e[n+p]=255&a,p+=f,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;e[n+p]=255&s,p+=f,s/=256,u-=8);e[n+p-f]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";e.exports=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];var i=s,a=Number(new Date),c=a-(n||a);i.diff=c,i.prev=n,i.curr=a,n=a,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return e;u++;var o=r.formatters[n];if("function"==typeof o){var s=t[u];e=o.call(i,s),t.splice(u,1),u--}return e})),r.formatArgs.call(i,t);var l=i.log||r.log;l.apply(i,t)}}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=o,s.extend=i,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function o(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function i(e,t){return r(this.namespace+(void 0===t?":":t)+e)}return r.debug=r,r.default=r,r.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(t=0;t<o;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var i=r.instances[t];i.enabled=r.enabled(i.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(94),Object.keys(e).forEach((function(t){r[t]=e[t]})),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t){var n=1e3,r=6e4,o=60*r,i=24*o;function s(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*o;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(e);if("number"===a&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return s(e,t,i,"day");if(t>=o)return s(e,t,o,"hour");if(t>=r)return s(e,t,r,"minute");if(t>=n)return s(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=r)return Math.round(e/r)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";(function(t,r){var o=n(42),i=n(96),s=n(30),a=n(53),c=n(28),u=n(29),l=n(52),d=n(31).EventEmitter;function h(e,t,n){Error.call(this),Error.captureStackTrace(this,this.constructor),this.message=e,this.condition=t,this.description=e,Object.defineProperty(this,"session",{value:n})}n(51).inherits(h,Error);var p=function(e){this.capacity=e,this.size=0,this.head=0,this.tail=0,this.entries=[]};function f(e){var t,n,r,i,s;for(i=0;i<e.length;i++)s=e[i],void 0===t&&(t=s,n=s,r=s.id),t!==n&&!a.are_outcomes_equivalent(n.state,s.state)||n.settled!==s.settled||r!==s.id?(t.link.session.output(o.disposition({role:t.link.is_receiver(),first:t.id,last:n.id,state:t.state,settled:t.settled})),t=s,n=s,r=s.id):(n.id!==s.id&&(n=s),r++);void 0!==t&&void 0!==n&&t.link.session.output(o.disposition({role:t.link.is_receiver(),first:t.id,last:n.id,state:t.state,settled:t.settled}))}p.prototype.available=function(){return this.capacity-this.size},p.prototype.push=function(e){if(!(this.size<this.capacity))throw Error("circular buffer overflow: head="+this.head+" tail="+this.tail+" size="+this.size+" capacity="+this.capacity);this.entries[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.size++},p.prototype.pop_if=function(e){for(var t=0;this.size&&e(this.entries[this.head]);)this.entries[this.head]=void 0,this.head=(this.head+1)%this.capacity,this.size--,t++;return t},p.prototype.by_id=function(e){if(this.size>0){var t=e-this.entries[this.head].id;if(t<this.size)return this.entries[(this.head+t)%this.capacity]}},p.prototype.get_head=function(){return this.size>0?this.entries[this.head]:void 0},p.prototype.get_tail=function(){return this.size>0?this.entries[(this.head+this.size-1)%this.capacity]:void 0};var m=function(e){this.deliveries=new p(2048),this.updated=[],this.pending_dispositions=[],this.next_delivery_id=0,this.next_pending_delivery=0,this.next_transfer_id=0,this.window=c.MAX_UINT,this.remote_next_transfer_id=void 0,this.remote_window=void 0,this.connection=e};m.prototype.available=function(){return this.deliveries.available()},m.prototype.compute_max_payload=function(e){return this.connection.max_frame_size?this.connection.max_frame_size-(50+e.length):void 0},m.prototype.send=function(e,t,n,r){var o=[],i=this.compute_max_payload(t);if(i&&n.length>i)for(var s=0;s<n.length;){var a=Math.min(s+i,n.length);o.push(n.slice(s,a)),s=a}else o.push(n);var c={id:this.next_delivery_id++,tag:t,link:e,data:o,format:r||0,sent:!1,settled:!1,state:void 0,remote_settled:!1,remote_state:void 0},u=this;return c.update=function(e,t){u.update(c,e,t)},this.deliveries.push(c),c},m.prototype.on_begin=function(e){this.remote_window=e.incoming_window},m.prototype.on_flow=function(e){this.remote_next_transfer_id=e.next_incoming_id,this.remote_window=e.incoming_window},m.prototype.on_disposition=function(e){for(var t=e.last?e.last:e.first,n=e.first;n<=t;n++){var r=this.deliveries.by_id(n);if(r&&!r.remote_settled){var o=!1;e.settled&&(r.remote_settled=e.settled,o=!0),e.state&&e.state!==r.remote_state&&(r.remote_state=a.unwrap_outcome(e.state),o=!0),o&&this.updated.push(r)}}},m.prototype.update=function(e,t,n){e&&(e.settled=t,void 0!==n&&(e.state=n),e.remote_settled||this.pending_dispositions.push(e),e.link.connection._register())},m.prototype.transfer_window=function(){return this.remote_window?this.remote_window-(this.next_transfer_id-this.remote_next_transfer_id):0},m.prototype.process=function(){for(var e;this.next_pending_delivery<this.next_delivery_id;){if(!(e=this.deliveries.by_id(this.next_pending_delivery))){console.error("ERROR: Next pending delivery not found: "+this.next_pending_delivery);break}if(!e.link.has_credit()){s.flow("[%s] Link has no credit",this.connection.options.id);break}if(!(this.transfer_window()>=e.data.length)){s.flow("[%s] Incoming window of peer preventing sending further transfers: remote_window=%d, remote_next_transfer_id=%d, next_transfer_id=%d",this.connection.options.id,this.remote_window,this.remote_next_transfer_id,this.next_transfer_id);break}this.window-=e.data.length;for(var t=0;t<e.data.length;t++){this.next_transfer_id++;var n=t+1<e.data.length,r=o.transfer({handle:e.link.local.handle,message_format:e.format,delivery_id:e.id,delivery_tag:e.tag,settled:e.settled,more:n});e.link.session.output(r,e.data[t]),e.settled&&(e.remote_settled=!0)}e.link.credit--,e.link.delivery_count++,this.next_pending_delivery++}for(t=0;t<this.updated.length;t++)(e=this.updated[t]).remote_state&&e.remote_state.constructor.composite_type&&e.link.dispatch(e.remote_state.constructor.composite_type,e.link._context({delivery:e})),e.remote_settled&&e.link.dispatch("settled",e.link._context({delivery:e}));this.updated=[],this.pending_dispositions.length&&(f(this.pending_dispositions),this.pending_dispositions=[]),this.deliveries.pop_if((function(e){return e.settled&&e.remote_settled}))};var g=function(){this.deliveries=new p(2048),this.updated=[],this.next_transfer_id=0,this.next_delivery_id=void 0,Object.defineProperty(this,"window",{get:function(){return this.deliveries.available()}}),this.remote_next_transfer_id=void 0,this.remote_window=void 0,this.max_transfer_id=this.next_transfer_id+this.window};g.prototype.update=function(e,t,n){e&&(e.settled=t,void 0!==n&&(e.state=n),e.remote_settled||this.updated.push(e),e.link.connection._register())},g.prototype.on_transfer=function(e,n){if(this.next_transfer_id++,!n.is_remote_open())throw Error("transfer after detach");var r,o;if(void 0===this.next_delivery_id&&(this.next_delivery_id=e.performative.delivery_id),n._incomplete){if(r=n._incomplete,u.is_defined(e.performative.delivery_id)&&r.id!==e.performative.delivery_id)throw Error("frame sequence error: delivery "+r.id+" not complete, got "+e.performative.delivery_id);o=e.payload?t.concat([r.data,e.payload],r.data.length+e.payload.length):r.data}else{if(this.next_delivery_id!==e.performative.delivery_id)throw Error("frame sequence error: expected "+this.next_delivery_id+", got "+e.performative.delivery_id);r={id:e.performative.delivery_id,tag:e.performative.delivery_tag,format:e.performative.message_format,link:n,settled:!1,state:void 0,remote_settled:void 0!==e.performative.settled&&e.performative.settled,remote_state:e.performative.state};var i=this;r.update=function(e,t){var o=e;void 0===o&&(o=1!==n.local.attach.rcv_settle_mode),i.update(r,o,t)},r.accept=function(){this.update(void 0,a.accepted().described())},r.release=function(e){e?this.update(void 0,a.modified(e).described()):this.update(void 0,a.released().described())},r.reject=function(e){this.update(void 0,a.rejected({error:e}).described())},r.modified=function(e){this.update(void 0,a.modified(e).described())},this.deliveries.push(r),this.next_delivery_id++,o=e.payload}if(r.incomplete=e.performative.more,r.incomplete)n._incomplete=r,r.data=o;else{n._incomplete=void 0,n.credit>0?n.credit--:console.error("Received transfer when credit was %d",n.credit),n.delivery_count++;var s=0===r.format?{message:a.decode(o),delivery:r}:{message:o,delivery:r,format:r.format};n.dispatch("message",n._context(s))}},g.prototype.process=function(e){this.updated.length>0&&(f(this.updated),this.updated=[]),this.deliveries.pop_if((function(e){return e.settled})),this.max_transfer_id-this.next_transfer_id<this.window/2&&e._write_flow()},g.prototype.on_begin=function(e){this.remote_window=e.outgoing_window,this.remote_next_transfer_id=e.next_outgoing_id},g.prototype.on_flow=function(e){this.remote_next_transfer_id=e.next_outgoing_id,this.remote_window=e.outgoing_window},g.prototype.on_disposition=function(e){for(var t=e.last?e.last:e.first,n=e.first;n<=t;n++){var r=this.deliveries.by_id(n);r&&!r.remote_settled&&(e.state&&e.state!==r.remote_state&&(r.remote_state=a.unwrap_outcome(e.state)),e.settled&&(r.remote_settled=e.settled,r.link.dispatch("settled",r.link._context({delivery:r}))))}};var y=function(e,t){this.connection=e,this.outgoing=new m(e),this.incoming=new g,this.state=new l,this.local={channel:t,handles:{}},this.local.begin=o.begin({next_outgoing_id:this.outgoing.next_transfer_id,incoming_window:this.incoming.window,outgoing_window:this.outgoing.window}),this.local.end=o.end(),this.remote={handles:{}},this.links={},this.options={},Object.defineProperty(this,"error",{get:function(){return this.remote.end?this.remote.end.error:void 0}}),this.observers=new d};function v(e,t,n,r){var o=Object.create(r||{});"string"==typeof t?o[n]=t:t&&function e(t,n){for(var r in n)"properties"===r&&t.properties?e(t.properties,n.properties):t[r]=n[r]}(o,t),o.name||(o.name=u.generate_uuid());var i=e(o.name,o);for(var s in{source:0,target:0})o[s]&&("string"==typeof o[s]&&(o[s]={address:o[s]}),i["set_"+s](o[s]));return i.is_sender()&&void 0===o.source&&(o.source=i.set_source({})),i.is_receiver()&&void 0===o.target&&(o.target=i.set_target({})),i.attach(),i}function b(e){e.dispatch("sendable",e._context())}function _(e){return e.is_open()&&e.sendable()}(y.prototype=Object.create(d.prototype)).constructor=y,y.prototype._disconnect=function(){for(var e in this.state.disconnected(),this.links)this.links[e]._disconnect();this.state.was_open||this.remove()},y.prototype._reconnect=function(){for(var e in this.state.reconnect(),this.outgoing=new m(this.connection),this.incoming=new g,this.remote={handles:{}},this.links)this.links[e]._reconnect()},y.prototype.dispatch=function(e){return s.events("[%s] Session got event: %s",this.connection.options.id,e),d.prototype.emit.apply(this.observers,arguments),this.listeners(e).length?(d.prototype.emit.apply(this,arguments),!0):this.connection.dispatch.apply(this.connection,arguments)},y.prototype.output=function(e,t){this.connection._write_frame(this.local.channel,e,t)},y.prototype.create_sender=function(e,t){return t||(t=this.get_option("sender_options",{})),this.create_link(e,i.Sender,t)},y.prototype.create_receiver=function(e,t){return t||(t=this.get_option("receiver_options",{})),this.create_link(e,i.Receiver,t)},y.prototype.get_option=function(e,t){return void 0!==this.options[e]?this.options[e]:this.connection.get_option(e,t)},y.prototype.attach_sender=function(e){return v(this.create_sender.bind(this),e,"target",this.get_option("sender_options",{}))},y.prototype.open_sender=y.prototype.attach_sender,y.prototype.attach_receiver=function(e){return v(this.create_receiver.bind(this),e,"source",this.get_option("receiver_options",{}))},y.prototype.open_receiver=y.prototype.attach_receiver,y.prototype.find_sender=function(e){return this.find_link(u.sender_filter(e))},y.prototype.find_receiver=function(e){return this.find_link(u.receiver_filter(e))},y.prototype.find_link=function(e){for(var t in this.links){var n=this.links[t];if(e(n))return n}},y.prototype.each_receiver=function(e,t){this.each_link(e,u.receiver_filter(t))},y.prototype.each_sender=function(e,t){this.each_link(e,u.sender_filter(t))},y.prototype.each_link=function(e,t){for(var n in this.links){var r=this.links[n];(void 0===t||t(r))&&e(r)}},y.prototype.create_link=function(e,t,n){for(var r=0;this.local.handles[r];)r++;var o=new t(this,e,r,n);return this.links[e]=o,this.local.handles[r]=o,o},y.prototype.begin=function(){this.state.open()&&this.connection._register()},y.prototype.open=y.prototype.begin,y.prototype.end=function(e){e&&(this.local.end.error=e),this.state.close()&&this.connection._register()},y.prototype.close=y.prototype.end,y.prototype.is_open=function(){return this.connection.is_open()&&this.state.is_open()},y.prototype.is_remote_open=function(){return this.connection.is_remote_open()&&this.state.remote_open},y.prototype.is_itself_closed=function(){return this.state.is_closed()},y.prototype.is_closed=function(){return this.connection.is_closed()||this.is_itself_closed()},y.prototype._process=function(){do{this.state.need_open()&&this.output(this.local.begin);var e=0===this.outgoing.deliveries.available();for(var t in this.outgoing.process(),e&&this.outgoing.deliveries.available()&&this.each_sender(b,_),this.incoming.process(this),this.links)this.links[t]._process();this.state.need_close()&&this.output(this.local.end)}while(!this.state.has_settled())},y.prototype.send=function(e,t,n,r){var o=this.outgoing.send(e,t,n,r);return this.connection._register(),o},y.prototype._write_flow=function(e){var t={next_incoming_id:this.incoming.next_transfer_id,incoming_window:this.incoming.window,next_outgoing_id:this.outgoing.next_transfer_id,outgoing_window:this.outgoing.window};this.incoming.max_transfer_id=t.next_incoming_id+t.incoming_window,e&&(e._get_drain()&&(t.drain=!0),t.delivery_count=e.delivery_count,t.handle=e.local.handle,t.link_credit=e.credit),this.output(o.flow(t))},y.prototype.on_begin=function(e){if(!this.state.remote_opened())throw Error("Begin already received");this.remote.channel||(this.remote.channel=e.channel),this.remote.begin=e.performative,this.outgoing.on_begin(e.performative),this.incoming.on_begin(e.performative),this.open(),this.dispatch("session_open",this._context())},y.prototype.on_end=function(e){if(!this.state.remote_closed())throw Error("End already received");this.remote.end=e.performative;var t=this.remote.end.error;if(t){var n=this.dispatch("session_error",this._context());(n=this.dispatch("session_close",this._context())||n)||d.prototype.emit.call(this.connection.container,"error",new h(t.description,t.condition,this))}else this.dispatch("session_close",this._context());var o=this,i=this.state.mark();r.nextTick((function(){o.state.marker===i&&(o.close(),r.nextTick((function(){o.remove()})))}))},y.prototype.on_attach=function(e){var t=e.performative.name,n=this.links[t];n||(n=e.performative.role?this.create_sender(t):this.create_receiver(t)),this.remote.handles[e.performative.handle]=n,n.on_attach(e),n.remote.attach=e.performative},y.prototype.on_disposition=function(e){e.performative.role?(s.events("[%s] Received disposition for outgoing transfers",this.connection.options.id),this.outgoing.on_disposition(e.performative)):(s.events("[%s] Received disposition for incoming transfers",this.connection.options.id),this.incoming.on_disposition(e.performative)),this.connection._register()},y.prototype.on_flow=function(e){this.outgoing.on_flow(e.performative),this.incoming.on_flow(e.performative),u.is_defined(e.performative.handle)&&this._get_link(e).on_flow(e),this.connection._register()},y.prototype._context=function(e){var t=e||{};return t.session=this,this.connection._context(t)},y.prototype._get_link=function(e){var t=e.performative.handle,n=this.remote.handles[t];if(!n)throw Error("Invalid handle "+t);return n},y.prototype.on_detach=function(e){this._get_link(e).on_detach(e)},y.prototype.remove_link=function(e){delete this.remote.handles[e.remote.handle],delete this.local.handles[e.local.handle],delete this.links[e.name]},y.prototype.remove=function(){this.connection.remove_session(this)},y.prototype.on_transfer=function(e){this.incoming.on_transfer(e,this._get_link(e))},e.exports=y}).call(this,n(19).Buffer,n(16))},function(e,t,n){"use strict";(function(t,r){var o=n(42),i=n(30),s=n(53),a=n(97),c=n(52),u=function(e){this.window=e};function l(e){e.delivery.settled=!0}function d(e){e.delivery.update(void 0,s.accepted().described())}function h(e,t,n){Error.call(this),Error.captureStackTrace(this,this.constructor),this.message=e,this.condition=t,this.description=e,Object.defineProperty(this,"link",{value:n})}u.prototype.update=function(e){var t=this.window-e.receiver.credit;t>=this.window/4&&e.receiver.flow(t)},n(51).inherits(h,Error);var p=n(31).EventEmitter,f=Object.create(p.prototype);function m(e){switch(e){case"name":case"handle":case"role":case"initial_delivery_count":return!0;default:return!1}}f.dispatch=function(e){return i.events("[%s] Link got event: %s",this.connection.options.id,e),p.prototype.emit.apply(this.observers,arguments),this.listeners(e).length?(p.prototype.emit.apply(this,arguments),!0):this.session.dispatch.apply(this.session,arguments)},f.set_source=function(e){this.local.attach.source=a.source(e).described()},f.set_target=function(e){this.local.attach.target=a.target(e).described()},f.attach=function(){this.state.open()&&this.connection._register()},f.open=f.attach,f.detach=function(){this.local.detach.closed=!1,this.state.close()&&this.connection._register()},f.close=function(e){e&&(this.local.detach.error=e),this.local.detach.closed=!0,this.state.close()&&this.connection._register()},f.remove=function(){this.session.remove_link(this)},f.is_open=function(){return this.session.is_open()&&this.state.is_open()},f.is_remote_open=function(){return this.session.is_remote_open()&&this.state.remote_open},f.is_itself_closed=function(){return this.state.is_closed()},f.is_closed=function(){return this.session.is_closed()||this.is_itself_closed()},f._process=function(){do{this.state.need_open()&&this.session.output(this.local.attach),this.issue_flow&&this.state.local_open&&(this.session._write_flow(this),this.issue_flow=!1),this.state.need_close()&&this.session.output(this.local.detach)}while(!this.state.has_settled())},f.on_attach=function(e){if(!this.state.remote_opened())throw Error("Attach already received");this.remote.handle||(this.remote.handle=e.handle),e.performative.source=a.unwrap(e.performative.source),e.performative.target=a.unwrap(e.performative.target),this.remote.attach=e.performative,this.open(),this.dispatch(this.is_receiver()?"receiver_open":"sender_open",this._context())},f.prefix_event=function(e){return(this.local.attach.role?"receiver_":"sender_")+e},f.on_detach=function(e){if(!this.state.remote_closed())throw Error("Detach already received");this._incomplete&&(this._incomplete.settled=!0),this.remote.detach=e.performative;var n=this.remote.detach.error;if(n){var r=this.dispatch(this.prefix_event("error"),this._context());(r=this.dispatch(this.prefix_event("close"),this._context())||r)||p.prototype.emit.call(this.connection.container,"error",new h(n.description,n.condition,this))}else this.dispatch(this.prefix_event("close"),this._context());var o=this,i=this.state.mark();t.nextTick((function(){o.state.marker===i&&(o.close(),t.nextTick((function(){o.remove()})))}))};var g=["snd_settle_mode","rcv_settle_mode","source","target","max_message_size","offered_capabilities","desired_capabilities","properties"];function y(e){return function(){return this.remote.attach?this.remote.attach[e]:void 0}}f.init=function(e,t,n,r,i){for(var s in this.session=e,this.connection=e.connection,this.name=t,this.options=void 0===r?{}:r,this.state=new c,this.issue_flow=!1,this.local={handle:n},this.local.attach=o.attach({handle:n,name:t,role:i}),this.local.attach)m(s)||void 0===this.options[s]||(this.local.attach[s]=this.options[s]);this.local.detach=o.detach({handle:n,closed:!0}),this.remote={handle:void 0},this.delivery_count=0,this.credit=0,this.observers=new p;var a=this;g.forEach((function(e){Object.defineProperty(a,e,{get:y(e)})})),Object.defineProperty(this,"error",{get:function(){return this.remote.detach?this.remote.detach.error:void 0}})},f._disconnect=function(){this.state.disconnected(),this.state.was_open||this.remove()},f._reconnect=function(){this.state.reconnect(),this.remote={handle:void 0},this.delivery_count=0,this.credit=0},f.has_credit=function(){return this.credit>0},f.is_receiver=function(){return this.local.attach.role},f.is_sender=function(){return!this.is_receiver()},f._context=function(e){var t=e||{};return this.is_receiver()?t.receiver=this:t.sender=this,this.session._context(t)},f.get_option=function(e,t){return void 0!==this.options[e]?this.options[e]:this.session.get_option(e,t)};var v=function(e,t,n,r){this.init(e,t,n,r,!1),this._draining=!1,this._drained=!1,this.local.attach.initial_delivery_count=0,this.tag=0,this.get_option("autosettle",!0)&&this.observers.on("settled",l);var o=this;this.get_option("treat_modified_as_released",!0)&&this.observers.on("modified",(function(e){o.dispatch("released",e)}))};(v.prototype=Object.create(f)).constructor=v,v.prototype._get_drain=function(){if(this._draining&&this._drained&&this.credit){for(;this.credit;)++this.delivery_count,--this.credit;return!0}return!1},v.prototype.set_drained=function(e){this._drained=e,this._draining&&this._drained&&(this.issue_flow=!0)},v.prototype.next_tag=function(){return r.from(new String(this.tag++))},v.prototype.sendable=function(){return Boolean(this.credit&&this.session.outgoing.available())},v.prototype.on_flow=function(e){var t=e.performative;this.credit=t.delivery_count+t.link_credit-this.delivery_count,this._draining=t.drain,this._drained=this.credit>0,this.is_open()&&(this.dispatch("sender_flow",this._context()),this._draining&&this.dispatch("sender_draining",this._context()),this.sendable()&&this.dispatch("sendable",this._context()))},v.prototype.on_transfer=function(){throw Error("got transfer on sending link")},v.prototype.send=function(e,t,n){var r=void 0===n?s.encode(e):e,o=this.session.send(this,t||this.next_tag(),r,n);return 1===this.local.attach.snd_settle_mode&&(o.settled=!0),o};var b=function(e,t,n,r){this.init(e,t,n,r,!0),this.drain=!1,this.set_credit_window(this.get_option("credit_window",1e3)),this.get_option("autoaccept",!0)&&this.observers.on("message",d),1===this.local.attach.rcv_settle_mode&&this.get_option("autosettle",!0)&&this.observers.on("settled",l)};(b.prototype=Object.create(f)).constructor=b,b.prototype.on_flow=function(e){this.dispatch("receiver_flow",this._context()),e.performative.drain&&(this.credit=e.performative.link_credit,this.delivery_count=e.performative.delivery_count,e.performative.link_credit>0?console.error("ERROR: received flow with drain set, but non zero credit"):this.dispatch("receiver_drained",this._context()))},b.prototype.flow=function(e){e>0&&(this.credit+=e,this.issue_flow=!0,this.connection._register())},b.prototype.drain_credit=function(){this.drain=!0,this.issue_flow=!0,this.connection._register()},b.prototype.add_credit=b.prototype.flow,b.prototype._get_drain=function(){return this.drain},b.prototype.set_credit_window=function(e){if(e>0){var t=new u(e),n=t.update.bind(t);this.observers.on("message",n),this.observers.on("receiver_open",n)}},e.exports={Sender:v,Receiver:b}}).call(this,n(16),n(19).Buffer)},function(e,t,n){"use strict";var r=n(28),o={},i={};function s(e){var t=r.define_composite(e);o[e.name]=t.create,i[Number(t.descriptor.numeric).toString(10)]=t,i[t.descriptor.symbolic]=t}o.unwrap=function(e){if(e&&e.descriptor){var t=i[e.descriptor.value];if(t)return new t(e.value);console.warn("Unknown terminus: "+e.descriptor)}return null},s({name:"source",code:40,fields:[{name:"address",type:"string"},{name:"durable",type:"uint",default_value:0},{name:"expiry_policy",type:"symbol",default_value:"session-end"},{name:"timeout",type:"uint",default_value:0},{name:"dynamic",type:"boolean",default_value:!1},{name:"dynamic_node_properties",type:"symbolic_map"},{name:"distribution_mode",type:"symbol"},{name:"filter",type:"symbolic_map"},{name:"default_outcome",type:"*"},{name:"outcomes",type:"symbol",multiple:!0},{name:"capabilities",type:"symbol",multiple:!0}]}),s({name:"target",code:41,fields:[{name:"address",type:"string"},{name:"durable",type:"uint",default_value:0},{name:"expiry_policy",type:"symbol",default_value:"session-end"},{name:"timeout",type:"uint",default_value:0},{name:"dynamic",type:"boolean",default_value:!1},{name:"dynamic_node_properties",type:"symbolic_map"},{name:"capabilities",type:"symbol",multiple:!0}]}),e.exports=o},function(e,t){},function(e,t){t.endianness=function(){return"LE"},t.hostname=function(){return"undefined"!=typeof location?location.hostname:""},t.loadavg=function(){return[]},t.uptime=function(){return 0},t.freemem=function(){return Number.MAX_VALUE},t.totalmem=function(){return Number.MAX_VALUE},t.cpus=function(){return[]},t.type=function(){return"Browser"},t.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},t.networkInterfaces=t.getNetworkInterfaces=function(){return{}},t.arch=function(){return"javascript"},t.platform=function(){return"browser"},t.tmpdir=t.tmpDir=function(){return"/tmp"},t.EOL="\n",t.homedir=function(){return"/"}},function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var o=e[r];"."===o?e.splice(r,1):".."===o?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",o=!1,i=arguments.length-1;i>=-1&&!o;i--){var s=i>=0?arguments[i]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(t=s+"/"+t,o="/"===s.charAt(0))}return(o?"/":"")+(t=n(r(t.split("/"),(function(e){return!!e})),!o).join("/"))||"."},t.normalize=function(e){var i=t.isAbsolute(e),s="/"===o(e,-1);return(e=n(r(e.split("/"),(function(e){return!!e})),!i).join("/"))||i||(e="."),e&&s&&(e+="/"),(i?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var o=r(e.split("/")),i=r(n.split("/")),s=Math.min(o.length,i.length),a=s,c=0;c<s;c++)if(o[c]!==i[c]){a=c;break}var u=[];for(c=a;c<o.length;c++)u.push("..");return(u=u.concat(i.slice(a))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,o=!0,i=e.length-1;i>=1;--i)if(47===(t=e.charCodeAt(i))){if(!o){r=i;break}}else o=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,o=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!o){n=t+1;break}}else-1===r&&(o=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,o=!0,i=0,s=e.length-1;s>=0;--s){var a=e.charCodeAt(s);if(47!==a)-1===r&&(o=!1,r=s+1),46===a?-1===t?t=s:1!==i&&(i=1):-1!==t&&(i=-1);else if(!o){n=s+1;break}}return-1===t||-1===r||0===i||1===i&&t===r-1&&t===n+1?"":e.slice(t,r)};var o="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n(16))},function(e,t,n){"use strict";var r,o,i,s;!function(e){e.message="message",e.receiverOpen="receiver_open",e.receiverDrained="receiver_drained",e.receiverFlow="receiver_flow",e.receiverError="receiver_error",e.receiverClose="receiver_close",e.settled="settled"}(r||(r={})),function(e){e.sendable="sendable",e.senderOpen="sender_open",e.senderDraining="sender_draining",e.senderFlow="sender_flow",e.senderError="sender_error",e.senderClose="sender_close",e.accepted="accepted",e.released="released",e.rejected="rejected",e.modified="modified",e.settled="settled"}(o||(o={})),function(e){e.sessionOpen="session_open",e.sessionError="session_error",e.sessionClose="session_close",e.settled="settled"}(i||(i={})),function(e){e.connectionOpen="connection_open",e.connectionClose="connection_close",e.connectionError="connection_error",e.protocolError="protocol_error",e.error="error",e.disconnected="disconnected",e.settled="settled"}(s||(s={})),e.exports={ReceiverEvents:r,SenderEvents:o,SessionEvents:i,ConnectionEvents:s}},function(e,t,n){"use strict";(function(t){function n(e){return e}function r(e){return e instanceof ArrayBuffer?t.from(new Uint8Array(e)):t.from(e)}function o(e){return new Uint8Array(e)}function i(e){var t=n,i=n;return e.binaryType&&(e.binaryType="arraybuffer",t=r,i=o),{end:function(){e.close()},write:function(t){try{e.send(i(t),{binary:!0})}catch(t){e.onerror(t)}},on:function(n,r){"data"===n?e.onmessage=function(e){r(t(e.data))}:"end"===n?e.onclose=r:"error"===n?e.onerror=r:console.error("ERROR: Attempt to set unrecognised handler on websocket wrapper: "+n)},get_id_string:function(){return e.url}}}e.exports={connect:function(e){return function(t,n,r){return function(){return{connect:function(o,s,a,c){var u=new e(t,n,r);return u.onopen=c,i(u)}}}}},wrap:i}}).call(this,n(19).Buffer)},function(e,t,n){"use strict";var r=n(28);e.exports={selector:function(e){return{"jms-selector":r.wrap_described(e,77567109365764)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultOperationTimeoutInSeconds=60},function(e,t,n){"use strict";var r=n(106),o=n(78),i=n(61),s=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},c=Array.isArray,u=String.prototype.split,l=Array.prototype.push,d=function(e,t){l.apply(e,c(t)?t:[t])},h=Date.prototype.toISOString,p=i.default,f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,format:p,formatter:i.formatters[p],indices:!1,serializeDate:function(e){return h.call(e)},skipNulls:!1,strictNullHandling:!1},m={},g=function e(t,n,i,s,a,l,h,p,g,y,v,b,_,w,E,S){for(var O,C=t,I=S,T=0,A=!1;void 0!==(I=I.get(m))&&!A;){var k=I.get(t);if(T+=1,void 0!==k){if(k===T)throw new RangeError("Cyclic object value");A=!0}void 0===I.get(m)&&(T=0)}if("function"==typeof p?C=p(n,C):C instanceof Date?C=v(C):"comma"===i&&c(C)&&(C=o.maybeMap(C,(function(e){return e instanceof Date?v(e):e}))),null===C){if(a)return h&&!w?h(n,f.encoder,E,"key",b):n;C=""}if("string"==typeof(O=C)||"number"==typeof O||"boolean"==typeof O||"symbol"==typeof O||"bigint"==typeof O||o.isBuffer(C)){if(h){var P=w?n:h(n,f.encoder,E,"key",b);if("comma"===i&&w){for(var R=u.call(String(C),","),x="",N=0;N<R.length;++N)x+=(0===N?"":",")+_(h(R[N],f.encoder,E,"value",b));return[_(P)+(s&&c(C)&&1===R.length?"[]":"")+"="+x]}return[_(P)+"="+_(h(C,f.encoder,E,"value",b))]}return[_(n)+"="+_(String(C))]}var j,M=[];if(void 0===C)return M;if("comma"===i&&c(C))j=[{value:C.length>0?C.join(",")||null:void 0}];else if(c(p))j=p;else{var q=Object.keys(C);j=g?q.sort(g):q}for(var L=s&&c(C)&&1===C.length?n+"[]":n,U=0;U<j.length;++U){var H=j[U],D="object"==typeof H&&void 0!==H.value?H.value:C[H];if(!l||null!==D){var z=c(C)?"function"==typeof i?i(L,H):L:L+(y?"."+H:"["+H+"]");S.set(t,T);var $=r();$.set(m,S),d(M,e(D,z,i,s,a,l,h,p,g,y,v,b,_,w,E,$))}}return M};e.exports=function(e,t){var n,o=e,u=function(e){if(!e)return f;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||f.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=i.default;if(void 0!==e.format){if(!s.call(i.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=i.formatters[n],o=f.filter;return("function"==typeof e.filter||c(e.filter))&&(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:f.addQueryPrefix,allowDots:void 0===e.allowDots?f.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:f.charsetSentinel,delimiter:void 0===e.delimiter?f.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:f.encode,encoder:"function"==typeof e.encoder?e.encoder:f.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:f.encodeValuesOnly,filter:o,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:f.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:f.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:f.strictNullHandling}}(t);"function"==typeof u.filter?o=(0,u.filter)("",o):c(u.filter)&&(n=u.filter);var l,h=[];if("object"!=typeof o||null===o)return"";l=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var p=a[l];if(t&&"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var m="comma"===p&&t&&t.commaRoundTrip;n||(n=Object.keys(o)),u.sort&&n.sort(u.sort);for(var y=r(),v=0;v<n.length;++v){var b=n[v];u.skipNulls&&null===o[b]||d(h,g(o[b],b,p,m,u.strictNullHandling,u.skipNulls,u.encode?u.encoder:null,u.filter,u.sort,u.allowDots,u.serializeDate,u.format,u.formatter,u.encodeValuesOnly,u.charset,y))}var _=h.join(u.delimiter),w=!0===u.addQueryPrefix?"?":"";return u.charsetSentinel&&("iso-8859-1"===u.charset?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),_.length>0?w+_:""}},function(e,t,n){"use strict";var r=n(59),o=n(111),i=n(113),s=r("%TypeError%"),a=r("%WeakMap%",!0),c=r("%Map%",!0),u=o("WeakMap.prototype.get",!0),l=o("WeakMap.prototype.set",!0),d=o("WeakMap.prototype.has",!0),h=o("Map.prototype.get",!0),p=o("Map.prototype.set",!0),f=o("Map.prototype.has",!0),m=function(e,t){for(var n,r=e;null!==(n=r.next);r=n)if(n.key===t)return r.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,r={assert:function(e){if(!r.has(e))throw new s("Side channel does not contain "+i(e))},get:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(e)return u(e,r)}else if(c){if(t)return h(t,r)}else if(n)return function(e,t){var n=m(e,t);return n&&n.value}(n,r)},has:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(e)return d(e,r)}else if(c){if(t)return f(t,r)}else if(n)return function(e,t){return!!m(e,t)}(n,r);return!1},set:function(r,o){a&&r&&("object"==typeof r||"function"==typeof r)?(e||(e=new a),l(e,r,o)):c?(t||(t=new c),p(t,r,o)):(n||(n={key:{},next:null}),function(e,t,n){var r=m(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}}(n,r,o))}};return r}},function(e,t,n){"use strict";var r="undefined"!=typeof Symbol&&Symbol,o=n(108);e.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&o())))}},function(e,t,n){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},function(e,t,n){"use strict";var r="Function.prototype.bind called on incompatible ",o=Array.prototype.slice,i=Object.prototype.toString;e.exports=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==i.call(t))throw new TypeError(r+t);for(var n,s=o.call(arguments,1),a=function(){if(this instanceof n){var r=t.apply(this,s.concat(o.call(arguments)));return Object(r)===r?r:this}return t.apply(e,s.concat(o.call(arguments)))},c=Math.max(0,t.length-s.length),u=[],l=0;l<c;l++)u.push("$"+l);if(n=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(a),t.prototype){var d=function(){};d.prototype=t.prototype,n.prototype=new d,d.prototype=null}return n}},function(e,t,n){"use strict";var r=n(60);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},function(e,t,n){"use strict";var r=n(59),o=n(112),i=o(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&i(e,".prototype.")>-1?o(n):n}},function(e,t,n){"use strict";var r=n(60),o=n(59),i=o("%Function.prototype.apply%"),s=o("%Function.prototype.call%"),a=o("%Reflect.apply%",!0)||r.call(s,i),c=o("%Object.getOwnPropertyDescriptor%",!0),u=o("%Object.defineProperty%",!0),l=o("%Math.max%");if(u)try{u({},"a",{value:1})}catch(e){u=null}e.exports=function(e){var t=a(r,s,arguments);if(c&&u){var n=c(t,"length");n.configurable&&u(t,"length",{value:1+l(0,e.length-(arguments.length-1))})}return t};var d=function(){return a(r,i,arguments)};u?u(e.exports,"apply",{value:d}):e.exports.apply=d},function(e,t,n){var r="function"==typeof Map&&Map.prototype,o=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,i=r&&o&&"function"==typeof o.get?o.get:null,s=r&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,c=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,u=a&&c&&"function"==typeof c.get?c.get:null,l=a&&Set.prototype.forEach,d="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,h="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,v=String.prototype.slice,b=String.prototype.replace,_=String.prototype.toUpperCase,w=String.prototype.toLowerCase,E=RegExp.prototype.test,S=Array.prototype.concat,O=Array.prototype.join,C=Array.prototype.slice,I=Math.floor,T="function"==typeof BigInt?BigInt.prototype.valueOf:null,A=Object.getOwnPropertySymbols,k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,P="function"==typeof Symbol&&"object"==typeof Symbol.iterator,R="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===P||"symbol")?Symbol.toStringTag:null,x=Object.prototype.propertyIsEnumerable,N=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function j(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||E.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var r=e<0?-I(-e):I(e);if(r!==e){var o=String(r),i=v.call(t,o.length+1);return b.call(o,n,"$&_")+"."+b.call(b.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(t,n,"$&_")}var M=n(114),q=M.custom,L=$(q)?q:null;function U(e,t,n){var r="double"===(n.quoteStyle||t)?'"':"'";return r+e+r}function H(e){return b.call(String(e),/"/g,"&quot;")}function D(e){return!("[object Array]"!==K(e)||R&&"object"==typeof e&&R in e)}function z(e){return!("[object RegExp]"!==K(e)||R&&"object"==typeof e&&R in e)}function $(e){if(P)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!k)return!1;try{return k.call(e),!0}catch(e){}return!1}e.exports=function e(t,n,r,o){var a=n||{};if(F(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(F(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var c=!F(a,"customInspect")||a.customInspect;if("boolean"!=typeof c&&"symbol"!==c)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(F(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(F(a,"numericSeparator")&&"boolean"!=typeof a.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var m=a.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return function e(t,n){if(t.length>n.maxStringLength){var r=t.length-n.maxStringLength,o="... "+r+" more character"+(r>1?"s":"");return e(v.call(t,0,n.maxStringLength),n)+o}return U(b.call(b.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Y),"single",n)}(t,a);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var _=String(t);return m?j(t,_):_}if("bigint"==typeof t){var E=String(t)+"n";return m?j(t,E):E}var I=void 0===a.depth?5:a.depth;if(void 0===r&&(r=0),r>=I&&I>0&&"object"==typeof t)return D(t)?"[Array]":"[Object]";var A=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=O.call(Array(e.indent+1)," ")}return{base:n,prev:O.call(Array(t+1),n)}}(a,r);if(void 0===o)o=[];else if(G(o,t)>=0)return"[Circular]";function q(t,n,i){if(n&&(o=C.call(o)).push(n),i){var s={depth:a.depth};return F(a,"quoteStyle")&&(s.quoteStyle=a.quoteStyle),e(t,s,r+1,o)}return e(t,a,r+1,o)}if("function"==typeof t&&!z(t)){var B=function(e){if(e.name)return e.name;var t=y.call(g.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),Z=X(t,q);return"[Function"+(B?": "+B:" (anonymous)")+"]"+(Z.length>0?" { "+O.call(Z,", ")+" }":"")}if($(t)){var ee=P?b.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):k.call(t);return"object"!=typeof t||P?ee:W(ee)}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(t)){for(var te="<"+w.call(String(t.nodeName)),ne=t.attributes||[],re=0;re<ne.length;re++)te+=" "+ne[re].name+"="+U(H(ne[re].value),"double",a);return te+=">",t.childNodes&&t.childNodes.length&&(te+="..."),te+="</"+w.call(String(t.nodeName))+">"}if(D(t)){if(0===t.length)return"[]";var oe=X(t,q);return A&&!function(e){for(var t=0;t<e.length;t++)if(G(e[t],"\n")>=0)return!1;return!0}(oe)?"["+J(oe,A)+"]":"[ "+O.call(oe,", ")+" ]"}if(function(e){return!("[object Error]"!==K(e)||R&&"object"==typeof e&&R in e)}(t)){var ie=X(t,q);return"cause"in Error.prototype||!("cause"in t)||x.call(t,"cause")?0===ie.length?"["+String(t)+"]":"{ ["+String(t)+"] "+O.call(ie,", ")+" }":"{ ["+String(t)+"] "+O.call(S.call("[cause]: "+q(t.cause),ie),", ")+" }"}if("object"==typeof t&&c){if(L&&"function"==typeof t[L]&&M)return M(t,{depth:I-r});if("symbol"!==c&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!i||!e||"object"!=typeof e)return!1;try{i.call(e);try{u.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var se=[];return s.call(t,(function(e,n){se.push(q(n,t,!0)+" => "+q(e,t))})),Q("Map",i.call(t),se,A)}if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e);try{i.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ae=[];return l.call(t,(function(e){ae.push(q(e,t))})),Q("Set",u.call(t),ae,A)}if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return V("WeakMap");if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return V("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return V("WeakRef");if(function(e){return!("[object Number]"!==K(e)||R&&"object"==typeof e&&R in e)}(t))return W(q(Number(t)));if(function(e){if(!e||"object"!=typeof e||!T)return!1;try{return T.call(e),!0}catch(e){}return!1}(t))return W(q(T.call(t)));if(function(e){return!("[object Boolean]"!==K(e)||R&&"object"==typeof e&&R in e)}(t))return W(f.call(t));if(function(e){return!("[object String]"!==K(e)||R&&"object"==typeof e&&R in e)}(t))return W(q(String(t)));if(!function(e){return!("[object Date]"!==K(e)||R&&"object"==typeof e&&R in e)}(t)&&!z(t)){var ce=X(t,q),ue=N?N(t)===Object.prototype:t instanceof Object||t.constructor===Object,le=t instanceof Object?"":"null prototype",de=!ue&&R&&Object(t)===t&&R in t?v.call(K(t),8,-1):le?"Object":"",he=(ue||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(de||le?"["+O.call(S.call([],de||[],le||[]),": ")+"] ":"");return 0===ce.length?he+"{}":A?he+"{"+J(ce,A)+"}":he+"{ "+O.call(ce,", ")+" }"}return String(t)};var B=Object.prototype.hasOwnProperty||function(e){return e in this};function F(e,t){return B.call(e,t)}function K(e){return m.call(e)}function G(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function Y(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+_.call(t.toString(16))}function W(e){return"Object("+e+")"}function V(e){return e+" { ? }"}function Q(e,t,n,r){return e+" ("+t+") {"+(r?J(n,r):O.call(n,", "))+"}"}function J(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+O.call(e,","+n)+"\n"+t.prev}function X(e,t){var n=D(e),r=[];if(n){r.length=e.length;for(var o=0;o<e.length;o++)r[o]=F(e,o)?t(e[o],e):""}var i,s="function"==typeof A?A(e):[];if(P){i={};for(var a=0;a<s.length;a++)i["$"+s[a]]=s[a]}for(var c in e)F(e,c)&&(n&&String(Number(c))===c&&c<e.length||P&&i["$"+c]instanceof Symbol||(E.call(/[^\w$]/,c)?r.push(t(c,e)+": "+t(e[c],e)):r.push(c+": "+t(e[c],e))));if("function"==typeof A)for(var u=0;u<s.length;u++)x.call(e,s[u])&&r.push("["+t(s[u])+"]: "+t(e[s[u]],e));return r}},function(e,t){},function(e,t,n){"use strict";var r=n(78),o=Object.prototype.hasOwnProperty,i=Array.isArray,s={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},u=function(e,t,n,r){if(e){var i=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,s=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(i),u=a?i.slice(0,a.index):i,l=[];if(u){if(!n.plainObjects&&o.call(Object.prototype,u)&&!n.allowPrototypes)return;l.push(u)}for(var d=0;n.depth>0&&null!==(a=s.exec(i))&&d<n.depth;){if(d+=1,!n.plainObjects&&o.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(a[1])}return a&&l.push("["+i.slice(a.index)+"]"),function(e,t,n,r){for(var o=r?t:c(t,n),i=e.length-1;i>=0;--i){var s,a=e[i];if("[]"===a&&n.parseArrays)s=[].concat(o);else{s=n.plainObjects?Object.create(null):{};var u="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=parseInt(u,10);n.parseArrays||""!==u?!isNaN(l)&&a!==u&&String(l)===u&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(s=[])[l]=o:"__proto__"!==u&&(s[u]=o):s={0:o}}o=s}return o}(l,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return s;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?s.charset:e.charset;return{allowDots:void 0===e.allowDots?s.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:s.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:s.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:s.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:s.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:s.comma,decoder:"function"==typeof e.decoder?e.decoder:s.decoder,delimiter:"string"==typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:s.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:s.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:s.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:s.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:s.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:s.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var l="string"==typeof e?function(e,t){var n,u={},l=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,h=l.split(t.delimiter,d),p=-1,f=t.charset;if(t.charsetSentinel)for(n=0;n<h.length;++n)0===h[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===h[n]?f="utf-8":"utf8=%26%2310003%3B"===h[n]&&(f="iso-8859-1"),p=n,n=h.length);for(n=0;n<h.length;++n)if(n!==p){var m,g,y=h[n],v=y.indexOf("]="),b=-1===v?y.indexOf("="):v+1;-1===b?(m=t.decoder(y,s.decoder,f,"key"),g=t.strictNullHandling?null:""):(m=t.decoder(y.slice(0,b),s.decoder,f,"key"),g=r.maybeMap(c(y.slice(b+1),t),(function(e){return t.decoder(e,s.decoder,f,"value")}))),g&&t.interpretNumericEntities&&"iso-8859-1"===f&&(g=a(g)),y.indexOf("[]=")>-1&&(g=i(g)?[g]:g),o.call(u,m)?u[m]=r.combine(u[m],g):u[m]=g}return u}(e,n):e,d=n.plainObjects?Object.create(null):{},h=Object.keys(l),p=0;p<h.length;++p){var f=h[p],m=u(f,l[f],n,"string"==typeof e);d=r.merge(d,m,n)}return!0===n.allowSparse?d:r.compact(d)}},function(e,t,n){"use strict";n.r(t),n.d(t,"ChainedTokenCredential",(function(){return u})),n.d(t,"EnvironmentCredential",(function(){return h})),n.d(t,"ClientSecretCredential",(function(){return P})),n.d(t,"ClientCertificateCredential",(function(){return N})),n.d(t,"InteractiveBrowserCredential",(function(){return yn})),n.d(t,"VisualStudioCodeCredential",(function(){return w})),n.d(t,"AzureCliCredential",(function(){return v})),n.d(t,"ManagedIdentityCredential",(function(){return m})),n.d(t,"DeviceCodeCredential",(function(){return _n})),n.d(t,"DefaultAzureCredential",(function(){return E})),n.d(t,"UsernamePasswordCredential",(function(){return En})),n.d(t,"AuthorizationCodeCredential",(function(){return Cn})),n.d(t,"AuthenticationError",(function(){return o.c})),n.d(t,"AggregateAuthenticationError",(function(){return o.a})),n.d(t,"AuthenticationErrorName",(function(){return o.d})),n.d(t,"AggregateAuthenticationErrorName",(function(){return o.b})),n.d(t,"CredentialUnavailable",(function(){return o.e})),n.d(t,"logger",(function(){return a.d})),n.d(t,"AzureAuthorityHosts",(function(){return mn.a})),n.d(t,"getDefaultAzureCredential",(function(){return In}));var r=n(8),o=n(17),i=n(20),s=n(39),a=n(3);const c=Object(a.a)("ChainedTokenCredential");class u{constructor(...e){this.UnavailableMessage="ChainedTokenCredential => failed to retrieve a token from the included credentials",this._sources=[],this._sources=e}getToken(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){let n=null;const r=[],{span:u,updatedOptions:l}=Object(i.a)("ChainedTokenCredential-getToken",t);for(let t=0;t<this._sources.length&&null===n;t++)try{n=yield this._sources[t].getToken(e,l)}catch(t){if(!(t instanceof o.e))throw c.getToken.info(Object(a.b)(e,t)),t;r.push(t)}if(!n&&r.length>0){const t=new o.a(r);throw u.setStatus({code:s.b.ERROR,message:t.message}),c.getToken.info(Object(a.b)(e,t)),t}return u.end(),c.getToken.info(Object(a.c)(e)),n}))}}const l=new Error("EnvironmentCredential is not supported in the browser."),d=Object(a.a)("EnvironmentCredential");class h{constructor(){throw d.info(Object(a.b)("",l)),l}getToken(){throw d.getToken.info(Object(a.b)("",l)),l}}const p=new Error("ManagedIdentityCredential is not supported in the browser."),f=Object(a.a)("ManagedIdentityCredential");class m{constructor(){throw f.info(Object(a.b)("",p)),p}getToken(){return Object(r.__awaiter)(this,void 0,void 0,(function*(){throw f.getToken.info(Object(a.b)("",p)),p}))}}const g=new Error("AzureCliCredential is not supported in the browser."),y=Object(a.a)("AzureCliCredential");class v{constructor(){throw y.info(Object(a.b)("",g)),g}getToken(){throw y.getToken.info(Object(a.b)("",g)),g}}const b=new Error("VisualStudioCodeCredential is not supported in the browser."),_=Object(a.a)("VisualStudioCodeCredential");class w{constructor(){throw _.info(Object(a.b)("",b)),b}getToken(){throw _.getToken.info(Object(a.b)("",b)),b}}class E extends u{constructor(e){const t=[];t.push(new h(e)),t.push(new m(e)),t.push(new v),t.push(new w(e)),super(...t)}}var S=n(33),O=n.n(S),C=n(64),I=n(26),T=n(48),A=n(35);const k=Object(a.a)("ClientSecretCredential");class P{constructor(e,t,n,r){this.identityClient=new T.a(r),this.tenantId=e,this.clientId=t,this.clientSecret=n}getToken(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){const{span:n,updatedOptions:r}=Object(i.a)("ClientSecretCredential-getToken",t);try{const o=Object(A.a)(this.tenantId),i=Object(C.a)({url:`${this.identityClient.authorityHost}/${this.tenantId}/${o}`,method:"POST",body:O.a.stringify({response_type:"token",grant_type:"client_credentials",client_id:this.clientId,client_secret:this.clientSecret,scope:"string"==typeof e?e:e.join(" ")}),headers:Object(I.a)({Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}),abortSignal:t&&t.abortSignal,tracingOptions:{spanOptions:r.tracingOptions&&r.tracingOptions.spanOptions,tracingContext:r.tracingOptions&&r.tracingOptions.tracingContext}}),s=yield this.identityClient.sendTokenRequest(i);return k.getToken.info(Object(a.c)(e)),s&&s.accessToken||null}catch(t){throw n.setStatus({code:s.b.ERROR,message:t.message}),k.getToken.info(Object(a.b)(e,t)),t}finally{n.end()}}))}}const R=new Error("ClientCertificateCredential is not supported in the browser."),x=Object(a.a)("ClientCertificateCredential");class N{constructor(){throw x.info(Object(a.b)("",R)),R}getToken(){throw x.getToken.info(Object(a.b)("",R)),R}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var j=function(e,t){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function M(e,t){function n(){this.constructor=e}j(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var q=function(){return(q=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function L(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function U(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function H(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r}var D,z=function(){function e(){}return e.createNewGuid=function(){var t=window.crypto;if(t&&t.getRandomValues){var n=new Uint8Array(16);return t.getRandomValues(n),n[6]|=64,n[6]&=79,n[8]|=128,n[8]&=191,e.decimalToHex(n[0])+e.decimalToHex(n[1])+e.decimalToHex(n[2])+e.decimalToHex(n[3])+"-"+e.decimalToHex(n[4])+e.decimalToHex(n[5])+"-"+e.decimalToHex(n[6])+e.decimalToHex(n[7])+"-"+e.decimalToHex(n[8])+e.decimalToHex(n[9])+"-"+e.decimalToHex(n[10])+e.decimalToHex(n[11])+e.decimalToHex(n[12])+e.decimalToHex(n[13])+e.decimalToHex(n[14])+e.decimalToHex(n[15])}for(var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",o="0123456789abcdef",i=0,s="",a=0;a<36;a++)"-"!==r[a]&&"4"!==r[a]&&(i=16*Math.random()|0),"x"===r[a]?s+=o[i]:"y"===r[a]?(i&=3,s+=o[i|=8]):s+=r[a];return s},e.isGuid=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e.decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t},e.base64Encode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))})))},e.base64Decode=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("Invalid base64 string")}return decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))},e.deserialize=function(e){var t,n=/\+/g,r=/([^&=]+)=([^&]*)/g,o=function(e){return decodeURIComponent(e.replace(n," "))},i={};for(t=r.exec(e);t;)i[o(t[1])]=o(t[2]),t=r.exec(e);return i},e}(),$=function(){function e(){}return Object.defineProperty(e,"libraryName",{get:function(){return"Msal.js"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"claims",{get:function(){return"claims"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"clientId",{get:function(){return"clientId"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"adalIdToken",{get:function(){return"adal.idtoken"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"cachePrefix",{get:function(){return"msal"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"scopes",{get:function(){return"scopes"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"no_account",{get:function(){return"NO_ACCOUNT"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"upn",{get:function(){return"upn"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"domain_hint",{get:function(){return"domain_hint"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"prompt_select_account",{get:function(){return"&prompt=select_account"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"prompt_none",{get:function(){return"&prompt=none"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"prompt",{get:function(){return"prompt"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"response_mode_fragment",{get:function(){return"&response_mode=fragment"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"resourceDelimiter",{get:function(){return"|"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"cacheDelimiter",{get:function(){return"."},enumerable:!1,configurable:!0}),Object.defineProperty(e,"popUpWidth",{get:function(){return this._popUpWidth},set:function(e){this._popUpWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"popUpHeight",{get:function(){return this._popUpHeight},set:function(e){this._popUpHeight=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"login",{get:function(){return"LOGIN"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"renewToken",{get:function(){return"RENEW_TOKEN"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"unknown",{get:function(){return"UNKNOWN"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ADFS",{get:function(){return"adfs"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"homeAccountIdentifier",{get:function(){return"homeAccountIdentifier"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"common",{get:function(){return"common"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"openidScope",{get:function(){return"openid"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"profileScope",{get:function(){return"profile"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"oidcScopes",{get:function(){return[this.openidScope,this.profileScope]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"interactionTypeRedirect",{get:function(){return"redirectInteraction"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"interactionTypePopup",{get:function(){return"popupInteraction"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"interactionTypeSilent",{get:function(){return"silentInteraction"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"inProgress",{get:function(){return"inProgress"},enumerable:!1,configurable:!0}),e._popUpWidth=483,e._popUpHeight=600,e}();!function(e){e.SCOPE="scope",e.STATE="state",e.ERROR="error",e.ERROR_DESCRIPTION="error_description",e.ACCESS_TOKEN="access_token",e.ID_TOKEN="id_token",e.EXPIRES_IN="expires_in",e.SESSION_STATE="session_state",e.CLIENT_INFO="client_info"}(D||(D={}));var B,F,K,G="id_token",Y="token",W="id_token token";!function(e){e.AUTHORITY="authority",e.ACQUIRE_TOKEN_ACCOUNT="acquireTokenAccount",e.SESSION_STATE="session.state",e.STATE_LOGIN="state.login",e.STATE_ACQ_TOKEN="state.acquireToken",e.STATE_RENEW="state.renew",e.NONCE_IDTOKEN="nonce.idtoken",e.LOGIN_REQUEST="login.request",e.RENEW_STATUS="token.renew.status",e.URL_HASH="urlHash",e.INTERACTION_STATUS="interaction.status",e.REDIRECT_REQUEST="redirect_request"}(B||(B={})),function(e){e.IDTOKEN="idtoken",e.CLIENT_INFO="client.info"}(F||(F={})),function(e){e.LOGIN_ERROR="login.error",e.ERROR="error",e.ERROR_DESC="error.description"}(K||(K={}));var V;!function(e){e.ACCOUNT="account",e.SID="sid",e.LOGIN_HINT="login_hint",e.ORGANIZATIONS="organizations",e.CONSUMERS="consumers",e.ID_TOKEN="id_token",e.ACCOUNT_ID="accountIdentifier",e.HOMEACCOUNT_ID="homeAccountIdentifier"}(V||(V={}));var Q,J=[V.SID,V.LOGIN_HINT],X="GET",Z={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none"},ee="msalIdTokenFrame",te="msalRenewFrame",ne={code:"unexpected_error",desc:"Unexpected error in authentication."},re={code:"no_window_object",desc:"No window object available. Details:"},oe=function(e){function t(n,r){var o=e.call(this,r)||this;return Object.setPrototypeOf(o,t.prototype),o.errorCode=n,o.errorMessage=r,o.name="AuthError",o}return M(t,e),t.createUnexpectedError=function(e){return new t(ne.code,ne.desc+": "+e)},t.createNoWindowObjectError=function(e){return new t(re.code,re.desc+" "+e)},t}(Error),ie=function(){function e(){}return e.isEmpty=function(e){return void 0===e||!e||0===e.length},e.validateAndParseJsonCacheKey=function(e){try{var t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}},e}(),se={code:"endpoints_resolution_error",desc:"Error: could not resolve endpoints. Please check network and try again."},ae={code:"popup_window_error",desc:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser."},ce={code:"token_renewal_error",desc:"Token renewal operation failed due to timeout."},ue={code:"invalid_id_token",desc:"Invalid ID token format."},le={code:"invalid_state_error",desc:"Invalid state."},de={code:"nonce_mismatch_error",desc:"Nonce is not matching, Nonce received: "},he={code:"login_progress_error",desc:"Login_In_Progress: Error during login call - login is already in progress."},pe={code:"acquiretoken_progress_error",desc:"AcquireToken_In_Progress: Error during login call - login is already in progress."},fe={code:"user_cancelled",desc:"User cancelled the flow."},me={code:"callback_error",desc:"Error occurred in token received callback function."},ge={code:"user_login_error",desc:"User login is required. For silent calls, request must contain either sid or login_hint"},ye={code:"user_non_existent",desc:"User object does not exist. Please call a login API."},ve={code:"client_info_decoding_error",desc:"The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause."},be={code:"client_info_not_populated_error",desc:"The service did not populate client_info in the response, Please verify with the service team"},_e={code:"null_or_empty_id_token",desc:"The idToken is null or empty. Please review the trace to determine the root cause."},we={code:"id_token_parsing_error",desc:"ID token cannot be parsed. Please review stack trace to determine root cause."},Ee={code:"token_encoding_error",desc:"The token to be decoded is not encoded correctly."},Se={code:"invalid_interaction_type",desc:"The interaction type passed to the handler was incorrect or unknown"},Oe={code:"cannot_parse_cache",desc:"The cached token key is not a valid JSON and cannot be parsed"},Ce={code:"block_token_requests",desc:"Token calls are blocked in hidden iframes"},Ie=function(e){function t(n,r){var o=e.call(this,n,r)||this;return o.name="ClientAuthError",Object.setPrototypeOf(o,t.prototype),o}return M(t,e),t.createEndpointResolutionError=function(e){var n=se.desc;return e&&!ie.isEmpty(e)&&(n+=" Details: "+e),new t(se.code,n)},t.createPopupWindowError=function(e){var n=ae.desc;return e&&!ie.isEmpty(e)&&(n+=" Details: "+e),new t(ae.code,n)},t.createTokenRenewalTimeoutError=function(){return new t(ce.code,ce.desc)},t.createInvalidIdTokenError=function(e){return new t(ue.code,ue.desc+" Given token: "+e)},t.createInvalidStateError=function(e,n){return new t(le.code,le.desc+" "+e+", state expected : "+n+".")},t.createNonceMismatchError=function(e,n){return new t(de.code,de.desc+" "+e+", nonce expected : "+n+".")},t.createLoginInProgressError=function(){return new t(he.code,he.desc)},t.createAcquireTokenInProgressError=function(){return new t(pe.code,pe.desc)},t.createUserCancelledError=function(){return new t(fe.code,fe.desc)},t.createErrorInCallbackFunction=function(e){return new t(me.code,me.desc+" "+e+".")},t.createUserLoginRequiredError=function(){return new t(ge.code,ge.desc)},t.createUserDoesNotExistError=function(){return new t(ye.code,ye.desc)},t.createClientInfoDecodingError=function(e){return new t(ve.code,ve.desc+" Failed with error: "+e)},t.createClientInfoNotPopulatedError=function(e){return new t(be.code,be.desc+" Failed with error: "+e)},t.createIdTokenNullOrEmptyError=function(e){return new t(_e.code,_e.desc+" Raw ID Token Value: "+e)},t.createIdTokenParsingError=function(e){return new t(we.code,we.desc+" Failed with error: "+e)},t.createTokenEncodingError=function(e){return new t(Ee.code,Ee.desc+" Attempted to decode: "+e)},t.createInvalidInteractionTypeError=function(){return new t(Se.code,Se.desc)},t.createCacheParseError=function(e){var n="invalid key: "+e+", "+Oe.desc;return new t(Oe.code,n)},t.createBlockTokenRequestsInHiddenIframeError=function(){return new t(Ce.code,Ce.desc)},t}(oe),Te={code:"no_config_set",desc:"Configuration has not been set. Please call the UserAgentApplication constructor with a valid Configuration object."},Ae={code:"storage_not_supported",desc:"The value for the cacheLocation is not supported."},ke={code:"no_redirect_callbacks",desc:"No redirect callbacks have been set. Please call handleRedirectCallback() with the appropriate function arguments before continuing. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},Pe={code:"invalid_callback_object",desc:"The object passed for the callback was invalid. More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."},Re={code:"scopes_required",desc:"Scopes are required to obtain an access token."},xe={code:"empty_input_scopes_error",desc:"Scopes cannot be passed as empty array."},Ne={code:"nonarray_input_scopes_error",desc:"Scopes cannot be passed as non-array."},je={code:"invalid_prompt_value",desc:"Supported prompt values are 'login', 'select_account', 'consent' and 'none'"},Me={code:"invalid_authority_type",desc:"The given authority is not a valid type of authority supported by MSAL. Please see here for valid authorities: <insert URL here>."},qe={code:"authority_uri_insecure",desc:"Authority URIs must use https."},Le={code:"authority_uri_invalid_path",desc:"Given authority URI is invalid."},Ue={code:"untrusted_authority",desc:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter or set validateAuthority=false."},He={code:"b2c_known_authorities_not_set",desc:"Must set known authorities when validateAuthority is set to True and using B2C"},De={code:"claims_request_parsing_error",desc:"Could not parse the given claims request object."},ze={code:"empty_request_error",desc:"Request object is required."},$e={code:"invalid_guid_sent_as_correlationId",desc:"Please set the correlationId as a valid guid"},Be={code:"telemetry_config_error",desc:"Telemetry config is not configured with required values"},Fe={code:"sso_silent_error",desc:"request must contain either sid or login_hint"},Ke={code:"authority_metadata_error",desc:"Invalid authorityMetadata. Must be a JSON object containing authorization_endpoint, end_session_endpoint, and issuer fields."},Ge=function(e){function t(n,r){var o=e.call(this,n,r)||this;return o.name="ClientConfigurationError",Object.setPrototypeOf(o,t.prototype),o}return M(t,e),t.createNoSetConfigurationError=function(){return new t(Te.code,""+Te.desc)},t.createStorageNotSupportedError=function(e){return new t(Ae.code,Ae.desc+" Given location: "+e)},t.createRedirectCallbacksNotSetError=function(){return new t(ke.code,ke.desc)},t.createInvalidCallbackObjectError=function(e){return new t(Pe.code,Pe.desc+" Given value for callback function: "+e)},t.createEmptyScopesArrayError=function(e){return new t(xe.code,xe.desc+" Given value: "+e+".")},t.createScopesNonArrayError=function(e){return new t(Ne.code,Ne.desc+" Given value: "+e+".")},t.createScopesRequiredError=function(e){return new t(Re.code,Re.desc+" Given value: "+e)},t.createInvalidPromptError=function(e){return new t(je.code,je.desc+" Given value: "+e)},t.createClaimsRequestParsingError=function(e){return new t(De.code,De.desc+" Given value: "+e)},t.createEmptyRequestError=function(){var e=ze;return new t(e.code,e.desc)},t.createInvalidCorrelationIdError=function(){return new t($e.code,$e.desc)},t.createKnownAuthoritiesNotSetError=function(){return new t(He.code,He.desc)},t.createInvalidAuthorityTypeError=function(){return new t(Me.code,Me.desc)},t.createUntrustedAuthorityError=function(e){return new t(Ue.code,Ue.desc+" Provided Authority: "+e)},t.createTelemetryConfigError=function(e){var n=Be,r=n.code,o=n.desc,i={applicationName:"string",applicationVersion:"string",telemetryEmitter:"function"};return new t(r,o+" mising values: "+Object.keys(i).reduce((function(t,n){return e[n]?t:t.concat([n+" ("+i[n]+")"])}),[]).join(","))},t.createSsoSilentError=function(){return new t(Fe.code,Fe.desc)},t.createInvalidAuthorityMetadataError=function(){return new t(Ke.code,Ke.desc)},t}(Ie),Ye=function(){function e(){}return e.isIntersectingScopes=function(e,t){for(var n=this.trimAndConvertArrayToLowerCase(H(e)),r=this.trimAndConvertArrayToLowerCase(H(t)),o=0;o<r.length;o++)if(n.indexOf(r[o].toLowerCase())>-1)return!0;return!1},e.containsScope=function(e,t){var n=this.trimAndConvertArrayToLowerCase(H(e));return this.trimAndConvertArrayToLowerCase(H(t)).every((function(e){return n.indexOf(e.toString().toLowerCase())>=0}))},e.trimAndConvertToLowerCase=function(e){return e.trim().toLowerCase()},e.trimAndConvertArrayToLowerCase=function(e){var t=this;return e.map((function(e){return t.trimAndConvertToLowerCase(e)}))},e.trimScopes=function(e){return e.map((function(e){return e.trim()}))},e.removeElement=function(e,t){var n=this.trimAndConvertToLowerCase(t);return e.filter((function(e){return e!==n}))},e.parseScope=function(e){var t="";if(e)for(var n=0;n<e.length;++n)t+=n!==e.length-1?e[n]+" ":e[n];return t},e.validateInputScope=function(e,t){if(e){if(!Array.isArray(e))throw Ge.createScopesNonArrayError(e);if(e.length<1&&t)throw Ge.createEmptyScopesArrayError(e.toString())}else if(t)throw Ge.createScopesRequiredError(e)},e.getScopeFromState=function(e){if(e){var t=e.indexOf($.resourceDelimiter);if(t>-1&&t+1<e.length)return e.substring(t+1)}return""},e.appendScopes=function(e,t){if(e){var n=t?this.trimAndConvertArrayToLowerCase(H(t)):null,r=this.trimAndConvertArrayToLowerCase(H(e));return n?H(r,n):r}return null},e.onlyContainsOidcScopes=function(e){var t=e.length,n=0;return e.indexOf($.openidScope)>-1&&(n+=1),e.indexOf($.profileScope)>-1&&(n+=1),t>0&&t===n},e.containsAnyOidcScopes=function(e){var t=e.indexOf($.openidScope)>-1,n=e.indexOf($.profileScope)>-1;return t||n},e.onlyContainsClientId=function(e,t){return!!e&&e.indexOf(t)>-1&&1===e.length},e.appendDefaultScopes=function(e){var t=e;return-1===t.indexOf($.openidScope)&&t.push($.openidScope),-1===t.indexOf($.profileScope)&&t.push($.profileScope),t},e.removeDefaultScopes=function(e){return e.filter((function(e){return e!==$.openidScope&&e!==$.profileScope}))},e.translateClientIdIfSingleScope=function(e,t){return this.onlyContainsClientId(e,t)?$.oidcScopes:e},e}(),We=function(){function e(){}return e.createNavigateUrl=function(e){var t=this.createNavigationUrlString(e),n=e.authorityInstance.AuthorizationEndpoint;return n.indexOf("?")<0?n+="?":n+="&",""+n+t.join("&")},e.createNavigationUrlString=function(e){var t=Ye.appendDefaultScopes(e.scopes),n=[];return n.push("response_type="+e.responseType),n.push("scope="+encodeURIComponent(Ye.parseScope(t))),n.push("client_id="+encodeURIComponent(e.clientId)),n.push("redirect_uri="+encodeURIComponent(e.redirectUri)),n.push("state="+encodeURIComponent(e.state)),n.push("nonce="+encodeURIComponent(e.nonce)),n.push("client_info=1"),n.push("x-client-SKU="+e.xClientSku),n.push("x-client-Ver="+e.xClientVer),e.promptValue&&n.push("prompt="+encodeURIComponent(e.promptValue)),e.claimsValue&&n.push("claims="+encodeURIComponent(e.claimsValue)),e.queryParameters&&n.push(e.queryParameters),e.extraQueryParameters&&n.push(e.extraQueryParameters),n.push("client-request-id="+encodeURIComponent(e.correlationId)),n},e.getCurrentUrl=function(){return window.location.href.split("?")[0].split("#")[0]},e.removeHashFromUrl=function(e){return e.split("#")[0]},e.replaceTenantPath=function(e,t){var n=e.toLowerCase(),r=this.GetUrlComponents(n),o=r.PathSegments;return!t||0===o.length||o[0]!==$.common&&o[0]!==V.ORGANIZATIONS&&o[0]!==V.CONSUMERS||(o[0]=t),this.constructAuthorityUriFromObject(r,o)},e.constructAuthorityUriFromObject=function(e,t){return this.CanonicalizeUri(e.Protocol+"//"+e.HostNameAndPort+"/"+t.join("/"))},e.isCommonAuthority=function(e){var t=this.CanonicalizeUri(e),n=this.GetUrlComponents(t).PathSegments;return 0!==n.length&&n[0]===$.common},e.isOrganizationsAuthority=function(e){var t=this.CanonicalizeUri(e),n=this.GetUrlComponents(t).PathSegments;return 0!==n.length&&n[0]===V.ORGANIZATIONS},e.isConsumersAuthority=function(e){var t=this.CanonicalizeUri(e),n=this.GetUrlComponents(t).PathSegments;return 0!==n.length&&n[0]===V.CONSUMERS},e.GetUrlComponents=function(e){if(!e)throw"Url required";var t=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),n=e.match(t);if(!n||n.length<6)throw"Valid url required";var r={Protocol:n[1],HostNameAndPort:n[4],AbsolutePath:n[5]},o=r.AbsolutePath.split("/");return o=o.filter((function(e){return e&&e.length>0})),r.PathSegments=o,n[6]&&(r.Search=n[6]),n[8]&&(r.Hash=n[8]),r},e.CanonicalizeUri=function(t){if(t){var n=t.toLowerCase();return e.endsWith(n,"/")||(n+="/"),n}return t},e.endsWith=function(e,t){return!(!e||!t)&&-1!==e.indexOf(t,e.length-t.length)},e.urlRemoveQueryStringParameter=function(e,t){if(ie.isEmpty(e))return e;var n=new RegExp("(\\&"+t+"=)[^&]+");return e.replace(n,""),n=new RegExp("("+t+"=)[^&]+&"),e.replace(n,""),n=new RegExp("("+t+"=)[^&]+"),e.replace(n,"")},e.getHashFromUrl=function(e){var t=e.indexOf("#"),n=e.indexOf("#/");return n>-1?e.substring(n+2):t>-1?e.substring(t+1):e},e.urlContainsHash=function(t){var n=e.deserializeHash(t);return n.hasOwnProperty(D.ERROR_DESCRIPTION)||n.hasOwnProperty(D.ERROR)||n.hasOwnProperty(D.ACCESS_TOKEN)||n.hasOwnProperty(D.ID_TOKEN)},e.deserializeHash=function(t){var n=e.getHashFromUrl(t);return z.deserialize(n)},e.getHostFromUri=function(e){var t=String(e).replace(/^(https?:)\/\//,"");return t=t.split("/")[0]},e}(),Ve=function(e,t,n,r,o){this.authority=We.CanonicalizeUri(e),this.clientId=t,this.scopes=n,this.homeAccountIdentifier=z.base64Encode(r)+"."+z.base64Encode(o)},Qe=function(e,t,n,r){this.accessToken=e,this.idToken=t,this.expiresIn=n,this.homeAccountIdentifier=r},Je=function(){function e(e,t,n,r,o,i,s){this.authorityInstance=e,this.clientId=t,this.nonce=z.createNewGuid(),this.scopes=o?H(o):$.oidcScopes,this.scopes=Ye.trimScopes(this.scopes),this.state=i,this.correlationId=s,this.xClientSku="MSAL.JS",this.xClientVer="1.4.17",this.responseType=n,this.redirectUri=r}return Object.defineProperty(e.prototype,"authority",{get:function(){return this.authorityInstance?this.authorityInstance.CanonicalAuthority:null},enumerable:!1,configurable:!0}),e.prototype.populateQueryParams=function(t,n,r,o){var i={};n&&(n.prompt&&(this.promptValue=n.prompt),n.claimsRequest&&(this.claimsValue=n.claimsRequest),e.isSSOParam(n)&&(i=this.constructUnifiedCacheQueryParameter(n,null))),r&&(i=this.constructUnifiedCacheQueryParameter(null,r)),i=this.addHintParameters(t,i);var s=n?n.extraQueryParameters:null;this.queryParameters=e.generateQueryParametersString(i),this.extraQueryParameters=e.generateQueryParametersString(s,o)},e.prototype.constructUnifiedCacheQueryParameter=function(e,t){var n,r,o;if(e)if(e.account){var i=e.account;(null===(n=i.idTokenClaims)||void 0===n?void 0:n.login_hint)?(r=V.LOGIN_HINT,o=i.idTokenClaims.login_hint):i.sid?(r=V.SID,o=i.sid):i.userName&&(r=V.LOGIN_HINT,o=i.userName)}else e.sid?(r=V.SID,o=e.sid):e.loginHint&&(r=V.LOGIN_HINT,o=e.loginHint);else t&&t.hasOwnProperty($.upn)&&(r=V.ID_TOKEN,o=t.upn);return this.addSSOParameter(r,o)},e.prototype.addHintParameters=function(e,t){var n,r,o=t;return e&&(o[V.SID]||o[V.LOGIN_HINT]||((null===(n=e.idTokenClaims)||void 0===n?void 0:n.login_hint)?o=this.addSSOParameter(V.LOGIN_HINT,null===(r=e.idTokenClaims)||void 0===r?void 0:r.login_hint,o):e.sid&&this.promptValue===Z.NONE?o=this.addSSOParameter(V.SID,e.sid,o):e.userName&&(o=this.addSSOParameter(V.LOGIN_HINT,e.userName,o)))),o},e.prototype.addSSOParameter=function(e,t,n){var r=n||{};if(!t)return r;switch(e){case V.SID:r[V.SID]=t;break;case V.ID_TOKEN:case V.LOGIN_HINT:r[V.LOGIN_HINT]=t}return r},e.generateQueryParametersString=function(e,t){var n=null;return e&&Object.keys(e).forEach((function(r){r===$.domain_hint&&(t||e[V.SID])||(n?n+="&"+r+"="+encodeURIComponent(e[r]):n=r+"="+encodeURIComponent(e[r]))})),n},e.isSSOParam=function(e){return!(!e||!(e.account||e.sid||e.loginHint))},e.determineResponseType=function(e,t){return Ye.onlyContainsOidcScopes(t)?G:e?this.responseTypeForMatchingAccounts(t):W},e.responseTypeForMatchingAccounts=function(e){return Ye.containsAnyOidcScopes(e)?W:Y},e}(),Xe=function(){function e(){}return e.prototype.sendRequestAsync=function(e,t,n){var r=this;return new Promise((function(n,o){var i=new XMLHttpRequest;if(i.open(t,e,!0),i.onload=function(){var e;(i.status<200||i.status>=300)&&o(r.handleError(i.responseText));try{e=JSON.parse(i.responseText)}catch(e){o(r.handleError(i.responseText))}var t={statusCode:i.status,body:e};n(t)},i.onerror=function(){o(i.status)},t!==X)throw"not implemented";i.send()}))},e.prototype.handleError=function(e){var t;try{if((t=JSON.parse(e)).error)return t.error;throw e}catch(t){return e}},e}(),Ze=function(){function e(){}return e.setTrustedAuthoritiesFromConfig=function(t,n){t&&!this.getTrustedHostList().length&&n.forEach((function(t){e.TrustedHostList.push(t.toLowerCase())}))},e.getAliases=function(e,t,n){return L(this,void 0,void 0,(function(){var r,o,i,s;return U(this,(function(a){return r=new Xe,o=X,i="https://login.microsoftonline.com/common//discovery/instance?api-version=1.1&authorization_endpoint="+e+"oauth2/v2.0/authorize",s=t.createAndStartHttpEvent(n,o,i,"getAliases"),[2,r.sendRequestAsync(i,o,!0).then((function(e){return s.httpResponseStatus=e.statusCode,t.stopEvent(s),e.body.metadata})).catch((function(e){throw s.serverErrorCode=e,t.stopEvent(s),e}))]}))}))},e.setTrustedAuthoritiesFromNetwork=function(t,n,r){return L(this,void 0,void 0,(function(){var o;return U(this,(function(i){switch(i.label){case 0:return[4,this.getAliases(t,n,r)];case 1:return i.sent().forEach((function(t){t.aliases.forEach((function(t){e.TrustedHostList.push(t.toLowerCase())}))})),o=We.GetUrlComponents(t).HostNameAndPort,e.getTrustedHostList().length&&!e.IsInTrustedHostList(o)&&e.TrustedHostList.push(o.toLowerCase()),[2]}}))}))},e.getTrustedHostList=function(){return this.TrustedHostList},e.IsInTrustedHostList=function(e){return this.TrustedHostList.indexOf(e.toLowerCase())>-1},e.TrustedHostList=[],e}();!function(e){e[e.Default=0]="Default",e[e.Adfs=1]="Adfs"}(Q||(Q={}));var et,tt=function(){function e(e,t,n){this.IsValidationEnabled=t,this.CanonicalAuthority=e,this.validateAsUri(),this.tenantDiscoveryResponse=n}return e.isAdfs=function(e){var t=We.GetUrlComponents(e).PathSegments;return t.length&&t[0].toLowerCase()===$.ADFS},Object.defineProperty(e.prototype,"AuthorityType",{get:function(){return e.isAdfs(this.canonicalAuthority)?Q.Adfs:Q.Default},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Tenant",{get:function(){return this.CanonicalAuthorityUrlComponents.PathSegments[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"AuthorizationEndpoint",{get:function(){return this.validateResolved(),this.tenantDiscoveryResponse.AuthorizationEndpoint.replace(/{tenant}|{tenantid}/g,this.Tenant)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"EndSessionEndpoint",{get:function(){return this.validateResolved(),this.tenantDiscoveryResponse.EndSessionEndpoint.replace(/{tenant}|{tenantid}/g,this.Tenant)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"SelfSignedJwtAudience",{get:function(){return this.validateResolved(),this.tenantDiscoveryResponse.Issuer.replace(/{tenant}|{tenantid}/g,this.Tenant)},enumerable:!1,configurable:!0}),e.prototype.validateResolved=function(){if(!this.hasCachedMetadata())throw"Please call ResolveEndpointsAsync first"},Object.defineProperty(e.prototype,"CanonicalAuthority",{get:function(){return this.canonicalAuthority},set:function(e){this.canonicalAuthority=We.CanonicalizeUri(e),this.canonicalAuthorityUrlComponents=null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"CanonicalAuthorityUrlComponents",{get:function(){return this.canonicalAuthorityUrlComponents||(this.canonicalAuthorityUrlComponents=We.GetUrlComponents(this.CanonicalAuthority)),this.canonicalAuthorityUrlComponents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"DefaultOpenIdConfigurationEndpoint",{get:function(){return this.AuthorityType===Q.Adfs?this.CanonicalAuthority+".well-known/openid-configuration":this.CanonicalAuthority+"v2.0/.well-known/openid-configuration"},enumerable:!1,configurable:!0}),e.prototype.validateAsUri=function(){var e;try{e=this.CanonicalAuthorityUrlComponents}catch(e){throw Me}if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw qe;if(!e.PathSegments||e.PathSegments.length<1)throw Le},e.prototype.DiscoverEndpoints=function(e,t,n){var r=new Xe,o=X,i=t.createAndStartHttpEvent(n,o,e,"openIdConfigurationEndpoint");return r.sendRequestAsync(e,o,!0).then((function(e){return i.httpResponseStatus=e.statusCode,t.stopEvent(i),{AuthorizationEndpoint:e.body.authorization_endpoint,EndSessionEndpoint:e.body.end_session_endpoint,Issuer:e.body.issuer}})).catch((function(e){throw i.serverErrorCode=e,t.stopEvent(i),e}))},e.prototype.resolveEndpointsAsync=function(e,t){return L(this,void 0,void 0,(function(){var n,r,o;return U(this,(function(i){switch(i.label){case 0:return this.IsValidationEnabled?(n=this.canonicalAuthorityUrlComponents.HostNameAndPort,0!==Ze.getTrustedHostList().length?[3,2]:[4,Ze.setTrustedAuthoritiesFromNetwork(this.canonicalAuthority,e,t)]):[3,3];case 1:i.sent(),i.label=2;case 2:if(!Ze.IsInTrustedHostList(n))throw Ge.createUntrustedAuthorityError(n);i.label=3;case 3:return r=this.GetOpenIdConfigurationEndpoint(),o=this,[4,this.DiscoverEndpoints(r,e,t)];case 4:return o.tenantDiscoveryResponse=i.sent(),[2,this.tenantDiscoveryResponse]}}))}))},e.prototype.hasCachedMetadata=function(){return!!(this.tenantDiscoveryResponse&&this.tenantDiscoveryResponse.AuthorizationEndpoint&&this.tenantDiscoveryResponse.EndSessionEndpoint&&this.tenantDiscoveryResponse.Issuer)},e.prototype.GetOpenIdConfigurationEndpoint=function(){return this.DefaultOpenIdConfigurationEndpoint},e}(),nt=function(){function e(t,n){if(!t||ie.isEmpty(t))return this.uid="",void(this.utid="");try{var r=z.base64Decode(t),o=JSON.parse(r);o&&(o.hasOwnProperty("uid")&&(this.uid=n?e.stripPolicyFromUid(o.uid,n):o.uid),o.hasOwnProperty("utid")&&(this.utid=o.utid))}catch(e){throw Ie.createClientInfoDecodingError(e)}}return Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid?this._uid:""},set:function(e){this._uid=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"utid",{get:function(){return this._utid?this._utid:""},set:function(e){this._utid=e},enumerable:!1,configurable:!0}),e.createClientInfoFromIdToken=function(t,n){var r={uid:t.subject,utid:""};return new e(z.base64Encode(JSON.stringify(r)),n)},e.stripPolicyFromUid=function(e,t){var n=e.split("-"),r=t.split("/").reverse(),o="";return ie.isEmpty(r[0])?r.length>1&&(o=r[1]):o=r[0],n[n.length-1]===o?n.slice(0,n.length-1).join("-"):e},e.prototype.encodeClientInfo=function(){var e=JSON.stringify({uid:this.uid,utid:this.utid});return z.base64Encode(e)},e}(),rt=function(){function e(){}return e.parseExpiresIn=function(e){return parseInt(e||"3599",10)},e.now=function(){return Math.round((new Date).getTime()/1e3)},e.relativeNowMs=function(){return window.performance.now()},e}(),ot=function(){function e(){}return e.decodeJwt=function(e){if(ie.isEmpty(e))return null;var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);return!t||t.length<4?null:{header:t[1],JWSPayload:t[2],JWSSig:t[3]}},e.validateExpirationIsWithinOffset=function(e,t){var n=t||300;return e&&e>rt.now()+n},e.extractIdToken=function(e){var t=this.decodeJwt(e);if(!t)return null;try{var n=t.JWSPayload,r=z.base64Decode(n);return r?JSON.parse(r):null}catch(e){}return null},e}(),it=function(e){if(ie.isEmpty(e))throw Ie.createIdTokenNullOrEmptyError(e);try{this.rawIdToken=e,this.claims=ot.extractIdToken(e),this.claims&&(this.claims.hasOwnProperty("iss")&&(this.issuer=this.claims.iss),this.claims.hasOwnProperty("oid")&&(this.objectId=this.claims.oid),this.claims.hasOwnProperty("sub")&&(this.subject=this.claims.sub),this.claims.hasOwnProperty("tid")&&(this.tenantId=this.claims.tid),this.claims.hasOwnProperty("ver")&&(this.version=this.claims.ver),this.claims.hasOwnProperty("preferred_username")?this.preferredName=this.claims.preferred_username:this.claims.hasOwnProperty("upn")&&(this.preferredName=this.claims.upn),this.claims.hasOwnProperty("name")&&(this.name=this.claims.name),this.claims.hasOwnProperty("nonce")&&(this.nonce=this.claims.nonce),this.claims.hasOwnProperty("exp")&&(this.expiration=this.claims.exp),this.claims.hasOwnProperty("home_oid")&&(this.homeObjectId=this.claims.home_oid),this.claims.hasOwnProperty("sid")&&(this.sid=this.claims.sid),this.claims.hasOwnProperty("cloud_instance_host_name")&&(this.cloudInstance=this.claims.cloud_instance_host_name))}catch(e){throw Ie.createIdTokenParsingError(e)}},st=function(e,t){this.key=e,this.value=t},at=function(){function e(e){if(!window)throw oe.createNoWindowObjectError("Browser storage class could not find window object");if(!(void 0!==window[e]&&null!==window[e]))throw Ge.createStorageNotSupportedError(e);this.cacheLocation=e}return e.prototype.setItem=function(e,t,n){window[this.cacheLocation].setItem(e,t),n&&this.setItemCookie(e,t)},e.prototype.getItem=function(e,t){return t&&this.getItemCookie(e)?this.getItemCookie(e):window[this.cacheLocation].getItem(e)},e.prototype.removeItem=function(e){return window[this.cacheLocation].removeItem(e)},e.prototype.clear=function(){return window[this.cacheLocation].clear()},e.prototype.setItemCookie=function(e,t,n){var r=encodeURIComponent(e)+"="+encodeURIComponent(t)+";path=/;";n&&(r+="expires="+this.getCookieExpirationTime(n)+";");document.cookie=r},e.prototype.getItemCookie=function(e){for(var t=encodeURIComponent(e)+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return decodeURIComponent(o.substring(t.length,o.length))}return""},e.prototype.clearItemCookie=function(e){this.setItemCookie(e,"",-1)},e.prototype.getCookieExpirationTime=function(e){var t=new Date;return new Date(t.getTime()+24*e*60*60*1e3).toUTCString()},e}(),ct=function(){function e(){}return e.validateRequest=function(e,t,n,r){if(!t&&!e)throw Ge.createEmptyRequestError();var o,i;e&&(o=t?Ye.appendScopes(e.scopes,e.extraScopesToConsent):e.scopes,Ye.validateInputScope(o,!t),o=Ye.translateClientIdIfSingleScope(o,n),this.validatePromptParameter(e.prompt),i=this.validateEQParameters(e.extraQueryParameters,e.claimsRequest),this.validateClaimsRequest(e.claimsRequest));var s=this.validateAndGenerateState(e&&e.state,r),a=this.validateAndGenerateCorrelationId(e&&e.correlationId);return q(q({},e),{extraQueryParameters:i,scopes:o,state:s,correlationId:a})},e.validatePromptParameter=function(e){if(e&&[Z.LOGIN,Z.SELECT_ACCOUNT,Z.CONSENT,Z.NONE].indexOf(e)<0)throw Ge.createInvalidPromptError(e)},e.validateEQParameters=function(e,t){var n=q({},e);return n?(t&&delete n[$.claims],J.forEach((function(e){n[e]&&delete n[e]})),n):null},e.validateClaimsRequest=function(e){if(e)try{JSON.parse(e)}catch(e){throw Ge.createClaimsRequestParsingError(e)}},e.validateAndGenerateState=function(t,n){return ie.isEmpty(t)?e.generateLibraryState(n):""+e.generateLibraryState(n)+$.resourceDelimiter+t},e.generateLibraryState=function(e){var t={id:z.createNewGuid(),ts:rt.now(),method:e},n=JSON.stringify(t);return z.base64Encode(n)},e.parseLibraryState=function(e){var t=decodeURIComponent(e).split($.resourceDelimiter)[0];if(z.isGuid(t))return{id:t,ts:rt.now(),method:$.interactionTypeRedirect};try{var n=z.base64Decode(t);return JSON.parse(n)}catch(t){throw Ie.createInvalidStateError(e,null)}},e.validateAndGenerateCorrelationId=function(e){if(e&&!z.isGuid(e))throw Ge.createInvalidCorrelationIdError();return z.isGuid(e)?e:z.createNewGuid()},e.createRequestSignature=function(e){return""+e.scopes.join(" ").toLowerCase()+$.resourceDelimiter+e.authority},e}(),ut=function(e){function t(t,n,r){var o=e.call(this,n)||this;return o.temporaryCache=new at("sessionStorage"),o.clientId=t,o.rollbackEnabled=!0,o.migrateCacheEntries(r),o}return M(t,e),t.prototype.migrateCacheEntries=function(t){var n,r=this,o=$.cachePrefix+"."+F.IDTOKEN,i=$.cachePrefix+"."+F.CLIENT_INFO,s=$.cachePrefix+"."+K.ERROR,a=$.cachePrefix+"."+K.ERROR_DESC,c=e.prototype.getItem.call(this,o);if(c)try{n=new it(c)}catch(e){return}if(n&&n.claims&&n.claims.aud===this.clientId){var u=[c,e.prototype.getItem.call(this,i),e.prototype.getItem.call(this,s),e.prototype.getItem.call(this,a)];[F.IDTOKEN,F.CLIENT_INFO,K.ERROR,K.ERROR_DESC].forEach((function(e,n){return r.duplicateCacheEntry(e,u[n],t)}))}},t.prototype.duplicateCacheEntry=function(e,t,n){t&&this.setItem(e,t,n)},t.prototype.generateCacheKey=function(e,t){try{return JSON.parse(e),e}catch(n){return 0===e.indexOf(""+$.cachePrefix)||0===e.indexOf($.adalIdToken)?e:t?$.cachePrefix+"."+this.clientId+"."+e:$.cachePrefix+"."+e}},t.prototype.matchKeyForType=function(e,t,n,r){var o=ie.validateAndParseJsonCacheKey(e);if(!o)return null;var i=e.match(t)&&e.match(n),s=!1;switch(r){case D.ACCESS_TOKEN:s=!!e.match($.scopes);break;case D.ID_TOKEN:s=!e.match($.scopes)}return i&&s?o:null},t.prototype.setItem=function(t,n,r){e.prototype.setItem.call(this,this.generateCacheKey(t,!0),n,r),this.rollbackEnabled&&!r&&e.prototype.setItem.call(this,this.generateCacheKey(t,!1),n,r)},t.prototype.getItem=function(t,n){return e.prototype.getItem.call(this,this.generateCacheKey(t,!0),n)},t.prototype.removeItem=function(t){this.temporaryCache.removeItem(this.generateCacheKey(t,!0)),e.prototype.removeItem.call(this,this.generateCacheKey(t,!0)),this.rollbackEnabled&&e.prototype.removeItem.call(this,this.generateCacheKey(t,!1))},t.prototype.setTemporaryItem=function(e,t,n){this.temporaryCache.setItem(this.generateCacheKey(e,!0),t,n)},t.prototype.getTemporaryItem=function(e,t){return this.temporaryCache.getItem(this.generateCacheKey(e,!0),t)},t.prototype.resetCacheItems=function(){var t,n=window[this.cacheLocation];for(t in n)n.hasOwnProperty(t)&&-1!==t.indexOf($.cachePrefix)&&e.prototype.removeItem.call(this,t)},t.prototype.resetTempCacheItems=function(t){var n=this,r=t&&ct.parseLibraryState(t).id,o=this.tokenRenewalInProgress(t),i=window[this.cacheLocation];r&&!o&&Object.keys(i).forEach((function(t){-1!==t.indexOf(r)&&(n.removeItem(t),e.prototype.clearItemCookie.call(n,t))})),this.setInteractionInProgress(!1),this.removeItem(B.REDIRECT_REQUEST)},t.prototype.setItemCookie=function(t,n,r){e.prototype.setItemCookie.call(this,this.generateCacheKey(t,!0),n,r),this.rollbackEnabled&&e.prototype.setItemCookie.call(this,this.generateCacheKey(t,!1),n,r)},t.prototype.clearItemCookie=function(t){e.prototype.clearItemCookie.call(this,this.generateCacheKey(t,!0)),this.rollbackEnabled&&e.prototype.clearItemCookie.call(this,this.generateCacheKey(t,!1))},t.prototype.getItemCookie=function(t){return e.prototype.getItemCookie.call(this,this.generateCacheKey(t,!0))},t.prototype.getAllTokensByType=function(e,t,n){var r=this;return Object.keys(window[this.cacheLocation]).reduce((function(o,i){var s=r.matchKeyForType(i,e,t,n);if(s){var a=r.getItem(i);if(a)try{var c=new st(s,JSON.parse(a));return o.concat([c])}catch(e){return o}}return o}),[])},t.prototype.getAllAccessTokens=function(e,t){return this.getAllTokensByType(e,t,D.ACCESS_TOKEN)},t.prototype.getAllIdTokens=function(e,t){return this.getAllTokensByType(e,t,D.ID_TOKEN)},t.prototype.getAllTokens=function(e,t){return H(this.getAllAccessTokens(e,t),this.getAllIdTokens(e,t))},t.prototype.isInteractionInProgress=function(e){var t=this.getInteractionInProgress();return e?t===this.clientId:!!t},t.prototype.getInteractionInProgress=function(){return this.getTemporaryItem(this.generateCacheKey(B.INTERACTION_STATUS,!1))},t.prototype.setInteractionInProgress=function(e){if(e){if(this.isInteractionInProgress(!1))throw Ie.createAcquireTokenInProgressError();this.setTemporaryItem(this.generateCacheKey(B.INTERACTION_STATUS,!1),this.clientId)}else!e&&this.isInteractionInProgress(!0)&&this.removeItem(this.generateCacheKey(B.INTERACTION_STATUS,!1))},t.prototype.tokenRenewalInProgress=function(e){var n=this.getItem(t.generateTemporaryCacheKey(B.RENEW_STATUS,e));return!(!n||n!==$.inProgress)},t.prototype.clearMsalCookie=function(n){var r=this;n?(this.clearItemCookie(t.generateTemporaryCacheKey(B.NONCE_IDTOKEN,n)),this.clearItemCookie(t.generateTemporaryCacheKey(B.STATE_LOGIN,n)),this.clearItemCookie(t.generateTemporaryCacheKey(B.LOGIN_REQUEST,n)),this.clearItemCookie(t.generateTemporaryCacheKey(B.STATE_ACQ_TOKEN,n))):document.cookie.split(";").forEach((function(t){var n=t.trim().split("=")[0];n.indexOf($.cachePrefix)>-1&&e.prototype.clearItemCookie.call(r,n)}))},t.generateAcquireTokenAccountKey=function(e,t){var n=ct.parseLibraryState(t).id;return""+B.ACQUIRE_TOKEN_ACCOUNT+$.resourceDelimiter+e+$.resourceDelimiter+n},t.generateAuthorityKey=function(e){return t.generateTemporaryCacheKey(B.AUTHORITY,e)},t.generateTemporaryCacheKey=function(e,t){var n=ct.parseLibraryState(t).id;return""+e+$.resourceDelimiter+n},t}(at),lt=function(){function e(e,t,n,r,o,i,s){this.accountIdentifier=e,this.homeAccountIdentifier=t,this.userName=n,this.name=r,this.idToken=o,this.idTokenClaims=o,this.sid=i,this.environment=s}return e.createAccount=function(t,n){var r,o=t.objectId||t.subject,i=n?n.uid:"",s=n?n.utid:"";return ie.isEmpty(i)||(r=ie.isEmpty(s)?z.base64Encode(i):z.base64Encode(i)+"."+z.base64Encode(s)),new e(o,r,t.preferredName,t.name,t.claims,t.sid,t.issuer)},e.compareAccounts=function(e,t){return!(!e||!t)&&!(!e.homeAccountIdentifier||!t.homeAccountIdentifier||e.homeAccountIdentifier!==t.homeAccountIdentifier)},e}(),dt=function(){function e(){}return e.isInIframe=function(){return window.parent!==window},e.isInPopup=function(){return!(!window.opener||window.opener===window)},e.generateFrameName=function(e,t){return""+e+$.resourceDelimiter+t},e.monitorIframeForHash=function(t,n,r,o){return new Promise((function(i,s){var a=rt.relativeNowMs()+n;o.verbose("monitorWindowForIframe polling started");var c=setInterval((function(){if(rt.relativeNowMs()>a)return o.error("monitorIframeForHash unable to find hash in url, timing out"),o.errorPii("monitorIframeForHash polling timed out for url: "+r),clearInterval(c),void s(Ie.createTokenRenewalTimeoutError());var e;try{e=t.location.href}catch(e){}e&&We.urlContainsHash(e)&&(o.verbose("monitorIframeForHash found url in hash"),clearInterval(c),i(t.location.hash))}),e.POLLING_INTERVAL_MS)}))},e.monitorPopupForHash=function(t,n,r,o){return new Promise((function(i,s){var a=n/e.POLLING_INTERVAL_MS,c=0;o.verbose("monitorWindowForHash polling started");var u=setInterval((function(){if(t.closed)return o.error("monitorWindowForHash window closed"),clearInterval(u),void s(Ie.createUserCancelledError());var n;try{n=t.location.href}catch(e){}if(n&&"about:blank"!==n)if(c++,n&&We.urlContainsHash(n)){o.verbose("monitorPopupForHash found url in hash"),clearInterval(u);var l=t.location.hash;e.clearUrlFragment(t),i(l)}else c>a&&(o.error("monitorPopupForHash unable to find hash in url, timing out"),o.errorPii("monitorPopupForHash polling timed out for url: "+r),clearInterval(u),s(Ie.createTokenRenewalTimeoutError()))}),e.POLLING_INTERVAL_MS)}))},e.loadFrame=function(e,t,n,r){var o=this;return r.infoPii("LoadFrame: "+t),new Promise((function(i,s){setTimeout((function(){var n=o.loadFrameSync(e,t,r);n?i(n):s("Unable to load iframe with name: "+t)}),n)}))},e.loadFrameSync=function(t,n,r){var o=e.addHiddenIFrame(n,r);return o?(""!==o.src&&"about:blank"!==o.src||(o.src=t,r.infoPii("Frame Name : "+n+" Navigated to: "+t)),o):null},e.addHiddenIFrame=function(e,t){if(void 0===e)return null;t.info("Add msal iframe to document"),t.infoPii("Add msal frame to document:"+e);var n=document.getElementById(e);if(n)t.verbose("Add msal iframe already exists");else{t.verbose("Add msal iframe does not exist");var r=document.createElement("iframe");r.setAttribute("id",e),r.setAttribute("aria-hidden","true"),r.style.visibility="hidden",r.style.position="absolute",r.style.width=r.style.height="0",r.style.border="0",r.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),n=document.getElementsByTagName("body")[0].appendChild(r)}return n},e.removeHiddenIframe=function(e){document.body===e.parentNode&&document.body.removeChild(e)},e.getIframeWithHash=function(e){var t=document.getElementsByTagName("iframe");return Array.apply(null,Array(t.length)).map((function(e,n){return t.item(n)})).filter((function(t){try{return t.contentWindow.location.hash===e}catch(e){return!1}}))[0]},e.getPopups=function(){return window.openedWindows||(window.openedWindows=[]),window.openedWindows},e.getPopUpWithHash=function(t){return e.getPopups().filter((function(e){try{return e.location.hash===t}catch(e){return!1}}))[0]},e.trackPopup=function(t){e.getPopups().push(t)},e.closePopups=function(){e.getPopups().forEach((function(e){return e.close()}))},e.blockReloadInHiddenIframes=function(){if(We.urlContainsHash(window.location.hash)&&e.isInIframe())throw Ie.createBlockTokenRequestsInHiddenIframeError()},e.checkIfBackButtonIsPressed=function(e){var t=e.getItem(B.REDIRECT_REQUEST);if(t&&!We.urlContainsHash(window.location.hash)){var n=t.split($.resourceDelimiter);n.shift();var r=n.length>0?n.join($.resourceDelimiter):null;e.resetTempCacheItems(r)}},e.clearUrlFragment=function(e){e.location.hash="","function"==typeof e.history.replaceState&&e.history.replaceState(null,null,""+e.location.pathname+e.location.search)},e.POLLING_INTERVAL_MS=50,e}(),ht=function(){function e(){}return e.setResponseIdToken=function(e,t){if(!e)return null;if(!t)return e;var n=Number(t.expiration);return n&&!e.expiresOn&&(e.expiresOn=new Date(1e3*n)),q(q({},e),{idToken:t,idTokenClaims:t.claims,uniqueId:t.objectId||t.subject,tenantId:t.tenantId})},e.buildAuthResponse=function(t,n,r,o,i,s){switch(r.responseType){case G:var a=q(q({},n),{tokenType:D.ID_TOKEN,account:o,scopes:i,accountState:s});return(a=e.setResponseIdToken(a,t)).idToken?a:null;case W:var c=e.setResponseIdToken(n,t);return c&&c.accessToken&&c.idToken?c:null;case Y:return e.setResponseIdToken(n,t);default:return null}},e}(),pt=function(){function e(){}return e.saveMetadataFromNetwork=function(e,t,n){return L(this,void 0,void 0,(function(){var r;return U(this,(function(o){switch(o.label){case 0:return[4,e.resolveEndpointsAsync(t,n)];case 1:return r=o.sent(),this.metadataMap.set(e.CanonicalAuthority,r),[2,r]}}))}))},e.getMetadata=function(e){return this.metadataMap.get(e)},e.saveMetadataFromConfig=function(e,t){try{if(t){var n=JSON.parse(t);if(!n.authorization_endpoint||!n.end_session_endpoint||!n.issuer)throw Ge.createInvalidAuthorityMetadataError();this.metadataMap.set(e,{AuthorizationEndpoint:n.authorization_endpoint,EndSessionEndpoint:n.end_session_endpoint,Issuer:n.issuer})}}catch(e){throw Ge.createInvalidAuthorityMetadataError()}},e.CreateInstance=function(e,t,n){return ie.isEmpty(e)?null:(n&&this.saveMetadataFromConfig(e,n),new tt(e,t,this.metadataMap.get(e)))},e.metadataMap=new Map,e}();!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose"}(et||(et={}));var ft=function(){function e(e,t){void 0===t&&(t={}),this.level=et.Info;var n=t.correlationId,r=void 0===n?"":n,o=t.level,i=void 0===o?et.Info:o,s=t.piiLoggingEnabled,a=void 0!==s&&s;this.localCallback=e,this.correlationId=r,this.level=i,this.piiLoggingEnabled=a}return e.prototype.logMessage=function(e,t,n){if(!(e>this.level||!this.piiLoggingEnabled&&n)){var r,o=(new Date).toUTCString();r=ie.isEmpty(this.correlationId)?o+":1.4.17-"+et[e]+(n?"-pii":"")+" "+t:o+":"+this.correlationId+"-1.4.17-"+et[e]+(n?"-pii":"")+" "+t,this.executeCallback(e,r,n)}},e.prototype.executeCallback=function(e,t,n){this.localCallback&&this.localCallback(e,t,n)},e.prototype.error=function(e){this.logMessage(et.Error,e,!1)},e.prototype.errorPii=function(e){this.logMessage(et.Error,e,!0)},e.prototype.warning=function(e){this.logMessage(et.Warning,e,!1)},e.prototype.warningPii=function(e){this.logMessage(et.Warning,e,!0)},e.prototype.info=function(e){this.logMessage(et.Info,e,!1)},e.prototype.infoPii=function(e){this.logMessage(et.Info,e,!0)},e.prototype.verbose=function(e){this.logMessage(et.Verbose,e,!1)},e.prototype.verbosePii=function(e){this.logMessage(et.Verbose,e,!0)},e.prototype.isPiiLoggingEnabled=function(){return this.piiLoggingEnabled},e}(),mt={clientId:"",authority:null,validateAuthority:!0,authorityMetadata:"",knownAuthorities:[],redirectUri:function(){return We.getCurrentUrl()},postLogoutRedirectUri:function(){return We.getCurrentUrl()},navigateToLoginRequestUrl:!0},gt={cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},yt={logger:new ft(null),loadFrameTimeout:6e3,tokenRenewalOffsetSeconds:300,navigateFrameWait:500},vt={isAngular:!1,unprotectedResources:new Array,protectedResourceMap:new Map};var bt={code:"server_unavailable",desc:"Server is temporarily unavailable."},_t={code:"unknown_server_error"},wt=function(e){function t(n,r){var o=e.call(this,n,r)||this;return o.name="ServerError",Object.setPrototypeOf(o,t.prototype),o}return M(t,e),t.createServerUnavailableError=function(){return new t(bt.code,bt.desc)},t.createUnknownServerError=function(e){return new t(_t.code,e)},t}(oe),Et={code:"interaction_required"},St={code:"consent_required"},Ot={code:"login_required"},Ct=function(e){function t(n,r){var o=e.call(this,n,r)||this;return o.name="InteractionRequiredAuthError",Object.setPrototypeOf(o,t.prototype),o}return M(t,e),t.isInteractionRequiredError=function(e){var t=[Et.code,St.code,Ot.code];return e&&t.indexOf(e)>-1},t.createLoginRequiredAuthError=function(e){return new t(Ot.code,e)},t.createInteractionRequiredAuthError=function(e){return new t(Et.code,e)},t.createConsentRequiredAuthError=function(e){return new t(St.code,e)},t}(wt);function It(e){return{uniqueId:"",tenantId:"",tokenType:"",idToken:null,idTokenClaims:null,accessToken:"",scopes:null,expiresOn:null,account:null,accountState:e,fromCache:!1}}var Tt,At,kt,Pt="Microsoft.MSAL.correlation_id",Rt="msal.api_telem_id",xt="msal.api_id",Nt="Microsoft_MSAL_cache_event_count",jt="Microsoft_MSAL_http_event_count",Mt="Microsoft_MSAL_ui_event_count",qt=function(e){var t=We.GetUrlComponents(e);if(tt.isAdfs(e))return e;var n=t.PathSegments;if(n&&n.length>=2){var r="tfp"===n[1]?2:1;r<n.length&&(n[r]="<tenant>")}return t.Protocol+"//"+t.HostNameAndPort+"/"+n.join("/")},Lt=function(e){return z.base64Encode(e)},Ut=function(e){return"msal."+(e||"")},Ht=function(){return!!("undefined"!=typeof window&&"performance"in window&&window.performance.mark&&window.performance.measure)},Dt=function(){function e(e,t,n){var r;this.eventId=z.createNewGuid(),this.label=n,this.event=((r={})[Ut("event_name")]=e,r[Ut("elapsed_time")]=-1,r[""+Pt]=t,r)}return e.prototype.setElapsedTime=function(e){this.event[Ut("elapsed_time")]=e},e.prototype.stop=function(){var e,t,n;this.setElapsedTime(+Date.now()-+this.startTimestamp),e=this.displayName,t=this.perfStartMark,n=this.perfEndMark,Ht()&&(window.performance.mark(n),window.performance.measure(e,t,n),window.performance.clearMeasures(e),window.performance.clearMarks(t),window.performance.clearMarks(n))},e.prototype.start=function(){var e;this.startTimestamp=Date.now(),this.event[Ut("start_time")]=this.startTimestamp,e=this.perfStartMark,Ht()&&window.performance.mark(e)},Object.defineProperty(e.prototype,"telemetryCorrelationId",{get:function(){return this.event[""+Pt]},set:function(e){this.event[""+Pt]=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eventName",{get:function(){return this.event[Ut("event_name")]},enumerable:!1,configurable:!0}),e.prototype.get=function(){return q(q({},this.event),{eventId:this.eventId})},Object.defineProperty(e.prototype,"key",{get:function(){return this.telemetryCorrelationId+"_"+this.eventId+"-"+this.eventName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return"Msal-"+this.label+"-"+this.telemetryCorrelationId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"perfStartMark",{get:function(){return"start-"+this.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"perfEndMark",{get:function(){return"end-"+this.key},enumerable:!1,configurable:!0}),e}(),zt=function(e){function t(t,n,r,o){var i=e.call(this,Ut("default_event"),n,"DefaultEvent")||this;return i.event[Ut("client_id")]=r,i.event[Ut("sdk_plaform")]=t.sdk,i.event[Ut("sdk_version")]=t.sdkVersion,i.event[Ut("application_name")]=t.applicationName,i.event[Ut("application_version")]=t.applicationVersion,i.event[Ut("effective_connection_speed")]=t.networkInformation&&t.networkInformation.connectionSpeed,i.event[""+Mt]=i.getEventCount(Ut("ui_event"),o),i.event[""+jt]=i.getEventCount(Ut("http_event"),o),i.event[""+Nt]=i.getEventCount(Ut("cache_event"),o),i}return M(t,e),t.prototype.getEventCount=function(e,t){return t[e]?t[e]:0},t}(Dt),$t=Ut("authority"),Bt=Ut("authority_type"),Ft=Ut("ui_behavior"),Kt=Ut("tenant_id"),Gt=Ut("user_id"),Yt=Ut("was_successful"),Wt=Ut("api_error_code"),Vt=Ut("login_hint");!function(e){e[e.AcquireTokenRedirect=2001]="AcquireTokenRedirect",e[e.AcquireTokenSilent=2002]="AcquireTokenSilent",e[e.AcquireTokenPopup=2003]="AcquireTokenPopup",e[e.LoginRedirect=2004]="LoginRedirect",e[e.LoginPopup=2005]="LoginPopup",e[e.Logout=2006]="Logout"}(At||(At={})),function(e){e.AcquireTokenRedirect="AcquireTokenRedirect",e.AcquireTokenSilent="AcquireTokenSilent",e.AcquireTokenPopup="AcquireTokenPopup",e.LoginRedirect="LoginRedirect",e.LoginPopup="LoginPopup",e.Logout="Logout"}(kt||(kt={}));var Qt=((Tt={})[kt.AcquireTokenSilent]=At.AcquireTokenSilent,Tt[kt.AcquireTokenPopup]=At.AcquireTokenPopup,Tt[kt.AcquireTokenRedirect]=At.AcquireTokenRedirect,Tt[kt.LoginPopup]=At.LoginPopup,Tt[kt.LoginRedirect]=At.LoginRedirect,Tt[kt.Logout]=At.Logout,Tt),Jt=function(e){function t(t,n,r){var o=e.call(this,Ut("api_event"),t,r)||this;return r&&(o.apiCode=Qt[r],o.apiEventIdentifier=r),o.piiEnabled=n,o}return M(t,e),Object.defineProperty(t.prototype,"apiEventIdentifier",{set:function(e){this.event[Rt]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apiCode",{set:function(e){this.event[xt]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authority",{set:function(e){this.event[$t]=qt(e).toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apiErrorCode",{set:function(e){this.event[Wt]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tenantId",{set:function(e){this.event[Kt]=this.piiEnabled&&e?Lt(e):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"accountId",{set:function(e){this.event[Gt]=this.piiEnabled&&e?Lt(e):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wasSuccessful",{get:function(){return!0===this.event[Yt]},set:function(e){this.event[Yt]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loginHint",{set:function(e){this.event[Vt]=this.piiEnabled&&e?Lt(e):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authorityType",{set:function(e){this.event[Bt]=e.toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"promptType",{set:function(e){this.event[Ft]=e.toLowerCase()},enumerable:!1,configurable:!0}),t}(Dt),Xt=Ut("http_path"),Zt=Ut("user_agent"),en=Ut("query_parameters"),tn=Ut("api_version"),nn=Ut("response_code"),rn=Ut("oauth_error_code"),on=Ut("http_method"),sn=Ut("request_id_header"),an=Ut("spe_info"),cn=Ut("server_error_code"),un=Ut("server_sub_error_code"),ln=Ut("url"),dn=function(e){function t(t,n){return e.call(this,Ut("http_event"),t,n)||this}return M(t,e),Object.defineProperty(t.prototype,"url",{set:function(e){var t=qt(e);this.event[ln]=t&&t.toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"httpPath",{set:function(e){this.event[Xt]=qt(e).toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userAgent",{set:function(e){this.event[Zt]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queryParams",{set:function(e){this.event[en]=Je.generateQueryParametersString(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apiVersion",{set:function(e){this.event[tn]=e.toLowerCase()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"httpResponseStatus",{set:function(e){this.event[nn]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oAuthErrorCode",{set:function(e){this.event[rn]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"httpMethod",{set:function(e){this.event[on]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"requestIdHeader",{set:function(e){this.event[sn]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"speInfo",{set:function(e){this.event[an]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serverErrorCode",{set:function(e){this.event[cn]=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serverSubErrorCode",{set:function(e){this.event[un]=e},enumerable:!1,configurable:!0}),t}(Dt),hn=function(){function e(e,t,n){this.completedEvents={},this.inProgressEvents={},this.eventCountByCorrelationId={},this.onlySendFailureTelemetry=!1,this.telemetryPlatform=q({sdk:$.libraryName,sdkVersion:"1.4.17",networkInformation:{connectionSpeed:"undefined"!=typeof navigator&&navigator.connection&&navigator.connection.effectiveType}},e.platform),this.clientId=e.clientId,this.onlySendFailureTelemetry=e.onlySendFailureTelemetry,this.telemetryEmitter=t,this.logger=n}return e.getTelemetrymanagerStub=function(e,t){return new this({platform:{applicationName:"UnSetStub",applicationVersion:"0.0"},clientId:e},(function(){}),t)},e.prototype.startEvent=function(e){this.logger.verbose("Telemetry Event started: "+e.key),this.telemetryEmitter&&(e.start(),this.inProgressEvents[e.key]=e)},e.prototype.stopEvent=function(e){if(this.logger.verbose("Telemetry Event stopped: "+e.key),this.telemetryEmitter&&this.inProgressEvents[e.key]){e.stop(),this.incrementEventCount(e);var t=this.completedEvents[e.telemetryCorrelationId];this.completedEvents[e.telemetryCorrelationId]=H(t||[],[e]),delete this.inProgressEvents[e.key]}},e.prototype.flush=function(e){var t=this;if(this.logger.verbose("Flushing telemetry events: "+e),this.telemetryEmitter&&this.completedEvents[e]){var n=this.getOrphanedEvents(e);n.forEach((function(e){return t.incrementEventCount(e)}));var r=H(this.completedEvents[e],n);delete this.completedEvents[e];var o=this.eventCountByCorrelationId[e];if(delete this.eventCountByCorrelationId[e],r&&r.length){var i=H(r,[new zt(this.telemetryPlatform,e,this.clientId,o)]);this.telemetryEmitter(i.map((function(e){return e.get()})))}}},e.prototype.createAndStartApiEvent=function(e,t){var n=new Jt(e,this.logger.isPiiLoggingEnabled(),t);return this.startEvent(n),n},e.prototype.stopAndFlushApiEvent=function(e,t,n,r){t.wasSuccessful=n,r&&(t.apiErrorCode=r),this.stopEvent(t),this.flush(e)},e.prototype.createAndStartHttpEvent=function(e,t,n,r){var o=new dn(e,r);return o.url=n,o.httpMethod=t,this.startEvent(o),o},e.prototype.incrementEventCount=function(e){var t,n=e.eventName,r=this.eventCountByCorrelationId[e.telemetryCorrelationId];r?r[n]=r[n]?r[n]+1:1:this.eventCountByCorrelationId[e.telemetryCorrelationId]=((t={})[n]=1,t)},e.prototype.getOrphanedEvents=function(e){var t=this;return Object.keys(this.inProgressEvents).reduce((function(n,r){if(-1!==r.indexOf(e)){var o=t.inProgressEvents[r];return delete t.inProgressEvents[r],H(n,[o])}return n}),[])},e}(),pn=function(){function e(){}return e.filterTokenCacheItemsByScope=function(e,t){return e.filter((function(e){var n=e.key.scopes.split(" "),r=Ye.removeDefaultScopes(t);return 0===r.length?Ye.containsScope(n,t):Ye.containsScope(n,r)}))},e.filterTokenCacheItemsByAuthority=function(e,t){return e.filter((function(e){return We.CanonicalizeUri(e.key.authority)===t}))},e.filterTokenCacheItemsByDomain=function(e,t){return e.filter((function(e){return We.GetUrlComponents(e.key.authority).HostNameAndPort===t}))},e}(),fn=function(){function e(e){var t,n,r,o,i,s,a,c;this.authResponseCallback=null,this.tokenReceivedCallback=null,this.errorReceivedCallback=null,this.config=(n=(t=e).auth,r=t.cache,o=void 0===r?{}:r,i=t.system,s=void 0===i?{}:i,a=t.framework,c=void 0===a?{}:a,{auth:q(q({},mt),n),cache:q(q({},gt),o),system:q(q({},yt),s),framework:q(q({},vt),c)}),this.logger=this.config.system.logger,this.clientId=this.config.auth.clientId,this.inCookie=this.config.cache.storeAuthStateInCookie,this.telemetryManager=this.getTelemetryManagerFromConfig(this.config.system.telemetry,this.clientId),Ze.setTrustedAuthoritiesFromConfig(this.config.auth.validateAuthority,this.config.auth.knownAuthorities),pt.saveMetadataFromConfig(this.config.auth.authority,this.config.auth.authorityMetadata),this.authority=this.config.auth.authority||"https://login.microsoftonline.com/common",this.cacheStorage=new ut(this.clientId,this.config.cache.cacheLocation,this.inCookie),window.activeRenewals||(window.activeRenewals={}),window.renewStates||(window.renewStates=[]),window.callbackMappedToRenewStates||(window.callbackMappedToRenewStates={}),window.promiseMappedToRenewStates||(window.promiseMappedToRenewStates={}),window.msal=this;var u=window.location.hash,l=We.urlContainsHash(u);(dt.checkIfBackButtonIsPressed(this.cacheStorage),l&&this.cacheStorage.isInteractionInProgress(!0))&&(this.getResponseState(u).method===$.interactionTypeRedirect&&this.handleRedirectAuthenticationResponse(u))}return Object.defineProperty(e.prototype,"authority",{get:function(){return this.authorityInstance.CanonicalAuthority},set:function(e){this.authorityInstance=pt.CreateInstance(e,this.config.auth.validateAuthority)},enumerable:!1,configurable:!0}),e.prototype.getAuthorityInstance=function(){return this.authorityInstance},e.prototype.handleRedirectCallback=function(e,t){if(!e)throw Ge.createInvalidCallbackObjectError(e);t?(this.tokenReceivedCallback=e,this.errorReceivedCallback=t,this.logger.warning("This overload for callback is deprecated - please change the format of the callbacks to a single callback as shown: (err: AuthError, response: AuthResponse).")):this.authResponseCallback=e,this.redirectError?this.authErrorHandler($.interactionTypeRedirect,this.redirectError,this.redirectResponse):this.redirectResponse&&this.authResponseHandler($.interactionTypeRedirect,this.redirectResponse)},e.prototype.urlContainsHash=function(e){return this.logger.verbose("UrlContainsHash has been called"),We.urlContainsHash(e)},e.prototype.authResponseHandler=function(e,t,n){if(this.logger.verbose("AuthResponseHandler has been called"),this.cacheStorage.setInteractionInProgress(!1),e===$.interactionTypeRedirect)this.logger.verbose("Interaction type is redirect"),this.errorReceivedCallback?(this.logger.verbose("Two callbacks were provided to handleRedirectCallback, calling success callback with response"),this.tokenReceivedCallback(t)):this.authResponseCallback&&(this.logger.verbose("One callback was provided to handleRedirectCallback, calling authResponseCallback with response"),this.authResponseCallback(null,t));else{if(e!==$.interactionTypePopup)throw Ie.createInvalidInteractionTypeError();this.logger.verbose("Interaction type is popup, resolving"),n(t)}},e.prototype.authErrorHandler=function(e,t,n,r){if(this.logger.verbose("AuthErrorHandler has been called"),this.cacheStorage.setInteractionInProgress(!1),e===$.interactionTypeRedirect)if(this.logger.verbose("Interaction type is redirect"),this.errorReceivedCallback)this.logger.verbose("Two callbacks were provided to handleRedirectCallback, calling error callback"),this.errorReceivedCallback(t,n.accountState);else{if(!this.authResponseCallback)throw this.logger.verbose("handleRedirectCallback has not been called and no callbacks are registered, throwing error"),t;this.logger.verbose("One callback was provided to handleRedirectCallback, calling authResponseCallback with error"),this.authResponseCallback(t,n)}else{if(e!==$.interactionTypePopup)throw Ie.createInvalidInteractionTypeError();this.logger.verbose("Interaction type is popup, rejecting"),r(t)}},e.prototype.loginRedirect=function(e){this.logger.verbose("LoginRedirect has been called");var t=ct.validateRequest(e,!0,this.clientId,$.interactionTypeRedirect);this.acquireTokenInteractive($.interactionTypeRedirect,!0,t,null,null)},e.prototype.acquireTokenRedirect=function(e){this.logger.verbose("AcquireTokenRedirect has been called");var t=ct.validateRequest(e,!1,this.clientId,$.interactionTypeRedirect);this.acquireTokenInteractive($.interactionTypeRedirect,!1,t,null,null)},e.prototype.loginPopup=function(e){var t=this;this.logger.verbose("LoginPopup has been called");var n=ct.validateRequest(e,!0,this.clientId,$.interactionTypePopup),r=this.telemetryManager.createAndStartApiEvent(n.correlationId,kt.LoginPopup);return new Promise((function(e,r){t.acquireTokenInteractive($.interactionTypePopup,!0,n,e,r)})).then((function(e){return t.logger.verbose("Successfully logged in"),t.telemetryManager.stopAndFlushApiEvent(n.correlationId,r,!0),e})).catch((function(e){throw t.cacheStorage.resetTempCacheItems(n.state),t.telemetryManager.stopAndFlushApiEvent(n.correlationId,r,!1,e.errorCode),e}))},e.prototype.acquireTokenPopup=function(e){var t=this;this.logger.verbose("AcquireTokenPopup has been called");var n=ct.validateRequest(e,!1,this.clientId,$.interactionTypePopup),r=this.telemetryManager.createAndStartApiEvent(n.correlationId,kt.AcquireTokenPopup);return new Promise((function(e,r){t.acquireTokenInteractive($.interactionTypePopup,!1,n,e,r)})).then((function(e){return t.logger.verbose("Successfully acquired token"),t.telemetryManager.stopAndFlushApiEvent(n.correlationId,r,!0),e})).catch((function(e){throw t.cacheStorage.resetTempCacheItems(n.state),t.telemetryManager.stopAndFlushApiEvent(n.correlationId,r,!1,e.errorCode),e}))},e.prototype.acquireTokenInteractive=function(e,t,n,r,o){var i,s=this;this.logger.verbose("AcquireTokenInteractive has been called"),dt.blockReloadInHiddenIframes();try{this.cacheStorage.setInteractionInProgress(!0)}catch(r){var a=t?Ie.createLoginInProgressError():Ie.createAcquireTokenInProgressError(),c=It(this.getAccountState(n.state));return this.cacheStorage.resetTempCacheItems(n.state),void this.authErrorHandler(e,a,c,o)}if(e===$.interactionTypeRedirect&&this.cacheStorage.setItem(B.REDIRECT_REQUEST,""+$.inProgress+$.resourceDelimiter+n.state),n&&n.account&&!t?(i=n.account,this.logger.verbose("Account set from request")):(i=this.getAccount(),this.logger.verbose("Account set from MSAL Cache")),i||Je.isSSOParam(n))this.logger.verbose("User session exists, login not required"),this.acquireTokenHelper(i,e,t,n,r,o);else{if(!t){this.logger.verbose("AcquireToken call, no context or account given"),this.logger.info("User login is required");c=It(this.getAccountState(n.state));return this.cacheStorage.resetTempCacheItems(n.state),void this.authErrorHandler(e,Ie.createUserLoginRequiredError(),c,o)}if(this.extractADALIdToken()&&!n.scopes){this.logger.info("ADAL's idToken exists. Extracting login information from ADAL's idToken");var u=this.buildIDTokenRequest(n);this.silentLogin=!0,this.acquireTokenSilent(u).then((function(t){s.silentLogin=!1,s.logger.info("Unified cache call is successful"),s.authResponseHandler(e,t,r)}),(function(i){s.silentLogin=!1,s.logger.error("Error occurred during unified cache ATS: "+i),s.acquireTokenHelper(null,e,t,n,r,o)}))}else this.logger.verbose("Login call but no token found, proceed to login"),this.acquireTokenHelper(null,e,t,n,r,o)}},e.prototype.acquireTokenHelper=function(e,t,n,r,o,i){return L(this,void 0,void 0,(function(){var s,a,c,u,l,d,h,p,f,m;return U(this,(function(g){switch(g.label){case 0:this.logger.verbose("AcquireTokenHelper has been called"),this.logger.verbose("Interaction type: "+t+". isLoginCall: "+n),s=r.scopes?r.scopes.join(" ").toLowerCase():$.oidcScopes.join(" "),this.logger.verbosePii("Request signature: "+s),c=r&&r.authority?pt.CreateInstance(r.authority,this.config.auth.validateAuthority,r.authorityMetadata):this.authorityInstance,g.label=1;case 1:return g.trys.push([1,11,,12]),c.hasCachedMetadata()?[3,3]:(this.logger.verbose("No cached metadata for authority"),[4,pt.saveMetadataFromNetwork(c,this.telemetryManager,r.correlationId)]);case 2:return g.sent(),[3,4];case 3:this.logger.verbose("Cached metadata found for authority"),g.label=4;case 4:if(l=n?G:this.getTokenType(e,r.scopes),d=r.redirectStartPage||window.location.href,a=new Je(c,this.clientId,l,this.getRedirectUri(r&&r.redirectUri),r.scopes,r.state,r.correlationId),this.logger.verbose("Finished building server authentication request"),this.updateCacheEntries(a,e,n,d),this.logger.verbose("Updating cache entries"),a.populateQueryParams(e,r),this.logger.verbose("Query parameters populated from account"),h=We.createNavigateUrl(a)+$.response_mode_fragment,t===$.interactionTypeRedirect)n?this.logger.verbose("Interaction type redirect but login call is true. State not cached"):(this.cacheStorage.setItem(ut.generateTemporaryCacheKey(B.STATE_ACQ_TOKEN,r.state),a.state,this.inCookie),this.logger.verbose("State cached for redirect"),this.logger.verbosePii("State cached: "+a.state));else{if(t!==$.interactionTypePopup)throw this.logger.verbose("Invalid interaction error. State not cached"),Ie.createInvalidInteractionTypeError();window.renewStates.push(a.state),window.requestType=n?$.login:$.renewToken,this.logger.verbose("State saved to window"),this.logger.verbosePii("State saved: "+a.state),this.registerCallback(a.state,s,o,i)}if(t!==$.interactionTypePopup)return[3,9];this.logger.verbose("Interaction type is popup. Generating popup window");try{u=this.openPopup(h,"msal",$.popUpWidth,$.popUpHeight),dt.trackPopup(u)}catch(e){if(this.logger.info(ae.code+":"+ae.desc),this.cacheStorage.setItem(K.ERROR,ae.code),this.cacheStorage.setItem(K.ERROR_DESC,ae.desc),i)return i(Ie.createPopupWindowError()),[2]}if(!u)return[3,8];g.label=5;case 5:return g.trys.push([5,7,,8]),[4,dt.monitorPopupForHash(u,this.config.system.loadFrameTimeout,h,this.logger)];case 6:return p=g.sent(),this.handleAuthenticationResponse(p),this.cacheStorage.setInteractionInProgress(!1),this.logger.info("Closing popup window"),this.config.framework.isAngular&&this.broadcast("msal:popUpHashChanged",p),dt.closePopups(),[3,8];case 7:return f=g.sent(),i&&i(f),this.config.framework.isAngular?this.broadcast("msal:popUpClosed",f.errorCode+$.resourceDelimiter+f.errorMessage):(this.cacheStorage.setInteractionInProgress(!1),u.close()),[3,8];case 8:return[3,10];case 9:r.onRedirectNavigate?(this.logger.verbose("Invoking onRedirectNavigate callback"),!1!==r.onRedirectNavigate(h)?(this.logger.verbose("onRedirectNavigate did not return false, navigating"),this.navigateWindow(h)):this.logger.verbose("onRedirectNavigate returned false, stopping navigation")):(this.logger.verbose("Navigating window to urlNavigate"),this.navigateWindow(h)),g.label=10;case 10:return[3,12];case 11:return m=g.sent(),this.logger.error(m),this.cacheStorage.resetTempCacheItems(r.state),this.authErrorHandler(t,Ie.createEndpointResolutionError(m.toString),It(r.state),i),u&&u.close(),[3,12];case 12:return[2]}}))}))},e.prototype.ssoSilent=function(e){if(this.logger.verbose("ssoSilent has been called"),!e)throw Ge.createEmptyRequestError();if(!e.sid&&!e.loginHint)throw Ge.createSsoSilentError();return this.acquireTokenSilent(q(q({},e),{scopes:$.oidcScopes}))},e.prototype.acquireTokenSilent=function(e){var t=this;this.logger.verbose("AcquireTokenSilent has been called");var n=ct.validateRequest(e,!1,this.clientId,$.interactionTypeSilent),r=this.telemetryManager.createAndStartApiEvent(n.correlationId,kt.AcquireTokenSilent),o=ct.createRequestSignature(n);return new Promise((function(e,r){return L(t,void 0,void 0,(function(){var t,i,s,a,c,u,l,d,h,p,f;return U(this,(function(m){switch(m.label){case 0:if(dt.blockReloadInHiddenIframes(),t=n.scopes.join(" ").toLowerCase(),this.logger.verbosePii("Serialized scopes: "+t),n.account?(i=n.account,this.logger.verbose("Account set from request")):(i=this.getAccount(),this.logger.verbose("Account set from MSAL Cache")),s=this.cacheStorage.getItem($.adalIdToken),!i&&!n.sid&&!n.loginHint&&ie.isEmpty(s))return this.logger.info("User login is required"),[2,r(Ie.createUserLoginRequiredError())];if(a=this.getTokenType(i,n.scopes),this.logger.verbose("Response type: "+a),c=new Je(pt.CreateInstance(n.authority,this.config.auth.validateAuthority,n.authorityMetadata),this.clientId,a,this.getRedirectUri(n.redirectUri),n.scopes,n.state,n.correlationId),this.logger.verbose("Finished building server authentication request"),Je.isSSOParam(n)||i?(c.populateQueryParams(i,n,null,!0),this.logger.verbose("Query parameters populated from existing SSO or account")):i||ie.isEmpty(s)?this.logger.verbose("No additional query parameters added"):(u=ot.extractIdToken(s),this.logger.verbose("ADAL's idToken exists. Extracting login information from ADAL's idToken to populate query parameters"),c.populateQueryParams(i,null,u,!0)),!(l=n.claimsRequest||c.claimsValue)&&!n.forceRefresh)try{h=this.getCachedToken(c,i)}catch(e){d=e}return h?(this.logger.verbose("Token found in cache lookup"),this.logger.verbosePii("Scopes found: "+JSON.stringify(h.scopes)),e(h),[2,null]):[3,1];case 1:return d?(this.logger.infoPii(d.errorCode+":"+d.errorMessage),r(d),[2,null]):[3,2];case 2:p=void 0,p=l?"Skipped cache lookup since claims were given":n.forceRefresh?"Skipped cache lookup since request.forceRefresh option was set to true":"No valid token found in cache lookup",this.logger.verbose(p),c.authorityInstance||(c.authorityInstance=n.authority?pt.CreateInstance(n.authority,this.config.auth.validateAuthority,n.authorityMetadata):this.authorityInstance),this.logger.verbosePii("Authority instance: "+c.authority),m.label=3;case 3:return m.trys.push([3,7,,8]),c.authorityInstance.hasCachedMetadata()?[3,5]:(this.logger.verbose("No cached metadata for authority"),[4,pt.saveMetadataFromNetwork(c.authorityInstance,this.telemetryManager,n.correlationId)]);case 4:return m.sent(),this.logger.verbose("Authority has been updated with endpoint discovery response"),[3,6];case 5:this.logger.verbose("Cached metadata found for authority"),m.label=6;case 6:return window.activeRenewals[o]?(this.logger.verbose("Renewing token in progress. Registering callback"),this.registerCallback(window.activeRenewals[o],o,e,r)):n.scopes&&Ye.onlyContainsOidcScopes(n.scopes)?(this.logger.verbose("OpenID Connect scopes only, renewing idToken"),this.silentLogin=!0,this.renewIdToken(o,e,r,i,c)):(this.logger.verbose("Renewing access token"),this.renewToken(o,e,r,i,c)),[3,8];case 7:return f=m.sent(),this.logger.error(f),r(Ie.createEndpointResolutionError(f.toString())),[2,null];case 8:return[2]}}))}))})).then((function(e){return t.logger.verbose("Successfully acquired token"),t.telemetryManager.stopAndFlushApiEvent(n.correlationId,r,!0),e})).catch((function(e){throw t.cacheStorage.resetTempCacheItems(n.state),t.telemetryManager.stopAndFlushApiEvent(n.correlationId,r,!1,e.errorCode),e}))},e.prototype.openPopup=function(e,t,n,r){this.logger.verbose("OpenPopup has been called");try{var o=window.screenLeft?window.screenLeft:window.screenX,i=window.screenTop?window.screenTop:window.screenY,s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,c=s/2-n/2+o,u=a/2-r/2+i,l=window.open(e,t,"width="+n+", height="+r+", top="+u+", left="+c+", scrollbars=yes");if(!l)throw Ie.createPopupWindowError();return l.focus&&l.focus(),l}catch(e){throw this.cacheStorage.setInteractionInProgress(!1),Ie.createPopupWindowError(e.toString())}},e.prototype.loadIframeTimeout=function(e,t,n){return L(this,void 0,void 0,(function(){var r,o,i,s,a;return U(this,(function(c){switch(c.label){case 0:return r=window.activeRenewals[n],this.logger.verbosePii("Set loading state to pending for: "+n+":"+r),this.cacheStorage.setItem(ut.generateTemporaryCacheKey(B.RENEW_STATUS,r),$.inProgress),this.config.system.navigateFrameWait?[4,dt.loadFrame(e,t,this.config.system.navigateFrameWait,this.logger)]:[3,2];case 1:return i=c.sent(),[3,3];case 2:i=dt.loadFrameSync(e,t,this.logger),c.label=3;case 3:o=i,c.label=4;case 4:return c.trys.push([4,6,,7]),[4,dt.monitorIframeForHash(o.contentWindow,this.config.system.loadFrameTimeout,e,this.logger)];case 5:return(s=c.sent())&&this.handleAuthenticationResponse(s),[3,7];case 6:throw a=c.sent(),this.cacheStorage.getItem(ut.generateTemporaryCacheKey(B.RENEW_STATUS,r))===$.inProgress&&(this.logger.verbose("Loading frame has timed out after: "+this.config.system.loadFrameTimeout/1e3+" seconds for scope/authority "+n+":"+r),r&&window.callbackMappedToRenewStates[r]&&window.callbackMappedToRenewStates[r](null,a),this.cacheStorage.removeItem(ut.generateTemporaryCacheKey(B.RENEW_STATUS,r))),dt.removeHiddenIframe(o),a;case 7:return dt.removeHiddenIframe(o),[2]}}))}))},e.prototype.navigateWindow=function(e,t){if(!e||ie.isEmpty(e))throw this.logger.info("Navigate url is empty"),oe.createUnexpectedError("Navigate url is empty");var n=t||window,r=t?"Navigated Popup window to:"+e:"Navigate to:"+e;this.logger.infoPii(r),n.location.assign(e)},e.prototype.registerCallback=function(e,t,n,r){var o=this;window.activeRenewals[t]=e,window.promiseMappedToRenewStates[e]||(window.promiseMappedToRenewStates[e]=[]),window.promiseMappedToRenewStates[e].push({resolve:n,reject:r}),window.callbackMappedToRenewStates[e]||(window.callbackMappedToRenewStates[e]=function(n,r){delete window.activeRenewals[t];for(var i=0;i<window.promiseMappedToRenewStates[e].length;++i)try{if(r)window.promiseMappedToRenewStates[e][i].reject(r);else{if(!n)throw o.cacheStorage.resetTempCacheItems(e),oe.createUnexpectedError("Error and response are both null");window.promiseMappedToRenewStates[e][i].resolve(n)}}catch(e){o.logger.warning(e)}delete window.promiseMappedToRenewStates[e],delete window.callbackMappedToRenewStates[e]})},e.prototype.logout=function(e){this.logger.verbose("Logout has been called"),this.logoutAsync(e)},e.prototype.logoutAsync=function(e){return L(this,void 0,void 0,(function(){var t,n,r,o,i,s;return U(this,(function(a){switch(a.label){case 0:t=e||z.createNewGuid(),n=this.telemetryManager.createAndStartApiEvent(t,kt.Logout),this.clearCache(),this.account=null,a.label=1;case 1:return a.trys.push([1,5,,6]),this.authorityInstance.hasCachedMetadata()?[3,3]:(this.logger.verbose("No cached metadata for authority"),[4,pt.saveMetadataFromNetwork(this.authorityInstance,this.telemetryManager,e)]);case 2:return a.sent(),[3,4];case 3:this.logger.verbose("Cached metadata found for authority"),a.label=4;case 4:return r="client-request-id="+t,o=void 0,this.getPostLogoutRedirectUri()?(o="&post_logout_redirect_uri="+encodeURIComponent(this.getPostLogoutRedirectUri()),this.logger.verbose("redirectUri found and set")):(o="",this.logger.verbose("No redirectUri set for app. postLogoutQueryParam is empty")),i=void 0,this.authorityInstance.EndSessionEndpoint?(i=this.authorityInstance.EndSessionEndpoint+"?"+r+o,this.logger.verbose("EndSessionEndpoint found and urlNavigate set"),this.logger.verbosePii("urlNavigate set to: "+this.authorityInstance.EndSessionEndpoint)):(i=this.authority+"oauth2/v2.0/logout?"+r+o,this.logger.verbose("No endpoint, urlNavigate set to default")),this.telemetryManager.stopAndFlushApiEvent(t,n,!0),this.logger.verbose("Navigating window to urlNavigate"),this.navigateWindow(i),[3,6];case 5:return s=a.sent(),this.telemetryManager.stopAndFlushApiEvent(t,n,!1,s.errorCode),[3,6];case 6:return[2]}}))}))},e.prototype.clearCache=function(){this.logger.verbose("Clearing cache"),window.renewStates=[];for(var e=this.cacheStorage.getAllTokens($.clientId,$.homeAccountIdentifier),t=0;t<e.length;t++)this.cacheStorage.removeItem(JSON.stringify(e[t].key));this.cacheStorage.resetCacheItems(),this.cacheStorage.clearMsalCookie(),this.logger.verbose("Cache cleared")},e.prototype.clearCacheForScope=function(e){this.logger.verbose("Clearing access token from cache");for(var t=this.cacheStorage.getAllAccessTokens($.clientId,$.homeAccountIdentifier),n=0;n<t.length;n++){var r=t[n];r.value.accessToken===e&&(this.cacheStorage.removeItem(JSON.stringify(r.key)),this.logger.verbosePii("Access token removed: "+r.key))}},e.prototype.isCallback=function(e){return this.logger.info("isCallback will be deprecated in favor of urlContainsHash in MSAL.js v2.0."),this.logger.verbose("isCallback has been called"),We.urlContainsHash(e)},e.prototype.processCallBack=function(e,t,n){this.logger.info("ProcessCallBack has been called. Processing callback from redirect response");var r,o,i=t;i||(this.logger.verbose("StateInfo is null, getting stateInfo from hash"),i=this.getResponseState(e));try{r=this.saveTokenFromHash(e,i)}catch(e){o=e}try{this.cacheStorage.clearMsalCookie(i.state);var s=this.getAccountState(i.state);if(r){if(i.requestType===$.renewToken||r.accessToken?(window.parent!==window?this.logger.verbose("Window is in iframe, acquiring token silently"):this.logger.verbose("Acquiring token interactive in progress"),this.logger.verbose("Response tokenType set to "+D.ACCESS_TOKEN),r.tokenType=D.ACCESS_TOKEN):i.requestType===$.login&&(this.logger.verbose("Response tokenType set to "+D.ID_TOKEN),r.tokenType=D.ID_TOKEN),!n)return this.logger.verbose("Setting redirectResponse"),void(this.redirectResponse=r)}else if(!n)return this.logger.verbose("Response is null, setting redirectResponse with state"),this.redirectResponse=It(s),this.redirectError=o,void this.cacheStorage.resetTempCacheItems(i.state);this.logger.verbose("Calling callback provided to processCallback"),n(r,o)}catch(e){throw this.logger.error("Error occurred in token received callback function: "+e),Ie.createErrorInCallbackFunction(e.toString())}},e.prototype.handleAuthenticationResponse=function(e){this.logger.verbose("HandleAuthenticationResponse has been called");var t=e||window.location.hash,n=this.getResponseState(t);this.logger.verbose("Obtained state from response");var r=window.callbackMappedToRenewStates[n.state];this.processCallBack(t,n,r)},e.prototype.handleRedirectAuthenticationResponse=function(e){this.logger.info("Returned from redirect url"),this.logger.verbose("HandleRedirectAuthenticationResponse has been called"),dt.clearUrlFragment(window),this.logger.verbose("Window.location.hash cleared");var t=this.getResponseState(e);if(this.config.auth.navigateToLoginRequestUrl&&window.parent===window){this.logger.verbose("Window.parent is equal to window, not in popup or iframe. Navigation to login request url after login turned on");var n=this.cacheStorage.getItem(ut.generateTemporaryCacheKey(B.LOGIN_REQUEST,t.state),this.inCookie);if(!n||"null"===n)return this.logger.error("Unable to get valid login request url from cache, redirecting to home page"),void window.location.assign("/");this.logger.verbose("Valid login request url obtained from cache");var r=We.removeHashFromUrl(window.location.href),o=We.removeHashFromUrl(n);if(r!==o)return this.logger.verbose("Current url is not login request url, navigating"),this.logger.verbosePii("CurrentUrl: "+r+", finalRedirectUrl: "+o),void window.location.assign(""+o+e);this.logger.verbose("Current url matches login request url");var i=We.GetUrlComponents(n);i.Hash&&(this.logger.verbose("Login request url contains hash, resetting non-msal hash"),window.location.hash=i.Hash)}else this.config.auth.navigateToLoginRequestUrl||this.logger.verbose("Default navigation to start page after login turned off");this.processCallBack(e,t,null)},e.prototype.getResponseState=function(e){this.logger.verbose("GetResponseState has been called");var t,n=We.deserializeHash(e);if(!n)throw oe.createUnexpectedError("Hash was not parsed correctly.");if(!n.hasOwnProperty(D.STATE))throw oe.createUnexpectedError("Hash does not contain state.");this.logger.verbose("Hash contains state. Creating stateInfo object");var r=ct.parseLibraryState(n.state);if((t={requestType:$.unknown,state:n.state,timestamp:r.ts,method:r.method,stateMatch:!1}).state===this.cacheStorage.getItem(ut.generateTemporaryCacheKey(B.STATE_LOGIN,t.state),this.inCookie)||t.state===this.silentAuthenticationState)return this.logger.verbose("State matches cached state, setting requestType to login"),t.requestType=$.login,t.stateMatch=!0,t;if(t.state===this.cacheStorage.getItem(ut.generateTemporaryCacheKey(B.STATE_ACQ_TOKEN,t.state),this.inCookie))return this.logger.verbose("State matches cached state, setting requestType to renewToken"),t.requestType=$.renewToken,t.stateMatch=!0,t;if(!t.stateMatch){this.logger.verbose("State does not match cached state, setting requestType to type from window"),t.requestType=window.requestType;for(var o=window.renewStates,i=0;i<o.length;i++)if(o[i]===t.state){this.logger.verbose("Matching state found for request"),t.stateMatch=!0;break}t.stateMatch||this.logger.verbose("Matching state not found for request")}return t},e.prototype.getCachedToken=function(e,t){this.logger.verbose("GetCachedToken has been called");var n=e.scopes,r=this.getCachedIdToken(e,t),o=this.getCachedAccessToken(e,t,n),i=this.getAccountState(e.state);return ht.buildAuthResponse(r,o,e,t,n,i)},e.prototype.getTokenCacheItemByAuthority=function(e,t,n,r){var o,i=this;return 1===(o=We.isCommonAuthority(e)||We.isOrganizationsAuthority(e)||We.isConsumersAuthority(e)?pn.filterTokenCacheItemsByDomain(t,We.GetUrlComponents(e).HostNameAndPort):pn.filterTokenCacheItemsByAuthority(t,e)).length?o[0]:o.length>1?(this.logger.warning("Multiple matching tokens found. Cleaning cache and requesting a new token."),o.forEach((function(e){i.cacheStorage.removeItem(JSON.stringify(e.key))})),null):(this.logger.verbose("No matching tokens of type "+r+" found"),null)},e.prototype.getCachedIdToken=function(e,t){this.logger.verbose("Getting all cached tokens of type ID Token");var n=this.cacheStorage.getAllIdTokens(this.clientId,t?t.homeAccountIdentifier:null),r=e.authority||this.authority,o=this.getTokenCacheItemByAuthority(r,n,null,D.ID_TOKEN);if(o){if(this.logger.verbose("Evaluating ID token found"),this.evaluateTokenExpiration(o)){this.logger.verbose("ID token expiration is within offset, using ID token found in cache");var i=o.value;return i?this.logger.verbose("ID Token found in cache is valid and unexpired"):this.logger.verbose("ID Token found in cache is invalid"),i?new it(i.idToken):null}return this.logger.verbose("Cached ID token is expired, removing from cache"),this.cacheStorage.removeItem(JSON.stringify(o.key)),null}return this.logger.verbose("No tokens found"),null},e.prototype.getCachedAccessToken=function(e,t,n){this.logger.verbose("Getting all cached tokens of type Access Token");var r=this.cacheStorage.getAllAccessTokens(this.clientId,t?t.homeAccountIdentifier:null),o=pn.filterTokenCacheItemsByScope(r,n),i=e.authority||this.authority,s=this.getTokenCacheItemByAuthority(i,o,n,D.ACCESS_TOKEN);if(s){if(e.authorityInstance=pt.CreateInstance(s.key.authority,this.config.auth.validateAuthority),this.logger.verbose("Evaluating access token found"),this.evaluateTokenExpiration(s)){this.logger.verbose("Access token expiration is within offset, using access token found in cache");var a=t||this.getAccount();if(!a)throw oe.createUnexpectedError("Account should not be null here.");var c=this.getAccountState(e.state);return{uniqueId:"",tenantId:"",tokenType:D.ACCESS_TOKEN,idToken:null,idTokenClaims:null,accessToken:s.value.accessToken,scopes:s.key.scopes.split(" "),expiresOn:new Date(1e3*Number(s.value.expiresIn)),account:a,accountState:c,fromCache:!0}}return this.logger.verbose("Access token expired, removing from cache"),this.cacheStorage.removeItem(JSON.stringify(s.key)),null}return this.logger.verbose("No matching token found when filtering by scope and authority"),null},e.prototype.evaluateTokenExpiration=function(e){var t=Number(e.value.expiresIn);return ot.validateExpirationIsWithinOffset(t,this.config.system.tokenRenewalOffsetSeconds)},e.prototype.extractADALIdToken=function(){this.logger.verbose("ExtractADALIdToken has been called");var e=this.cacheStorage.getItem($.adalIdToken);return ie.isEmpty(e)?null:ot.extractIdToken(e)},e.prototype.renewToken=function(e,t,n,r,o){this.logger.verbose("RenewToken has been called"),this.logger.verbosePii("RenewToken scope and authority: "+e);var i=dt.generateFrameName(te,e);dt.addHiddenIFrame(i,this.logger),this.updateCacheEntries(o,r,!1),this.logger.verbosePii("RenewToken expected state: "+o.state);var s=We.urlRemoveQueryStringParameter(We.createNavigateUrl(o),$.prompt)+$.prompt_none+$.response_mode_fragment;window.renewStates.push(o.state),window.requestType=$.renewToken,this.logger.verbose("Set window.renewState and requestType"),this.registerCallback(o.state,e,t,n),this.logger.infoPii("Navigate to: "+s),this.loadIframeTimeout(s,i,e).catch((function(e){return n(e)}))},e.prototype.renewIdToken=function(e,t,n,r,o){this.logger.info("RenewIdToken has been called");var i=dt.generateFrameName(ee,e);dt.addHiddenIFrame(i,this.logger),this.updateCacheEntries(o,r,!1),this.logger.verbose("RenewIdToken expected state: "+o.state);var s=We.urlRemoveQueryStringParameter(We.createNavigateUrl(o),$.prompt)+$.prompt_none+$.response_mode_fragment;this.silentLogin?(this.logger.verbose("Silent login is true, set silentAuthenticationState"),window.requestType=$.login,this.silentAuthenticationState=o.state):(this.logger.verbose("Not silent login, set window.renewState and requestType"),window.requestType=$.renewToken,window.renewStates.push(o.state)),this.registerCallback(o.state,e,t,n),this.logger.infoPii('Navigate to:" '+s),this.loadIframeTimeout(s,i,e).catch((function(e){return n(e)}))},e.prototype.saveToken=function(e,t,n,r,o){var i=new Ve(t,this.clientId,n,r.uid,r.utid),s=new Qe(e.accessToken,e.idToken.rawIdToken,o.toString(),r.encodeClientInfo());return this.cacheStorage.setItem(JSON.stringify(i),JSON.stringify(s)),o?(this.logger.verbose("New expiration set for token"),e.expiresOn=new Date(1e3*o)):this.logger.error("Could not parse expiresIn parameter for access token"),e},e.prototype.saveIdToken=function(e,t,n,r,o){this.logger.verbose("SaveIdToken has been called");var i=q({},e);i.scopes=$.oidcScopes,i.accessToken=n[D.ID_TOKEN];var s=Number(o.expiration);return this.logger.verbose("Saving ID token to cache"),this.saveToken(i,t,void 0,r,s)},e.prototype.saveAccessToken=function(e,t,n,r){this.logger.verbose("SaveAccessToken has been called");var o=q({},e),i=n[D.SCOPE],s=i.split(" "),a=this.cacheStorage.getAllAccessTokens(this.clientId,t);this.logger.verbose("Retrieving all access tokens from cache and removing duplicates");for(var c=0;c<a.length;c++){var u=a[c];if(u.key.homeAccountIdentifier===e.account.homeAccountIdentifier){var l=u.key.scopes.split(" ");Ye.isIntersectingScopes(l,s)&&this.cacheStorage.removeItem(JSON.stringify(u.key))}}o.accessToken=n[D.ACCESS_TOKEN],o.scopes=s;var d=rt.parseExpiresIn(n[D.EXPIRES_IN]),h=ct.parseLibraryState(n[D.STATE]).ts+d;return this.logger.verbose("Saving access token to cache"),this.saveToken(o,t,i,r,h)},e.prototype.saveTokenFromHash=function(e,t){this.logger.verbose("SaveTokenFromHash has been called"),this.logger.info("State status: "+t.stateMatch+"; Request type: "+t.requestType);var n,r={uniqueId:"",tenantId:"",tokenType:"",idToken:null,idTokenClaims:null,accessToken:null,scopes:[],expiresOn:null,account:null,accountState:"",fromCache:!1},o=We.deserializeHash(e),i="",s="",a=null;if(o.hasOwnProperty(D.ERROR_DESCRIPTION)||o.hasOwnProperty(D.ERROR)){if(this.logger.verbose("Server returned an error"),this.logger.infoPii("Error : "+o[D.ERROR]+"; Error description: "+o[D.ERROR_DESCRIPTION]),this.cacheStorage.setItem(K.ERROR,o[D.ERROR]),this.cacheStorage.setItem(K.ERROR_DESC,o[D.ERROR_DESCRIPTION]),t.requestType===$.login&&(this.logger.verbose("RequestType is login, caching login error, generating authorityKey"),this.cacheStorage.setItem(K.LOGIN_ERROR,o[D.ERROR_DESCRIPTION]+":"+o[D.ERROR]),i=ut.generateAuthorityKey(t.state)),t.requestType===$.renewToken){this.logger.verbose("RequestType is renewToken, generating acquireTokenAccountKey"),i=ut.generateAuthorityKey(t.state);var c=this.getAccount(),u=void 0;c&&!ie.isEmpty(c.homeAccountIdentifier)?(u=c.homeAccountIdentifier,this.logger.verbose("AccountId is set")):(u=$.no_account,this.logger.verbose("AccountId is set as no_account")),s=ut.generateAcquireTokenAccountKey(u,t.state)}var l=o[D.ERROR],d=o[D.ERROR_DESCRIPTION];n=Ct.isInteractionRequiredError(l)||Ct.isInteractionRequiredError(d)?new Ct(o[D.ERROR],o[D.ERROR_DESCRIPTION]):new wt(o[D.ERROR],o[D.ERROR_DESCRIPTION])}else if(this.logger.verbose("Server returns success"),t.stateMatch){this.logger.info("State is right"),o.hasOwnProperty(D.SESSION_STATE)&&(this.logger.verbose("Fragment has session state, caching"),this.cacheStorage.setItem(ut.generateTemporaryCacheKey(B.SESSION_STATE,t.state),o[D.SESSION_STATE])),r.accountState=this.getAccountState(t.state);var h=void 0;if(o.hasOwnProperty(D.ACCESS_TOKEN)){this.logger.info("Fragment has access token"),r.accessToken=o[D.ACCESS_TOKEN],o.hasOwnProperty(D.SCOPE)&&(r.scopes=o[D.SCOPE].split(" ")),o.hasOwnProperty(D.ID_TOKEN)?(this.logger.verbose("Fragment has id_token"),a=new it(o[D.ID_TOKEN])):(this.logger.verbose("No idToken on fragment, getting idToken from cache"),a=new it(this.cacheStorage.getItem(F.IDTOKEN))),r=ht.setResponseIdToken(r,a);var p=this.populateAuthority(t.state,this.inCookie,this.cacheStorage,a);this.logger.verbose("Got authority from cache"),o.hasOwnProperty(D.CLIENT_INFO)?(this.logger.verbose("Fragment has clientInfo"),h=new nt(o[D.CLIENT_INFO],p)):this.authorityInstance.AuthorityType===Q.Adfs?h=nt.createClientInfoFromIdToken(a,p):this.logger.warning("ClientInfo not received in the response from AAD"),r.account=lt.createAccount(a,h),this.logger.verbose("Account object created from response");var f=void 0;r.account&&!ie.isEmpty(r.account.homeAccountIdentifier)?(this.logger.verbose("AccountKey set"),f=r.account.homeAccountIdentifier):(this.logger.verbose("AccountKey set as no_account"),f=$.no_account),s=ut.generateAcquireTokenAccountKey(f,t.state);var m=ut.generateAcquireTokenAccountKey($.no_account,t.state);this.logger.verbose("AcquireTokenAccountKey generated");var g=this.cacheStorage.getItem(s),y=void 0;ie.isEmpty(g)?ie.isEmpty(this.cacheStorage.getItem(m))||(this.logger.verbose("No acquireToken account retrieved from cache"),r=this.saveAccessToken(r,p,o,h)):(y=JSON.parse(g),this.logger.verbose("AcquireToken request account retrieved from cache"),r.account&&y&&lt.compareAccounts(r.account,y)?(r=this.saveAccessToken(r,p,o,h),this.logger.info("The user object received in the response is the same as the one passed in the acquireToken request")):this.logger.warning("The account object created from the response is not the same as the one passed in the acquireToken request"))}if(o.hasOwnProperty(D.ID_TOKEN)){this.logger.info("Fragment has idToken"),a=new it(o[D.ID_TOKEN]);p=this.populateAuthority(t.state,this.inCookie,this.cacheStorage,a);if(r=ht.setResponseIdToken(r,a),o.hasOwnProperty(D.CLIENT_INFO)?(this.logger.verbose("Fragment has clientInfo"),h=new nt(o[D.CLIENT_INFO],p)):this.authorityInstance.AuthorityType===Q.Adfs?h=nt.createClientInfoFromIdToken(a,p):this.logger.warning("ClientInfo not received in the response from AAD"),this.account=lt.createAccount(a,h),r.account=this.account,this.logger.verbose("Account object created from response"),a&&a.nonce){this.logger.verbose("IdToken has nonce");var v=this.cacheStorage.getItem(ut.generateTemporaryCacheKey(B.NONCE_IDTOKEN,t.state),this.inCookie);a.nonce!==v?(this.account=null,this.cacheStorage.setItem(K.LOGIN_ERROR,"Nonce Mismatch. Expected Nonce: "+v+",Actual Nonce: "+a.nonce),this.logger.error("Nonce Mismatch. Expected Nonce: "+v+", Actual Nonce: "+a.nonce),n=Ie.createNonceMismatchError(v,a.nonce)):(this.logger.verbose("Nonce matches, saving idToken to cache"),this.cacheStorage.setItem(F.IDTOKEN,o[D.ID_TOKEN],this.inCookie),this.cacheStorage.setItem(F.CLIENT_INFO,h.encodeClientInfo(),this.inCookie),this.saveIdToken(r,p,o,h,a))}else this.logger.verbose("No idToken or no nonce. Cache key for Authority set as state"),i=t.state,s=t.state,this.logger.error("Invalid id_token received in the response"),n=Ie.createInvalidIdTokenError(a),this.cacheStorage.setItem(K.ERROR,n.errorCode),this.cacheStorage.setItem(K.ERROR_DESC,n.errorMessage)}}else{this.logger.verbose("State mismatch"),i=t.state,s=t.state;var b=this.cacheStorage.getItem(ut.generateTemporaryCacheKey(B.STATE_LOGIN,t.state),this.inCookie);this.logger.error("State Mismatch. Expected State: "+b+", Actual State: "+t.state),n=Ie.createInvalidStateError(t.state,b),this.cacheStorage.setItem(K.ERROR,n.errorCode),this.cacheStorage.setItem(K.ERROR_DESC,n.errorMessage)}if(this.cacheStorage.removeItem(ut.generateTemporaryCacheKey(B.RENEW_STATUS,t.state)),this.cacheStorage.resetTempCacheItems(t.state),this.logger.verbose("Status set to complete, temporary cache cleared"),this.inCookie&&(this.logger.verbose("InCookie is true, setting authorityKey in cookie"),this.cacheStorage.setItemCookie(i,"",-1),this.cacheStorage.clearMsalCookie(t.state)),n)throw n;if(!r)throw oe.createUnexpectedError("Response is null");return r},e.prototype.populateAuthority=function(e,t,n,r){this.logger.verbose("PopulateAuthority has been called");var o=ut.generateAuthorityKey(e),i=n.getItem(o,t);return ie.isEmpty(i)?i:We.replaceTenantPath(i,r.tenantId)},e.prototype.getAccount=function(){if(this.account)return this.account;var e=this.cacheStorage.getItem(F.IDTOKEN,this.inCookie),t=this.cacheStorage.getItem(F.CLIENT_INFO,this.inCookie);if(!ie.isEmpty(e)&&!ie.isEmpty(t)){var n=new it(e),r=new nt(t,"");return this.account=lt.createAccount(n,r),this.account}return null},e.prototype.getAccountState=function(e){if(e){var t=e.indexOf($.resourceDelimiter);if(t>-1&&t+1<e.length)return e.substring(t+1)}return e},e.prototype.getAllAccounts=function(){for(var e=[],t=this.cacheStorage.getAllAccessTokens($.clientId,$.homeAccountIdentifier),n=0;n<t.length;n++){var r=new it(t[n].value.idToken),o=new nt(t[n].value.homeAccountIdentifier,""),i=lt.createAccount(r,o);e.push(i)}return this.getUniqueAccounts(e)},e.prototype.getUniqueAccounts=function(e){if(!e||e.length<=1)return e;for(var t=[],n=[],r=0;r<e.length;++r)e[r].homeAccountIdentifier&&-1===t.indexOf(e[r].homeAccountIdentifier)&&(t.push(e[r].homeAccountIdentifier),n.push(e[r]));return n},e.prototype.broadcast=function(e,t){var n=new CustomEvent(e,{detail:t});window.dispatchEvent(n)},e.prototype.getCachedTokenInternal=function(e,t,n,r){var o=t||this.getAccount();if(!o)return null;var i=this.authorityInstance?this.authorityInstance:pt.CreateInstance(this.authority,this.config.auth.validateAuthority),s=this.getTokenType(o,e),a=new Je(i,this.clientId,s,this.getRedirectUri(),e,n,r);return this.getCachedToken(a,t)},e.prototype.getScopesForEndpoint=function(e){if(this.config.framework.unprotectedResources.length>0)for(var t=0;t<this.config.framework.unprotectedResources.length;t++)if(e.indexOf(this.config.framework.unprotectedResources[t])>-1)return null;if(this.config.framework.protectedResourceMap.size>0)for(var n=0,r=Array.from(this.config.framework.protectedResourceMap.keys());n<r.length;n++){var o=r[n];if(e.indexOf(o)>-1)return this.config.framework.protectedResourceMap.get(o)}return e.indexOf("http://")>-1||e.indexOf("https://")>-1?We.getHostFromUri(e)===We.getHostFromUri(this.getRedirectUri())?new Array(this.clientId):null:new Array(this.clientId)},e.prototype.getLoginInProgress=function(){return this.cacheStorage.isInteractionInProgress(!0)},e.prototype.setInteractionInProgress=function(e){this.cacheStorage.setInteractionInProgress(e)},e.prototype.setloginInProgress=function(e){this.setInteractionInProgress(e)},e.prototype.getAcquireTokenInProgress=function(){return this.cacheStorage.isInteractionInProgress(!0)},e.prototype.setAcquireTokenInProgress=function(e){this.setInteractionInProgress(e)},e.prototype.getLogger=function(){return this.logger},e.prototype.setLogger=function(e){this.logger=e},e.prototype.getRedirectUri=function(e){return e||("function"==typeof this.config.auth.redirectUri?this.config.auth.redirectUri():this.config.auth.redirectUri)},e.prototype.getPostLogoutRedirectUri=function(){return"function"==typeof this.config.auth.postLogoutRedirectUri?this.config.auth.postLogoutRedirectUri():this.config.auth.postLogoutRedirectUri},e.prototype.getCurrentConfiguration=function(){if(!this.config)throw Ge.createNoSetConfigurationError();return this.config},e.prototype.getTokenType=function(e,t){var n=lt.compareAccounts(e,this.getAccount());return Je.determineResponseType(n,t)},e.prototype.setAccountCache=function(e,t){var n=e?this.getAccountId(e):$.no_account,r=ut.generateAcquireTokenAccountKey(n,t);this.cacheStorage.setItem(r,JSON.stringify(e))},e.prototype.setAuthorityCache=function(e,t){var n=ut.generateAuthorityKey(e);this.cacheStorage.setItem(n,We.CanonicalizeUri(t),this.inCookie)},e.prototype.updateCacheEntries=function(e,t,n,r){r&&this.cacheStorage.setItem(ut.generateTemporaryCacheKey(B.LOGIN_REQUEST,e.state),r,this.inCookie),n?this.cacheStorage.setItem(ut.generateTemporaryCacheKey(B.STATE_LOGIN,e.state),e.state,this.inCookie):this.setAccountCache(t,e.state),this.setAuthorityCache(e.state,e.authority),this.cacheStorage.setItem(ut.generateTemporaryCacheKey(B.NONCE_IDTOKEN,e.state),e.nonce,this.inCookie)},e.prototype.getAccountId=function(e){return ie.isEmpty(e.homeAccountIdentifier)?$.no_account:e.homeAccountIdentifier},e.prototype.buildIDTokenRequest=function(e){return{scopes:$.oidcScopes,authority:this.authority,account:this.getAccount(),extraQueryParameters:e.extraQueryParameters,correlationId:e.correlationId}},e.prototype.getTelemetryManagerFromConfig=function(e,t){if(!e)return hn.getTelemetrymanagerStub(t,this.logger);var n=e.applicationName,r=e.applicationVersion,o=e.telemetryEmitter;if(!n||!r||!o)throw Ge.createTelemetryConfigError(e);return new hn({platform:{applicationName:n,applicationVersion:r},clientId:t},o,this.logger)},e}(),mn=n(23);const gn=Object(a.a)("InteractiveBrowserCredential");class yn{constructor(e){if(e=Object.assign(Object.assign({authorityHost:mn.b},e),{tenantId:e&&e.tenantId||mn.c,clientId:e&&e.clientId||mn.d}),this.loginStyle=e.loginStyle||"popup",-1===["redirect","popup"].indexOf(this.loginStyle)){const t=new Error("Invalid loginStyle: "+e.loginStyle);throw gn.info(Object(a.b)("",t)),t}const t="adfs"===e.tenantId&&e.authorityHost?[e.authorityHost]:[];this.msalConfig={auth:Object.assign(Object.assign({clientId:e.clientId,authority:`${e.authorityHost}/${e.tenantId}`,knownAuthorities:t},e.redirectUri&&{redirectUri:e.redirectUri}),e.postLogoutRedirectUri&&{redirectUri:e.postLogoutRedirectUri}),cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!0}},this.msalObject=new fn(this.msalConfig)}login(){switch(this.loginStyle){case"redirect":{const e=new Promise((e,t)=>{this.msalObject.handleRedirectCallback(e,t)});return this.msalObject.loginRedirect(),e}case"popup":return this.msalObject.loginPopup()}}acquireToken(e){return Object(r.__awaiter)(this,void 0,void 0,(function*(){let t,n;try{gn.info("Attempting to acquire token silently"),t=yield this.msalObject.acquireTokenSilent(e)}catch(t){if(t instanceof oe)switch(t.errorCode){case"consent_required":case"interaction_required":case"login_required":gn.info("Authentication returned errorCode "+t.errorCode);break;default:throw gn.info(Object(a.b)(e.scopes,"Failed to acquire token: "+t.message)),t}}if(void 0===t){switch(gn.info("Silent authentication failed, falling back to interactive method "+this.loginStyle),this.loginStyle){case"redirect":n=new Promise((e,t)=>{this.msalObject.handleRedirectCallback(e,t)}),this.msalObject.acquireTokenRedirect(e);break;case"popup":n=this.msalObject.acquireTokenPopup(e)}t=n&&(yield n)}return t}))}getToken(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){const{span:n}=Object(i.a)("InteractiveBrowserCredential-getToken",t);try{this.msalObject.getAccount()||(yield this.login());const t=yield this.acquireToken({scopes:Array.isArray(e)?e:e.split(",")});if(t){const n=t.expiresOn.getTime();return gn.getToken.info(Object(a.c)(e)),{token:t.accessToken,expiresOnTimestamp:n}}return gn.getToken.info("No response"),null}catch(t){throw n.setStatus({code:s.b.ERROR,message:t.message}),gn.getToken.info(Object(a.b)(e,t)),t}finally{n.end()}}))}}const vn=new Error("DeviceCodeCredential is not supported in the browser."),bn=Object(a.a)("DeviceCodeCredential");class _n{constructor(){throw bn.info(Object(a.b)("",vn)),vn}getToken(){throw bn.getToken.info(Object(a.b)("",vn)),vn}}const wn=Object(a.a)("UsernamePasswordCredential");class En{constructor(e,t,n,r,o){!function(e,t){if(!t.match(/^[0-9a-zA-Z-.:/]+$/)){const t=new Error("Invalid tenant id provided. You can locate your tenant id by following the instructions listed here: https://docs.microsoft.com/partner-center/find-ids-and-domain-names.");throw e.info(Object(a.b)("",t)),t}}(wn,e),this.identityClient=new T.a(o),this.tenantId=e,this.clientId=t,this.username=n,this.password=r}getToken(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function*(){const{span:n,updatedOptions:r}=Object(i.a)("UsernamePasswordCredential-getToken",t);try{const o=Object(A.a)(this.tenantId),i=Object(C.a)({url:`${this.identityClient.authorityHost}/${this.tenantId}/${o}`,method:"POST",body:O.a.stringify({response_type:"token",grant_type:"password",client_id:this.clientId,username:this.username,password:this.password,scope:"string"==typeof e?e:e.join(" ")}),headers:Object(I.a)({Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}),abortSignal:t&&t.abortSignal,tracingOptions:{spanOptions:r.tracingOptions&&r.tracingOptions.spanOptions,tracingContext:r.tracingOptions&&r.tracingOptions.tracingContext}}),s=yield this.identityClient.sendTokenRequest(i);return wn.getToken.info(Object(a.c)(e)),s&&s.accessToken||null}catch(t){throw n.setStatus({code:s.b.ERROR,message:t.message}),wn.getToken.info(Object(a.b)(e,t)),t}finally{n.end()}}))}}const Sn=new Error("AuthorizationCodeCredential is not supported in the browser.  InteractiveBrowserCredential is more appropriate for this use case."),On=Object(a.a)("AuthorizationCodeCredential");class Cn{constructor(){throw On.info(Object(a.b)("",Sn)),Sn}getToken(){throw On.getToken.info(Object(a.b)("",Sn)),Sn}}function In(){return new E}},function(e,t,n){"use strict";n.r(t),n.d(t,"EventHubConsumerClient",(function(){return Et})),n.d(t,"EventHubProducerClient",(function(){return Tt})),n.d(t,"EventHubBufferedProducerClient",(function(){return jt})),n.d(t,"latestEventPosition",(function(){return l})),n.d(t,"earliestEventPosition",(function(){return u})),n.d(t,"CloseReason",(function(){return f})),n.d(t,"MessagingError",(function(){return a.c})),n.d(t,"RetryMode",(function(){return g.a})),n.d(t,"logger",(function(){return o.b})),n.d(t,"parseEventHubConnectionString",(function(){return ut})),n.d(t,"createEventDataAdapter",(function(){return Mt}));var r=n(45),o=n(0);class i{constructor(e,t,n){this._eventHandlers=e,this._checkpointStore=t,this._context=n}get lastEnqueuedEventProperties(){return this._lastEnqueuedEventProperties}set lastEnqueuedEventProperties(e){this._lastEnqueuedEventProperties=e}get fullyQualifiedNamespace(){return this._context.fullyQualifiedNamespace}get consumerGroup(){return this._context.consumerGroup}get eventHubName(){return this._context.eventHubName}get partitionId(){return this._context.partitionId}get eventProcessorId(){return this._context.eventProcessorId}async initialize(){this._eventHandlers.processInitialize&&await this._eventHandlers.processInitialize(this)}async close(e){this._eventHandlers.processClose&&await this._eventHandlers.processClose(e,this)}async processEvents(e){await this._eventHandlers.processEvents(e,this)}async processError(e){if(this._eventHandlers.processError)try{await this._eventHandlers.processError(e,this)}catch(e){o.b.verbose("Error thrown from user's processError handler : "+e)}}async updateCheckpoint(e){const t={fullyQualifiedNamespace:this._context.fullyQualifiedNamespace,eventHubName:this._context.eventHubName,consumerGroup:this._context.consumerGroup,partitionId:this._context.partitionId,sequenceNumber:e.sequenceNumber,offset:e.offset};await this._checkpointStore.updateCheckpoint(t)}}var s=n(5),a=n(10),c=n(1);const u={offset:-1},l={offset:"@latest"};function d(e){if(!Object(c.b)(e))return;const t=Object.keys(e);if(!t.length)throw new TypeError("Invalid value for EventPosition found. Pass an object with either of offset, sequenceNumber or enqueuedOn properties set.");if(h(e))return void p(e);const n=e;for(let e=0;e<t.length;e++)Object.prototype.hasOwnProperty.call(n,t[e])&&p(n[t[e]])}function h(e){return!!e&&(!(!Object(c.d)(e,"offset")||!Object(c.b)(e.offset))||(!(!Object(c.d)(e,"sequenceNumber")||!Object(c.b)(e.sequenceNumber))||!(!Object(c.d)(e,"enqueuedOn")||!Object(c.b)(e.enqueuedOn))))}function p(e){if(!Object(c.b)(e))return;const t=Object(c.b)(e.offset),n=Object(c.b)(e.sequenceNumber),r=Object(c.b)(e.enqueuedOn);if(t&&n||t&&r||r&&n)throw new TypeError("Invalid value for EventPosition found. Set only one of offset, sequenceNumber or enqueuedOn properties.");if(!t&&!r&&!n)throw new TypeError("Invalid value for EventPosition found. Pass an object with either of offset, sequenceNumber or enqueuedOn properties set.")}var f;!function(e){e.OwnershipLost="OwnershipLost",e.Shutdown="Shutdown"}(f||(f={}));var m=n(14),g=n(84),y=n(2),v=n(4);const b={toRheaMessageHeader(e){const t={};return null!=e.deliveryCount&&(t.delivery_count=e.deliveryCount),null!=e.durable&&(t.durable=e.durable),null!=e.firstAcquirer&&(t.first_acquirer=e.firstAcquirer),null!=e.priority&&(t.priority=e.priority),null!=e.timeToLive&&(t.ttl=e.timeToLive),v.b.verbose("To RheaMessageHeader: %O",t),t},fromRheaMessageHeader(e){const t={};return null!=e.delivery_count&&(t.deliveryCount=e.delivery_count),null!=e.durable&&(t.durable=e.durable),null!=e.first_acquirer&&(t.firstAcquirer=e.first_acquirer),null!=e.priority&&(t.priority=e.priority),null!=e.ttl&&(t.timeToLive=e.ttl),v.b.verbose("From RheaMessageHeader: %O",t),t}},_={toRheaMessageProperties(e){const t={};return null!=e.absoluteExpiryTime&&(t.absolute_expiry_time=new Date(e.absoluteExpiryTime)),null!=e.contentEncoding&&(t.content_encoding=e.contentEncoding),null!=e.contentType&&(t.content_type=e.contentType),null!=e.correlationId&&(t.correlation_id=e.correlationId),null!=e.creationTime&&(t.creation_time=new Date(e.creationTime)),null!=e.groupId&&(t.group_id=e.groupId),null!=e.groupSequence&&(t.group_sequence=e.groupSequence),null!=e.messageId&&(t.message_id=e.messageId),null!=e.replyTo&&(t.reply_to=e.replyTo),null!=e.replyToGroupId&&(t.reply_to_group_id=e.replyToGroupId),null!=e.subject&&(t.subject=e.subject),null!=e.to&&(t.to=e.to),v.b.verbose("To RheaMessageProperties: %O",t),t},fromRheaMessageProperties(e){const t={};return null!=e.absolute_expiry_time&&(t.absoluteExpiryTime=e.absolute_expiry_time.getTime()),null!=e.content_encoding&&(t.contentEncoding=e.content_encoding),null!=e.content_type&&(t.contentType=e.content_type),null!=e.correlation_id&&(t.correlationId=e.correlation_id),null!=e.creation_time&&(t.creationTime=e.creation_time.getTime()),null!=e.group_id&&(t.groupId=e.group_id),null!=e.group_sequence&&(t.groupSequence=e.group_sequence),null!=e.message_id&&(t.messageId=e.message_id),null!=e.reply_to&&(t.replyTo=e.reply_to),null!=e.reply_to_group_id&&(t.replyToGroupId=e.reply_to_group_id),null!=e.subject&&(t.subject=e.subject),null!=e.to&&(t.to=e.to),v.b.verbose("From RheaMessageProperties: %O",t),t}},w={fromRheaMessage:e=>({header:b.fromRheaMessageHeader(e),footer:e.footer,messageAnnotations:e.message_annotations,deliveryAnnotations:e.delivery_annotations,applicationProperties:e.application_properties,properties:_.fromRheaMessageProperties(e),body:e.body}),toRheaMessage:e=>Object.assign(Object.assign(Object.assign({},_.toRheaMessageProperties(e.properties||{})),b.toRheaMessageHeader(e.header||{})),{body:e.body,message_annotations:e.messageAnnotations,delivery_annotations:e.deliveryAnnotations,application_properties:e.applicationProperties,footer:e.footer})};var E=n(19),S=n(63),O=n.n(S);const C={encode(e,t){let n;if(void 0===e&&(e=null),"value"===t)n=y.message.data_section(e),n.typecode=119;else if("sequence"===t)n=y.message.sequence_section(e);else if(O()(e)||e instanceof Uint8Array)n=y.message.data_section(e);else if(null===e&&"data"===t)n=y.message.data_section(null);else try{const t=JSON.stringify(e);n=y.message.data_section(E.Buffer.from(t,"utf8"))}catch(t){const n="An error occurred while executing JSON.stringify() on the given body "+e+(t?t.stack:JSON.stringify(t));throw o.b.warning("[encode] "+n),Object(o.a)(t),new Error(n)}return n},decode(e,t){try{if(null==(n=e)||"number"!=typeof n.typecode||117!==n.typecode&&119!==n.typecode&&118!==n.typecode)return O()(e)?{body:t?e:I(e),bodyType:"data"}:{body:e,bodyType:"value"};switch(e.typecode){case 117:return{body:t?e.content:I(e.content),bodyType:"data"};case 118:return{body:e.content,bodyType:"sequence"};case 119:return{body:e.content,bodyType:"value"}}}catch(e){throw o.b.verbose("[decode] An error occurred while decoding the received message body. The error is: %O",e),e}var n}};function I(e){let t=e;try{const e=t.toString("utf8");t=JSON.parse(e)}catch(e){o.b.verbose("[decode] An error occurred while trying JSON.parse() on the received body. The error is %O",e)}return t}var T=n(6),A=n(11);function k(e,t,n,r){var o,i;const s=q(e)?e.applicationProperties:e.properties;if(Boolean(null==s?void 0:s["Diagnostic-Id"]))return{event:e,spanContext:void 0};const{span:a,updatedOptions:c}=A.b.startSpan("message",t,Object(A.a)({entityPath:n,host:r},"producer"));try{if(!a.isRecording())return{event:e,spanContext:void 0};const t=A.b.createRequestHeaders(null===(o=c.tracingOptions)||void 0===o?void 0:o.tracingContext).traceparent;if(t){const n=Object.assign({},s);e=q(e)?Object.assign(Object.assign({},e),{applicationProperties:n}):Object.assign(Object.assign({},e),{properties:n}),n["Diagnostic-Id"]=t}return{event:e,spanContext:null===(i=c.tracingOptions)||void 0===i?void 0:i.tracingContext}}finally{a.end()}}function P(e){if(!e.properties||!e.properties["Diagnostic-Id"])return;const t=e.properties["Diagnostic-Id"];return A.b.parseTraceparentHeader(t)}var R=n(9);function x(e){return Object(c.c)(e,["count","sizeInBytes","tryAdd"])&&"function"==typeof e.tryAdd&&"number"==typeof e.count&&"number"==typeof e.sizeInBytes}class N{constructor(e,t,n,r,o){this._encodedMessages=[],this._spanContexts=[],this._context=e,this._maxSizeInBytes=t,this._isIdempotent=n,this._partitionKey=Object(c.b)(r)?String(r):r,this._partitionId=Object(c.b)(o)?String(o):o,this._sizeInBytes=0,this._count=0}get maxSizeInBytes(){return this._maxSizeInBytes}get partitionKey(){return this._partitionKey}get partitionId(){return this._partitionId}get sizeInBytes(){return this._sizeInBytes}get count(){return this._count}get startingPublishedSequenceNumber(){return this._startingPublishSequenceNumber}get _messageSpanContexts(){return this._spanContexts}_generateBatch(e,t,n){if(this._isIdempotent&&n){const t=e.map(y.message.decode);e=this._decorateRheaMessagesWithPublishingProps(t,n).map(y.message.encode)}const r={body:y.message.data_sections(e)};return t&&(r.message_annotations=t),y.message.encode(r)}_decorateRheaMessagesWithPublishingProps(e,t){if(!this._isIdempotent)return e;const{lastPublishedSequenceNumber:n=0,ownerLevel:r,producerGroupId:o}=t,i=n+1;for(let t=0;t<e.length;t++){U(e[t],{isIdempotentPublishingEnabled:this._isIdempotent,ownerLevel:r,producerGroupId:o,publishSequenceNumber:i+t})}return this._pendingStartingSequenceNumber=i,e}_decorateRheaMessageWithPlaceholderIdempotencyProps(e){return this._isIdempotent?(e.message_annotations||(e.message_annotations={}),U(e,{isIdempotentPublishingEnabled:this._isIdempotent,ownerLevel:0,publishSequenceNumber:0,producerGroupId:0}),e):e}_generateMessage(e){return this._generateBatch(this._encodedMessages,this._batchAnnotations,e)}_commitPublish(){this._startingPublishSequenceNumber=this._pendingStartingSequenceNumber}tryAdd(e,t={}){Object(R.d)(this._context.connectionId,"tryAdd","eventData",e);const{entityPath:n,host:r}=this._context.config,{event:o,spanContext:i}=k(e,t,n,r),s=M(o,this._partitionKey),a=s.message_annotations&&Object.assign({},s.message_annotations);this._decorateRheaMessageWithPlaceholderIdempotencyProps(s);const c=y.message.encode(s);let u=this._sizeInBytes;0===this.count&&(a&&(this._batchAnnotations=a),u+=this._generateBatch([],this._batchAnnotations).length);const l=c.length;return u+=l+(l<=255?5:8),!(u>this._maxSizeInBytes)&&(this._encodedMessages.push(c),i&&this._spanContexts.push(i),this._sizeInBytes=u,this._count++,!0)}}const j={message_id:"messageId",user_id:"userId",to:"to",subject:"subject",reply_to:"replyTo",correlation_id:"correlationId",content_type:"contentType",content_encoding:"contentEncoding",absolute_expiry_time:"absoluteExpiryTime",creation_time:"creationTime",group_id:"groupId",group_sequence:"groupSequence",reply_to_group_id:"replyToGroupId"};function M(e,t){var n,r;let o;if(q(e))o=Object.assign(Object.assign({},w.toRheaMessage(e)),{body:C.encode(e.body,null!==(n=e.bodyType)&&void 0!==n?n:"data")});else{let n="data";if("function"==typeof e.getRawAmqpMessage&&(n=null!==(r=e.getRawAmqpMessage().bodyType)&&void 0!==r?r:"data"),o={body:C.encode(e.body,n)},o.message_annotations={},e.properties&&(o.application_properties=e.properties),Object(c.b)(t)&&(o.message_annotations[s.a.partitionKey]=t,o.durable=!0),null!=e.contentType&&(o.content_type=e.contentType),null!=e.correlationId&&(o.correlation_id=e.correlationId),null!=e.messageId){if("string"==typeof e.messageId&&e.messageId.length>s.a.maxMessageIdLength)throw new Error(`Length of 'messageId' property on the event cannot be greater than ${s.a.maxMessageIdLength} characters.`);o.message_id=e.messageId}}return o}function q(e){return Object(c.c)(e,["body","bodyType"])&&!Object(c.d)(e,"getRawAmqpMessage")}function L(e){if(!Object(c.b)(e))return e;if("object"==typeof e&&Object(c.d)(e,"getTime")&&"function"==typeof e.getTime)return e.getTime();if(Array.isArray(e))return e.map(L);if("object"==typeof e&&Object(c.b)(e)){e=Object.assign({},e);for(const t of Object.keys(e))e[t]=L(e[t])}return e}function U(e,{isIdempotentPublishingEnabled:t,ownerLevel:n,producerGroupId:r,publishSequenceNumber:o}){if(!t)return;const i=e.message_annotations||{};e.message_annotations||(e.message_annotations=i),Object(c.b)(n)&&(i[T.b.epoch]=y.types.wrap_short(n)),Object(c.b)(r)&&(i[T.b.producerId]=y.types.wrap_long(r)),Object(c.b)(o)&&(i[T.b.producerSequenceNumber]=y.types.wrap_int(o))}var H=n(36),D=n(21);class z extends H.a{constructor(e,t,n,r,o={}){super(e,{partitionId:n,name:e.config.getReceiverAddress(n,t)}),this._checkpoint=-1,this._internalQueue=[],this._usingInternalQueue=!1,this._isReceivingMessages=!1,this._isStreaming=!1,this._isClosed=!1,this.consumerGroup=t,this.address=e.config.getReceiverAddress(n,this.consumerGroup),this.audience=e.config.getReceiverAudience(n,this.consumerGroup),this.ownerLevel=o.ownerLevel,this.eventPosition=r,this.options=o,this.runtimeInfo={}}get checkpoint(){return this._checkpoint}get isReceivingMessages(){return this._isReceivingMessages}get isClosed(){return this._isClosed}get lastEnqueuedEventProperties(){return this.runtimeInfo}_onAmqpMessage(e){if(!e.message)return;const t=function(e,t){const n=w.fromRheaMessage(e),{body:r,bodyType:o}=C.decode(e.body,t);n.bodyType=o;const i={body:r,getRawAmqpMessage:()=>n};if(e.message_annotations)for(const t of Object.keys(e.message_annotations))switch(t){case s.a.partitionKey:i.partitionKey=e.message_annotations[t];break;case s.a.sequenceNumber:i.sequenceNumber=e.message_annotations[t];break;case s.a.enqueuedTime:i.enqueuedTimeUtc=new Date(e.message_annotations[t]);break;case s.a.offset:i.offset=e.message_annotations[t];break;default:i.systemProperties||(i.systemProperties={}),i.systemProperties[t]=L(e.message_annotations[t])}e.application_properties&&(i.properties=L(e.application_properties)),e.delivery_annotations&&(i.lastEnqueuedOffset=e.delivery_annotations.last_enqueued_offset,i.lastSequenceNumber=e.delivery_annotations.last_enqueued_sequence_number,i.lastEnqueuedTime=new Date(e.delivery_annotations.last_enqueued_time_utc),i.retrievalTime=new Date(e.delivery_annotations.runtime_info_retrieval_time_utc));const a=Object.keys(j);for(const t of a)i.systemProperties||(i.systemProperties={}),null!=e[t]&&(i.systemProperties[j[t]]=L(e[t]));return null!=e.content_type&&(i.contentType=e.content_type),null!=e.correlation_id&&(i.correlationId=e.correlation_id),null!=e.message_id&&(i.messageId=e.message_id),i}(e.message,!!this.options.skipParsingBodyAsJson),n=t.getRawAmqpMessage(),r={body:t.body,properties:t.properties,offset:t.offset,sequenceNumber:t.sequenceNumber,enqueuedTimeUtc:t.enqueuedTimeUtc,partitionKey:t.partitionKey,systemProperties:t.systemProperties,getRawAmqpMessage:()=>n};null!=t.correlationId&&(r.correlationId=t.correlationId),null!=t.contentType&&(r.contentType=t.contentType),null!=t.messageId&&(r.messageId=t.messageId),this._checkpoint=r.sequenceNumber,this.options.trackLastEnqueuedEventProperties&&t&&(this.runtimeInfo.sequenceNumber=t.lastSequenceNumber,this.runtimeInfo.enqueuedOn=t.lastEnqueuedTime,this.runtimeInfo.offset=t.lastEnqueuedOffset,this.runtimeInfo.retrievedOn=t.retrievalTime),!this._onMessage||this._usingInternalQueue?this._internalQueue.push(r):(this._isStreaming&&this._addCredit(1),this._onMessage(r))}_onAmqpError(e){const t=this._receiver||e.receiver,n=t&&t.error;if(o.b.verbose("[%s] 'receiver_error' event occurred on the receiver '%s' with address '%s'. The associated error is: %O",this._context.connectionId,this.name,this.address,n),this._onError&&n){const e=Object(a.e)(n);Object(o.a)(e),this._onError(e)}}_onAmqpSessionError(e){const t=e.session&&e.session.error;if(o.b.verbose("[%s] 'session_error' event occurred on the session of receiver '%s' with address '%s'. The associated error is: %O",this._context.connectionId,this.name,this.address,t),this._onError&&t){const e=Object(a.e)(t);Object(o.a)(e),this._onError(e)}}async _onAmqpClose(e){const t=this._receiver||e.receiver;o.b.verbose("[%s] 'receiver_close' event occurred on the receiver '%s' with address '%s'. Value for isItselfClosed on the receiver is: '%s' Value for isConnecting on the session is: '%s'.",this._context.connectionId,this.name,this.address,t?t.isItselfClosed().toString():void 0,this.isConnecting),t&&!this.isConnecting&&await t.close().catch(e=>{o.b.verbose("[%s] Error when closing receiver [%s] after 'receiver_close' event: %O",this._context.connectionId,this.name,e)})}async _onAmqpSessionClose(e){const t=this._receiver||e.receiver;o.b.verbose("[%s] 'session_close' event occurred on the session of receiver '%s' with address '%s'. Value for isSessionItselfClosed on the session is: '%s' Value for isConnecting on the session is: '%s'.",this._context.connectionId,this.name,this.address,t?t.isSessionItselfClosed().toString():void 0,this.isConnecting),t&&!this.isConnecting&&await t.close().catch(e=>{o.b.verbose("[%s] Error when closing receiver [%s] after 'session_close' event: %O",this._context.connectionId,this.name,e)})}async abort(){const e=`[${this._context.connectionId}] The receive operation on the Receiver "${this.name}" with address "${this.address}" has been cancelled by the user.`;if(o.b.info(e),this._onError){const e=new r.b(s.b);this._onError(e)}this.clearHandlers(),await this.close()}clearHandlers(){this._abortSignal&&this._onAbort&&this._abortSignal.removeEventListener("abort",this._onAbort),this._abortSignal=void 0,this._onAbort=void 0,this._onError=void 0,this._onMessage=void 0,this._isReceivingMessages=!1,this._isStreaming=!1}async close(){try{if(this.clearHandlers(),!this._receiver)return;const e=this._receiver;this._deleteFromCache(),await this._closeLink(e)}catch(e){const t=`[${this._context.connectionId}] An error occurred while closing receiver ${this.name}: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`;throw o.b.warning(t),Object(o.a)(e),e}finally{this._isClosed=!0}}isOpen(){const e=Boolean(this._receiver&&this._receiver.isOpen());return o.b.verbose("[%s] Receiver '%s' with address '%s' is open? -> %s",this._context.connectionId,this.name,this.address,e),e}registerHandlers(e,t,n,r,i,s){this._abortSignal=i,this._onAbort=s,this._onError=t,this._onMessage=e,this._isStreaming=r,this._isReceivingMessages=!0,this._useInternalQueue(e,i).then(async s=>{if(this._onMessage!==e)return;if(!r&&n-s<=0)return;if(this.isOpen())o.b.verbose("[%s] Receiver link already present, hence reusing it.",this._context.connectionId);else try{await this.initialize({abortSignal:i,timeoutInMs:Object(D.a)(this.options.retryOptions)})}catch(e){return void(this._onError===t&&t(e))}const a=this._receiver?this._receiver.credit:0,c=r?0:s,u=Math.max(n-(a+c),0);this._addCredit(u)}).catch(e=>{this._onError===t&&t(e)})}_addCredit(e){this._receiver&&this._receiver.addCredit(e)}_deleteFromCache(){this._receiver=void 0,delete this._context.receivers[this.name],o.b.verbose("[%s] Deleted the receiver '%s' from the client cache.",this._context.connectionId,this.name)}async _useInternalQueue(e,t){let n=0;for(await Object(m.b)(0),this._usingInternalQueue=!0;this._internalQueue.length&&this._onMessage&&(!t||!t.aborted)&&this._onMessage===e;){n++,e(this._internalQueue.splice(0,1)[0]),await Object(m.b)(0)}return this._usingInternalQueue=!1,n}async initialize({abortSignal:e,timeoutInMs:t}){try{if(this.isOpen()||this.isConnecting)o.b.verbose("[%s] The receiver '%s' with address '%s' is open -> %s and is connecting -> %s. Hence not reconnecting.",this._context.connectionId,this.name,this.address,this.isOpen(),this.isConnecting);else{this.isConnecting=!0,await this._context.readyToOpenLink(),await this._negotiateClaim({setTokenRenewal:!1,abortSignal:e,timeoutInMs:t});const n={onClose:e=>this._onAmqpClose(e),onError:e=>this._onAmqpError(e),onMessage:e=>this._onAmqpMessage(e),onSessionClose:e=>this._onAmqpSessionClose(e),onSessionError:e=>this._onAmqpSessionError(e)};this.checkpoint>-1&&(n.eventPosition={sequenceNumber:this.checkpoint});const r=this._createReceiverOptions(n);o.b.verbose("[%s] Trying to create receiver '%s' with options %O",this._context.connectionId,this.name,r),this._receiver=await this._context.connection.createReceiver(Object.assign(Object.assign({},r),{abortSignal:e})),this.isConnecting=!1,o.b.verbose("[%s] Receiver '%s' created with receiver options: %O",this._context.connectionId,this.name,r),this._context.receivers[this.name]=this,this._ensureTokenRenewal()}}catch(e){this.isConnecting=!1;const t=Object(a.e)(e);throw o.b.warning("[%s] An error occured while creating the receiver '%s': %s",this._context.connectionId,this.name,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(o.a)(e),t}}_createReceiverOptions(e){const t={name:this.name,autoaccept:!0,source:{address:this.address},credit_window:0,onMessage:e.onMessage,onError:e.onError,onClose:e.onClose,onSessionError:e.onSessionError,onSessionClose:e.onSessionClose};"number"==typeof this.ownerLevel&&(t.properties={[s.a.attachEpoch]:y.types.wrap_long(this.ownerLevel)}),this.options.trackLastEnqueuedEventProperties&&(t.desired_capabilities=s.a.enableReceiverRuntimeMetricName);const n=e.eventPosition||this.eventPosition;if(n){const e=function(e){let t;if(Object(c.b)(e.offset))t=e.isInclusive?`${s.a.offsetAnnotation} >= '${e.offset}'`:`${s.a.offsetAnnotation} > '${e.offset}'`;else if(Object(c.b)(e.sequenceNumber))t=e.isInclusive?`${s.a.sequenceNumberAnnotation} >= '${e.sequenceNumber}'`:`${s.a.sequenceNumberAnnotation} > '${e.sequenceNumber}'`;else if(Object(c.b)(e.enqueuedOn)){const n=e.enqueuedOn instanceof Date?e.enqueuedOn.getTime():e.enqueuedOn;t=`${s.a.enqueuedTimeAnnotation} > '${n}'`}if(!t)throw Object(a.e)({condition:a.b.ArgumentError,description:"No starting position was set in the EventPosition."});return t}(n);e&&(t.source.filter={"apache.org:selector-filter:string":y.types.wrap_described(e,77567109365764)})}return t}async receiveBatch(e,t=60,n){const i=[],a=this.options.retryOptions||{},c=Object.defineProperties({operation:()=>new Promise((a,c)=>{if(this._isClosed||this._context.wasConnectionCloseCalled)return a(i);let u;const l=()=>{const e=this.name,t=this.address,n=`[${this._context.connectionId}] The request operation on the Receiver "${e}" with address "${t}" has been cancelled by the user.`;o.b.info(n)},d=async()=>{l();try{await this.close()}finally{c(new r.b(s.b))}};if(n&&n.aborted)return d();const h=Math.max(e-i.length,0);if(0===h)return a(i);o.b.verbose("[%s] Receiver '%s', setting the prefetch count to %d.",this._context.connectionId,this.name,h);const p=()=>{this.clearHandlers(),clearTimeout(u)},f=()=>{clearTimeout(u),d()};this.registerHandlers(n=>{i.push(n),i.length===e&&(o.b.info("[%s] Batching Receiver '%s', %d messages received within %d seconds.",this._context.connectionId,this.name,i.length,t),p(),a(i))},e=>{for(;i.length;)this._internalQueue.unshift(i.pop());p(),"AbortError"===e.name?d():c(e)},e-i.length,!1,n,f);(()=>{o.b.verbose("[%s] Setting the wait timer for %d seconds for receiver '%s'.",this._context.connectionId,t,this.name),u=setTimeout(()=>{o.b.info("[%s] Batching Receiver '%s', %d messages received when max wait time in seconds %d is over.",this._context.connectionId,this.name,i.length,t),p(),a(i)},1e3*t)})(),n&&!n.aborted&&n.addEventListener("abort",f)}),operationType:g.b.receiveMessage,abortSignal:n,retryOptions:a},{connectionId:{enumerable:!0,get:()=>this._context.connectionId},connectionHost:{enumerable:!0,get:()=>this._context.config.host}});return Object(g.c)(c)}}class ${constructor(e,t,n,o){this._context=e,this._startPosition=n,this._isReceiving=!1,this._isStopped=!1,this._partitionProcessor=t,this._processorOptions=o,this._abortController=new r.a}get isReceiving(){return this._isReceiving}async start(){this._isReceiving=!0;try{await this._partitionProcessor.initialize()}catch(e){this._partitionProcessor.processError(e)}this._receiveEvents(this._partitionProcessor.partitionId),o.b.info(`Successfully started the receiver for partition "${this._partitionProcessor.partitionId}".`)}_setOrReplaceReceiver(e,t){const n=t>=0?{sequenceNumber:t,isInclusive:!1}:this._startPosition;return this._receiver=new z(this._context,this._partitionProcessor.consumerGroup,e,n,{ownerLevel:this._processorOptions.ownerLevel,trackLastEnqueuedEventProperties:this._processorOptions.trackLastEnqueuedEventProperties,retryOptions:this._processorOptions.retryOptions,skipParsingBodyAsJson:this._processorOptions.skipParsingBodyAsJson}),this._receiver}async _receiveEvents(e){let t=-1,n=this._setOrReplaceReceiver(e,t);for(;this._isReceiving;)try{n.isClosed&&(n=this._setOrReplaceReceiver(e,t));const r=await n.receiveBatch(this._processorOptions.maxBatchSize,this._processorOptions.maxWaitTimeInSeconds,this._abortController.signal);if(this._processorOptions.trackLastEnqueuedEventProperties&&n.lastEnqueuedEventProperties&&(this._partitionProcessor.lastEnqueuedEventProperties=n.lastEnqueuedEventProperties),!this._isReceiving)return;r.length&&(t=r[r.length-1].sequenceNumber),await A.b.withSpan("PartitionPump.process",{},()=>this._partitionProcessor.processEvents(r),B(r,this._context.config))}catch(e){if(!this._isReceiving)return;o.b.warning(`An error was thrown while receiving or processing events on partition "${this._partitionProcessor.partitionId}"`),Object(o.a)(e);try{await this._partitionProcessor.processError(e)}catch(e){o.b.verbose("An error was thrown by user's processError method: ",e)}if("object"!=typeof e||!e.retryable)try{return"ReceiverDisconnectedError"===e.code?await this.stop(f.OwnershipLost):await this.stop(f.Shutdown)}catch(e){o.b.verbose(`An error occurred while closing the receiver with reason ${f.Shutdown}: `,e)}}}async stop(e){if(!this._isStopped){this._isStopped=!0,this._isReceiving=!1;try{this._abortController.abort(),this._receiver&&await this._receiver.close(),await this._partitionProcessor.close(e)}catch(e){throw o.b.warning(`An error occurred while closing the receiver: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(o.a)(e),this._partitionProcessor.processError(e),e}}}}function B(e,t){const n=[];for(const t of e){const e=P(t);e&&n.push({tracingContext:e,attributes:{enqueuedTime:t.enqueuedTimeUtc.getTime()}})}return Object.assign({spanLinks:n,spanKind:"consumer"},Object(A.a)(t))}class F{constructor(e,t){this._partitionIdToPumps={},this._eventProcessorName=e,this._options=t}receivingFromPartitions(){return Object.keys(this._partitionIdToPumps).filter(e=>{const t=this._partitionIdToPumps[e];return Boolean(t&&t.isReceiving)})}isReceivingFromPartition(e){const t=this._partitionIdToPumps[e];return Boolean(t&&t.isReceiving)}async createPump(e,t,n,r){const i=n.partitionId;if(r.aborted)return void o.b.verbose(`${this._eventProcessorName}] The subscription was closed before creating the pump for partition ${i}.`);const s=this._partitionIdToPumps[i];if(s){if(s.isReceiving)return void o.b.verbose(`[${this._eventProcessorName}] [${i}] The existing pump is running.`);o.b.verbose(`[${this._eventProcessorName}] [${i}] The existing pump is not running.`),await this.removePump(i,f.OwnershipLost)}o.b.verbose(`[${this._eventProcessorName}] [${i}] Creating a new pump.`);const a=new $(t,n,e,this._options);try{this._partitionIdToPumps[i]=a,await a.start()}catch(e){o.b.verbose(`[${this._eventProcessorName}] [${i}] An error occured while adding/updating a pump: ${e}`),Object(o.a)(e)}}async removePump(e,t){try{const n=this._partitionIdToPumps[e];n?(delete this._partitionIdToPumps[e],o.b.verbose(`[${this._eventProcessorName}] [${e}] Stopping the pump.`),await n.stop(t)):o.b.verbose(`[${this._eventProcessorName}] [${e}] No pump was found to remove.`)}catch(t){o.b.verbose(`[${this._eventProcessorName}] [${e}] An error occured while removing a pump: ${t}`),Object(o.a)(t)}}async removeAllPumps(e){const t=Object.keys(this._partitionIdToPumps);o.b.verbose(`[${this._eventProcessorName}] Removing all pumps due to reason ${e}.`);const n=[];for(const r of t){const t=this._partitionIdToPumps[r];t&&n.push(t.stop(e))}try{await Promise.all(n)}catch(e){o.b.verbose(`[${this._eventProcessorName}] An error occured while removing all pumps: ${e}`),Object(o.a)(e)}finally{this._partitionIdToPumps={}}}}async function K(e,t){try{await Object(m.b)(e,t)}catch(e){}}var G=n(49);class Y{constructor(e,t,n,r,i){this._consumerGroup=e,this._context=t,this._subscriptionEventHandlers=n,this._checkpointStore=r,this._isRunning=!1,i.ownerId?(this._id=i.ownerId,o.b.verbose("Starting event processor with ID "+this._id)):(this._id=Object(G.a)(),o.b.verbose("Starting event processor with autogenerated ID "+this._id)),this._eventHubName=this._context.config.entityPath,this._fullyQualifiedNamespace=this._context.config.host,this._processorOptions=i,this._pumpManager=i.pumpManager||new F(this._id,this._processorOptions),this._processingTarget=i.processingTarget,this._loopIntervalInMs=i.loopIntervalInMs,this._loadBalancingStrategy=i.loadBalancingStrategy}get id(){return this._id}_createPartitionOwnershipRequest(e,t){const n=e.get(t);return{ownerId:this._id,partitionId:t,fullyQualifiedNamespace:this._fullyQualifiedNamespace,consumerGroup:this._consumerGroup,eventHubName:this._eventHubName,etag:n?n.etag:void 0}}async _claimOwnership(e,t){if(t.aborted)o.b.verbose(`[${this._id}] Subscription was closed before claiming ownership of ${e.partitionId}.`);else{o.b.info(`[${this._id}] Attempting to claim ownership of partition ${e.partitionId}.`);try{if(!(await this._checkpointStore.claimOwnership([e])).length)return;o.b.info(`[${this._id}] Successfully claimed ownership of partition ${e.partitionId}.`),await this._startPump(e.partitionId,t)}catch(t){o.b.warning(`[${this.id}] Failed to claim ownership of partition ${e.partitionId}`),Object(o.a)(t),await this._handleSubscriptionError(t)}}}async _startPump(e,t){if(t.aborted)return void o.b.verbose(`[${this._id}] The subscription was closed before starting to read from ${e}.`);if(this._pumpManager.isReceivingFromPartition(e))return void o.b.verbose(`[${this._id}] There is already an active partitionPump for partition "${e}", skipping pump creation.`);o.b.verbose(`[${this._id}] [${e}] Calling user-provided PartitionProcessorFactory.`);const n=new i(this._subscriptionEventHandlers,this._checkpointStore,{fullyQualifiedNamespace:this._fullyQualifiedNamespace,eventHubName:this._eventHubName,consumerGroup:this._consumerGroup,partitionId:e,eventProcessorId:this.id}),r=await this._getStartingPosition(e);await this._pumpManager.createPump(r,this._context,n,t),o.b.verbose(`[${this._id}] PartitionPump created successfully.`)}async _getStartingPosition(e){const t=(await this._checkpointStore.listCheckpoints(this._fullyQualifiedNamespace,this._eventHubName,this._consumerGroup)).filter(t=>t.partitionId===e);return t.length>0?{offset:t[0].offset}:(o.b.verbose(`No checkpoint found for partition ${e}. Looking for fallback.`),function(e,t){if(null==t)return l;if(h(t))return t;const n=t[e];if(null==n)return l;return n}(e,this._processorOptions.startPosition))}async _runLoopForSinglePartition(e,t){for(;!t.aborted;)try{await this._startPump(e,t)}catch(e){o.b.warning(`[${this._id}] An error occured within the EventProcessor loop: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(o.a)(e),await this._handleSubscriptionError(e)}finally{o.b.verbose(`[${this._id}] Pausing the EventProcessor loop for ${this._loopIntervalInMs} ms.`),await K(this._loopIntervalInMs,t)}this._isRunning=!1}async _runLoopWithLoadBalancing(e,t){let n;const r=new Promise(e=>{n=e,t.aborted?e():t.addEventListener("abort",e)});for(;!t.aborted;){const n=Date.now();try{const{partitionIds:r}=await this._context.managementSession.getEventHubProperties({abortSignal:t});await this._performLoadBalancing(e,r,t)}catch(e){o.b.warning(`[${this._id}] An error occured within the EventProcessor loop: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(o.a)(e),await Promise.race([this._handleSubscriptionError(e),r])}finally{const e=Date.now()-n,r=Math.max(this._loopIntervalInMs-e,0);o.b.verbose(`[${this._id}] Pausing the EventProcessor loop for ${r} ms.`),await K(r,t)}}n&&t.removeEventListener("abort",n),this._isRunning=!1}async _performLoadBalancing(e,t,n){if(n.aborted)throw new r.b("The operation was aborted.");const o=await this._checkpointStore.listOwnership(this._fullyQualifiedNamespace,this._eventHubName,this._consumerGroup);if(n.aborted)throw new r.b("The operation was aborted.");const i=new Map,s=new Map,a=[];for(const e of o)i.set(e.partitionId,e),W(e)||s.set(e.partitionId,e),e.ownerId===this._id&&this._pumpManager.isReceivingFromPartition(e.partitionId)&&a.push(e.partitionId);const c=e.getPartitionsToCliam(this._id,s,t);c.push(...a);const u=new Set(c);for(const e of u){const t=this._createPartitionOwnershipRequest(i,e);await this._claimOwnership(t,n)}}async _handleSubscriptionError(e){if("AbortError"!==e.name&&this._subscriptionEventHandlers.processError)try{await this._subscriptionEventHandlers.processError(e,{fullyQualifiedNamespace:this._fullyQualifiedNamespace,eventHubName:this._eventHubName,consumerGroup:this._consumerGroup,partitionId:"",updateCheckpoint:async()=>{}})}catch(e){o.b.verbose(`[${this._id}] An error was thrown from the user's processError handler: ${e}`)}}start(){this._isRunning?o.b.verbose(`[${this._id}] Attempted to start an already running EventProcessor.`):(this._isRunning=!0,this._abortController=new r.a,o.b.verbose(`[${this._id}] Starting an EventProcessor.`),this._processingTarget?(o.b.verbose(`[${this._id}] Single partition target: ${this._processingTarget}`),this._loopTask=this._runLoopForSinglePartition(this._processingTarget,this._abortController.signal)):(o.b.verbose(`[${this._id}] Multiple partitions, using load balancer`),this._loopTask=this._runLoopWithLoadBalancing(this._loadBalancingStrategy,this._abortController.signal)))}isRunning(){return this._isRunning}async stop(){o.b.verbose(`[${this._id}] Stopping an EventProcessor.`),this._abortController&&this._abortController.abort();try{await this._pumpManager.removeAllPumps(f.Shutdown),this._loopTask&&await this._loopTask}catch(e){o.b.verbose(`[${this._id}] An error occured while stopping the EventProcessor: ${e}`)}finally{o.b.verbose(`[${this._id}] EventProcessor stopped.`)}this._processingTarget?o.b.verbose(`[${this._id}] No partitions owned, skipping abandoning.`):await this.abandonPartitionOwnerships()}async abandonPartitionOwnerships(){o.b.verbose(`[${this._id}] Abandoning owned partitions`);const e=(await this._checkpointStore.listOwnership(this._fullyQualifiedNamespace,this._eventHubName,this._consumerGroup)).filter(e=>e.ownerId===this._id);for(const t of e)t.ownerId="";return this._checkpointStore.claimOwnership(e)}}function W(e){return""===e.ownerId}function V(){if("undefined"==typeof self)return"";return self.navigator.appVersion}var Q=n(62);class J{constructor(e,t){this.endpoint=s.a.cbsEndpoint,this.replyTo=`${s.a.cbsReplyTo}-${Object(y.generate_uuid)()}`,this.cbsLock=`${s.a.negotiateCbsKey}-${Object(y.generate_uuid)()}`,this.connection=e,this.connectionLock=t}async init(e={}){const{abortSignal:t,timeoutInMs:n}=e;try{if(null==t?void 0:t.aborted)throw new r.b(s.b);if(this.connection.isOpen()||(v.b.verbose("The CBS client is trying to establish an AMQP connection."),await m.a.acquire(this.connectionLock,()=>this.connection.open({abortSignal:t}),{abortSignal:t,timeoutInMs:n})),this.isOpen())v.b.verbose("[%s] CBS session is already present. Reusing the cbs sender '%s' and receiver '%s' links over cbs session.",this.connection.id,this._cbsSenderReceiverLink.sender.name,this._cbsSenderReceiverLink.receiver.name);else{const e={source:{address:this.endpoint},name:this.replyTo,onSessionError:e=>{const t=e.connection.options.id,n=Object(a.e)(e.session.error);v.b.verbose("[%s] An error occurred on the session for request/response links for $cbs: %O",t,n)}},n={target:{address:this.endpoint}};v.b.verbose("[%s] Creating sender/receiver links on a session for $cbs endpoint.",this.connection.id),this._cbsSenderReceiverLink=await Q.a.create(this.connection,n,e,{abortSignal:t}),this._cbsSenderReceiverLink.sender.on(y.SenderEvents.senderError,e=>{const t=e.connection.options.id,n=Object(a.e)(e.sender.error);v.b.verbose("[%s] An error occurred on the cbs sender link.. %O",t,n)}),this._cbsSenderReceiverLink.receiver.on(y.ReceiverEvents.receiverError,e=>{const t=e.connection.options.id,n=Object(a.e)(e.receiver.error);v.b.verbose("[%s] An error occurred on the cbs receiver link.. %O",t,n)}),v.b.verbose("[%s] Successfully created the cbs sender '%s' and receiver '%s' links over cbs session.",this.connection.id,this._cbsSenderReceiverLink.sender.name,this._cbsSenderReceiverLink.receiver.name)}}catch(e){const t=Object(a.e)(e);throw v.b.warning("[%s] An error occurred while establishing the cbs links: %s",this.connection.id,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(v.a)(t),t}}async negotiateClaim(e,t,n,o={}){const{abortSignal:i,timeoutInMs:a}=o;try{if(null==i?void 0:i.aborted)throw new r.b(s.b);if(!this._cbsSenderReceiverLink)throw new Error("Attempted to negotiate a claim but the CBS link does not exist.");const o={body:t,message_id:Object(y.generate_uuid)(),reply_to:this.replyTo,to:this.endpoint,application_properties:{operation:s.a.operationPutToken,name:e,type:n}},c=await this._cbsSenderReceiverLink.sendRequest(o,{abortSignal:i,timeoutInMs:a,requestName:"negotiateClaim"});return v.b.verbose("[%s] The CBS response is: %O",this.connection.id,c),this._fromRheaMessageResponse(c)}catch(e){throw v.b.warning("[%s] An error occurred while negotiating the cbs claim: %s",this.connection.id,`${null==e?void 0:e.name}: ${null==e?void 0:e.message}`),Object(v.a)(e),e}}async close(){try{if(this.isOpen()){const e=this._cbsSenderReceiverLink;this._cbsSenderReceiverLink=void 0,await e.close(),v.b.verbose("[%s] Successfully closed the cbs session.",this.connection.id)}}catch(e){const t=`An error occurred while closing the cbs link: ${e.stack||JSON.stringify(e)}.`;throw v.b.verbose("[%s] %s",this.connection.id,t),new Error(t)}}remove(){try{if(this._cbsSenderReceiverLink){const e=this._cbsSenderReceiverLink;this._cbsSenderReceiverLink=void 0,e.remove(),v.b.verbose("[%s] Successfully removed the cbs session.",this.connection.id)}}catch(e){const t=`An error occurred while removing the cbs link: ${e.stack||JSON.stringify(e)}.`;throw v.b.verbose("[%s] %s",this.connection.id,t),new Error(t)}}isOpen(){var e;return Boolean(null===(e=this._cbsSenderReceiverLink)||void 0===e?void 0:e.isOpen())}_fromRheaMessageResponse(e){const t={correlationId:e.correlation_id,statusCode:e.application_properties?e.application_properties["status-code"]:"",statusDescription:e.application_properties?e.application_properties["status-description"]:""};return v.b.verbose("[%s] The deserialized CBS response is: %o",this.connection.id,t),t}}var X=n(13);const Z={create(e,t){e=String(e);const n=Object(m.f)(e);if(!n.Endpoint)throw new TypeError("Missing Endpoint in Connection String.");n.Endpoint.endsWith("/")||(n.Endpoint+="/");const r={connectionString:e,endpoint:n.Endpoint,host:n&&n.Endpoint?(n.Endpoint.match(".*://([^/]*)")||[])[1]:"",sharedAccessKeyName:n.SharedAccessKeyName,sharedAccessKey:n.SharedAccessKey};return(t||n.EntityPath)&&(r.entityPath=t||n.EntityPath),r},validate(e,t){if(t||(t={}),!e)throw new TypeError("Missing configuration");if(!e.endpoint)throw new TypeError("Missing 'endpoint' in configuration");if(e.endpoint=String(e.endpoint),!e.host)throw new TypeError("Missing 'host' in configuration");if(e.host=String(e.host),t.isEntityPathRequired&&!e.entityPath)throw new TypeError("Missing 'entityPath' in configuration");if(Object(X.a)(e.entityPath)&&(e.entityPath=String(e.entityPath)),null==e.connectionString.match(/;{0,1}SharedAccessSignature=SharedAccessSignature /)){if(!e.sharedAccessKeyName)throw new TypeError("Missing 'sharedAccessKeyName' in configuration");if(e.sharedAccessKeyName=String(e.sharedAccessKeyName),!e.sharedAccessKey)throw new TypeError("Missing 'sharedAccessKey' in configuration");e.sharedAccessKey=String(e.sharedAccessKey)}}};class ee extends y.Connection{async createSender(e){const t=await super.createSender(e);return t.setMaxListeners(1e3),t}async createAwaitableSender(e){const t=await super.createAwaitableSender(e);return t.setMaxListeners(1e3),t}async createReceiver(e){const t=await super.createReceiver(e);return t.setMaxListeners(1e3),t}}const te={create(e){var t,n,r;Z.validate(e.config,{isEntityPathRequired:e.isEntityPathRequired||!1});const o=e.connectionProperties.userAgent;if(o.length>s.a.maxUserAgentLength)throw new Error(`The user-agent string cannot be more than ${s.a.maxUserAgentLength} characters in length.The given user-agent string is: ${o} with length: ${o.length}`);const i={transport:s.a.TLS,host:e.config.host,hostname:null!==(t=e.config.amqpHostname)&&void 0!==t?t:e.config.host,username:e.config.sharedAccessKeyName,port:null!==(n=e.config.port)&&void 0!==n?n:5671,reconnect:!1,properties:{product:e.connectionProperties.product,version:e.connectionProperties.version,"user-agent":o,platform:`(javascript-Browser-${V()})`,framework:"Browser/"+V()},idle_time_out:s.a.defaultConnectionIdleTimeoutInMs,operationTimeoutInSeconds:e.operationTimeoutInMs?e.operationTimeoutInMs/1e3:void 0};if(e.config.webSocket||!m.c&&"undefined"!=typeof self&&self.WebSocket){const t=e.config.webSocket||self.WebSocket,n=e.config.host,o=e.config.webSocketEndpointPath||"",s=e.config.webSocketConstructorOptions||{},a=null!==(r=e.config.port)&&void 0!==r?r:443;i.webSocketOptions={webSocket:t,url:`wss://${n}:${a}/${o}`,protocol:["AMQPWSB10"],options:s}}const a=new ee(i),c=`${s.a.establishConnection}-${Object(y.generate_uuid)()}`;return{wasConnectionCloseCalled:!1,connectionLock:c,negotiateClaimLock:`${s.a.negotiateClaim}-${Object(y.generate_uuid)()}`,connection:a,connectionId:a.id,cbsSession:new J(a,c),config:e.config,refreshConnection(){const e=new ee(i),t=`${s.a.establishConnection}-${Object(y.generate_uuid)()}`;this.wasConnectionCloseCalled=!1,this.connectionLock=t,this.negotiateClaimLock=`${s.a.negotiateClaim} - ${Object(y.generate_uuid)()}`,this.connection=e,this.connectionId=e.id,this.cbsSession=new J(e,t)}}}};var ne=n(123),re=n(124);const oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function ie(e,t,n,r){let o,i,s;const a=t||[0],c=(n=n||0)>>>3,u=-1===r?3:0;for(o=0;o<e.length;o+=1)s=o+c,i=s>>>2,a.length<=i&&a.push(0),a[i]|=e[o]<<8*(u+r*(s%4));return{value:a,binLen:8*e.length+n}}function se(e,t,n){switch(t){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw new Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(e){case"HEX":return function(e,t,r){return function(e,t,n,r){let o,i,s,a;if(0!=e.length%2)throw new Error("String of HEX type must be in byte increments");const c=t||[0],u=(n=n||0)>>>3,l=-1===r?3:0;for(o=0;o<e.length;o+=2){if(i=parseInt(e.substr(o,2),16),isNaN(i))throw new Error("String of HEX type contains invalid characters");for(a=(o>>>1)+u,s=a>>>2;c.length<=s;)c.push(0);c[s]|=i<<8*(l+r*(a%4))}return{value:c,binLen:4*e.length+n}}(e,t,r,n)};case"TEXT":return function(e,r,o){return function(e,t,n,r,o){let i,s,a,c,u,l,d,h,p=0;const f=n||[0],m=(r=r||0)>>>3;if("UTF8"===t)for(d=-1===o?3:0,a=0;a<e.length;a+=1)for(i=e.charCodeAt(a),s=[],128>i?s.push(i):2048>i?(s.push(192|i>>>6),s.push(128|63&i)):55296>i||57344<=i?s.push(224|i>>>12,128|i>>>6&63,128|63&i):(a+=1,i=65536+((1023&i)<<10|1023&e.charCodeAt(a)),s.push(240|i>>>18,128|i>>>12&63,128|i>>>6&63,128|63&i)),c=0;c<s.length;c+=1){for(l=p+m,u=l>>>2;f.length<=u;)f.push(0);f[u]|=s[c]<<8*(d+o*(l%4)),p+=1}else for(d=-1===o?2:0,h="UTF16LE"===t&&1!==o||"UTF16LE"!==t&&1===o,a=0;a<e.length;a+=1){for(i=e.charCodeAt(a),!0===h&&(c=255&i,i=c<<8|i>>>8),l=p+m,u=l>>>2;f.length<=u;)f.push(0);f[u]|=i<<8*(d+o*(l%4)),p+=2}return{value:f,binLen:8*p+r}}(e,t,r,o,n)};case"B64":return function(e,t,r){return function(e,t,n,r){let o,i,s,a,c,u,l,d=0;const h=t||[0],p=(n=n||0)>>>3,f=-1===r?3:0,m=e.indexOf("=");if(-1===e.search(/^[a-zA-Z0-9=+/]+$/))throw new Error("Invalid character in base-64 string");if(e=e.replace(/=/g,""),-1!==m&&m<e.length)throw new Error("Invalid '=' found in base-64 string");for(i=0;i<e.length;i+=4){for(c=e.substr(i,4),a=0,s=0;s<c.length;s+=1)o=oe.indexOf(c.charAt(s)),a|=o<<18-6*s;for(s=0;s<c.length-1;s+=1){for(l=d+p,u=l>>>2;h.length<=u;)h.push(0);h[u]|=(a>>>16-8*s&255)<<8*(f+r*(l%4)),d+=1}}return{value:h,binLen:8*d+n}}(e,t,r,n)};case"BYTES":return function(e,t,r){return function(e,t,n,r){let o,i,s,a;const c=t||[0],u=(n=n||0)>>>3,l=-1===r?3:0;for(i=0;i<e.length;i+=1)o=e.charCodeAt(i),a=i+u,s=a>>>2,c.length<=s&&c.push(0),c[s]|=o<<8*(l+r*(a%4));return{value:c,binLen:8*e.length+n}}(e,t,r,n)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch(e){throw new Error("ARRAYBUFFER not supported by this environment")}return function(e,t,r){return function(e,t,n,r){return ie(new Uint8Array(e),t,n,r)}(e,t,r,n)};case"UINT8ARRAY":try{new Uint8Array(0)}catch(e){throw new Error("UINT8ARRAY not supported by this environment")}return function(e,t,r){return ie(e,t,r,n)};default:throw new Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}function ae(e,t,n,r){switch(e){case"HEX":return function(e){return function(e,t,n,r){let o,i,s="";const a=t/8,c=-1===n?3:0;for(o=0;o<a;o+=1)i=e[o>>>2]>>>8*(c+n*(o%4)),s+="0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i);return r.outputUpper?s.toUpperCase():s}(e,t,n,r)};case"B64":return function(e){return function(e,t,n,r){let o,i,s,a,c,u="";const l=t/8,d=-1===n?3:0;for(o=0;o<l;o+=3)for(a=o+1<l?e[o+1>>>2]:0,c=o+2<l?e[o+2>>>2]:0,s=(e[o>>>2]>>>8*(d+n*(o%4))&255)<<16|(a>>>8*(d+n*((o+1)%4))&255)<<8|c>>>8*(d+n*((o+2)%4))&255,i=0;i<4;i+=1)u+=8*o+6*i<=t?oe.charAt(s>>>6*(3-i)&63):r.b64Pad;return u}(e,t,n,r)};case"BYTES":return function(e){return function(e,t,n){let r,o,i="";const s=t/8,a=-1===n?3:0;for(r=0;r<s;r+=1)o=e[r>>>2]>>>8*(a+n*(r%4))&255,i+=String.fromCharCode(o);return i}(e,t,n)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch(e){throw new Error("ARRAYBUFFER not supported by this environment")}return function(e){return function(e,t,n){let r;const o=t/8,i=new ArrayBuffer(o),s=new Uint8Array(i),a=-1===n?3:0;for(r=0;r<o;r+=1)s[r]=e[r>>>2]>>>8*(a+n*(r%4))&255;return i}(e,t,n)};case"UINT8ARRAY":try{new Uint8Array(0)}catch(e){throw new Error("UINT8ARRAY not supported by this environment")}return function(e){return function(e,t,n){let r;const o=t/8,i=-1===n?3:0,s=new Uint8Array(o);for(r=0;r<o;r+=1)s[r]=e[r>>>2]>>>8*(i+n*(r%4))&255;return s}(e,t,n)};default:throw new Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}const ce=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],ue=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],le=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],de="Chosen SHA variant is not supported";function he(e,t){let n,r;const o=e.binLen>>>3,i=t.binLen>>>3,s=o<<3,a=4-o<<3;if(o%4!=0){for(n=0;n<i;n+=4)r=o+n>>>2,e.value[r]|=t.value[n>>>2]<<s,e.value.push(0),e.value[r+1]|=t.value[n>>>2]>>>a;return(e.value.length<<2)-4>=i+o&&e.value.pop(),{value:e.value,binLen:e.binLen+t.binLen}}return{value:e.value.concat(t.value),binLen:e.binLen+t.binLen}}function pe(e){const t={outputUpper:!1,b64Pad:"=",outputLen:-1},n=e||{},r="Output length must be a multiple of 8";if(t.outputUpper=n.outputUpper||!1,n.b64Pad&&(t.b64Pad=n.b64Pad),n.outputLen){if(n.outputLen%8!=0)throw new Error(r);t.outputLen=n.outputLen}else if(n.shakeLen){if(n.shakeLen%8!=0)throw new Error(r);t.outputLen=n.shakeLen}if("boolean"!=typeof t.outputUpper)throw new Error("Invalid outputUpper formatting option");if("string"!=typeof t.b64Pad)throw new Error("Invalid b64Pad formatting option");return t}function fe(e,t,n,r){const o=e+" must include a value and format";if(!t){if(!r)throw new Error(o);return r}if(void 0===t.value||!t.format)throw new Error(o);return se(t.format,t.encoding||"UTF8",n)(t.value)}class me{constructor(e,t,n){const r=n||{};if(this.t=t,this.i=r.encoding||"UTF8",this.numRounds=r.numRounds||1,isNaN(this.numRounds)||this.numRounds!==parseInt(this.numRounds,10)||1>this.numRounds)throw new Error("numRounds must a integer >= 1");this.s=e,this.o=[],this.h=0,this.u=!1,this.l=0,this.A=!1,this.H=[],this.S=[]}update(e){let t,n=0;const r=this.p>>>5,o=this.m(e,this.o,this.h),i=o.binLen,s=o.value,a=i>>>5;for(t=0;t<a;t+=r)n+this.p<=i&&(this.C=this.R(s.slice(t,t+r),this.C),n+=this.p);this.l+=n,this.o=s.slice(n>>>5),this.h=i%this.p,this.u=!0}getHash(e,t){let n,r,o=this.U;const i=pe(t);if(this.v){if(-1===i.outputLen)throw new Error("Output length must be specified in options");o=i.outputLen}const s=ae(e,o,this.K,i);if(this.A&&this.T)return s(this.T(i));for(r=this.F(this.o.slice(),this.h,this.l,this.g(this.C),o),n=1;n<this.numRounds;n+=1)this.v&&o%32!=0&&(r[r.length-1]&=16777215>>>24-o%32),r=this.F(r,o,0,this.B(this.s),o);return s(r)}setHMACKey(e,t,n){if(!this.L)throw new Error("Variant does not support HMAC");if(this.u)throw new Error("Cannot set MAC key after calling update");const r=se(t,(n||{}).encoding||"UTF8",this.K);this.M(r(e))}M(e){const t=this.p>>>3,n=t/4-1;let r;if(1!==this.numRounds)throw new Error("Cannot set numRounds with MAC");if(this.A)throw new Error("MAC key already set");for(t<e.binLen/8&&(e.value=this.F(e.value,e.binLen,0,this.B(this.s),this.U));e.value.length<=n;)e.value.push(0);for(r=0;r<=n;r+=1)this.H[r]=909522486^e.value[r],this.S[r]=1549556828^e.value[r];this.C=this.R(this.H,this.C),this.l=this.p,this.A=!0}getHMAC(e,t){const n=pe(t);return ae(e,this.U,this.K,n)(this.k())}k(){let e;if(!this.A)throw new Error("Cannot call getHMAC without first setting MAC key");const t=this.F(this.o.slice(),this.h,this.l,this.g(this.C),this.U);return e=this.R(this.S,this.B(this.s)),e=this.F(t,this.U,this.p,e,this.U),e}}function ge(e,t){return e<<t|e>>>32-t}function ye(e,t){return e>>>t|e<<32-t}function ve(e,t){return e>>>t}function be(e,t,n){return e^t^n}function _e(e,t,n){return e&t^~e&n}function we(e,t,n){return e&t^e&n^t&n}function Ee(e){return ye(e,2)^ye(e,13)^ye(e,22)}function Se(e,t){const n=(65535&e)+(65535&t);return(65535&(e>>>16)+(t>>>16)+(n>>>16))<<16|65535&n}function Oe(e,t,n,r){const o=(65535&e)+(65535&t)+(65535&n)+(65535&r);return(65535&(e>>>16)+(t>>>16)+(n>>>16)+(r>>>16)+(o>>>16))<<16|65535&o}function Ce(e,t,n,r,o){const i=(65535&e)+(65535&t)+(65535&n)+(65535&r)+(65535&o);return(65535&(e>>>16)+(t>>>16)+(n>>>16)+(r>>>16)+(o>>>16)+(i>>>16))<<16|65535&i}function Ie(e){return ye(e,7)^ye(e,18)^ve(e,3)}function Te(e){return ye(e,6)^ye(e,11)^ye(e,25)}function Ae(e){return[1732584193,4023233417,2562383102,271733878,3285377520]}function ke(e,t){let n,r,o,i,s,a,c;const u=[];for(n=t[0],r=t[1],o=t[2],i=t[3],s=t[4],c=0;c<80;c+=1)u[c]=c<16?e[c]:ge(u[c-3]^u[c-8]^u[c-14]^u[c-16],1),a=c<20?Ce(ge(n,5),_e(r,o,i),s,1518500249,u[c]):c<40?Ce(ge(n,5),be(r,o,i),s,1859775393,u[c]):c<60?Ce(ge(n,5),we(r,o,i),s,2400959708,u[c]):Ce(ge(n,5),be(r,o,i),s,3395469782,u[c]),s=i,i=o,o=ge(r,30),r=n,n=a;return t[0]=Se(n,t[0]),t[1]=Se(r,t[1]),t[2]=Se(o,t[2]),t[3]=Se(i,t[3]),t[4]=Se(s,t[4]),t}function Pe(e,t,n,r){let o;const i=15+(t+65>>>9<<4),s=t+n;for(;e.length<=i;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[i]=4294967295&s,e[i-1]=s/4294967296|0,o=0;o<e.length;o+=16)r=ke(e.slice(o,o+16),r);return r}class Re extends me{constructor(e,t,n){if("SHA-1"!==e)throw new Error(de);super(e,t,n);const r=n||{};this.L=!0,this.T=this.k,this.K=-1,this.m=se(this.t,this.i,this.K),this.R=ke,this.g=function(e){return e.slice()},this.B=Ae,this.F=Pe,this.C=[1732584193,4023233417,2562383102,271733878,3285377520],this.p=512,this.U=160,this.v=!1,r.hmacKey&&this.M(fe("hmacKey",r.hmacKey,this.K))}}function xe(e){let t;return t="SHA-224"==e?ue.slice():le.slice(),t}function Ne(e,t){let n,r,o,i,s,a,c,u,l,d,h;const p=[];for(n=t[0],r=t[1],o=t[2],i=t[3],s=t[4],a=t[5],c=t[6],u=t[7],h=0;h<64;h+=1)p[h]=h<16?e[h]:Oe(ye(f=p[h-2],17)^ye(f,19)^ve(f,10),p[h-7],Ie(p[h-15]),p[h-16]),l=Ce(u,Te(s),_e(s,a,c),ce[h],p[h]),d=Se(Ee(n),we(n,r,o)),u=c,c=a,a=s,s=Se(i,l),i=o,o=r,r=n,n=Se(l,d);var f;return t[0]=Se(n,t[0]),t[1]=Se(r,t[1]),t[2]=Se(o,t[2]),t[3]=Se(i,t[3]),t[4]=Se(s,t[4]),t[5]=Se(a,t[5]),t[6]=Se(c,t[6]),t[7]=Se(u,t[7]),t}class je extends me{constructor(e,t,n){if("SHA-224"!==e&&"SHA-256"!==e)throw new Error(de);super(e,t,n);const r=n||{};this.T=this.k,this.L=!0,this.K=-1,this.m=se(this.t,this.i,this.K),this.R=Ne,this.g=function(e){return e.slice()},this.B=xe,this.F=function(t,n,r,o){return function(e,t,n,r,o){let i,s;const a=15+(t+65>>>9<<4),c=t+n;for(;e.length<=a;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[a]=4294967295&c,e[a-1]=c/4294967296|0,i=0;i<e.length;i+=16)r=Ne(e.slice(i,i+16),r);return s="SHA-224"===o?[r[0],r[1],r[2],r[3],r[4],r[5],r[6]]:r,s}(t,n,r,o,e)},this.C=xe(e),this.p=512,this.U="SHA-224"===e?224:256,this.v=!1,r.hmacKey&&this.M(fe("hmacKey",r.hmacKey,this.K))}}class Me{constructor(e,t){this.Y=e,this.N=t}}function qe(e,t){let n;return t>32?(n=64-t,new Me(e.N<<t|e.Y>>>n,e.Y<<t|e.N>>>n)):0!==t?(n=32-t,new Me(e.Y<<t|e.N>>>n,e.N<<t|e.Y>>>n)):e}function Le(e,t){let n;return t<32?(n=32-t,new Me(e.Y>>>t|e.N<<n,e.N>>>t|e.Y<<n)):(n=64-t,new Me(e.N>>>t|e.Y<<n,e.Y>>>t|e.N<<n))}function Ue(e,t){return new Me(e.Y>>>t,e.N>>>t|e.Y<<32-t)}function He(e,t,n){return new Me(e.Y&t.Y^e.Y&n.Y^t.Y&n.Y,e.N&t.N^e.N&n.N^t.N&n.N)}function De(e){const t=Le(e,28),n=Le(e,34),r=Le(e,39);return new Me(t.Y^n.Y^r.Y,t.N^n.N^r.N)}function ze(e,t){let n,r;n=(65535&e.N)+(65535&t.N),r=(e.N>>>16)+(t.N>>>16)+(n>>>16);const o=(65535&r)<<16|65535&n;return n=(65535&e.Y)+(65535&t.Y)+(r>>>16),r=(e.Y>>>16)+(t.Y>>>16)+(n>>>16),new Me((65535&r)<<16|65535&n,o)}function $e(e,t,n,r){let o,i;o=(65535&e.N)+(65535&t.N)+(65535&n.N)+(65535&r.N),i=(e.N>>>16)+(t.N>>>16)+(n.N>>>16)+(r.N>>>16)+(o>>>16);const s=(65535&i)<<16|65535&o;return o=(65535&e.Y)+(65535&t.Y)+(65535&n.Y)+(65535&r.Y)+(i>>>16),i=(e.Y>>>16)+(t.Y>>>16)+(n.Y>>>16)+(r.Y>>>16)+(o>>>16),new Me((65535&i)<<16|65535&o,s)}function Be(e,t,n,r,o){let i,s;i=(65535&e.N)+(65535&t.N)+(65535&n.N)+(65535&r.N)+(65535&o.N),s=(e.N>>>16)+(t.N>>>16)+(n.N>>>16)+(r.N>>>16)+(o.N>>>16)+(i>>>16);const a=(65535&s)<<16|65535&i;return i=(65535&e.Y)+(65535&t.Y)+(65535&n.Y)+(65535&r.Y)+(65535&o.Y)+(s>>>16),s=(e.Y>>>16)+(t.Y>>>16)+(n.Y>>>16)+(r.Y>>>16)+(o.Y>>>16)+(i>>>16),new Me((65535&s)<<16|65535&i,a)}function Fe(e,t){return new Me(e.Y^t.Y,e.N^t.N)}function Ke(e){const t=Le(e,19),n=Le(e,61),r=Ue(e,6);return new Me(t.Y^n.Y^r.Y,t.N^n.N^r.N)}function Ge(e){const t=Le(e,1),n=Le(e,8),r=Ue(e,7);return new Me(t.Y^n.Y^r.Y,t.N^n.N^r.N)}function Ye(e){const t=Le(e,14),n=Le(e,18),r=Le(e,41);return new Me(t.Y^n.Y^r.Y,t.N^n.N^r.N)}const We=[new Me(ce[0],3609767458),new Me(ce[1],602891725),new Me(ce[2],3964484399),new Me(ce[3],2173295548),new Me(ce[4],4081628472),new Me(ce[5],3053834265),new Me(ce[6],2937671579),new Me(ce[7],3664609560),new Me(ce[8],2734883394),new Me(ce[9],1164996542),new Me(ce[10],1323610764),new Me(ce[11],3590304994),new Me(ce[12],4068182383),new Me(ce[13],991336113),new Me(ce[14],633803317),new Me(ce[15],3479774868),new Me(ce[16],2666613458),new Me(ce[17],944711139),new Me(ce[18],2341262773),new Me(ce[19],2007800933),new Me(ce[20],1495990901),new Me(ce[21],1856431235),new Me(ce[22],3175218132),new Me(ce[23],2198950837),new Me(ce[24],3999719339),new Me(ce[25],766784016),new Me(ce[26],2566594879),new Me(ce[27],3203337956),new Me(ce[28],1034457026),new Me(ce[29],2466948901),new Me(ce[30],3758326383),new Me(ce[31],168717936),new Me(ce[32],1188179964),new Me(ce[33],1546045734),new Me(ce[34],1522805485),new Me(ce[35],2643833823),new Me(ce[36],2343527390),new Me(ce[37],1014477480),new Me(ce[38],1206759142),new Me(ce[39],344077627),new Me(ce[40],1290863460),new Me(ce[41],3158454273),new Me(ce[42],3505952657),new Me(ce[43],106217008),new Me(ce[44],3606008344),new Me(ce[45],1432725776),new Me(ce[46],1467031594),new Me(ce[47],851169720),new Me(ce[48],3100823752),new Me(ce[49],1363258195),new Me(ce[50],3750685593),new Me(ce[51],3785050280),new Me(ce[52],3318307427),new Me(ce[53],3812723403),new Me(ce[54],2003034995),new Me(ce[55],3602036899),new Me(ce[56],1575990012),new Me(ce[57],1125592928),new Me(ce[58],2716904306),new Me(ce[59],442776044),new Me(ce[60],593698344),new Me(ce[61],3733110249),new Me(ce[62],2999351573),new Me(ce[63],3815920427),new Me(3391569614,3928383900),new Me(3515267271,566280711),new Me(3940187606,3454069534),new Me(4118630271,4000239992),new Me(116418474,1914138554),new Me(174292421,2731055270),new Me(289380356,3203993006),new Me(460393269,320620315),new Me(685471733,587496836),new Me(852142971,1086792851),new Me(1017036298,365543100),new Me(1126000580,2618297676),new Me(1288033470,3409855158),new Me(1501505948,4234509866),new Me(1607167915,987167468),new Me(1816402316,1246189591)];function Ve(e){return"SHA-384"===e?[new Me(3418070365,ue[0]),new Me(1654270250,ue[1]),new Me(2438529370,ue[2]),new Me(355462360,ue[3]),new Me(1731405415,ue[4]),new Me(41048885895,ue[5]),new Me(3675008525,ue[6]),new Me(1203062813,ue[7])]:[new Me(le[0],4089235720),new Me(le[1],2227873595),new Me(le[2],4271175723),new Me(le[3],1595750129),new Me(le[4],2917565137),new Me(le[5],725511199),new Me(le[6],4215389547),new Me(le[7],327033209)]}function Qe(e,t){let n,r,o,i,s,a,c,u,l,d,h,p;const f=[];for(n=t[0],r=t[1],o=t[2],i=t[3],s=t[4],a=t[5],c=t[6],u=t[7],h=0;h<80;h+=1)h<16?(p=2*h,f[h]=new Me(e[p],e[p+1])):f[h]=$e(Ke(f[h-2]),f[h-7],Ge(f[h-15]),f[h-16]),l=Be(u,Ye(s),(g=a,y=c,new Me((m=s).Y&g.Y^~m.Y&y.Y,m.N&g.N^~m.N&y.N)),We[h],f[h]),d=ze(De(n),He(n,r,o)),u=c,c=a,a=s,s=ze(i,l),i=o,o=r,r=n,n=ze(l,d);var m,g,y;return t[0]=ze(n,t[0]),t[1]=ze(r,t[1]),t[2]=ze(o,t[2]),t[3]=ze(i,t[3]),t[4]=ze(s,t[4]),t[5]=ze(a,t[5]),t[6]=ze(c,t[6]),t[7]=ze(u,t[7]),t}class Je extends me{constructor(e,t,n){if("SHA-384"!==e&&"SHA-512"!==e)throw new Error(de);super(e,t,n);const r=n||{};this.T=this.k,this.L=!0,this.K=-1,this.m=se(this.t,this.i,this.K),this.R=Qe,this.g=function(e){return e.slice()},this.B=Ve,this.F=function(t,n,r,o){return function(e,t,n,r,o){let i,s;const a=31+(t+129>>>10<<5),c=t+n;for(;e.length<=a;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[a]=4294967295&c,e[a-1]=c/4294967296|0,i=0;i<e.length;i+=32)r=Qe(e.slice(i,i+32),r);return s="SHA-384"===o?[(r=r)[0].Y,r[0].N,r[1].Y,r[1].N,r[2].Y,r[2].N,r[3].Y,r[3].N,r[4].Y,r[4].N,r[5].Y,r[5].N]:[r[0].Y,r[0].N,r[1].Y,r[1].N,r[2].Y,r[2].N,r[3].Y,r[3].N,r[4].Y,r[4].N,r[5].Y,r[5].N,r[6].Y,r[6].N,r[7].Y,r[7].N],s}(t,n,r,o,e)},this.C=Ve(e),this.p=1024,this.U="SHA-384"===e?384:512,this.v=!1,r.hmacKey&&this.M(fe("hmacKey",r.hmacKey,this.K))}}const Xe=[new Me(0,1),new Me(0,32898),new Me(2147483648,32906),new Me(2147483648,2147516416),new Me(0,32907),new Me(0,2147483649),new Me(2147483648,2147516545),new Me(2147483648,32777),new Me(0,138),new Me(0,136),new Me(0,2147516425),new Me(0,2147483658),new Me(0,2147516555),new Me(2147483648,139),new Me(2147483648,32905),new Me(2147483648,32771),new Me(2147483648,32770),new Me(2147483648,128),new Me(0,32778),new Me(2147483648,2147483658),new Me(2147483648,2147516545),new Me(2147483648,32896),new Me(0,2147483649),new Me(2147483648,2147516424)],Ze=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];function et(e){let t;const n=[];for(t=0;t<5;t+=1)n[t]=[new Me(0,0),new Me(0,0),new Me(0,0),new Me(0,0),new Me(0,0)];return n}function tt(e){let t;const n=[];for(t=0;t<5;t+=1)n[t]=e[t].slice();return n}function nt(e,t){let n,r,o,i;const s=[],a=[];if(null!==e)for(r=0;r<e.length;r+=2)t[(r>>>1)%5][(r>>>1)/5|0]=Fe(t[(r>>>1)%5][(r>>>1)/5|0],new Me(e[r+1],e[r]));for(n=0;n<24;n+=1){for(i=et(),r=0;r<5;r+=1)s[r]=(c=t[r][0],u=t[r][1],l=t[r][2],d=t[r][3],h=t[r][4],new Me(c.Y^u.Y^l.Y^d.Y^h.Y,c.N^u.N^l.N^d.N^h.N));for(r=0;r<5;r+=1)a[r]=Fe(s[(r+4)%5],qe(s[(r+1)%5],1));for(r=0;r<5;r+=1)for(o=0;o<5;o+=1)t[r][o]=Fe(t[r][o],a[r]);for(r=0;r<5;r+=1)for(o=0;o<5;o+=1)i[o][(2*r+3*o)%5]=qe(t[r][o],Ze[r][o]);for(r=0;r<5;r+=1)for(o=0;o<5;o+=1)t[r][o]=Fe(i[r][o],new Me(~i[(r+1)%5][o].Y&i[(r+2)%5][o].Y,~i[(r+1)%5][o].N&i[(r+2)%5][o].N));t[0][0]=Fe(t[0][0],Xe[n])}var c,u,l,d,h;return t}function rt(e){let t,n,r=0;const o=[0,0],i=[4294967295&e,e/4294967296&2097151];for(t=6;t>=0;t--)n=i[t>>2]>>>8*t&255,0===n&&0===r||(o[r+1>>2]|=n<<8*(r+1),r+=1);return r=0!==r?r:1,o[0]|=r,{value:r+1>4?o:[o[0]],binLen:8+8*r}}function ot(e){return he(rt(e.binLen),e)}function it(e,t){let n,r=rt(t);r=he(r,e);const o=t>>>2,i=(o-r.value.length%o)%o;for(n=0;n<i;n++)r.value.push(0);return r.value}class st extends me{constructor(e,t,n){let r=6,o=0;super(e,t,n);const i=n||{};if(1!==this.numRounds){if(i.kmacKey||i.hmacKey)throw new Error("Cannot set numRounds with MAC");if("CSHAKE128"===this.s||"CSHAKE256"===this.s)throw new Error("Cannot set numRounds for CSHAKE variants")}switch(this.K=1,this.m=se(this.t,this.i,this.K),this.R=nt,this.g=tt,this.B=et,this.C=et(),this.v=!1,e){case"SHA3-224":this.p=o=1152,this.U=224,this.L=!0,this.T=this.k;break;case"SHA3-256":this.p=o=1088,this.U=256,this.L=!0,this.T=this.k;break;case"SHA3-384":this.p=o=832,this.U=384,this.L=!0,this.T=this.k;break;case"SHA3-512":this.p=o=576,this.U=512,this.L=!0,this.T=this.k;break;case"SHAKE128":r=31,this.p=o=1344,this.U=-1,this.v=!0,this.L=!1,this.T=null;break;case"SHAKE256":r=31,this.p=o=1088,this.U=-1,this.v=!0,this.L=!1,this.T=null;break;case"KMAC128":r=4,this.p=o=1344,this.I(n),this.U=-1,this.v=!0,this.L=!1,this.T=this.X;break;case"KMAC256":r=4,this.p=o=1088,this.I(n),this.U=-1,this.v=!0,this.L=!1,this.T=this.X;break;case"CSHAKE128":this.p=o=1344,r=this._(n),this.U=-1,this.v=!0,this.L=!1,this.T=null;break;case"CSHAKE256":this.p=o=1088,r=this._(n),this.U=-1,this.v=!0,this.L=!1,this.T=null;break;default:throw new Error(de)}this.F=function(e,t,n,i,s){return function(e,t,n,r,o,i,s){let a,c,u=0;const l=[],d=o>>>5,h=t>>>5;for(a=0;a<h&&t>=o;a+=d)r=nt(e.slice(a,a+d),r),t-=o;for(e=e.slice(a),t%=o;e.length<d;)e.push(0);for(a=t>>>3,e[a>>2]^=i<<a%4*8,e[d-1]^=2147483648,r=nt(e,r);32*l.length<s&&(c=r[u%5][u/5|0],l.push(c.N),!(32*l.length>=s));)l.push(c.Y),u+=1,0==64*u%o&&(nt(null,r),u=0);return l}(e,t,0,i,o,r,s)},i.hmacKey&&this.M(fe("hmacKey",i.hmacKey,this.K))}_(e,t){const n=function(e){const t=e||{};return{funcName:fe("funcName",t.funcName,1,{value:[],binLen:0}),customization:fe("Customization",t.customization,1,{value:[],binLen:0})}}(e||{});t&&(n.funcName=t);const r=he(ot(n.funcName),ot(n.customization));if(0!==n.customization.binLen||0!==n.funcName.binLen){const e=it(r,this.p>>>3);for(let t=0;t<e.length;t+=this.p>>>5)this.C=this.R(e.slice(t,t+(this.p>>>5)),this.C),this.l+=this.p;return 4}return 31}I(e){const t=function(e){const t=e||{};return{kmacKey:fe("kmacKey",t.kmacKey,1),funcName:{value:[1128353099],binLen:32},customization:fe("Customization",t.customization,1,{value:[],binLen:0})}}(e||{});this._(e,t.funcName);const n=it(ot(t.kmacKey),this.p>>>3);for(let e=0;e<n.length;e+=this.p>>>5)this.C=this.R(n.slice(e,e+(this.p>>>5)),this.C),this.l+=this.p;this.A=!0}X(e){const t=he({value:this.o.slice(),binLen:this.h},function(e){let t,n,r=0;const o=[0,0],i=[4294967295&e,e/4294967296&2097151];for(t=6;t>=0;t--)n=i[t>>2]>>>8*t&255,0===n&&0===r||(o[r>>2]|=n<<8*r,r+=1);return r=0!==r?r:1,o[r>>2]|=r<<8*r,{value:r+1>4?o:[o[0]],binLen:8+8*r}}(e.outputLen));return this.F(t.value,t.binLen,this.l,this.g(this.C),e.outputLen)}}function at(e){return Object(ne.a)(e)||Object(re.a)(e)?new ct(e):Object(X.b)(e,["sharedAccessKeyName","sharedAccessKey"])?new ct({name:e.sharedAccessKeyName,key:e.sharedAccessKey}):new ct({signature:e.sharedAccessSignature})}class ct{constructor(e){this._credential=e}get isSasTokenProvider(){return!0}getToken(e){return Object(ne.a)(this._credential)?function(e,t,n,r){r=encodeURIComponent(r),e=encodeURIComponent(e);const o=r+"\n"+n,i=new class{constructor(e,t,n){if("SHA-1"==e)this.O=new Re(e,t,n);else if("SHA-224"==e||"SHA-256"==e)this.O=new je(e,t,n);else if("SHA-384"==e||"SHA-512"==e)this.O=new Je(e,t,n);else{if("SHA3-224"!=e&&"SHA3-256"!=e&&"SHA3-384"!=e&&"SHA3-512"!=e&&"SHAKE128"!=e&&"SHAKE256"!=e&&"CSHAKE128"!=e&&"CSHAKE256"!=e&&"KMAC128"!=e&&"KMAC256"!=e)throw new Error(de);this.O=new st(e,t,n)}}update(e){this.O.update(e)}getHash(e,t){return this.O.getHash(e,t)}setHMACKey(e,t,n){this.O.setHMACKey(e,t,n)}getHMAC(e,t){return this.O.getHMAC(e,t)}}("SHA-256","TEXT");i.setHMACKey(t,"TEXT"),i.update(o);const s=encodeURIComponent(i.getHMAC("B64"));return{token:`SharedAccessSignature sr=${r}&sig=${s}&se=${n}&skn=${e}`,expiresOnTimestamp:n}}(this._credential.name,this._credential.key,Math.floor(Date.now()/1e3)+3600,e):{token:this._credential.signature,expiresOnTimestamp:0}}}function ut(e){const t=Object(m.f)(e);!function(e,t,n,r){if(!e)throw new Error("Connection string should have an Endpoint key.");if(t){if(n||r)throw new Error("Connection string cannot have both SharedAccessSignature and SharedAccessKey keys.")}else{if(n&&!r)throw new Error("Connection string with SharedAccessKey should have SharedAccessKeyName.");if(!n&&r)throw new Error("Connection string with SharedAccessKeyName should have SharedAccessKey as well.")}}(t.Endpoint,t.SharedAccessSignature,t.SharedAccessKey,t.SharedAccessKeyName);const n={fullyQualifiedNamespace:(t.Endpoint.match(".*://([^/]*)")||[])[1],endpoint:t.Endpoint};return t.EntityPath&&(n.eventHubName=t.EntityPath),t.SharedAccessSignature&&(n.sharedAccessSignature=t.SharedAccessSignature),t.SharedAccessKey&&t.SharedAccessKeyName&&(n.sharedAccessKey=t.SharedAccessKey,n.sharedAccessKeyName=t.SharedAccessKeyName),n}var lt=n(81);const dt={create(e,t){const n=Z.create(e,t);if(!n.entityPath)throw new TypeError(`Either provide "path" or the "connectionString": "${e}", must contain EntityPath="<path-to-the-entity>".`);return dt.createFromConnectionConfig(n)},createFromConnectionConfig:e=>(Z.validate(e,{isEntityPathRequired:!0}),e.getManagementAudience=()=>`${e.endpoint}${e.entityPath}/$management`,e.getManagementAddress=()=>e.entityPath+"/$management",e.getSenderAudience=t=>null!=t?`${e.endpoint}${e.entityPath}/Partitions/${t}`:`${e.endpoint}${e.entityPath}`,e.getSenderAddress=t=>null!=t?`${e.entityPath}/Partitions/${t}`:""+e.entityPath,e.getReceiverAudience=(t,n)=>(n||(n="$default"),`${e.endpoint}${e.entityPath}/ConsumerGroups/${n}/Partitions/`+t),e.getReceiverAddress=(t,n)=>(n||(n="$default"),`${e.entityPath}/ConsumerGroups/${n}/Partitions/${t}`),e),setCustomEndpointAddress(e,t){e.amqpHostname=e.host;const{hostname:n,port:r}=function(e){const t=e.match(/.*:\/\/([^/]*)/);if(!t)throw new TypeError("Invalid endpoint missing host: "+e);const[,n]=t,[r,o]=n.split(":");return{host:n,hostname:r,port:o}}(t);e.host=n,r&&(e.port=parseInt(r,10))},validate:e=>Z.validate(e,{isEntityPathRequired:!0})};function ht(){return"BROWSER-VERSION; Browser "+function(){if("undefined"==typeof self)return"";return self.navigator.appVersion}()}var pt;function ft(e,t,n,r){let o,i,s;if(e=String(e),Object(c.a)(n)){const r=t;let a=e;if(s=Object(ne.a)(n)||Object(re.a)(n)?at(n):n,!r)throw new TypeError('"eventHubName" is missing');a.endsWith("/")||(a+="/"),o=`Endpoint=sb://${a};SharedAccessKeyName=defaultKeyName;SharedAccessKey=defaultKeyValue;EntityPath=${r}`,i=dt.create(o)}else{const a=ut(e);if(!(a.eventHubName||"string"==typeof t&&t))throw new TypeError(`Either provide "eventHubName" or the "connectionString": "${e}", must contain "EntityPath=<your-event-hub-name>".`);if(a.eventHubName&&"string"==typeof t&&t&&a.eventHubName!==t)throw new TypeError(`The entity path "${a.eventHubName}" in connectionString: "${e}" doesn't match with eventHubName: "${t}".`);if(o=e,"string"!=typeof t)i=dt.create(o),r=t;else{const e=t;i=dt.create(o,e),r=n}s=at(ut(o))}return(null==r?void 0:r.customEndpointAddress)&&dt.setCustomEndpointAddress(i,r.customEndpointAddress),Z.validate(i),pt.create(i,s,r)}function mt(e,t,n,r){if(!n.length)return[];const i=function(e,t){const n=new Map;return e.forEach((e,r)=>{if(void 0===e.lastModifiedTimeInMs||null===e.lastModifiedTimeInMs)return;Date.now()-e.lastModifiedTimeInMs<t&&e.ownerId&&n.set(r,e)}),n}(t,r);if(o.b.verbose(`[${e}] Number of active ownership records: ${i.size}.`),0===i.size)return n;const s=new Map;for(const e of i.values()){const t=s.get(e.ownerId)||[];t.push(e),s.set(e.ownerId,t)}s.has(e)||s.set(e,[]),o.b.info(`[${e}] Number of active event processors: ${s.size}.`);const{minPartitionsPerOwner:a,requiredNumberOfOwnersWithExtraPartition:c}=function(e,t){return{minPartitionsPerOwner:Math.floor(t.length/e.size),requiredNumberOfOwnersWithExtraPartition:t.length%e.size}}(s,n);o.b.verbose(`[${e}] Expected minimum number of partitions per event processor: ${a},expected number of event processors with additional partition: ${c}.`);const u=function(e,t){const n={haveRequiredPartitions:0,haveAdditionalPartition:0,haveTooManyPartitions:0};for(const r of t.values()){const t=r.length;t===e?n.haveRequiredPartitions++:t===e+1?n.haveAdditionalPartition++:t>e+1&&n.haveTooManyPartitions++}return n}(a,s);if(function(e,t,{haveAdditionalPartition:n,haveRequiredPartitions:r}){return n===e&&r+n===t}(c,s.size,u))return[];let l=function(e,t,n,{haveAdditionalPartition:r,haveTooManyPartitions:o}){let i=e;return t>0&&r+o<t&&(i=e+1),i-n}(a,c,s.get(e).length,u);if(l<=0)return[];const d=[],h=n.filter(e=>!i.has(e));for(;Math.min(l,h.length);){const e=Math.floor(Math.random()*h.length);d.push(h.splice(e,1)[0]),l--}if(0===l)return d;const p=function(e,t,n,r,o){const i=[],s=[];o.forEach((e,n)=>{n===r||e.length<=t||s.push(e)}),s.sort((e,t)=>e.length>t.length?-1:e.length<t.length?1:0);let a=0,c=s.shift();for(;e>0&&c;){let r=t;a<n&&r++,a++;let o=c.length-r;for(;Math.min(e,o);){const t=Math.floor(Math.random()*c.length);i.push(c.splice(t,1)[0].partitionId),e--,o--}c=s.shift()}return i}(l,a,c,e,s);return d.concat(p)}!function(e){const t=`azsdk-js-azureeventhubs/${T.c.version} (${ht()})`;function n(e){const n=e.userAgent?`${t},${e.userAgent}`:t;if(n.length>s.a.maxUserAgentLength)throw new Error(`The user-agent string cannot be more than ${s.a.maxUserAgentLength} characters in length.The given user-agent string is: ${n} with length: ${n.length}`);return n}e.getUserAgent=n,e.create=function(e,t,r){r||(r={}),e.webSocket=r.webSocketOptions&&r.webSocketOptions.webSocket,e.webSocketEndpointPath="$servicebus/websocket",e.webSocketConstructorOptions=r.webSocketOptions&&r.webSocketOptions.webSocketConstructorOptions;const i={config:e,isEntityPathRequired:!0,connectionProperties:{product:"MSJSClient",userAgent:n(r),version:T.c.version}},s=te.create(i);s.tokenCredential=t,s.wasConnectionCloseCalled=!1,s.senders={},s.receivers={};const a={address:r.managementSessionAddress,audience:r.managementSessionAudience};let c,u;s.managementSession=new lt.a(s,a),Object.assign(s,{isConnectionClosing(){return Boolean(!this.connection.isOpen()&&this.connection.isRemoteOpen())},async readyToOpenLink(){this.isConnectionClosing()&&await this.waitForDisconnectedEvent(),await this.waitForConnectionReset()},waitForDisconnectedEvent(){return new Promise(e=>{o.b.verbose(`[${this.connectionId}] Attempting to reinitialize connection but the connection is in the process of closing. Waiting for the disconnect event before continuing.`),this.connection.once(y.ConnectionEvents.disconnected,e)})},waitForConnectionReset:()=>u||Promise.resolve(),async close(){var e;try{this.connection.isOpen()&&(await Promise.all(Object.keys(s.senders).map(e=>{var t;return null===(t=s.senders[e])||void 0===t?void 0:t.close().catch(()=>{})})),await Promise.all(Object.keys(s.receivers).map(e=>{var t;return null===(t=s.receivers[e])||void 0===t?void 0:t.close().catch(()=>{})})),await this.cbsSession.close(),await(null===(e=this.managementSession)||void 0===e?void 0:e.close()),await this.connection.close(),this.wasConnectionCloseCalled=!0,o.b.info("Closed the amqp connection '%s' on the client.",this.connectionId))}catch(e){const t=e instanceof Error?`${e.name}: ${e.message}`:JSON.stringify(e);throw o.b.warning(`An error occurred while closing the connection "${this.connectionId}":\n${t}`),Object(o.a)(e),e}}});const l=()=>{s.wasConnectionCloseCalled=!1,o.b.verbose("[%s] setting 'wasConnectionCloseCalled' property of connection context to %s.",s.connection.id,s.wasConnectionCloseCalled)},d=async e=>{var t,n;if(!u){u=new Promise(e=>{c=e});try{o.b.verbose("[%s] 'disconnected' event occurred on the amqp connection.",s.connection.id),e.connection&&e.connection.error&&o.b.verbose("[%s] Accompanying error on the context.connection: %O",s.connection.id,e.connection&&e.connection.error),e.error&&o.b.verbose("[%s] Accompanying error on the context: %O",s.connection.id,e.error);const r={wasConnectionCloseCalled:s.wasConnectionCloseCalled,numSenders:Object.keys(s.senders).length,numReceivers:Object.keys(s.receivers).length};o.b.verbose("[%s] Closing all open senders and receivers in the state: %O",s.connection.id,r),s.connection.removeAllSessions(),await(null===(t=s.cbsSession)||void 0===t?void 0:t.close().catch(()=>{})),await(null===(n=s.managementSession)||void 0===n?void 0:n.close().catch(()=>{})),(r.numSenders||r.numReceivers)&&(await Promise.all(Object.keys(s.senders).map(e=>{var t;return null===(t=s.senders[e])||void 0===t?void 0:t.close().catch(()=>{})})),await Promise.all(Object.keys(s.receivers).map(e=>{var t;return null===(t=s.receivers[e])||void 0===t?void 0:t.close().catch(()=>{})})))}catch(e){o.b.verbose(`[${s.connectionId}] An error occurred while closing the connection in 'disconnected'. %O`,e)}try{await async function(e){const t=e.connectionId;try{await function(e){return e.connection.removeListener(y.ConnectionEvents.connectionOpen,l),e.connection.removeListener(y.ConnectionEvents.disconnected,d),e.connection.removeListener(y.ConnectionEvents.protocolError,h),e.connection.removeListener(y.ConnectionEvents.error,p),e.connection.close()}(e)}catch(t){o.b.verbose(`[${e.connectionId}] There was an error closing the connection before reconnecting: %O`,t)}e.refreshConnection(),f(e.connection),o.b.verbose(`The connection "${t}" has been updated to "${e.connectionId}".`)}(s)}catch(e){o.b.verbose(`[${s.connectionId}] An error occurred while refreshing the connection in 'disconnected'. %O`,e)}finally{c(),u=void 0}}},h=async e=>{o.b.verbose("[%s] 'protocol_error' event occurred on the amqp connection.",s.connection.id),e.connection&&e.connection.error&&o.b.verbose("[%s] Accompanying error on the context.connection: %O",s.connection.id,e.connection&&e.connection.error),e.error&&o.b.verbose("[%s] Accompanying error on the context: %O",s.connection.id,e.error)},p=async e=>{o.b.verbose("[%s] 'error' event occurred on the amqp connection.",s.connection.id),e.connection&&e.connection.error&&o.b.verbose("[%s] Accompanying error on the context.connection: %O",s.connection.id,e.connection&&e.connection.error),e.error&&o.b.verbose("[%s] Accompanying error on the context: %O",s.connection.id,e.error)};function f(e){e.on(y.ConnectionEvents.connectionOpen,l),e.on(y.ConnectionEvents.disconnected,d),e.on(y.ConnectionEvents.protocolError,h),e.on(y.ConnectionEvents.error,p)}return f(s.connection),o.b.verbose("[%s] Created connection context successfully.",s.connectionId),s}}(pt||(pt={}));class gt{constructor(e){this._partitionOwnershipExpirationIntervalInMs=e}getPartitionsToCliam(e,t,n){const r=mt(e,t,n,this._partitionOwnershipExpirationIntervalInMs);if(!r.length)return[];return[r[Math.floor(Math.random()*r.length)]]}}class yt{constructor(e){this._partitionOwnershipExpirationIntervalInMs=e}getPartitionsToCliam(e,t,n){return mt(e,t,n,this._partitionOwnershipExpirationIntervalInMs)}}class vt{constructor(){this._partitionOwnershipMap=new Map,this._committedCheckpoints=new Map}async listOwnership(e,t,n){const r=[];for(const e of this._partitionOwnershipMap.values())r.push(Object.assign({},e));return r}async claimOwnership(e){const t=[];for(const n of e)if(!this._partitionOwnershipMap.has(n.partitionId)||this._partitionOwnershipMap.get(n.partitionId).etag===n.etag){const e=new Date,r=Object.assign(Object.assign({},n),{etag:Object(y.generate_uuid)(),lastModifiedTimeInMs:e.getTime()});this._partitionOwnershipMap.set(r.partitionId,r),t.push(r)}return t}async updateCheckpoint(e){Object(R.d)("","updateCheckpoint","sequenceNumber",e.sequenceNumber),Object(R.d)("","updateCheckpoint","offset",e.offset),e=Object.assign({},e);const t=this._partitionOwnershipMap.get(e.partitionId);if(t){t.etag=Object(y.generate_uuid)();const n=`${e.fullyQualifiedNamespace}:${e.eventHubName}:${e.consumerGroup}`;let r=this._committedCheckpoints.get(n);null==r&&(r=new Map,this._committedCheckpoints.set(n,r)),r.set(e.partitionId,e)}}async listCheckpoints(e,t,n){const r=`${e}:${t}:${n}`,o=this._committedCheckpoints.get(r);if(null==o)return[];const i=[];for(const e of o.values())i.push(Object.assign({},e));return i}}class bt{constructor(){this._partitions=new Set}add(e){if("all"===e&&this._partitions.size>0||this._partitions.has(e)||this._partitions.has("all"))throw new Error("Partition already has a subscriber.");this._partitions.add(e)}remove(e){this._partitions.delete(e)}}class _t{getPartitionsToCliam(e,t,n){return n}}const wt={maxBatchSize:1,maxWaitTimeInSeconds:60};class Et{constructor(e,t,n,r,i,s){var a;this._consumerGroup=e,this._partitionGate=new bt,this._id=Object(G.a)(),this._subscriptions=new Set,Object(c.a)(r)?(o.b.info("Creating EventHubConsumerClient with TokenCredential."),St(i)?(this._checkpointStore=i,this._userChoseCheckpointStore=!0,this._clientOptions=s||{}):(this._checkpointStore=new vt,this._userChoseCheckpointStore=!1,this._clientOptions=i||{}),this._context=ft(t,n,r,this._clientOptions)):"string"==typeof n?(o.b.info("Creating EventHubConsumerClient with connection string and event hub name."),St(r)?(this._checkpointStore=r,this._userChoseCheckpointStore=!0,this._clientOptions=i||{}):(this._checkpointStore=new vt,this._userChoseCheckpointStore=!1,this._clientOptions=r||{}),this._context=ft(t,n,this._clientOptions)):(o.b.info("Creating EventHubConsumerClient with connection string."),St(n)?(this._checkpointStore=n,this._userChoseCheckpointStore=!0,this._clientOptions=r||{}):(this._checkpointStore=new vt,this._userChoseCheckpointStore=!1,this._clientOptions=n||{}),this._context=ft(t,this._clientOptions)),this._loadBalancingOptions=Object.assign({strategy:"balanced",updateIntervalInMs:1e4,partitionOwnershipExpirationIntervalInMs:6e4},null===(a=this._clientOptions)||void 0===a?void 0:a.loadBalancingOptions)}get eventHubName(){return this._context.config.entityPath}get fullyQualifiedNamespace(){return this._context.config.host}async close(){const e=Array.from(this._subscriptions);return await Promise.all(e.map(e=>e.close())),this._context.close()}getPartitionIds(e={}){return this._context.managementSession.getEventHubProperties(Object.assign(Object.assign({},e),{retryOptions:this._clientOptions.retryOptions})).then(e=>e.partitionIds)}getPartitionProperties(e,t={}){return this._context.managementSession.getPartitionProperties(e,Object.assign(Object.assign({},t),{retryOptions:this._clientOptions.retryOptions}))}getEventHubProperties(e={}){return this._context.managementSession.getEventHubProperties(Object.assign(Object.assign({},e),{retryOptions:this._clientOptions.retryOptions}))}subscribe(e,t,n){let r,o;if(Ot(e)){const n=t;n&&n.startPosition&&d(n.startPosition),({targetedPartitionId:o,eventProcessor:r}=this.createEventProcessorForAllPartitions(e,n))}else{if(!Ot(t))throw new TypeError("Unhandled subscribe() overload");{const i=n;i&&i.startPosition&&d(i.startPosition),({targetedPartitionId:o,eventProcessor:r}=this.createEventProcessorForSinglePartition(String(e),t,n))}}r.start();const i={get isRunning(){return r.isRunning()},close:()=>(this._partitionGate.remove(o),this._subscriptions.delete(i),r.stop())};return this._subscriptions.add(i),i}_getLoadBalancingStrategy(){var e;if(!this._userChoseCheckpointStore)return new _t;const t=this._loadBalancingOptions.partitionOwnershipExpirationIntervalInMs;return"greedy"===(null===(e=this._loadBalancingOptions)||void 0===e?void 0:e.strategy)?new yt(t):new gt(t)}createEventProcessorForAllPartitions(e,t){this._partitionGate.add("all"),this._userChoseCheckpointStore?o.b.verbose("EventHubConsumerClient subscribing to all partitions, using a checkpoint store."):o.b.verbose("EventHubConsumerClient subscribing to all partitions, no checkpoint store.");const n=this._getLoadBalancingStrategy();return{targetedPartitionId:"all",eventProcessor:this._createEventProcessor(this._context,e,this._checkpointStore,Object.assign(Object.assign(Object.assign({},wt),t),{ownerLevel:Ct(t,this._userChoseCheckpointStore),ownerId:this._id,retryOptions:this._clientOptions.retryOptions,loadBalancingStrategy:n,loopIntervalInMs:this._loadBalancingOptions.updateIntervalInMs}))}}createEventProcessorForSinglePartition(e,t,n){var r;this._partitionGate.add(e);const i=n;this._userChoseCheckpointStore?o.b.verbose(`EventHubConsumerClient subscribing to specific partition (${e}), using a checkpoint store.`):o.b.verbose(`EventHubConsumerClient subscribing to specific partition (${e}), no checkpoint store.`);return{targetedPartitionId:e,eventProcessor:this._createEventProcessor(this._context,t,this._checkpointStore,Object.assign(Object.assign(Object.assign({},wt),n),{processingTarget:e,ownerLevel:Ct(i,this._userChoseCheckpointStore),retryOptions:this._clientOptions.retryOptions,loadBalancingStrategy:new _t,loopIntervalInMs:null!==(r=this._loadBalancingOptions.updateIntervalInMs)&&void 0!==r?r:1e4}))}}_createEventProcessor(e,t,n,r){return new Y(this._consumerGroup,e,t,n,r)}}function St(e){if(!e)return!1;const t=e;return"function"==typeof t.claimOwnership&&"function"==typeof t.listCheckpoints&&"function"==typeof t.listOwnership&&"function"==typeof t.updateCheckpoint}function Ot(e){return"function"==typeof e.processEvents}function Ct(e,t){return e&&e.ownerLevel?e.ownerLevel:t?0:void 0}Et.defaultConsumerGroupName=s.a.defaultConsumerGroup;class It extends H.a{constructor(e,{partitionId:t,enableIdempotentProducer:n,partitionPublishingOptions:r}){super(e,{name:e.config.getSenderAddress(t),partitionId:t}),this.senderLock="sender-"+Object(G.a)(),this.address=e.config.getSenderAddress(t),this.audience=e.config.getSenderAudience(t),this._isIdempotentProducer=n,this._userProvidedPublishingOptions=r,this._onAmqpError=e=>{const t=e.sender&&e.sender.error;o.b.verbose("[%s] 'sender_error' event occurred on the sender '%s' with address '%s'. The associated error is: %O",this._context.connectionId,this.name,this.address,t)},this._onSessionError=e=>{const t=e.session&&e.session.error;o.b.verbose("[%s] 'session_error' event occurred on the session of sender '%s' with address '%s'. The associated error is: %O",this._context.connectionId,this.name,this.address,t)},this._onAmqpClose=async e=>{const t=this._sender||e.sender;o.b.verbose("[%s] 'sender_close' event occurred on the sender '%s' with address '%s'. Value for isItselfClosed on the receiver is: '%s' Value for isConnecting on the session is: '%s'.",this._context.connectionId,this.name,this.address,t?t.isItselfClosed().toString():void 0,this.isConnecting),t&&!this.isConnecting&&await t.close().catch(e=>{o.b.verbose("[%s] Error when closing sender [%s] after 'sender_close' event: %O",this._context.connectionId,this.name,e)})},this._onSessionClose=async e=>{const t=this._sender||e.sender;o.b.verbose("[%s] 'session_close' event occurred on the session of sender '%s' with address '%s'. Value for isSessionItselfClosed on the session is: '%s' Value for isConnecting on the session is: '%s'.",this._context.connectionId,this.name,this.address,t?t.isSessionItselfClosed().toString():void 0,this.isConnecting),t&&!this.isConnecting&&await t.close().catch(e=>{o.b.verbose("[%s] Error when closing sender [%s] after 'session_close' event: %O",this._context.connectionId,this.name,e)})}}async close(){try{if(this._sender){o.b.info("[%s] Closing the Sender for the entity '%s'.",this._context.connectionId,this._context.config.entityPath);const e=this._sender;this._deleteFromCache(),await this._closeLink(e)}}catch(e){const t=`[${this._context.connectionId}] An error occurred while closing sender ${this.name}: ${null==e?void 0:e.name}: ${null==e?void 0:e.message}`;throw o.b.warning(t),Object(o.a)(e),e}}isOpen(){const e=Boolean(this._sender&&this._sender.isOpen());return o.b.verbose("[%s] Sender '%s' with address '%s' is open? -> %s",this._context.connectionId,this.name,this.address,e),e}async getMaxMessageSize(e={}){return(await this._getLink(e)).maxMessageSize}async getPartitionPublishingProperties(e={}){var t,n;if(this._localPublishingProperties)return Object.assign({},this._localPublishingProperties);const r={isIdempotentPublishingEnabled:this._isIdempotentProducer,partitionId:null!==(t=this.partitionId)&&void 0!==t?t:""};if(this._isIdempotentProducer){if(this._sender=await this._getLink(e),!this._sender)throw new Error(`Failed to retrieve partition publishing properties for partition "${this.partitionId}".`);const{[T.b.epoch]:t,[T.b.producerId]:o,[T.b.producerSequenceNumber]:i}=null!==(n=this._sender.properties)&&void 0!==n?n:{};r.ownerLevel=parseInt(t,10),r.producerGroupId=parseInt(o,10),r.lastPublishedSequenceNumber=parseInt(i,10)}return this._localPublishingProperties=r,Object.assign({},r)}async send(e,t){try{if(o.b.info("[%s] Sender '%s', trying to send EventData[].",this._context.connectionId,this.name),this._isIdempotentProducer&&this._hasPendingSend)throw new Error('There can only be 1 "sendBatch" call in-flight per partition while "enableIdempotentRetries" is set to true.');const n=x(e)?e.count:e.length;if(0===n)return void o.b.info(`[${this._context.connectionId}] No events were passed to sendBatch.`);if(this._isIdempotentProducer&&(this._hasPendingSend=!0),o.b.info("[%s] Sender '%s', sending encoded batch message.",this._context.connectionId,this.name),await this._trySendBatch(e,t),this._isIdempotentProducer&&(function(e){if(x(e))e._commitPublish();else for(const t of e)t._publishedSequenceNumber=t[T.a],delete t[T.a]}(e),this._localPublishingProperties)){const{lastPublishedSequenceNumber:e=0}=this._localPublishingProperties;this._localPublishingProperties.lastPublishedSequenceNumber=e+n}return}catch(t){throw function(e){if(x(e));else for(const t of e)delete t[T.a]}(e),o.b.warning(`An error occurred while sending the batch message ${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(o.a)(t),t}finally{this._isIdempotentProducer&&(this._hasPendingSend=!1)}}_populateLocalPublishingProperties(e){var t,n;const{[T.b.epoch]:r,[T.b.producerId]:o,[T.b.producerSequenceNumber]:i}=null!==(t=e.properties)&&void 0!==t?t:{};this._localPublishingProperties={isIdempotentPublishingEnabled:this._isIdempotentProducer,partitionId:null!==(n=this.partitionId)&&void 0!==n?n:"",lastPublishedSequenceNumber:i,ownerLevel:r,producerGroupId:o}}_deleteFromCache(){this._sender=void 0,delete this._context.senders[this.name],o.b.verbose("[%s] Deleted the sender '%s' with address '%s' from the client cache.",this._context.connectionId,this.name,this.address)}_createSenderOptions(e){e&&(this.name=""+Object(G.a)());const t={name:this.name,target:{address:this.address},onError:this._onAmqpError,onClose:this._onAmqpClose,onSessionError:this._onSessionError,onSessionClose:this._onSessionClose};if(this._isIdempotentProducer){t.desired_capabilities=T.b.capability;const e=function(e,t){let n,r,o;if(t)n=t.ownerLevel,r=t.producerGroupId,o=t.lastPublishedSequenceNumber;else{if(!e)return{};n=e.ownerLevel,r=e.producerGroupId,o=e.startingSequenceNumber}return{[T.b.epoch]:Object(c.b)(n)?y.types.wrap_short(n):null,[T.b.producerId]:Object(c.b)(r)?y.types.wrap_long(r):null,[T.b.producerSequenceNumber]:Object(c.b)(o)?y.types.wrap_int(o):null}}(this._userProvidedPublishingOptions,this._localPublishingProperties);t.properties=e}return o.b.verbose("Creating sender with options: %O",t),t}async _trySendBatch(e,t={}){const n=t.abortSignal,r=t.retryOptions||{},i=Object(D.a)(r);r.timeoutInMs=i;const s={operation:async()=>{var r,s;const c=Date.now(),u=await this._getLink(t),l=await this.getPartitionPublishingProperties(t),d=Date.now()-c;o.b.verbose("[%s] Sender '%s', credit: %d available: %d",this._context.connectionId,this.name,u.credit,u.session.outgoing.available());let h=1e3;if(!u.sendable()&&i-d>h?(o.b.verbose("%s Sender '%s', waiting for 1 second for sender to become sendable",this._context.connectionId,this.name),await Object(m.b)(h),o.b.verbose("%s Sender '%s' after waiting for a second, credit: %d available: %d",this._context.connectionId,this.name,u.credit,null===(s=null===(r=u.session)||void 0===r?void 0:r.outgoing)||void 0===s?void 0:s.available())):h=0,!u.sendable()){const e=`[${this._context.connectionId}] Sender "${this.name}", cannot send the message right now. Please try later.`;o.b.warning(e);const t={condition:a.b.SenderBusyError,description:e};throw Object(a.e)(t)}if(o.b.verbose("[%s] Sender '%s', sending message with id '%s'.",this._context.connectionId,this.name),i<=d+h){const e=`${this._context.connectionId} Sender "${this.name}" with address "${this.address}", was not able to send the message right now, due to operation timeout.`;o.b.warning(e);const t={condition:a.b.ServiceUnavailableError,description:e};throw Object(a.e)(t)}try{const r=function(e,t,n={}){var r;if(x(e))return e._generateMessage(t);{const o=e.length,i=[],s=null!==(r=n.tracingProperties)&&void 0!==r?r:[];for(let r=0;r<o;r++){const o=e[r],a=s[r],c=M(Object.assign(Object.assign({},o),{properties:Object.assign(Object.assign({},o.properties),a)}),n.partitionKey),{lastPublishedSequenceNumber:u=0}=t,l=u+1+r;U(c,Object.assign(Object.assign({},t),{publishSequenceNumber:l})),t.isIdempotentPublishingEnabled&&(o[T.a]=l),i.push(c)}const a={body:y.message.data_sections(i.map(y.message.encode))};return i[0].message_annotations&&(a.message_annotations=Object.assign({},i[0].message_annotations)),y.message.encode(a)}}(e,l,t),s=await u.send(r,{format:2147563264,timeoutInSeconds:(i-d-h)/1e3,abortSignal:n});o.b.info("[%s] Sender '%s', sent message with delivery id: %d",this._context.connectionId,this.name,s.id)}catch(e){const t=e.innerError||e;throw Object(R.e)(t)}},connectionId:this._context.connectionId,operationType:g.b.sendMessage,abortSignal:n,retryOptions:r};try{await Object(g.c)(s)}catch(e){const t=Object(a.e)(e);throw o.b.warning("[%s] Sender '%s', An error occurred while sending the message %s",this._context.connectionId,this.name,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(o.a)(t),t}}async _getLink(e={}){if(this.isOpen()&&this._sender)return this._sender;const t=e.retryOptions||{},n=Object(D.a)(t);t.timeoutInMs=n;const r=this._createSenderOptions(),i=Date.now(),s={operation:async()=>m.a.acquire(this.senderLock,()=>{const t=Date.now(),o=n-(t-i);return this._init(Object.assign(Object.assign({},r),{abortSignal:e.abortSignal,timeoutInMs:o}))},{abortSignal:e.abortSignal,timeoutInMs:n}),connectionId:this._context.connectionId,operationType:g.b.senderLink,abortSignal:e.abortSignal,retryOptions:t};try{return await Object(g.c)(s)}catch(e){const t=Object(a.e)(e);throw o.b.warning("[%s] An error occurred while creating the sender %s: %s",this._context.connectionId,this.name,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(o.a)(t),t}}async _init(e){try{if(this.isOpen()&&this._sender)return o.b.verbose("[%s] The sender '%s' with address '%s' is open -> %s. Hence not reconnecting.",this._context.connectionId,this.name,this.address,this.isOpen()),this._sender;{await this._context.readyToOpenLink(),await this._negotiateClaim({setTokenRenewal:!1,abortSignal:e.abortSignal,timeoutInMs:e.timeoutInMs}),o.b.verbose("[%s] Trying to create sender '%s'...",this._context.connectionId,this.name);const t=await this._context.connection.createAwaitableSender(e);return t.setMaxListeners(1e3),this._sender=t,this._populateLocalPublishingProperties(this._sender),this.isConnecting=!1,o.b.verbose("[%s] Sender '%s' created with sender options: %O",this._context.connectionId,this.name,e),this._context.senders[this.name]||(this._context.senders[this.name]=this),this._ensureTokenRenewal(),t}}catch(e){const t=Object(a.e)(e);throw o.b.warning("[%s] An error occurred while creating the sender %s: %s",this._context.connectionId,this.name,`${null==t?void 0:t.name}: ${null==t?void 0:t.message}`),Object(o.a)(t),t}}static create(e,t){const n=new It(e,t);return e.senders[n.name]||(e.senders[n.name]=n),e.senders[n.name]}}class Tt{constructor(e,t,n,r){this._context=ft(e,t,n,r),"string"!=typeof t?this._clientOptions=t||{}:Object(c.a)(n)?this._clientOptions=r||{}:this._clientOptions=n||{},this._sendersMap=new Map}get eventHubName(){return this._context.config.entityPath}get fullyQualifiedNamespace(){return this._context.config.host}async createBatch(e={}){var t;Object(R.c)(this._context);const n=Object(c.b)(e.partitionId)?String(e.partitionId):void 0;Object(R.f)({enableIdempotentRetries:this._enableIdempotentRetries,partitionId:n,partitionKey:e.partitionKey});let r=this._sendersMap.get(n||"");if(!r){const e=Object(c.b)(n)?null===(t=this._partitionOptions)||void 0===t?void 0:t[n]:void 0;r=It.create(this._context,{enableIdempotentProducer:Boolean(this._enableIdempotentRetries),partitionId:n,partitionPublishingOptions:e}),this._sendersMap.set(n||"",r)}let i=await r.getMaxMessageSize({retryOptions:this._clientOptions.retryOptions,abortSignal:e.abortSignal});if(e.maxSizeInBytes){if(e.maxSizeInBytes>i){const t=new Error(`Max message size (${e.maxSizeInBytes} bytes) is greater than maximum message size (${i} bytes) on the AMQP sender link.`);throw o.b.warning(`[${this._context.connectionId}] ${t.message}`),Object(o.a)(t),t}i=e.maxSizeInBytes}return new N(this._context,i,Boolean(this._enableIdempotentRetries),e.partitionKey,n)}async getPartitionPublishingProperties(e,t={}){var n;if(!Object(c.b)(e))throw new TypeError('getPartitionPublishingProperties called without required argument "partitionId"');"number"==typeof e&&(e=String(e));let r=this._sendersMap.get(e);return r||(r=It.create(this._context,{enableIdempotentProducer:Boolean(this._enableIdempotentRetries),partitionId:e,partitionPublishingOptions:null===(n=this._partitionOptions)||void 0===n?void 0:n[e]}),this._sendersMap.set(e,r)),r.getPartitionPublishingProperties(t)}async sendBatch(e,t={}){let n,r;Object(R.c)(this._context),Object(R.d)(this._context.connectionId,"sendBatch","batch",e);const o=[];let i=[];if(x(e)){if(this._enableIdempotentRetries&&Object(c.b)(e.startingPublishedSequenceNumber))throw new Error(R.a);const o=function(e,t){const n={},r=e.partitionId,o=e.partitionKey,{partitionId:i,partitionKey:s}=At(t);if(s&&o!==s)throw new Error(`The partitionKey (${s}) set on sendBatch does not match the partitionKey (${o}) set when creating the batch.`);if(i&&i!==r)throw new Error(`The partitionId (${i}) set on sendBatch does not match the partitionId (${r}) set when creating the batch.`);Object(c.b)(r)&&(n.partitionId=String(r));Object(c.b)(o)&&(n.partitionKey=String(o));return n}(e,t);n=o.partitionId,r=o.partitionKey,i=e._messageSpanContexts}else{if(Array.isArray(e)||(e=[e]),e.some(e=>Object(c.b)(e._publishedSequenceNumber)))throw new Error(R.b);const i=At(t);n=i.partitionId,r=i.partitionKey;for(let n=0;n<e.length;n++)e[n]=k(e[n],t,this._context.config.entityPath,this._context.config.host).event,o[n]=e[n].properties}return Object(R.f)({enableIdempotentRetries:this._enableIdempotentRetries,partitionId:n,partitionKey:r}),A.b.withSpan(`${Tt.name}.${this.sendBatch.name}`,t,t=>{var o;let i=this._sendersMap.get(n||"");if(!i){const e=Object(c.b)(n)?null===(o=this._partitionOptions)||void 0===o?void 0:o[n]:void 0;i=It.create(this._context,{enableIdempotentProducer:Boolean(this._enableIdempotentRetries),partitionId:n,partitionPublishingOptions:e}),this._sendersMap.set(n||"",i)}return i.send(e,Object.assign(Object.assign({},t),{partitionId:n,partitionKey:r,retryOptions:this._clientOptions.retryOptions}))},Object.assign({spanLinks:i.map(e=>({tracingContext:e}))},Object(A.a)(this._context.config,"client")))}async close(){await this._context.close();for(const e of this._sendersMap)await e[1].close();this._sendersMap.clear()}getEventHubProperties(e={}){return this._context.managementSession.getEventHubProperties(Object.assign(Object.assign({},e),{retryOptions:this._clientOptions.retryOptions}))}getPartitionIds(e={}){return this._context.managementSession.getEventHubProperties(Object.assign(Object.assign({},e),{retryOptions:this._clientOptions.retryOptions})).then(e=>e.partitionIds)}getPartitionProperties(e,t={}){return this._context.managementSession.getPartitionProperties(e,Object.assign(Object.assign({},t),{retryOptions:this._clientOptions.retryOptions}))}}function At(e={}){const t={},{partitionId:n,partitionKey:r}=e;return Object(c.b)(n)&&(t.partitionId=String(n)),Object(c.b)(r)&&(t.partitionKey=String(r)),t}class kt{constructor(){this._resolvers=[],this._items=[]}size(){return this._items.length}shift(){const e=this._items.shift();return void 0!==e?Promise.resolve(e):new Promise(e=>this._resolvers.push(e))}push(e){this._resolveNextItem(e)||this._items.push(e)}_resolveNextItem(e){const t=this._resolvers.shift();return!!t&&(t(e),!0)}}function Pt(){let e,t;return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}}class Rt{constructor({loopAbortSignal:e,maxBufferSize:t,maxWaitTimeInMs:n,onSendEventsErrorHandler:r,onSendEventsSuccessHandler:o,partitionId:i,producer:s}){this._eventQueue=new kt,this._batchedEvents=[],this._bufferCount=0,this._readyQueue=[],this._flushState={isFlushing:!1},this._isRunning=!1,this._lastBatchCreationTime=0,this._loopAbortSignal=e,this._maxBufferSize=t,this._maxWaitTimeInMs=n,this._onSendEventsErrorHandler=r,this._onSendEventsSuccessHandler=o,this._partitionId=i,this._producer=s}getCurrentBufferedCount(){return this._bufferCount}async enqueueEvent(e){await this._ready(),this._eventQueue.push(e),this._bufferCount++,this._isRunning||(this._isRunning=!0,this._startPublishLoop().catch(e=>{o.b.error("The following error occured during batch creation or sending: "+JSON.stringify(e,void 0,"  "))}))}async flush(e={}){const t=this._flushState;if(t.isFlushing)return t.currentPromise;if(0===this.getCurrentBufferedCount())return Promise.resolve();const{promise:n,resolve:r}=Pt();return this._flushState={isFlushing:!0,currentPromise:n,resolve:r},n}_ready(){if(this.getCurrentBufferedCount()<this._maxBufferSize&&!this._readyQueue.length&&!this._flushState.isFlushing)return Promise.resolve();const{promise:e,reject:t,resolve:n}=Pt();return this._readyQueue.push({resolve:n,reject:t}),e}async _startPublishLoop(){let e,t,n=this._eventQueue.shift();for(;!this._loopAbortSignal.aborted;)try{Object(c.b)(e)||(e=await this._createBatch());const r=Date.now()-this._lastBatchCreationTime,o=e.count?Math.max(this._maxWaitTimeInMs-r,0):this._maxWaitTimeInMs,i=null!=t?t:await Promise.race([n,Object(m.b)(o)]);if(!i){e.count&&(await this._producer.sendBatch(e),this._reportSuccess(),e=await this._createBatch());continue}t||(t=i,n=this._eventQueue.shift());const s=e.tryAdd(i);s&&(this._batchedEvents.push(i),t=void 0),(s&&e.count>=this._maxBufferSize||!s&&e.count)&&(await this._producer.sendBatch(e),this._reportSuccess(),e=await this._createBatch()),s||e.tryAdd(i)?s||this._batchedEvents.push(i):this._reportFailure(new Error("Placeholder for max message size exceeded"),i),t=void 0}catch(t){Object(c.c)(t,["name"])&&"AbortError"===t.name||(this._reportFailure(t),e=void 0,this._batchedEvents=[])}}async _createBatch(){this._lastBatchCreationTime=Date.now(),this._batchedEvents=[];const e=await this._producer.createBatch({partitionId:this._partitionId});return this._incrementReadiness(),e}_incrementReadiness(){var e;if(this._flushState.isFlushing)return;const t=this.getCurrentBufferedCount(),n=Math.min(this._maxBufferSize-t,this._readyQueue.length);for(let t=0;t<n;t++)null===(e=this._readyQueue.shift())||void 0===e||e.resolve()}_reportSuccess(){var e;this._bufferCount=this._bufferCount-this._batchedEvents.length,this._updateFlushState();try{null===(e=this._onSendEventsSuccessHandler)||void 0===e||e.call(this,{events:this._batchedEvents,partitionId:this._partitionId})}catch(e){o.b.error("The following error occurred in the onSendEventsSuccessHandler: "+JSON.stringify(e,void 0,"  "))}}_reportFailure(e,t){this._bufferCount=this._bufferCount-(t?1:this._batchedEvents.length),this._updateFlushState();try{this._onSendEventsErrorHandler({error:e,events:t?[t]:this._batchedEvents,partitionId:this._partitionId})}catch(e){o.b.error("The following error occurred in the onSendEventsErrorHandler: "+JSON.stringify(e,void 0,"  "))}}_updateFlushState(){const e=this._flushState;e.isFlushing&&0===this.getCurrentBufferedCount()&&(e.resolve(),this._flushState={isFlushing:!1},this._incrementReadiness())}}var xt=n(82);class Nt{constructor(){this._partitions=[],this._lastRoundRobinPartitionIndex=-1}setPartitionIds(e){this._partitions=e}assignPartition({partitionId:e,partitionKey:t}){if(Object(c.b)(e)&&Object(c.b)(t))throw new Error(`The partitionId (${e}) and partitionKey (${t}) cannot both be specified.`);if(!this._partitions.length)throw new Error("Unable to determine partitionIds, can't assign partitionId.");return Object(c.b)(e)&&this._partitions.includes(e)?e:Object(c.b)(t)?Object(xt.a)(t,this._partitions.length).toString():this._assignRoundRobinPartition()}_assignRoundRobinPartition(){const e=this._partitions.length-1,t=this._lastRoundRobinPartitionIndex+1,n=t>e?0:t;return this._lastRoundRobinPartitionIndex=n,this._partitions[n]}}class jt{constructor(e,t,n,o){this._abortController=new r.a,this._isClosed=!1,this._partitionAssigner=new Nt,this._partitionIds=[],this._partitionChannels=new Map,this._backgroundManagementInterval=1e4,this._isBackgroundManagementRunning=!1,"string"!=typeof t?(this._producer=new Tt(e,t),this._clientOptions=Object.assign({},t)):Object(c.a)(n)?(this._producer=new Tt(e,t,n,o),this._clientOptions=Object.assign({},o)):(this._producer=new Tt(e,t,n),this._clientOptions=Object.assign({},n)),this._producer._enableIdempotentRetries=this._clientOptions.enableIdempotentRetries}get eventHubName(){return this._producer.eventHubName}get fullyQualifiedNamespace(){return this._producer.fullyQualifiedNamespace}async close(e={}){o.b.verbose("closing buffered producer client..."),Object(c.b)(e.flush)&&!0!==e.flush||await this.flush(e),this._abortController.abort(),await this._producer.close(),this._isClosed=!0}async enqueueEvent(e,t={}){if(this._isClosed)throw new Error("This EventHubBufferedProducerClient has already been closed. Create a new client to enqueue events.");this._partitionIds.length||await this._updatePartitionIds(),this._isBackgroundManagementRunning||(this._startPartitionIdsUpdateLoop().catch(e=>{o.b.error("The following error occured during batch creation or sending: "+JSON.stringify(e,void 0,"  "))}),this._isBackgroundManagementRunning=!0);const n=this._partitionAssigner.assignPartition({partitionId:t.partitionId,partitionKey:t.partitionKey}),r=this._getPartitionChannel(n);return await r.enqueueEvent(e),this._getTotalBufferedEventsCount()}async enqueueEvents(e,t={}){for(const n of e)await this.enqueueEvent(n,t);return this._getTotalBufferedEventsCount()}async flush(e={}){await Promise.all(Array.from(this._partitionChannels.values()).map(t=>t.flush(e)))}getEventHubProperties(e={}){return this._producer.getEventHubProperties(e)}getPartitionIds(e={}){return this._producer.getPartitionIds(e)}getPartitionProperties(e,t={}){return this._producer.getPartitionProperties(e,t)}_getPartitionChannel(e){var t;const n=null!==(t=this._partitionChannels.get(e))&&void 0!==t?t:new Rt({loopAbortSignal:this._abortController.signal,maxBufferSize:this._clientOptions.maxEventBufferLengthPerPartition||1500,maxWaitTimeInMs:this._clientOptions.maxWaitTimeInMs||1e3,onSendEventsErrorHandler:this._clientOptions.onSendEventsErrorHandler,onSendEventsSuccessHandler:this._clientOptions.onSendEventsSuccessHandler,partitionId:e,producer:this._producer});return this._partitionChannels.set(e,n),n}_getTotalBufferedEventsCount(){let e=0;for(const[t,n]of this._partitionChannels)e+=n.getCurrentBufferedCount();return e}async _updatePartitionIds(){o.b.verbose("Checking for partition Id updates...");const e=await this.getPartitionIds();this._partitionIds.length!==e.length&&(o.b.verbose("Applying partition Id updates"),this._partitionIds=e,this._partitionAssigner.setPartitionIds(this._partitionIds))}async _startPartitionIdsUpdateLoop(){for(o.b.verbose("Starting a background loop to check and apply partition id updates...");!this._abortController.signal.aborted&&!this._isClosed;)await Object(m.b)(this._backgroundManagementInterval),this._isClosed||await this._updatePartitionIds()}}function Mt(e={}){return{produce:({data:t,contentType:n})=>Object.assign(Object.assign({},e),{body:t,contentType:n}),consume:e=>{const{body:t,contentType:n}=e;if(void 0===t)throw new Error("Expected the body field to be defined");if(void 0===n)throw new Error("Expected the contentType field to be defined");return{data:"object"==typeof t?Uint8Array.from(Object.values(t)):t,contentType:n}}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"SchemaRegistryClient",(function(){return K}));var r={};n.r(r),n.d(r,"SchemaGroups",(function(){return s})),n.d(r,"ErrorModel",(function(){return a})),n.d(r,"ErrorDetail",(function(){return c})),n.d(r,"SchemaVersions",(function(){return u})),n.d(r,"SchemaId",(function(){return l})),n.d(r,"SchemaGroupsListExceptionHeaders",(function(){return d})),n.d(r,"SchemaGetByIdHeaders",(function(){return h})),n.d(r,"SchemaGetByIdExceptionHeaders",(function(){return p})),n.d(r,"SchemaGetVersionsExceptionHeaders",(function(){return f})),n.d(r,"SchemaQueryIdByContentHeaders",(function(){return m})),n.d(r,"SchemaQueryIdByContentExceptionHeaders",(function(){return g})),n.d(r,"SchemaRegisterHeaders",(function(){return y})),n.d(r,"SchemaRegisterExceptionHeaders",(function(){return v}));var o=n(119),i=n(22);const s={type:{name:"Composite",className:"SchemaGroups",modelProperties:{schemaGroups:{serializedName:"schemaGroups",type:{name:"Sequence",element:{type:{name:"String"}}}}}}},a={type:{name:"Composite",className:"ErrorModel",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ErrorDetail"}}}}},c={type:{name:"Composite",className:"ErrorDetail",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},details:{serializedName:"details",type:{name:"Sequence",element:{type:{name:"Composite",className:"ErrorDetail"}}}}}}},u={type:{name:"Composite",className:"SchemaVersions",modelProperties:{schemaVersions:{serializedName:"schemaVersions",type:{name:"Sequence",element:{type:{name:"Number"}}}}}}},l={type:{name:"Composite",className:"SchemaId",modelProperties:{id:{serializedName:"id",type:{name:"String"}}}}},d={type:{name:"Composite",className:"SchemaGroupsListExceptionHeaders",modelProperties:{xMsErrorCode:{serializedName:"x-ms-error-code",type:{name:"String"}}}}},h={type:{name:"Composite",className:"SchemaGetByIdHeaders",modelProperties:{location:{serializedName:"location",type:{name:"String"}},contentType:{serializedName:"content-type",type:{name:"String"}},schemaId:{serializedName:"schema-id",type:{name:"String"}},schemaIdLocation:{serializedName:"schema-id-location",type:{name:"String"}},schemaGroupName:{serializedName:"schema-group-name",type:{name:"String"}},schemaName:{serializedName:"schema-name",type:{name:"String"}},schemaVersion:{serializedName:"schema-version",type:{name:"Number"}}}}},p={type:{name:"Composite",className:"SchemaGetByIdExceptionHeaders",modelProperties:{xMsErrorCode:{serializedName:"x-ms-error-code",type:{name:"String"}}}}},f={type:{name:"Composite",className:"SchemaGetVersionsExceptionHeaders",modelProperties:{xMsErrorCode:{serializedName:"x-ms-error-code",type:{name:"String"}}}}},m={type:{name:"Composite",className:"SchemaQueryIdByContentHeaders",modelProperties:{location:{serializedName:"location",type:{name:"String"}},schemaId:{serializedName:"schema-id",type:{name:"String"}},schemaIdLocation:{serializedName:"schema-id-location",type:{name:"String"}},schemaGroupName:{serializedName:"schema-group-name",type:{name:"String"}},schemaName:{serializedName:"schema-name",type:{name:"String"}},schemaVersion:{serializedName:"schema-version",type:{name:"Number"}}}}},g={type:{name:"Composite",className:"SchemaQueryIdByContentExceptionHeaders",modelProperties:{xMsErrorCode:{serializedName:"x-ms-error-code",type:{name:"String"}}}}},y={type:{name:"Composite",className:"SchemaRegisterHeaders",modelProperties:{location:{serializedName:"location",type:{name:"String"}},schemaId:{serializedName:"schema-id",type:{name:"String"}},schemaIdLocation:{serializedName:"schema-id-location",type:{name:"String"}},schemaGroupName:{serializedName:"schema-group-name",type:{name:"String"}},schemaName:{serializedName:"schema-name",type:{name:"String"}},schemaVersion:{serializedName:"schema-version",type:{name:"Number"}}}}},v={type:{name:"Composite",className:"SchemaRegisterExceptionHeaders",modelProperties:{xMsErrorCode:{serializedName:"x-ms-error-code",type:{name:"String"}}}}},b={parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},_={parameterPath:"endpoint",mapper:{serializedName:"endpoint",required:!0,type:{name:"String"}},skipEncoding:!0},w={parameterPath:"apiVersion",mapper:{defaultValue:"2021-10",isConstant:!0,serializedName:"api-version",type:{name:"String"}}},E={parameterPath:"groupName",mapper:{serializedName:"groupName",required:!0,type:{name:"String"}}},S={parameterPath:"schemaName",mapper:{constraints:{MaxLength:50},serializedName:"schemaName",required:!0,type:{name:"String"}}},O={parameterPath:"schemaContent",mapper:{serializedName:"schemaContent",required:!0,type:{name:"Stream"}}},C={parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},I={parameterPath:"contentType",mapper:{serializedName:"Content-Type",required:!0,type:{name:"String"}}};class T{constructor(e){this.client=e}list(e){return this.client.sendOperationRequest({options:e},k)}}const A=i.b(r,!1),k={path:"/$schemaGroups",httpMethod:"GET",responses:{200:{bodyMapper:s},default:{bodyMapper:a,headersMapper:d}},queryParameters:[w],urlParameters:[_],headerParameters:[b],serializer:A};class P{constructor(e){this.client=e}getById(e,t){return this.client.sendOperationRequest({id:e,options:t},x)}getVersions(e,t,n){return this.client.sendOperationRequest({groupName:e,schemaName:t,options:n},N)}queryIdByContent(e,t,n,r,o){return this.client.sendOperationRequest({groupName:e,schemaName:t,contentType:n,schemaContent:r,options:o},j)}register(e,t,n,r,o){return this.client.sendOperationRequest({groupName:e,schemaName:t,contentType:n,schemaContent:r,options:o},M)}}const R=i.b(r,!1),x={path:"/$schemaGroups/$schemas/{id}",httpMethod:"GET",responses:{200:{bodyMapper:{type:{name:"Stream"},serializedName:"parsedResponse"},headersMapper:h},default:{bodyMapper:a,headersMapper:p}},queryParameters:[w],urlParameters:[_,{parameterPath:"id",mapper:{serializedName:"id",required:!0,type:{name:"String"}}}],headerParameters:[{parameterPath:"accept",mapper:{defaultValue:"application/json; serialization=Avro",isConstant:!0,serializedName:"Accept",type:{name:"String"}}}],serializer:R},N={path:"/$schemaGroups/{groupName}/schemas/{schemaName}/versions",httpMethod:"GET",responses:{200:{bodyMapper:u},default:{bodyMapper:a,headersMapper:f}},queryParameters:[w],urlParameters:[_,E,S],headerParameters:[b],serializer:R},j={path:"/$schemaGroups/{groupName}/schemas/{schemaName}:get-id",httpMethod:"POST",responses:{204:{headersMapper:m},415:{bodyMapper:a,headersMapper:g,isError:!0},default:{bodyMapper:a,headersMapper:g}},requestBody:O,queryParameters:[w],urlParameters:[_,E,S],headerParameters:[C,I],mediaType:"binary",serializer:R},M={path:"/$schemaGroups/{groupName}/schemas/{schemaName}",httpMethod:"PUT",responses:{204:{headersMapper:y},415:{bodyMapper:a,headersMapper:v,isError:!0},default:{bodyMapper:a,headersMapper:v}},requestBody:O,queryParameters:[w],urlParameters:[_,E,S],headerParameters:[C,I],mediaType:"binary",serializer:R};class q extends o.a{constructor(e,t){var n,r;if(void 0===e)throw new Error("'endpoint' cannot be null");t||(t={});const o=t.userAgentOptions&&t.userAgentOptions.userAgentPrefix?t.userAgentOptions.userAgentPrefix+" azsdk-js-schema-registry/1.1.0":"azsdk-js-schema-registry/1.1.0";super(Object.assign(Object.assign(Object.assign({},{requestContentType:"application/json; charset=utf-8"}),t),{userAgentOptions:{userAgentPrefix:o},baseUri:null!==(r=null!==(n=t.endpoint)&&void 0!==n?n:t.baseUri)&&void 0!==r?r:"https://{endpoint}"})),this.endpoint=e,this.apiVersion=t.apiVersion||"2021-10",this.schemaGroupsOperations=new T(this),this.schema=new P(this)}}var L=n(120),U=n(125);async function H(e){return async function(e){return new Promise((t,n)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=()=>n,r.readAsText(e)})}(await e.blobBody)}async function D(e){return{definition:await H(e),properties:{id:e.schemaId,format:$(e.contentType),groupName:e.schemaGroupName,name:e.schemaName}}}function z(e){return t=>({id:t.schemaId,format:e,groupName:t.schemaGroupName,name:t.schemaName})}function $(e){const t=/.*serialization=(.*)$/.exec(e),n=null==t?void 0:t[1];if(n)return n;throw new Error("Unrecognized response's content-type: "+e)}var B=n(15);const F=Object(B.a)("schema-registry");class K{constructor(e,t,n={}){this.fullyQualifiedNamespace=e;const r=Object.assign(Object.assign({},n),{loggingOptions:{logger:F.info}});this._client=new q(this.fullyQualifiedNamespace,Object.assign({endpoint:this.fullyQualifiedNamespace,apiVersion:n.apiVersion},r)),this._tracing=Object(L.a)({namespace:"Microsoft.EventHub",packageName:"@azure/schema-registry",packageVersion:"1.1.0"});const o=Object(U.a)({credential:t,scopes:"https://eventhubs.azure.net/.default"});this._client.pipeline.addPolicy(o)}registerSchema(e,t={}){const{groupName:n,name:r,definition:o,format:i}=e;return this._tracing.withSpan("SchemaRegistryClient.registerSchema",t,e=>this._client.schema.register(n,r,"application/json; serialization="+i,o,e).then(z(i)))}getSchemaProperties(e,t={}){const{groupName:n,name:r,definition:o,format:i}=e;return this._tracing.withSpan("SchemaRegistryClient.getSchemaProperties",t,e=>this._client.schema.queryIdByContent(n,r,"application/json; serialization="+i,o,e).then(z(i)))}getSchema(e,t={}){return this._tracing.withSpan("SchemaRegistryClient.getSchema",t,t=>this._client.schema.getById(e,t).then(D))}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return J}));var r=n(64),o=n(7);function i(e){return!("object"!=typeof e||null===e||Array.isArray(e)||e instanceof RegExp||e instanceof Date)}function s(e){if(i(e)){const t="string"==typeof e.name,n="string"==typeof e.message;return t&&n}return!1}function a(e){if(s(e))return e.message;{let t;try{t="object"==typeof e&&e?JSON.stringify(e):String(e)}catch(e){t="[unable to stringify input]"}return"Unknown error "+t}}const c={},u=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],l=["api-version"];class d{constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:t=[]}={}){e=u.concat(e),t=l.concat(t),this.allowedHeaderNames=new Set(e.map(e=>e.toLowerCase())),this.allowedQueryParameters=new Set(t.map(e=>e.toLowerCase()))}sanitize(e){const t=new Set;return JSON.stringify(e,(e,n)=>{if(n instanceof Error)return Object.assign(Object.assign({},n),{name:n.name,message:n.message});if("headers"===e)return this.sanitizeHeaders(n);if("url"===e)return this.sanitizeUrl(n);if("query"===e)return this.sanitizeQuery(n);if("body"!==e&&"response"!==e&&"operationSpec"!==e){if(Array.isArray(n)||i(n)){if(t.has(n))return"[Circular]";t.add(n)}return n}},2)}sanitizeHeaders(e){const t={};for(const n of Object.keys(e))this.allowedHeaderNames.has(n.toLowerCase())?t[n]=e[n]:t[n]="REDACTED";return t}sanitizeQuery(e){if("object"!=typeof e||null===e)return e;const t={};for(const n of Object.keys(e))this.allowedQueryParameters.has(n.toLowerCase())?t[n]=e[n]:t[n]="REDACTED";return t}sanitizeUrl(e){if("string"!=typeof e||null===e)return e;const t=new URL(e);if(!t.search)return e;for(const[e]of t.searchParams)this.allowedQueryParameters.has(e.toLowerCase())||t.searchParams.set(e,"REDACTED");return t.toString()}}const h=new d;class p extends Error{constructor(e,t={}){super(e),this.name="RestError",this.code=t.code,this.statusCode=t.statusCode,this.request=t.request,this.response=t.response,Object.setPrototypeOf(this,p.prototype)}[c](){return`RestError: ${this.message} \n ${h.sanitize(this)}`}}p.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR",p.PARSE_ERROR="PARSE_ERROR";var f=n(22);function m(e,t,n){let r=t.parameterPath;const o=t.mapper;let i;if("string"==typeof r&&(r=[r]),Array.isArray(r)){if(r.length>0)if(o.isConstant)i=o.defaultValue;else{let t=g(e,r);!t.propertyFound&&n&&(t=g(n,r));let s=!1;t.propertyFound||(s=o.required||"options"===r[0]&&2===r.length),i=s?o.defaultValue:t.propertyValue}}else{o.required&&(i={});for(const t in r){const s=o.type.modelProperties[t],a=m(e,{parameterPath:r[t],mapper:s},n);void 0!==a&&(i||(i={}),i[t]=a)}}return i}function g(e,t){const n={propertyFound:!1};let r=0;for(;r<t.length;++r){const n=t[r];if(!e||!(n in e))break;e=e[n]}return r===t.length&&(n.propertyValue=e,n.propertyFound=!0),n}const y=new WeakMap;function v(e){let t=y.get(e);return t||(t={},y.set(e,t)),t}const b=["application/json","text/json"],_=["application/xml","application/atom+xml"];function w(e={}){var t,n,r,i,s,a,c;const u=null!==(n=null===(t=e.expectedContentTypes)||void 0===t?void 0:t.json)&&void 0!==n?n:b,l=null!==(i=null===(r=e.expectedContentTypes)||void 0===r?void 0:r.xml)&&void 0!==i?i:_,d=e.parseXML,h=e.serializerOptions,m={xml:{rootName:null!==(s=null==h?void 0:h.xml.rootName)&&void 0!==s?s:"",includeRoot:null!==(a=null==h?void 0:h.xml.includeRoot)&&void 0!==a&&a,xmlCharKey:null!==(c=null==h?void 0:h.xml.xmlCharKey)&&void 0!==c?c:o.b}};return{name:"deserializationPolicy",async sendRequest(e,t){const n=await t(e);return async function(e,t,n,r,o){const i=await async function(e,t,n,r,o){var i;if(!(null===(i=n.request.streamResponseStatusCodes)||void 0===i?void 0:i.has(n.status))&&n.bodyAsText){const i=n.bodyAsText,s=n.headers.get("Content-Type")||"",a=s?s.split(";").map(e=>e.toLowerCase()):[];try{if(0===a.length||a.some(t=>-1!==e.indexOf(t)))return n.parsedBody=JSON.parse(i),n;if(a.some(e=>-1!==t.indexOf(e))){if(!o)throw new Error("Parsing XML not supported.");const e=await o(i,r.xml);return n.parsedBody=e,n}}catch(e){const t=`Error "${e}" occurred while parsing the response body - ${n.bodyAsText}.`,r=e.code||p.PARSE_ERROR;throw new p(t,{code:r,statusCode:n.status,request:n.request,response:n})}}return n}(e,t,n,r,o);if(!function(e){const t=v(e.request),n=null==t?void 0:t.shouldDeserialize;let r;r=void 0===n||("boolean"==typeof n?n:n(e));return r}(i))return i;const s=v(i.request),a=null==s?void 0:s.operationSpec;if(!a||!a.responses)return i;const c=function(e){let t;const n=v(e.request),r=null==n?void 0:n.operationSpec;r&&(t=(null==n?void 0:n.operationResponseGetter)?null==n?void 0:n.operationResponseGetter(r,e):r.responses[e.status]);return t}(i),{error:u,shouldReturnResponse:l}=function(e,t,n){var r;const o=200<=e.status&&e.status<300;if(function(e){const t=Object.keys(e.responses);return 0===t.length||1===t.length&&"default"===t[0]}(t)?o:n){if(!n)return{error:null,shouldReturnResponse:!1};if(!n.isError)return{error:null,shouldReturnResponse:!1}}const i=null!=n?n:t.responses.default,s=(null===(r=e.request.streamResponseStatusCodes)||void 0===r?void 0:r.has(e.status))?"Unexpected status code: "+e.status:e.bodyAsText,a=new p(s,{statusCode:e.status,request:e.request,response:e});if(!i)throw a;const c=i.bodyMapper,u=i.headersMapper;try{if(e.parsedBody){const n=e.parsedBody;let r;if(c){let e=n;if(t.isXML&&c.type.name===f.a.Sequence){e=[];const t=c.xmlElementName;"object"==typeof n&&t&&(e=n[t])}r=t.serializer.deserialize(c,e,"error.response.parsedBody")}const o=n.error||r||n;a.code=o.code,o.message&&(a.message=o.message),c&&(a.response.parsedBody=r)}e.headers&&u&&(a.response.parsedHeaders=t.serializer.deserialize(u,e.headers.toJSON(),"operationRes.parsedHeaders"))}catch(t){a.message=`Error "${t.message}" occurred in deserializing the responseBody - "${e.bodyAsText}" for the default response.`}return{error:a,shouldReturnResponse:!1}}(i,a,c);if(u)throw u;if(l)return i;if(c){if(c.bodyMapper){let e=i.parsedBody;a.isXML&&c.bodyMapper.type.name===f.a.Sequence&&(e="object"==typeof e?e[c.bodyMapper.xmlElementName]:[]);try{i.parsedBody=a.serializer.deserialize(c.bodyMapper,e,"operationRes.parsedBody")}catch(e){throw new p(`Error ${e} occurred in deserializing the responseBody - ${i.bodyAsText}`,{statusCode:i.status,request:i.request,response:i})}}else"HEAD"===a.httpMethod&&(i.parsedBody=n.status>=200&&n.status<300);c.headersMapper&&(i.parsedHeaders=a.serializer.deserialize(c.headersMapper,i.headers.toJSON(),"operationRes.parsedHeaders"))}return i}(u,l,n,m,d)}}}var E=n(15);const S=Object(E.a)("core-rest-pipeline");const O=new Set(["Deserialize","Serialize","Retry","Sign"]);class C{constructor(e=[]){this._policies=[],this._policies=e,this._orderedPolicies=void 0}addPolicy(e,t={}){if(t.phase&&t.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(t.phase&&!O.has(t.phase))throw new Error("Invalid phase name: "+t.phase);if(t.afterPhase&&!O.has(t.afterPhase))throw new Error("Invalid afterPhase name: "+t.afterPhase);this._policies.push({policy:e,options:t}),this._orderedPolicies=void 0}removePolicy(e){const t=[];return this._policies=this._policies.filter(n=>!(e.name&&n.policy.name===e.name||e.phase&&n.options.phase===e.phase)||(t.push(n.policy),!1)),this._orderedPolicies=void 0,t}sendRequest(e,t){return this.getOrderedPolicies().reduceRight((e,t)=>n=>t.sendRequest(n,e),t=>e.sendRequest(t))(t)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new C(this._policies)}static create(){return new C}orderPolicies(){const e=[],t=new Map;function n(e){return{name:e,policies:new Set,hasRun:!1}}const r=n("Serialize"),o=n("None"),i=n("Deserialize"),s=n("Retry"),a=n("Sign"),c=[r,o,i,s,a];function u(e){return"Retry"===e?s:"Serialize"===e?r:"Deserialize"===e?i:"Sign"===e?a:o}for(const e of this._policies){const n=e.policy,r=e.options,o=n.name;if(t.has(o))throw new Error("Duplicate policy names not allowed in pipeline");const i={policy:n,dependsOn:new Set,dependants:new Set};r.afterPhase&&(i.afterPhase=u(r.afterPhase)),t.set(o,i);u(r.phase).policies.add(i)}for(const e of this._policies){const{policy:n,options:r}=e,o=n.name,i=t.get(o);if(!i)throw new Error("Missing node for policy "+o);if(r.afterPolicies)for(const e of r.afterPolicies){const n=t.get(e);n&&(i.dependsOn.add(n),n.dependants.add(i))}if(r.beforePolicies)for(const e of r.beforePolicies){const n=t.get(e);n&&(n.dependsOn.add(i),i.dependants.add(n))}}function l(n){n.hasRun=!0;for(const r of n.policies)if((!r.afterPhase||r.afterPhase.hasRun&&!r.afterPhase.policies.size)&&0===r.dependsOn.size){e.push(r.policy);for(const e of r.dependants)e.dependsOn.delete(r);t.delete(r.policy.name),n.policies.delete(r)}}function d(){for(const e of c)if(l(e),e.policies.size>0&&e!==o)return void(o.hasRun||l(o))}let h=0;for(;t.size>0;){h++;const t=e.length;if(d(),e.length<=t&&h>1)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}}function I(e){const t=new Map;t.set("core-rest-pipeline","1.9.0"),function(e){const t=self.navigator;e.set("OS",(t.oscpu||t.platform).replace(" ",""))}(t);const n=function(e){const t=[];for(const[n,r]of e){const e=r?`${n}/${r}`:n;t.push(e)}return t.join(" ")}(t);return e?`${e} ${n}`:n}new Error("decompressResponsePolicy is not supported in browser environment");var T=n(34);const A=["retry-after-ms","x-ms-retry-after-ms","Retry-After"];function k(e){if(e&&[429,503].includes(e.status))try{for(const t of A){const n=Object(T.b)(e,t);if(0===n||n){return n*("Retry-After"===t?1e3:1)}}const t=e.headers.get("Retry-After");if(!t)return;const n=Date.parse(t)-Date.now();return Number.isFinite(n)?Math.max(0,n):void 0}catch(e){return}}function P(e={}){var t,n;const r=null!==(t=e.retryDelayInMs)&&void 0!==t?t:1e3,o=null!==(n=e.maxRetryDelayInMs)&&void 0!==n?n:64e3;let i=r;return{name:"exponentialRetryStrategy",retry({retryCount:t,response:n,responseError:r}){const s=function(e){if(!e)return!1;return"ETIMEDOUT"===e.code||"ESOCKETTIMEDOUT"===e.code||"ECONNREFUSED"===e.code||"ECONNRESET"===e.code||"ENOENT"===e.code}(r),a=s&&e.ignoreSystemErrors,c=function(e){return Boolean(e&&void 0!==e.status&&(e.status>=500||408===e.status)&&501!==e.status&&505!==e.status)}(n),u=c&&e.ignoreHttpStatusCodes;if(n&&(function(e){return Number.isFinite(k(e))}(n)||!c)||u||a)return{skipStrategy:!0};if(r&&!s&&!c)return{errorToThrow:r};const l=i*Math.pow(2,t),d=Math.min(o,l);var h,p;return i=d/2+(h=0,p=d/2,h=Math.ceil(h),p=Math.floor(p),Math.floor(Math.random()*(p-h+1))+h),{retryAfterInMs:i}}}}var R=n(45);const x=Object(E.a)("core-rest-pipeline retryPolicy");function N(e,t={maxRetries:3}){const n=t.logger||x;return{name:"retryPolicy",async sendRequest(r,o){var i,s;let a,c,u=-1;e:for(;;){u+=1,a=void 0,c=void 0;try{n.info(`Retry ${u}: Attempting to send request`,r.requestId),a=await o(r),n.info(`Retry ${u}: Received a response from request`,r.requestId)}catch(e){if(n.error(`Retry ${u}: Received an error from request`,r.requestId),c=e,!e||"RestError"!==c.name)throw e;a=c.response}if(null===(i=r.abortSignal)||void 0===i?void 0:i.aborted){n.error(`Retry ${u}: Request aborted.`);throw new R.b}if(u>=(null!==(s=t.maxRetries)&&void 0!==s?s:3)){if(n.info(`Retry ${u}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),c)throw c;if(a)return a;throw new Error("Maximum retries reached with no response or error to throw")}n.info(`Retry ${u}: Processing ${e.length} retry strategies.`);t:for(const t of e){const e=t.logger||x;e.info(`Retry ${u}: Processing retry strategy ${t.name}.`);const n=t.retry({retryCount:u,response:a,responseError:c});if(n.skipStrategy){e.info(`Retry ${u}: Skipped.`);continue t}const{errorToThrow:o,retryAfterInMs:i,redirectTo:s}=n;if(o)throw e.error(`Retry ${u}: Retry strategy ${t.name} throws error:`,o),o;if(i||0===i){e.info(`Retry ${u}: Retry strategy ${t.name} retries after ${i}`),await Object(T.a)(i,void 0,{abortSignal:r.abortSignal});continue e}if(s){e.info(`Retry ${u}: Retry strategy ${t.name} redirects to ${s}`),r.url=s;continue e}}if(c)throw n.info("None of the retry strategies could work with the received error. Throwing it."),c;if(a)return n.info("None of the retry strategies could work with the received response. Returning it."),a}}}}new Error("proxyPolicy is not supported in browser environment");var j=n(120);function M(e={}){const t=I(e.userAgentPrefix),n=function(){try{return Object(j.a)({namespace:"",packageName:"@azure/core-rest-pipeline",packageVersion:"1.9.0"})}catch(e){return void S.warning("Error when creating the TracingClient: "+a(e))}}();return{name:"tracingPolicy",async sendRequest(e,r){var o,i;if(!n||!(null===(o=e.tracingOptions)||void 0===o?void 0:o.tracingContext))return r(e);const{span:c,tracingContext:u}=null!==(i=function(e,t,n){try{const{span:r,updatedOptions:o}=e.startSpan("HTTP "+t.method,{tracingOptions:t.tracingOptions},{spanKind:"client",spanAttributes:{"http.method":t.method,"http.url":t.url,requestId:t.requestId}});if(!r.isRecording())return void r.end();n&&r.setAttribute("http.user_agent",n);const i=e.createRequestHeaders(o.tracingOptions.tracingContext);for(const[e,n]of Object.entries(i))t.headers.set(e,n);return{span:r,tracingContext:o.tracingOptions.tracingContext}}catch(e){return void S.warning("Skipping creating a tracing span due to an error: "+a(e))}}(n,e,t))&&void 0!==i?i:{};if(!c||!u)return r(e);try{const t=await n.withContext(u,r,e);return function(e,t){try{e.setAttribute("http.status_code",t.status);const n=t.headers.get("x-ms-request-id");n&&e.setAttribute("serviceRequestId",n),e.setStatus({status:"success"}),e.end()}catch(e){S.warning("Skipping tracing span processing due to an error: "+a(e))}}(c,t),t}catch(e){throw function(e,t){try{e.setStatus({status:"error",error:s(t)?t:void 0}),((n=t)instanceof p||s(n)&&"RestError"===n.name)&&t.statusCode&&e.setAttribute("http.status_code",t.statusCode),e.end()}catch(n){S.warning("Skipping tracing span processing due to an error: "+a(n))}var n}(c,e),e}}}}function q(e){const t=C.create();return t.addPolicy({name:"formDataPolicy",async sendRequest(e,t){if(e.formData){const t=e.formData,n=new FormData;for(const e of Object.keys(t)){const r=t[e];if(Array.isArray(r))for(const t of r)n.append(e,t);else n.append(e,r)}e.body=n,e.formData=void 0;const r=e.headers.get("Content-Type");r&&-1!==r.indexOf("application/x-www-form-urlencoded")?e.body=new URLSearchParams(n).toString():r&&-1!==r.indexOf("multipart/form-data")&&e.headers.delete("Content-Type")}return t(e)}}),t.addPolicy(function(e={}){const t=I(e.userAgentPrefix);return{name:"userAgentPolicy",sendRequest:async(e,n)=>(e.headers.has("x-ms-useragent")||e.headers.set("x-ms-useragent",t),n(e))}}(e.userAgentOptions)),t.addPolicy(function(e="x-ms-client-request-id"){return{name:"setClientRequestIdPolicy",sendRequest:async(t,n)=>(t.headers.has(e)||t.headers.set(e,t.requestId),n(t))}}()),t.addPolicy(function(e={}){var t;return{name:"defaultRetryPolicy",sendRequest:N([{name:"throttlingRetryStrategy",retry({response:e}){const t=k(e);return Number.isFinite(t)?{retryAfterInMs:t}:{skipStrategy:!0}}},P(e)],{maxRetries:null!==(t=e.maxRetries)&&void 0!==t?t:3}).sendRequest}}(e.retryOptions),{phase:"Retry"}),t.addPolicy(M(e.userAgentOptions),{afterPhase:"Retry"}),t.addPolicy(function(e={}){var t;const n=null!==(t=e.logger)&&void 0!==t?t:S.info,r=new d({additionalAllowedHeaderNames:e.additionalAllowedHeaderNames,additionalAllowedQueryParameters:e.additionalAllowedQueryParameters});return{name:"logPolicy",async sendRequest(e,t){if(!n.enabled)return t(e);n("Request: "+r.sanitize(e));const o=await t(e);return n("Response status code: "+o.status),n("Headers: "+r.sanitize(o.headers)),o}}}(e.loggingOptions),{afterPhase:"Retry"}),t}var L=n(125);function U(e){const{parameterPath:t,mapper:n}=e;let r;return r="string"==typeof t?t:Array.isArray(t)?t.join("."):n.serializedName,r}function H(e={}){const t=e.stringifyXML;return{name:"serializationPolicy",async sendRequest(e,n){const r=v(e),i=null==r?void 0:r.operationSpec,s=null==r?void 0:r.operationArguments;return i&&s&&(function(e,t,n){var r,o;if(n.headerParameters)for(const r of n.headerParameters){let o=m(t,r);if(null!=o||r.mapper.required){o=n.serializer.serialize(r.mapper,o,U(r));const t=r.mapper.headerCollectionPrefix;if(t)for(const n of Object.keys(o))e.headers.set(t+n,o[n]);else e.headers.set(r.mapper.serializedName||U(r),o)}}const i=null===(o=null===(r=t.options)||void 0===r?void 0:r.requestOptions)||void 0===o?void 0:o.customHeaders;if(i)for(const t of Object.keys(i))e.headers.set(t,i[t])}(e,s,i),function(e,t,n,r=function(){throw new Error("XML serialization unsupported!")}){var i,s,a,c,u;const l=null===(i=t.options)||void 0===i?void 0:i.serializerOptions,d={xml:{rootName:null!==(s=null==l?void 0:l.xml.rootName)&&void 0!==s?s:"",includeRoot:null!==(a=null==l?void 0:l.xml.includeRoot)&&void 0!==a&&a,xmlCharKey:null!==(c=null==l?void 0:l.xml.xmlCharKey)&&void 0!==c?c:o.b}},h=d.xml.xmlCharKey;if(n.requestBody&&n.requestBody.mapper){e.body=m(t,n.requestBody);const i=n.requestBody.mapper,{required:s,serializedName:a,xmlName:c,xmlElementName:l,xmlNamespace:p,xmlNamespacePrefix:g,nullable:y}=i,v=i.type.name;try{if(void 0!==e.body&&null!==e.body||y&&null===e.body||s){const t=U(n.requestBody);e.body=n.serializer.serialize(i,e.body,t,d);const s=v===f.a.Stream;if(n.isXML){const t=g?"xmlns:"+g:"xmlns",n=function(e,t,n,r,i){if(e&&!["Composite","Sequence","Dictionary"].includes(n)){const n={};return n[i.xml.xmlCharKey]=r,n[o.a]={[t]:e},n}return r}(p,t,v,e.body,d);v===f.a.Sequence?e.body=r(function(e,t,n,r){Array.isArray(e)||(e=[e]);if(!n||!r)return{[t]:e};const i={[t]:e};return i[o.a]={[n]:r},i}(n,l||c||a,t,p),{rootName:c||a,xmlCharKey:h}):s||(e.body=r(n,{rootName:c||a,xmlCharKey:h}))}else{if(v===f.a.String&&((null===(u=n.contentType)||void 0===u?void 0:u.match("text/plain"))||"text"===n.mediaType))return;s||(e.body=JSON.stringify(e.body))}}}catch(e){throw new Error(`Error "${e.message}" occurred in serializing the payload - ${JSON.stringify(a,void 0,"  ")}.`)}}else if(n.formDataParameters&&n.formDataParameters.length>0){e.formData={};for(const r of n.formDataParameters){const o=m(t,r);if(null!=o){const t=r.mapper.serializedName||U(r);e.formData[t]=n.serializer.serialize(r.mapper,o,U(r),d)}}}}(e,s,i,t)),n(e)}}}var D=n(37),z=n(26);function $(e){return Boolean(e&&"function"==typeof e.getReader&&"function"==typeof e.tee)}class B{async sendRequest(e){if("https:"!==new URL(e.url).protocol&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");try{return await async function(e){const{abortController:t,abortControllerCleanup:n}=function(e){const t=new AbortController;let n,r;if(e.abortSignal){if(e.abortSignal.aborted)throw new R.b("The operation was aborted.");r=e=>{"abort"===e.type&&t.abort()},e.abortSignal.addEventListener("abort",r),n=()=>{var t;r&&(null===(t=e.abortSignal)||void 0===t||t.removeEventListener("abort",r))}}e.timeout>0&&setTimeout(()=>{t.abort()},e.timeout);return{abortController:t,abortControllerCleanup:n}}(e);try{const r=function(e){const t=new Headers;for(const[n,r]of e)t.append(n,r);return t}(e.headers),o=function(e){const t="function"==typeof e.body?e.body():e.body;if(function(e){return e&&"function"==typeof e.pipe}(t))throw new Error("Node streams are not supported in browser environment.");return $(t)?F(t,e.onUploadProgress):t}(e);return async function(e,t){var n,r;const o=function(e){const t=Object(z.a)();for(const[n,r]of e.headers)t.set(n,r);return t}(e),i={request:t,headers:o,status:e.status},s=$(e.body)?F(e.body,t.onDownloadProgress):e.body;if((null===(n=t.streamResponseStatusCodes)||void 0===n?void 0:n.has(Number.POSITIVE_INFINITY))||(null===(r=t.streamResponseStatusCodes)||void 0===r?void 0:r.has(i.status)))if(t.enableBrowserStreams)i.browserStreamBody=null!=s?s:void 0;else{const e=new Response(s);i.blobBody=e.blob()}else{const e=new Response(s);i.bodyAsText=await e.text()}return i}(await fetch(e.url,{body:o,method:e.method,headers:r,signal:t.signal,credentials:e.withCredentials?"include":"same-origin",cache:"no-store"}),e)}finally{n&&n()}}(e)}catch(t){throw function(e,t){var n;return e&&"AbortError"===(null==e?void 0:e.name)?e:new p("Error sending request: "+e.message,{code:null!==(n=null==e?void 0:e.code)&&void 0!==n?n:p.REQUEST_SEND_ERROR,request:t})}(t,e)}}}function F(e,t){let n=0;if(function(e){return void 0!==e.pipeThrough&&void 0!==self.TransformStream}(e))return e.pipeThrough(new TransformStream({transform(e,r){null!==e?(r.enqueue(e),n+=e.length,t&&t({loadedBytes:n})):r.terminate()}}));{const r=e.getReader();return new ReadableStream({async pull(e){var o;const{done:i,value:s}=await r.read();if(i||!s)return e.close(),void r.releaseLock();n+=null!==(o=null==s?void 0:s.length)&&void 0!==o?o:0,e.enqueue(s),t&&t({loadedBytes:n})}})}}function K(){return new B}let G;const Y={CSV:",",SSV:" ",Multi:"Multi",TSV:"\t",Pipes:"|"};function W(e,t,n,r){const o=function(e,t,n){var r;const o=new Map;if(null===(r=e.urlParameters)||void 0===r?void 0:r.length)for(const r of e.urlParameters){let i=m(t,r,n);const s=U(r);i=e.serializer.serialize(r.mapper,i,s),r.skipEncoding||(i=encodeURIComponent(i)),o.set(`{${r.mapper.serializedName||s}}`,i)}return o}(t,n,r);let i=!1,s=V(e,o);if(t.path){let e=V(t.path,o);"/{nextLink}"===t.path&&e.startsWith("/")&&(e=e.substring(1)),e.includes("://")?(s=e,i=!0):s=function(e,t){if(!t)return e;const n=new URL(e);let r=n.pathname;r.endsWith("/")||(r+="/");t.startsWith("/")&&(t=t.substring(1));const o=t.indexOf("?");if(-1!==o){const e=t.substring(0,o),i=t.substring(o+1);r+=e,i&&(n.search=n.search?`${n.search}&${i}`:i)}else r+=t;return n.pathname=r,n.toString()}(s,e)}const{queryParams:a,sequenceParams:c}=function(e,t,n){var r;const o=new Map,i=new Set;if(null===(r=e.queryParameters)||void 0===r?void 0:r.length)for(const r of e.queryParameters){"Sequence"===r.mapper.type.name&&r.mapper.serializedName&&i.add(r.mapper.serializedName);let s=m(t,r,n);if(null!=s||r.mapper.required){s=e.serializer.serialize(r.mapper,s,U(r));const t=r.collectionFormat?Y[r.collectionFormat]:"";if(Array.isArray(s)&&(s=s.map(e=>null==e?"":e)),"Multi"===r.collectionFormat&&0===s.length)continue;!Array.isArray(s)||"SSV"!==r.collectionFormat&&"TSV"!==r.collectionFormat||(s=s.join(t)),r.skipEncoding||(s=Array.isArray(s)?s.map(e=>encodeURIComponent(e)):encodeURIComponent(s)),!Array.isArray(s)||"CSV"!==r.collectionFormat&&"Pipes"!==r.collectionFormat||(s=s.join(t)),o.set(r.mapper.serializedName||U(r),s)}}return{queryParams:o,sequenceParams:i}}(t,n,r);return s=function(e,t,n,r=!1){if(0===t.size)return e;const o=new URL(e),i=function(e){const t=new Map;if(!e||"?"!==e[0])return t;const n=(e=e.slice(1)).split("&");for(const e of n){const[n,r]=e.split("=",2),o=t.get(n);o?Array.isArray(o)?o.push(r):t.set(n,[o,r]):t.set(n,r)}return t}(o.search);for(const[e,o]of t){const t=i.get(e);if(Array.isArray(t))if(Array.isArray(o)){t.push(...o);const n=new Set(t);i.set(e,Array.from(n))}else t.push(o);else t?(Array.isArray(o)?o.unshift(t):n.has(e)&&i.set(e,[t,o]),r||i.set(e,o)):i.set(e,o)}const s=[];for(const[e,t]of i)if("string"==typeof t)s.push(`${e}=${t}`);else if(Array.isArray(t))for(const n of t)s.push(`${e}=${n}`);else s.push(`${e}=${t}`);return o.search=s.length?"?"+s.join("&"):"",o.toString()}(s,a,c,i),s}function V(e,t){let n=e;for(const[e,r]of t)n=n.split(e).join(r);return n}const Q=Object(E.a)("core-client");class J{constructor(e={}){var t,n;if(this._requestContentType=e.requestContentType,this._endpoint=null!==(t=e.endpoint)&&void 0!==t?t:e.baseUri,e.baseUri&&Q.warning("The baseUri option for SDK Clients has been deprecated, please use endpoint instead."),this._allowInsecureConnection=e.allowInsecureConnection,this._httpClient=e.httpClient||(G||(G=K()),G),this.pipeline=e.pipeline||function(e){const t=function(e){if(e.credentialScopes){const t=e.credentialScopes;return Array.isArray(t)?t.map(e=>new URL(e).toString()):new URL(t).toString()}if(e.endpoint)return e.endpoint+"/.default";if(e.baseUri)return e.baseUri+"/.default";if(e.credential&&!e.credentialScopes)throw new Error("When using credentials, the ServiceClientOptions must contain either a endpoint or a credentialScopes. Unable to create a bearerTokenAuthenticationPolicy");return}(e),n=e.credential&&t?{credentialScopes:t,credential:e.credential}:void 0;return function(e={}){const t=q(null!=e?e:{});return e.credentialOptions&&t.addPolicy(Object(L.a)({credential:e.credentialOptions.credential,scopes:e.credentialOptions.credentialScopes})),t.addPolicy(H(e.serializationOptions),{phase:"Serialize"}),t.addPolicy(w(e.deserializationOptions),{phase:"Deserialize"}),t}(Object.assign(Object.assign({},e),{credentialOptions:n}))}(e),null===(n=e.additionalPolicies)||void 0===n?void 0:n.length)for(const{policy:t,position:n}of e.additionalPolicies){const e="perRetry"===n?"Sign":void 0;this.pipeline.addPolicy(t,{afterPhase:e})}}async sendRequest(e){return this.pipeline.sendRequest(this._httpClient,e)}async sendOperationRequest(e,t){const n=t.baseUrl||this._endpoint;if(!n)throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a endpoint string property that contains the base URL to use.");const o=W(n,t,e,this),i=Object(r.a)({url:o});i.method=t.httpMethod;const s=v(i);s.operationSpec=t,s.operationArguments=e;const a=t.contentType||this._requestContentType;a&&t.requestBody&&i.headers.set("Content-Type",a);const c=e.options;if(c){const e=c.requestOptions;e&&(e.timeout&&(i.timeout=e.timeout),e.onUploadProgress&&(i.onUploadProgress=e.onUploadProgress),e.onDownloadProgress&&(i.onDownloadProgress=e.onDownloadProgress),void 0!==e.shouldDeserialize&&(s.shouldDeserialize=e.shouldDeserialize),e.allowInsecureConnection&&(i.allowInsecureConnection=!0)),c.abortSignal&&(i.abortSignal=c.abortSignal),c.tracingOptions&&(i.tracingOptions=c.tracingOptions)}this._allowInsecureConnection&&(i.allowInsecureConnection=!0),void 0===i.streamResponseStatusCodes&&(i.streamResponseStatusCodes=function(e){const t=new Set;for(const n in e.responses){const r=e.responses[n];r.bodyMapper&&r.bodyMapper.type.name===f.a.Stream&&t.add(Number(n))}return t}(t));try{const e=await this.sendRequest(i),n=Object(D.a)(e,t.responses[e.status]);return(null==c?void 0:c.onResponse)&&c.onResponse(e,n),n}catch(e){if("object"==typeof e&&(null==e?void 0:e.response)){const n=e.response,r=Object(D.a)(n,t.responses[e.statusCode]||t.responses.default);e.details=r,(null==c?void 0:c.onResponse)&&c.onResponse(n,r,e)}throw e}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));const r={span:Symbol.for("@azure/core-tracing span"),namespace:Symbol.for("@azure/core-tracing namespace")};function o(e={}){let t=new i(e.parentContext);return e.span&&(t=t.setValue(r.span,e.span)),e.namespace&&(t=t.setValue(r.namespace,e.namespace)),t}class i{constructor(e){this._contextMap=e instanceof i?new Map(e._contextMap):new Map}setValue(e,t){const n=new i(this);return n._contextMap.set(e,t),n}getValue(e){return this._contextMap.get(e)}deleteValue(e){const t=new i(this);return t._contextMap.delete(e),t}}let s;function a(){return s||(s={createRequestHeaders:()=>({}),parseTraceparentHeader:()=>{},startSpan:(e,t)=>({span:{end:()=>{},isRecording:()=>!1,recordException:()=>{},setAttribute:()=>{},setStatus:()=>{}},tracingContext:o({parentContext:t.tracingContext})}),withContext:(e,t,...n)=>t(...n)}),s}function c(e){const{namespace:t,packageName:n,packageVersion:o}=e;function i(e,i,s){var c;const u=a().startSpan(e,Object.assign(Object.assign({},s),{packageName:n,packageVersion:o,tracingContext:null===(c=null==i?void 0:i.tracingOptions)||void 0===c?void 0:c.tracingContext}));let l=u.tracingContext;const d=u.span;l.getValue(r.namespace)||(l=l.setValue(r.namespace,t)),d.setAttribute("az.namespace",l.getValue(r.namespace));return{span:d,updatedOptions:Object.assign({},i,{tracingOptions:Object.assign(Object.assign({},null==i?void 0:i.tracingOptions),{tracingContext:l})})}}function s(e,t,...n){return a().withContext(e,t,...n)}return{startSpan:i,withSpan:async function(e,t,n,r){const{span:o,updatedOptions:a}=i(e,t,r);try{const e=await s(a.tracingOptions.tracingContext,()=>Promise.resolve(n(a,o)));return o.setStatus({status:"success"}),e}catch(e){throw o.setStatus({status:"error",error:e}),e}finally{o.end()}},withContext:s,parseTraceparentHeader:function(e){return a().parseTraceparentHeader(e)},createRequestHeaders:function(e){return a().createRequestHeaders(e)}}}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(47);function o(e){return Object(r.a)(e,["name","key"])&&"string"==typeof e.key&&"string"==typeof e.name}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(47);function o(e){return Object(r.a)(e,["signature"])&&"string"==typeof e.signature}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(34);const o={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:12e4};function i(e,t){let n,i=null,s=null;const a=Object.assign(Object.assign({},o),t),c={get isRefreshing(){return null!==i},get shouldRefresh(){var e;return!c.isRefreshing&&(null!==(e=null==s?void 0:s.expiresOnTimestamp)&&void 0!==e?e:0)-a.refreshWindowInMs<Date.now()},get mustRefresh(){return null===s||s.expiresOnTimestamp-a.forcedRefreshWindowInMs<Date.now()}};function u(t,o){var u;if(!c.isRefreshing){i=async function(e,t,n){async function o(){if(!(Date.now()<n)){const t=await e();if(null===t)throw new Error("Failed to refresh access token.");return t}try{return await e()}catch(e){return null}}let i=await o();for(;null===i;)await Object(r.a)(t),i=await o();return i}(()=>e.getToken(t,o),a.retryIntervalInMs,null!==(u=null==s?void 0:s.expiresOnTimestamp)&&void 0!==u?u:Date.now()).then(e=>(i=null,s=e,n=o.tenantId,s)).catch(e=>{throw i=null,s=null,n=void 0,e})}return i}return async(e,t)=>n!==t.tenantId||c.mustRefresh?u(e,t):(c.shouldRefresh&&u(e,t),s)}async function s(e){const{scopes:t,getAccessToken:n,request:r}=e,o={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions},i=await n(t,o);i&&e.request.headers.set("Authorization","Bearer "+i.token)}function a(e){var t;const{credential:n,scopes:r,challengeCallbacks:o,logger:a}=e,c=Object.assign({authorizeRequest:null!==(t=null==o?void 0:o.authorizeRequest)&&void 0!==t?t:s,authorizeRequestOnChallenge:null==o?void 0:o.authorizeRequestOnChallenge},o),u=n?i(n):()=>Promise.resolve(null);return{name:"bearerTokenAuthenticationPolicy",async sendRequest(e,t){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");let n,o;await c.authorizeRequest({scopes:Array.isArray(r)?r:[r],request:e,getAccessToken:u,logger:a});try{n=await t(e)}catch(e){o=e,n=e.response}if(c.authorizeRequestOnChallenge&&401===(null==n?void 0:n.status)&&function(e){const t=e.headers.get("WWW-Authenticate");if(401===e.status&&t)return t}(n)){if(await c.authorizeRequestOnChallenge({scopes:Array.isArray(r)?r:[r],request:e,response:n,getAccessToken:u,logger:a}))return t(e)}if(o)throw o;return n}}}}]);